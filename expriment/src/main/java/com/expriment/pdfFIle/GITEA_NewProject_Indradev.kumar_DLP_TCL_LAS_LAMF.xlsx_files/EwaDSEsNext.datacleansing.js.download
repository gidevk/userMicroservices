'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[28],{1166:function(r,B,a){a.d(B,"a",function(){return b});r=a(0);B=a(735);var c=a(718);class b extends B.a{constructor(){super();this.worksheetId=null;this.bottom=this.right=this.top=this.left=0;this.H_=Object.assign(new c.a,{T_:b.getTypeName(),B_:b.Pd()})}static getTypeName(){return"AugLoop_ExcelTableAi_ExcelRangeAddressNew"}static Pd(){return[]}}Object(r.a)(b,"ExcelRangeAddressNew",B.a,[])},1167:function(r,B,a){a.d(B,
"a",function(){return c});r=a(0);class c{constructor(b,e,f,d,h,l){this.PD=b;this.confidence=e;this.headerRowCount=f;this.headerColumnCount=d;this.orientation=h;this.fields=l}}Object(r.a)(c,"TableInterpretation",null,[])},1199:function(r,B,a){var c=a(9);r=a(0);var b=a(15),e=a(228),f=a(50),d=a(38),h=a(7),l=a(178),k=a(741),w=a(718);class n extends k.a{constructor(){super();this.hasMergedcells=this.tableName=this.interpretations=this.range=null;this.H_=Object.assign(new w.a,{T_:n.getTypeName(),B_:n.Pd()})}static getTypeName(){return"AugLoop_ExcelTableAi_ExcelRecognizedTableNew"}static Pd(){return["AugLoop_Core_Annotation"]}}
Object(r.a)(n,"ExcelRecognizedTableNew",k.a,[]);class x extends n{constructor(){super();this.requestId=null;this.H_=Object.assign(new w.a,{T_:x.getTypeName(),B_:x.Pd()})}static getTypeName(){return"AugLoop_ExcelTableai_ExcelRangeMetadata"}static Pd(){return["AugLoop_ExcelTableAi_ExcelRecognizedTableNew","AugLoop_Core_Annotation"]}}Object(r.a)(x,"ExcelRangeMetadata",n,[]);k=a(1324);class m extends k.a{constructor(){super();this.value=null;this.type=0;this.H_=Object.assign(new w.a,{T_:m.getTypeName(),
B_:m.Pd()})}static getTypeName(){return"AugLoop_ExcelTableai_ExtendedExcelCell"}static Pd(){return["AugLoop_Excel_ExcelCell","AugLoop_Core_GridCell"]}}Object(r.a)(m,"ExtendedExcelCell",k.a,[]);k=a(840);class u extends k.a{constructor(){super();this.mergeCellAddresses=this.requestId=this.cells=this.range=null;this.H_=Object.assign(new w.a,{T_:u.getTypeName(),B_:u.Pd()})}static getTypeName(){return"AugLoop_ExcelTableai_RangeDataSignal"}static Pd(){return["AugLoop_Signals_Signal"]}}Object(r.a)(u,"RangeDataSignal",
k.a,[]);var t=a(1166),y=a(103);k=a(39);var v=a(1),A=a(22),z=a(21);class C extends Sys.EventArgs{constructor(L){super();this.VJb=L}}Object(r.a)(C,"RecognizedTableUpdateEventArgs",Sys.EventArgs,[]);var H=a(197),I=a(24),S=a(350);class P{constructor(L,fa,wa,oa){this.Ry=L;this.interpretations=fa;this.tableName=wa;this.id=oa}}Object(r.a)(P,"RecognizedTable",null,[]);class D{constructor(L,fa,wa){this.classification=L;this.aggregations=fa;this.headerReferences=wa}}Object(r.a)(D,"TableField",null,[]);var G=
a(1167);const E=L=>{var fa=new S.a(O(L.range),L.range.worksheetId);var wa=L.interpretations;var oa=new H.a;if(wa&&wa.length)for(const ta of wa){b:switch(ta.orientation.toLowerCase()){case "columnmajor":wa=2;break b;case "rowmajor":wa=1;break b;default:b.ULS.sendTraceTag(537151256,0,50,"Invalid value for table orientaion."),wa=0}const Ya=wa;if(0===Ya)b.ULS.sendTraceTag(537151257,0,50,"Invalid value for table orientaion. Skipping current interpretation.");else{wa=G.a;var xa=O(ta.location),bb=ta.confidence,
Za=ta.headerRowCount,La=ta.headerColumnCount;var va=ta.fields;var Ba=new H.a;if(va)for(const Da of va){va=Ba;var Ea=va.add;c:switch(Da.classification.toLowerCase()){case "dimension":var pa=1;break c;case "measure":pa=2;break c;default:b.ULS.sendTraceTag(537151255,0,50,"Invalid value %s for field classification."),pa=0}var $a=Da.aggregations;var cb=new H.a;if($a)for(const ba of $a)switch(ba.toLowerCase()){case "sum":cb.add(0);break;case "count":cb.add(1);break;case "average":cb.add(2);break;case "min":cb.add(3);
break;case "max":cb.add(4);break;case "distinctcount":cb.add(5);break;case "stddev":cb.add(6);break;case "variance":cb.add(7);break;default:b.ULS.sendTraceTag(537151254,0,50,"Invalid value for aggregation type.")}$a=cb;var ib=Da.headerReferences;cb=new H.a;if(ib)for(const ba of ib)ib=new I.Range(ba.top,ba.left,ba.top,ba.left,!1,!1),cb.add(ib);Ea.call(va,new D(pa,$a,cb))}wa=new wa(xa,bb,Za,La,Ya,Ba);oa.add(wa)}}return new P(fa,oa,L.tableName,L.id,L.hasMergedcells)},O=L=>new I.Range(L.top,L.left,L.bottom,
L.right,!1,!1);class N{constructor(L,fa){this.kGc=0;this.sy=new Map;this.eqd=!1;this.tableIntelligenceManager=L;this.augmentationLoopManager=fa;this.tableIntelligenceManager.CZa("Valid",this.z5i.bind(this));this.tableIntelligenceManager.CZa("Invalid",this.d_i.bind(this));v.EwaSettings.isChangeGateEnabled("OfficeVSO:7408706_QueryManagerCoauthVersionChecking")&&this.augmentationLoopManager.hqe(this.uUi.bind(this))}F5a(L,fa,wa){if(!this.sy)return b.ULS.sendTraceTag(521025344,306,10,"Recognized table is null"),
[];let oa=fa;v.EwaSettings.isChangeGateEnabled("OfficeVSO:7408706_QueryManagerCoauthVersionChecking")&&void 0!==wa&&this.kGc>wa&&(b.ULS.sendTraceTag(509681793,306,50,`getRecognizedTables: maxRevisions: ${wa}, versionChanges: ${this.kGc}`),oa=fa^4);return this.sy.has(L.sheetId)?(fa=this.sy.get(L.sheetId).filter(xa=>xa.table.Ry.range.vd(L.range)&&(oa&xa.BFb)==xa.BFb),b.ULS.sendTraceTag(509681792,306,50,`getRecognizedTables: foundRecords: ${fa.length}`),fa):[]}z5i(L,fa){if(this.sy){if(!this.eqd){for(const [wa,
oa]of this.sy)oa.every(xa=>4===xa.BFb)?this.sy.delete(wa):this.sy.set(wa,oa.filter(xa=>4!==xa.BFb));this.eqd=!0}L=fa.VJb;this.sy.has(L.Ry.sheetId)||this.sy.set(L.Ry.sheetId,[]);this.sy.get(L.Ry.sheetId).push({table:L,BFb:2});this.kGc=0}else b.ULS.sendTraceTag(521025315,306,10,"Recognized table is null")}d_i(L,fa){this.eqd=!1;L=fa.VJb;if(this.sy)if(this.sy.has(L.Ry.sheetId))for(const wa of this.sy.get(L.Ry.sheetId))wa.table.id===fa.VJb.id&&(wa.BFb=4);else b.ULS.debugAssertTag(522981602,306,!1,"No recognized tables for sheet");
else b.ULS.sendTraceTag(521025314,306,10,"Recognized table is null")}uUi(){this.kGc++}}Object(r.a)(N,"TableIntelligenceQueryManager",null,[286]);class J{}Object(r.a)(J,"RecognizedTableLog",null,[]);class W{}Object(r.a)(W,"Interpretation",null,[]);class ea{constructor(L){this.sy=new Map;this.J1b=void 0;this.Upb=new Set;this.HGb=void 0;this.tableIntelligenceManager=L}etg(){this.HGb?b.ULS.shipAssertTag(522303246,306,!1,"LogXlimRecognizedTables should not be called twice."):(this.HGb=this.zDd.bind(this),
this.tableIntelligenceManager.CZa("Valid",this.HGb))}kIi(L){L=this.q0(L);b.ULS.sendTraceTag(521233111,306,15,`${JSON.stringify(L)}`)}zDd(L,fa){L=fa.VJb;v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",!1)&&(this.Upb&&this.sy?(this.Upb.has(L.id)||(this.oOg(L),this.Upb.add(L.id)),this.J1b||(this.J1b=window.setTimeout(this.z6.bind(this),2E3))):b.ULS.sendTraceTag(522303245,306,15,`AnnotationId set or recognized table store is null. annotationIdSet = ${!!this.Upb}, recognizedTableStore = ${!!this.sy}`))}z6(){for(const [,
L]of this.sy)b.ULS.sendTraceTag(521233110,306,15,JSON.stringify(L));window.clearTimeout(this.J1b);this.Upb=this.J1b=void 0;this.sy.clear();this.sy=void 0;this.tableIntelligenceManager.jnj(this.HGb);this.HGb=void 0}oOg(L){const fa=L.Ry.sheetId;this.sy.has(fa)||this.sy.set(fa,[]);this.sy.get(fa).push(this.q0(L))}q0(L){const fa=[];for(const wa of L.interpretations){let oa=0,xa=0;for(const bb of wa.fields)1===bb.classification?oa++:2===bb.classification&&xa++;fa.push({confidence:wa.confidence,headerRowCount:wa.headerRowCount,
headerColumnCount:wa.headerColumnCount,orientation:wa.orientation,measureCount:xa,dimensionCount:oa})}return{interpretations:fa,range:{top:L.Ry.range.top,bottom:L.Ry.range.bottom,left:L.Ry.range.left,right:L.Ry.range.right},isTable:!!L.tableName,annotationId:L.id}}}Object(r.a)(ea,"RecognizedTableLogger",null,[]);class R extends k.a{constructor(L,fa){super();this.Yic=this.zkf=!1;this.ave={};this.instantaneousSupportInformationManager=null;this.wLd=void 0;this.Xuf=!1;this.oHh=(wa,oa)=>{var xa;1===oa.operationType&&
((oa=oa.VG)?(b.ULS.sendTraceTag(537151251,306,50,`TableIntelligenceManager::ExcelRangeMetadataHandler called for requestID = ${oa.requestId}`),wa=E(oa),v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",!1)&&(null===(xa=this.wLd)||void 0===xa?void 0:xa.kIi(wa)),({value:xa}=this.RWd.Ic(oa.requestId)).returnValue?(this.RWd.remove(oa.requestId),xa(wa)):b.ULS.sendTraceTag(537151250,306,10,`TableIntelligenceManager::ExcelRangeMetadataHandler Callback not found for requestId = ${oa.requestId}`)):
b.ULS.sendTraceTag(537151252,306,10,"TableIntelligenceManager::ExcelRangeMetadataHandler excelRangeMetadata is null."))};this.dLg=(wa,oa)=>{this.ORf("RecognizedTableUpdate",oa)};this.augmentationLoopManager=L;this.$=fa;this.RWd=new y.a;this.$.da.Ha(20,this);v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",!1)&&(this.wLd=new ea(this))}pwa(){this.OCc||(this.OCc=new N(this,this.augmentationLoopManager));return this.OCc}H1h(L,fa){if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:6648526_LimitCellsInSignal")&&
1E4<L.range.hw)return b.ULS.sendTraceTag(520501002,306,15,`Signal with range size of ${L.range.hw} exceeds limit of ${1E4}`),4;this.xKg();if(this.Ywi(L.range))return this.Z4h(L,fa);b.ULS.sendTraceTag(537151253,306,15,"Range is not completely contained within the viewport");return 2}BRg(L){this.yKg();this.addHandler("RecognizedTableUpdate",L);this.Ygf()}Npj(L){this.removeHandler("RecognizedTableUpdate",L)}CZa(L,fa){var wa,oa;v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceSheetCountThreshold",
!1)&&(null===(oa=null===(wa=this.$)||void 0===wa?void 0:wa.ua)||void 0===oa?0:oa.count)&&this.$.ua.count>v.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.TableIntelligenceSheetCountThresholdValue",100)?b.ULS.sendTraceTag(520720838,306,15,`TableIntelligenceManager::addRecognizedTableAnnotationCallback Exceeded max sheet count threshold. SheetCount ${this.$.ua.count}`):(this.ave[L]||(this.Yic||(this.augmentationLoopManager.mZa(n.getTypeName()),this.Yic=!0),this.augmentationLoopManager.D2.s2(L,
n.getTypeName(),(xa,bb)=>this.ORf(this.Szd(L),bb)),this.ave[L]=!0),this.rNg(L,fa),this.Ygf())}jnj(L){this.removeHandler(this.Szd("Valid"),L)}rNg(L,fa){this.addHandler(this.Szd(L),fa)}ikj(){v.EwaSettings.xa(259)&&v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligence",!1)&&(this.augmentationLoopManager.mZa(n.getTypeName()),this.augmentationLoopManager.s2(n.getTypeName(),this.dLg))}hkj(){this.augmentationLoopManager.mZa(x.getTypeName());this.augmentationLoopManager.s2(x.getTypeName(),
this.oHh)}yKg(){var L,fa;v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceSheetCountThreshold",!1)&&(null===(fa=null===(L=this.$)||void 0===L?void 0:L.ua)||void 0===fa?0:fa.count)&&this.$.ua.count>v.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.TableIntelligenceSheetCountThresholdValue",100)?b.ULS.sendTraceTag(520720837,306,15,`TableIntelligenceManager::addRecognizedTableAnnotationCallback Exceeded max sheet count threshold. SheetCount ${this.$.ua.count}`):this.Yic||
(this.ikj(),this.Yic=!0)}xKg(){this.zkf||(this.zkf=!0,this.hkj())}ORf(L,fa){1===fa.operationType&&((fa=fa.VG)?(fa=E(fa),this.raiseEvent(L,new C(fa))):b.ULS.sendTraceTag(523772681,306,10,"TableIntelligenceManager::processAndRaiseExcelRecognizedTableAnnotationReceivedEvent ExcelRecognizedTable is null."))}Szd(L){return`${"RecognizedTableUpdate"}_${L}`}Z4h(L,fa){b.ULS.sendTraceTag(537151248,306,15,"On-Demand Metadata Triggered");const wa=L.range,oa=z.h(this.$).Qj("TableIntelligence",wa,1),xa=[],bb=[];
let Za=0;const La=v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",!1),va=v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceNumberFormatEnabled",!1);for(va&&!this.instantaneousSupportInformationManager&&this.$.da.hb(268,Ba=>{this.instantaneousSupportInformationManager=Ba});oa.$$mn();){const Ba=oa.$$cu();if(!Ba)continue;if(0===Ba.Nr.type&&A.a.Pq(Ba.Nr.value))continue;Ba.NH&&Ba.range&&bb.push(Object(h.a)(new t.a,{worksheetId:L.sheetId,
left:Ba.range.left-1,top:Ba.range.top-1,right:Ba.range.right-1,bottom:Ba.range.bottom-1}));const Ea=Ba.range.top-1,pa=Ba.range.left-1;let $a=null,cb=null;va&&({category:cb}=this.instantaneousSupportInformationManager.FCa(Ba.cell.Ci,!0),Ba.text!=Ba.Nr.value&&($a=Ba.text,La&&Za++));xa.push(Object.assign(new m,{row:Ea,column:pa,value:Ba.Nr.value,type:Ba.Nr.type,displayText:$a,Rdk:cb}))}La&&b.ULS.sendTraceTag(526260166,306,50,`TableIntelligenceManager::getRangeDataFromGrid requests non-null displayText: ${Za}, number of values: ${xa.length}, range size: ${wa.height} rows by ${wa.width} columns`);
if(0<xa.length)return this.rjh(xa,L,bb,fa),bb.length?5:0;b.ULS.sendTraceTag(537151247,306,15,"All cells in range were empty");return 3}rjh(L,fa,wa,oa){var xa=fa.range;xa=Object(h.a)(new t.a,{top:xa.top,left:xa.left,bottom:xa.bottom,right:xa.right,worksheetId:fa.sheetId});fa=l.a.create().toString();L=Object(h.a)(new u,{cells:L,range:xa,mergeCellAddresses:wa,requestId:fa});this.augmentationLoopManager.mPb(L);this.RWd.add(fa,oa)}Ywi(L){const fa=z.h(this.$);if(v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",
!1)){const wa=fa.Yja();b.ULS.sendTraceTag(520501001,306,50,`viewportWidth: ${wa.width}, viewportHeight: ${wa.height}`)}return fa.Ca.hN(4,this.$.na)&&!!fa.Jb(L.topLeft)&&!!fa.Jb(L.bottomLeft)&&!!fa.Jb(L.topRight)&&!!fa.Jb(L.bottomRight)}Ygf(){var L;!this.Xuf&&v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",!1)&&(this.Xuf=!0,null===(L=this.wLd)||void 0===L?void 0:L.etg())}}Object(r.a)(R,"TableIntelligenceManager",k.a,[3,265]);class Y extends e.a{constructor(L){super();
this.$=L;this.Gb()}create(){d.TaskExtensions.za(f.GetServiceTaskFactory.Pa(this.$.da,328,327,1),L=>{if(L=L.result){let fa=this.$.da.Ba(20);fa||(fa=new R(L,this.$),this.$.da.Ha(20,fa));this.qb(fa)}else b.ULS.sendTraceTag(537151246,306,10,"AugmentationLoopManager instance null. Can not create TableIntelligenceManager instance. Creating null service event."),this.qb(null)},this.$.ka,3)}static la(L){L.da.Ha(404,new Y(L))}}Object(r.a)(Y,"TableIntelligenceManagerFactory",e.a,[]);class U{constructor(L,fa){this.bve=
!1;this.tableIntelligenceManager=L;v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EnableGridHighlights",!1)&&void f.GetServiceTaskFactory.n4(fa.da,510,511,1);this.tableIntelligenceManager.CZa("Valid",()=>{this.bve||(b.ULS.sendTraceTag(526979921,0,15,"Received annotation with interpretations"),this.bve=!0)})}}Object(r.a)(U,"TableIntelligenceDarkActivationManager",null,[264]);var da=a(717);class T extends e.a{constructor(L){super();this.$=L;this.Gb()}static la(L){L.da.Ha(481,new T(L))}create(){const L=
f.GetServiceTaskFactory.Pa(this.$.da,20,404,1);d.TaskExtensions.za(L,()=>{const fa=L.result,wa=Object(da.a)(this.$.da,480,()=>new U(fa,this.$));this.qb(wa)},this.$.ka,3)}}Object(r.a)(T,"TableIntelligenceDarkActivationManagerFactory",e.a,[]);a.d(B,"a",function(){return ka});const ka=()=>{c.a.Fa(L=>{Y.la(L);T.la(L)})}},1292:function(r,B,a){var c=a(9);r=a(0);var b=a(228),e=a(15),f=a(39),d=a(1);class h extends f.a{constructor(){super()}j0d(n,x){e.ULS.sendTraceTag(537154185,0,50,`ProactiveSuggestionManager.TriggerProactiveSuggestion: proactive suggestion was triggered. Range: ${n}, TriggerType: ${x}`);
if(d.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.DataCleansingProactiveSuggestion",!1))switch(x){case 0:this.raiseEvent("pssort",void 0,n);break;case 1:this.raiseEvent("psfilter",void 0,n);break;case 2:this.raiseEvent("pscrttbl",void 0,n)}}}Object(r.a)(h,"ProactiveSuggestionManager",f.a,[266]);var l=a(717);class k extends b.a{constructor(n){super();this.$=n;this.Gb()}create(){let n=Object(l.a)(this.$.da,476,()=>new h);this.qb(n)}static la(n){n.da.Ha(475,new k(n))}}Object(r.a)(k,
"ProactiveSuggestionManagerFactory",b.a,[]);a.d(B,"a",function(){return w});const w=()=>{c.a.Fa(n=>{k.la(n)})}},1467:function(r,B,a){function c(qb,Kb=U.a.zb){return Y.b(qb.Yc(-1502853784,Kb,12,null))}function b(qb,Kb){qb.Yc(2105621672,U.a.zb,12,{onClose:Kb})}function e(qb,Kb="DataCleansingTaskPane"){qb.Yc(802602464,U.a.zb,12,{[da.a.VJ]:Kb})}function f(qb){if(I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CleanDataSurvey",!1)){const Kb=R.has(0),jc=R.has(1);Kb&&!jc&&qb.Yc(2063144036,-1,
0,null)}}function d(qb,Kb,jc,Ac=cb){const {RA:Jc,success:hd}=qb.zNh(jc,Kb,Ac.width,Ac.font);return hd?Jc:(E.ULS.sendTraceTag(512508562,0,10,"formatValue: Failed to acquire friendly format string"),"")}function h(qb,Kb){return Object(G.a)(this,void 0,void 0,function*(){if(Object(bb.m)(qb.na)){const jc=qb.na.sheetProcessedData;Object(ib.a)(jc);return Kb.map(Ac=>Ea(Ac,!0)).filter(Ac=>jc.value.rCb(Ac))}return[]})}function l(qb){return qb.reduce((Kb,jc)=>{var Ac=jc.tableRange;jc=jc.suggestions;Ac&&jc&&
(Ac=Ea(Ac,!1).ZC(!1),Kb[Ac]=k(Kb[Ac],jc));return Kb},{})}function k(qb,Kb){return Kb.reduce((jc,{type:Ac})=>{Ac in jc?jc[Ac]++:Ac&&(jc[Ac]=1);return jc},null!==qb&&void 0!==qb?qb:{})}function w(qb,Kb,jc){return Object(G.a)(this,void 0,void 0,function*(){try{switch(null===Kb||void 0===Kb?void 0:Kb.type){case 0:return n(qb,Kb,jc);case 2:return m(qb,Kb,jc);case 1:return x(qb,Kb,jc);default:E.ULS.sendTraceTag(509617686,0,10,`applySuggestion: Unknown suggestion type ${null===Kb||void 0===Kb?void 0:Kb.type}`)}}catch(Ac){E.ULS.sendTraceTag(509617685,
0,10,`applySuggestion: ${Ac}`)}return null})}function n(qb,Kb,jc){return Object(G.a)(this,void 0,void 0,function*(){const Ac=Kb.variations.filter(Lc=>Lc.isSelected&&Lc.value!==Kb.replacementValue).map(Lc=>Lc.value),Jc={["SheetName"]:qb.na.sheetName,["MatchCase"]:!1,["MatchEntireCell"]:!1,["SearchAllSheets"]:!1,["ExcludeFormulaResult"]:!1,["SearchUp"]:!1,["SearchStrings"]:Ac},{oFd:hd,nFd:Cd,DGd:ac}=u(Kb);Object(Z.a)(qb.userOperationManager,(Lc,rd,Yd)=>Eb.x(qb.pa.va,Jc,Object(V.u)(qb.na.sheetName,null,
jc),Kb.replacementValue,Object(ja.b)(Lc,hd),Object(ja.a)(rd,Cd),Yd,null),Lc=>new la.a(258,0,Lc),null);yield ac;return{result:Ac.length,successful:!0}})}function x(qb,Kb,jc){return Object(G.a)(this,void 0,void 0,function*(){if(null===jc||void 0===jc||!jc.length)return E.ULS.sendTraceTag(509617684,0,10,"applyNumberFormatInconsistencySuggestion: empty changeRanges."),Promise.resolve({result:0,successful:!1});const Ac=Object(V.u)(qb.na.sheetName,null,jc),Jc={},hd=Kb.formats.find(({key:ie})=>ie===Kb.replacementFormat).format;
Jc.NumberFormatOptions=Object(ea.a)(new ba.a,{NumberFormatCategory:-1,CustomFormatString:hd});Jc.ValidMembers=32;Jc.NumberFormat=15;const Cd=Object(V.o)(pa.h(qb).ha.ra.activeCell,qb),ac=qb.pa.va.$b({ima:!0,$ka:1}),{oFd:Lc,nFd:rd,DGd:Yd}=u(Kb);Object(Z.a)(qb.userOperationManager,(ie,Je,ff)=>ua.l(qb.pa.va,Ac,Cd,Jc,!1,null,null,!0,!1,Object(ja.b)(ie,Lc),Object(ja.a)(Je,rd),ff,null,ac,null),ie=>new la.a(11,0,ie),null);yield Yd;return{result:-1,successful:!0}})}function m(qb,Kb,jc){return Object(G.a)(this,
void 0,void 0,function*(){const {oFd:Ac,nFd:Jc,DGd:hd}=u(Kb);Object(Z.a)(qb.userOperationManager,(Cd,ac,Lc)=>{var rd=qb.pa.va,Yd=Object(V.u)(qb.activeItemName,null,jc);a:{var ie=Kb.extraSpacesType;switch(ie){case 0:ie=1;break a;case 2:ie=2;break a;case 1:ie=4;break a;default:throw E.ULS.sendTraceTag(509617683,0,10,`ConvertExtraSpacesTypeToTrimWhitespaceType: Unknown ExtraSpacesPaddingType ${ie}`),Error.argument("illegal ExtraSpacesPaddingType");}}return eb(rd,Yd,ie,Object(ja.b)(Cd,Ac),Object(ja.a)(ac,
Jc),Lc,null)},Cd=>new la.a(253,0,Cd),null);return{result:(yield hd).Result,successful:!0}})}function u(qb){const Kb=new Da.a;return{oFd(jc){if(jc&&ya.a.Zf(jc.Errors))E.ULS.sendTraceTag(509617682,0,10,`DataCleansing onOperationSuccess: Ewa result contains error messages after applying type [${qb.type}]`),Kb.setResult(null);else{var Ac=E.ULS,Jc=Ac.sendTraceTag,hd=qb.type;var Cd=(Cd=qb.tableName)?Cd.includes(":")?"Range":"Ctrl-T":"";Jc.call(Ac,537163359,0,20,`DataCleansing onOperationSuccess: Suggestion of type [${hd}] applied successfully in tableType [${Cd}]`);
Kb.setResult(jc)}},nFd(jc){E.ULS.sendTraceTag(509617681,0,10,`DataCleansing onOperationFailed: Ewa result contains error messages for type [${qb.type}], HttpStatus [${jc.data.httpStatus}]`);Kb.setResult(null)},DGd:Y.d(Kb.task)}}function t(qb){return qb.find(Kb=>ab.a.eAd(Kb,[Aa.getTypeName()]))}function y(qb){return qb.filter(Kb=>ab.a.eAd(Kb,[za.getTypeName()]))}function v({level:qb,methodName:Kb,message:jc,Ffg:Ac="Table",jdk:Jc=0,dataFields:hd={},DF:Cd="OnDemand",fields:ac={}}){if(I.EwaSettings.isChangeGateEnabled("OfficeVSO:7288724_SmartViewEnableRecordLog"))switch(hd=
Object.assign({},hd),hd.Method=Kb,hd.Message=jc,hd.SuggestionType=Ac,hd.MetadataType=Cd,hd.Fields=ac,Kb=Pb.a.Ec(hd),qb){case 50:E.ULS.sendTraceTag(509752733,Jc,50,Kb);break;case 15:E.ULS.sendTraceTag(509752732,Jc,15,Kb);break;case 10:E.ULS.sendTraceTag(509752731,Jc,10,Kb)}}a.r(B);var A=a(517),z=a(9),C=a(0),H=a(714),I=a(1),S=a(196),P=a(58);class D{constructor(qb,Kb){this.$=qb;this.$Nf=Kb}Mc(){return!1}executeCommand(qb,Kb,jc){qb=!0;switch(Kb.command){case -1190551534:0!==I.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.DataCleansingTaskPaneDiscoverability",
0)&&(null===jc||void 0===jc?0:jc.discoverabilityOptions)?void this.$Nf.wKe(jc.discoverabilityOptions):void this.$Nf.wKe();break;default:qb=!1}return qb?P.Task.Ta(!0):S.a(Kb.command)}Ac(qb,Kb){return-1190551534===Kb.command&&I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingTaskPane",!1)}Rc(){return!1}}Object(C.a)(D,"DataCleansingCommandHandler",null,[222]);var G=a(155),E=a(15),O=a(33),N=a(1356),J=a(183),W=a(14),ea=a(7);const R=new Set;var Y=a(108),U=a(73),da=a(5);class T{constructor(qb,
Kb){this.type="DataCleansingStatefulTaskPaneProps";this.annotations=[];this.callbacks=qb;this.hostAppCallbacks=Kb}}Object(C.a)(T,"TaskpaneProps",null,[306]);class ka{constructor(qb,Kb,jc){this.Uc=qb;this.pCb=!1;this.IB=Object(ea.a)(new N.a,{width:330,title:W.a.instance.ga(1303),onOpen:()=>{this.pCb=!0;R.clear();E.ULS.sendTraceTag(510247821,0,20,"DataCleansingTaskpane.onOpen")},onClose:()=>{this.pCb=!1;this.Eeb({discoverability:void 0});f(this.Uc);E.ULS.sendTraceTag(510247820,0,20,"DataCleansingTaskpane.onClose")},
onHide:()=>{this.pCb=!1;f(this.Uc);E.ULS.sendTraceTag(510247819,0,20,"DataCleansingTaskpane.onHide")},onShow:()=>{this.pCb=!0;R.clear();E.ULS.sendTraceTag(510247818,0,20,"DataCleansingTaskpane.onShow")}});this.IB.contentProps=new T(Kb,jc)}Eeb(qb){Object.assign(this.IB.contentProps,qb);void this.render()}render(){return Object(G.a)(this,void 0,void 0,function*(){if(this.pCb){const qb=yield J.UISurfaces.mj();qb.updateTaskPane("DataCleansingStatefulTaskPane",this.IB);qb.setSelectedTaskPane("DataCleansingStatefulTaskPane")}})}show(){return Object(G.a)(this,
void 0,void 0,function*(){(yield J.UISurfaces.mj()).showTaskPane("DataCleansingStatefulTaskPane",this.IB)})}hide(){return Object(G.a)(this,void 0,void 0,function*(){(yield J.UISurfaces.mj()).hideTaskPane("DataCleansingStatefulTaskPane",this.IB.location)})}}Object(C.a)(ka,"DataCleansingTaskpane",null,[]);var L=a(50);class fa{constructor(qb){this.$=qb;this.lNf=0;this.CGf=(Kb,jc)=>{var Ac;null===(Ac=this.a8b)||void 0===Ac?void 0:Ac.Eeb(jc)}}wKe(qb){return Object(G.a)(this,void 0,void 0,function*(){O.a.Gd?
qb?yield this.xPj(qb):yield this.showTaskPane():E.ULS.sendTraceTag(522782367,0,10,"DataCleansingPaneManager.createOrShowDataCleansingTaskPane: Stateful taskpane is only supported in the new WacTaskPaneInfra")})}dispose(){var qb;null===(qb=this.dataCleansingHostManager)||void 0===qb?void 0:qb.EZf(this.CGf)}showTaskPane(){return Object(G.a)(this,void 0,void 0,function*(){yield(yield this.M5a()).show();E.ULS.sendTraceTag(509383055,0,20,'DataCleansingPaneManager.showTaskPane: Show task pane"\n      }')})}xPj(qb){return Object(G.a)(this,
void 0,void 0,function*(){if(0!==I.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.DataCleansingTaskPaneDiscoverability",0)&&(yield this.ZKj(qb))){const Kb=yield this.M5a();if(I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingTaskPaneDiscoverabilityFilter",!1)){const jc=yield this.PYd(qb.range);0!==jc.length&&this.dataCleansingHostManager&&Kb.Eeb({discoverability:{type:qb.type,filterHint:{filterTables:jc}}})}yield Kb.show();E.ULS.sendTraceTag(509379487,0,20,`DataCleansingPaneManager.showTaskPaneDiscoverability: Show task pane with discoverability type:  ${qb.type}`)}})}fhc(){return Object(G.a)(this,
void 0,void 0,function*(){this.dataCleansingHostManager||(this.dataCleansingHostManager=yield L.GetServiceTaskFactory.n4(this.$.da,494,495,4))})}M5a(){return Object(G.a)(this,void 0,void 0,function*(){this.a8b||(yield this.fhc(),this.a8b=new ka(this.$,this.dataCleansingHostManager.callbacks,this.dataCleansingHostManager.HUg),this.a8b.Eeb(this.dataCleansingHostManager.state),this.dataCleansingHostManager.lZc(this.CGf));return this.a8b})}ZKj(qb){return Object(G.a)(this,void 0,void 0,function*(){const Kb=
I.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.DataCleansingTaskPaneDiscoverability",0);if(0!==Kb)switch(qb.type){case 2:if(2===Kb)return yield this.aLj(qb);break;case 1:if(1===Kb)return yield this.$Kj(qb)}return!1})}aLj(qb){return Object(G.a)(this,void 0,void 0,function*(){yield this.fhc();if((null===qb||void 0===qb?0:qb.range)&&1>this.lNf){const Kb=this.dataCleansingHostManager.NVj(qb.range);if(Kb&&0<this.dataCleansingHostManager.Gfg(Kb)&&1===this.dataCleansingHostManager.ogg())return this.lNf++,
!0}return!1})}$Kj(qb){return Object(G.a)(this,void 0,void 0,function*(){yield this.fhc();return(null===qb||void 0===qb?0:qb.range)&&0<this.dataCleansingHostManager.Gfg(qb.range)&&1===this.dataCleansingHostManager.ogg()?!0:!1})}PYd(qb){return Object(G.a)(this,void 0,void 0,function*(){return qb?(yield this.fhc(),this.dataCleansingHostManager.PYd(qb)):[]})}}Object(C.a)(fa,"DataCleansingPaneManager",null,[]);class wa extends H.a{constructor(qb){super(qb)}ld(){this.fd([new D(this.$,new fa(this.$))])}static la(qb){H.a.Rd(417,
new wa(qb))}}Object(C.a)(wa,"DataCleansingCommandHandlerFactory",H.a,[]);var oa=a(228),xa=a(39),bb=a(71),Za=a(350),La=a(24);class va{constructor(){this.bottom=this.top=this.right=this.left=0}}Object(C.a)(va,"RangeAddress",null,[]);const Ba=qb=>Ea(qb,!1).ZC(!1),Ea=(qb,Kb=!1)=>{qb=new La.Range(qb.top,qb.left,qb.bottom,qb.right,!1,Kb);if(Kb&&(1>qb.top||qb.top>qb.maxRows||1>qb.bottom||qb.bottom>qb.maxRows||qb.top>qb.bottom||1>qb.left||qb.left>qb.maxColumns||1>qb.right||qb.right>qb.maxColumns||qb.left>
qb.right))throw E.ULS.sendTraceTag(510247817,0,10,"Range.ValidateRange: range is invalid"),Error.argument("Range.ValidateRange: range is invalid");return qb};var pa=a(21),$a=a(862);const cb={width:244,font:"12px sans-serif"};var ib=a(62);const ta={[0]:[45],[1]:[46]};class Ya{constructor(qb,Kb){this.$=qb;this.Zg=Kb;this.doUndo=()=>Object(G.a)(this,void 0,void 0,function*(){yield c(this.$)});this.highlightRangesOnGrid=(jc,Ac,Jc)=>Object(G.a)(this,void 0,void 0,function*(){this.mz(jc,Ac,ta[Jc])});this.openCustomNumberFormat=
()=>Object(G.a)(this,void 0,void 0,function*(){return new Promise(jc=>{b(this.$,Ac=>{jc(Ac);E.ULS.sendTraceTag(509617692,0,50,`HostAppCallbacks.openCustomNumberFormat: resolved with "${Ac?"OK":"Cancel"}"`)})})});this.openFeedback=jc=>Object(G.a)(this,void 0,void 0,function*(){e(this.$,jc)});this.sendOtelEvent=jc=>Object(G.a)(this,void 0,void 0,function*(){Object($a.a)(jc)});this.formatRanges=(jc=[])=>Object(G.a)(this,void 0,void 0,function*(){return jc.map(Ba)});this.formatValues=jc=>Object(G.a)(this,
void 0,void 0,function*(){return jc.map(Ac=>d(this.Zg,Ac.format,Ac.value))});this.containsHiddenCells=jc=>h(this.$,jc)}get grid(){return pa.h(this.$)}mz(qb,Kb,jc=[45]){const Ac=this.grid.Eb;Ac.Tj(jc,!1,!0);Ac.Bk(null,jc,!1);if(null===qb||void 0===qb?0:qb.length){const Jc=Za.a.qUa(bb.d(this.$.na),qb.map(hd=>Ea(hd,!1)));Ac.CB(Jc,jc,!0,void 0,!1);Kb&&this.cOi(qb)}Ac.update(!1)}cOi(qb){if(null===qb||void 0===qb?0:qb.length){const Kb=this.grid;[qb]=qb.sort((jc,Ac)=>jc.top<Ac.top?-1:jc.top>Ac.top?1:0);
qb=La.Range.Hc(qb.top,qb.left);Kb.gN(qb)||(E.ULS.sendTraceTag(509617691,0,50,"HostAppCallbacks.moveViewportToRangeIfNeeded moving viewport"),Kb.yv(qb,0,"DataCleansing"))}else E.ULS.sendTraceTag(509617690,0,10,"HostAppCallbacks.moveViewportToRangeIfNeeded no ranges to move viewport")}}Object(C.a)(Ya,"HostAppCallbacks",null,[310]);var Da=a(167),ba=a(790),ya=a(29),V=a(44),Z=a(379),ja=a(290),la=a(198),ua=a(63);const eb=(qb,Kb,jc,Ac,Jc,hd,Cd,ac=null)=>{ac=qb.Oa(9,ac);ac.ranges=Kb;ac.trimWhitespaceType=
jc;return ua.g(qb,"TrimWhitespace",ac,Ac,Jc,hd,Cd,0)};var Eb=a(291),Wb;(function(qb){qb[qb.textInconsistency=0]="textInconsistency";qb[qb.numberFormatInconsistency=1]="numberFormatInconsistency";qb[qb.extraSpaces=2]="extraSpaces"})(Wb||(Wb={}));Object(C.b)("SuggestionType",Wb);class Ab{constructor(qb){this.$=qb;this.applySuggestion=(Kb,jc=[])=>Object(G.a)(this,void 0,void 0,function*(){const Ac=jc.map(Jc=>Ea(Jc,!1));return w(this.$,Kb,Ac)});this.refreshAnnotations=()=>{throw Error("Method not implemented.");
};this.onPaneLifecycleEvent=Kb=>Object(G.a)(this,void 0,void 0,function*(){R.add(Kb)})}}Object(C.a)(Ab,"DataCleansingCallbacks",null,[309]);class Jb{constructor(){this.isInErrorState=!1;this.errorState=null;this.isInCoauthoring=this.isInViewMode=!1}}Object(C.a)(Jb,"HostState",null,[]);class Gb{constructor(){this.sheetName=this.sheetId=null;this.isProtected=this.isInNamedSheetView=!1}}Object(C.a)(Gb,"WorksheetState",null,[]);class Nb{constructor(){this.annotations=[];this.hostState=new Jb;this.worksheetState=
new Gb}}Object(C.a)(Nb,"DataCleansingHostState",null,[]);class Ja{constructor(qb){this.$=qb;this.aOe=!1}get isEnabled(){return I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingTeachingCallout",!1)}show(qb){this.isEnabled&&!this.aOe&&(2>qb?E.ULS.sendTraceTag(509720201,0,50,`DataCleansing.showCallout: suggestion count(${qb}) is below threshold to show teaching callout`):(this.$.Yc(-847286761,U.a.zb,0,{["SuggestionsCount"]:qb,["CalloutName"]:16}),this.aOe=!0))}}Object(C.a)(Ja,
"TeachingCallout",null,[]);var ab=a(735),wb=a(741),xb=a(718);class rb extends wb.a{constructor(){super();this.columnIdentifier=this.tableIdentifier=this.tableRange=this.tableName=this.worksheetName=this.worksheetId=null;this.H_=Object.assign(new xb.a,{T_:rb.getTypeName(),B_:rb.Pd()})}static getTypeName(){return"AugLoop_Tablelint_TableLintAnnotationBase"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(C.a)(rb,"TableLintAnnotationBase",wb.a,[]);class za extends rb{constructor(){super();this.investigationTelemetry=
this.suggestions=this.columnName=this.columnTitle=null;this.H_=Object.assign(new xb.a,{T_:za.getTypeName(),B_:za.Pd()})}static getTypeName(){return"AugLoop_Tablelint_TableLintColumnAnnotation"}static Pd(){return["AugLoop_Tablelint_TableLintAnnotationBase","AugLoop_Core_Annotation"]}}Object(C.a)(za,"TableLintColumnAnnotation",rb,[]);class Aa extends wb.a{constructor(){super();this.worksheetId=null;this.errorCount=this.suggestionsCount=0;this.aggregatedAnnotations=this.unsupportedFeaturesSet=null;this.H_=
Object.assign(new xb.a,{T_:Aa.getTypeName(),B_:Aa.Pd()})}static getTypeName(){return"AugLoop_Tablelint_TableLintWorksheetAggregateAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(C.a)(Aa,"TableLintWorksheetAggregateAnnotation",wb.a,[]);var pb=a(893),kb=a(96);const Cb=I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingDisableTaskPaneWhenALSessionClose",!1);class ob extends xa.a{constructor(qb,Kb,jc){super();this.$=qb;this.nHa=Kb;this.V5=new Nb;this.bLf=(Ac,Jc)=>
{this.WHi(Jc.sheetId,Jc.annotations);this.stateChanged();this.zQb()};this.rj=(Ac,Jc)=>{this.olg(Jc.OF);this.xfg(Jc.na);this.stateChanged();this.zQb()};this.F_=()=>{const Ac=this.gridView.inRangePicker||this.gridView.ei||this.ha.Oe&470;2!==I.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.DataCleansingTaskPaneDiscoverability",0)||Ac||this.tGd(this.ha.ra.activeCell,2)};this.Qma=()=>{this.stateChanged()};this.oB=()=>{this.stateChanged()};this.l6=()=>{this.stateChanged()};this.kMf=(Ac,[Jc,hd])=>
{E.ULS.sendTraceTag(509613389,0,50,`DataCleansingHostManager.onUnrecoverableErrorOccurred: Received augmentation loop session close. ${JSON.stringify({["closeReason"]:pb.a[Jc],["errorCode"]:hd})}`);Cb&&(I.EwaSettings.isChangeGateEnabled("OfficeVSO:7514489_AddSpecificErrorMessage")?this.V5.hostState.errorState=hd:this.V5.hostState.isInErrorState=!0,this.stateChanged())};this.x6=(Ac,Jc)=>{bb.m(Jc.item)&&Jc.item.Xh!==this.V5.worksheetState.isProtected&&(E.ULS.sendTraceTag(509613388,0,50,`DataCleansingHostManager.onSheetOptionsChanged: sheet protection has changed to ${Jc.item.Xh}.`),
this.stateChanged())};this.callbacks=new Ab(this.$);this.HUg=new Ya(this.$,jc);this.Dgg=new Ja(this.$);Kb.$Rg(this.bLf);Kb.nSg(this.kMf);void Kb.aXc();qb.xj.Yf(this.rj);qb.ea.T9(this.oB);qb.ea.x2(this.l6);this.gridView=pa.h(this.$);this.ha=this.gridView.ha;this.ha.vA(this.F_);this.xfg(this.$.na)}lZc(qb){this.addHandler(ob.fYd,qb)}EZf(qb){this.removeHandler(ob.fYd,qb)}dispose(){this.nHa.jqj(this.bLf);this.nHa.uqj(this.kMf);this.$.xj.yg(this.rj);this.$.ea.c7(this.oB);this.$.ea.Z6(this.l6);this.olg(this.$.na);
this.ha.TF(this.F_);super.dispose()}get state(){this.V5.annotations=this.nHa.KTg();if(bb.m(this.$.na)){const qb=this.$.na.Xh,Kb=this.$.na.sheetId,jc=this.$.na.sheetName;this.V5.worksheetState.isInNamedSheetView=this.$.na.ie.uz;this.V5.worksheetState.isProtected=qb;this.V5.worksheetState.sheetId=Kb;this.V5.worksheetState.sheetName=jc}this.V5.hostState.isInViewMode=!this.$.ea.isEditMode;this.V5.hostState.isInCoauthoring=this.isInCoauthoring();return this.V5}Gfg(qb){return this.qpe(qb)}PYd(qb){return this.rKh(qb)}NVj(qb){if(bb.m(this.$.na)){var Kb=
this.nHa.RNb(this.$.na.sheetId);if(t(Kb)&&(Kb=y(Kb).filter(jc=>qb.xe(Ea(jc.tableRange))),0<Kb.length))return Kb=Ea(Kb[0].tableRange),E.ULS.sendTraceTag(509219845,0,50,`DataCleansingHostManager.getTableRange: Table range is ${Kb}, selected cell range is ${qb}.`),Kb}}ogg(){if(!bb.m(this.$.na))return 0;var qb=this.nHa.RNb(this.$.na.sheetId);if(!t(qb))return 0;qb=new Set(y(qb).map(Kb=>Kb.tableName));E.ULS.sendTraceTag(509211032,0,50,`DataCleansingHostManager.tablesWithSuggestionsCount: ${qb.size} tables with suggestions found.`);
return qb.size}isInCoauthoring(){return!1}stateChanged(){this.raiseEvent(ob.fYd,this.state)}xfg(qb){bb.m(qb)&&(qb.ie.QZa(this.Qma),qb.TZa(this.x6))}olg(qb){bb.m(qb)&&(qb.ie.UKb(this.Qma),qb.cwc(this.x6))}zQb(){if(this.Dgg.isEnabled){const qb=this.qpe();0<qb&&this.Dgg.show(qb)}}qpe(qb){if(!bb.m(this.$.na))return 0;const Kb=this.nHa.RNb(this.$.na.sheetId),jc=t(Kb);if(!jc)return 0;if(qb)return this.ceh(Kb,qb);qb=this.beh(Kb);qb!==jc.suggestionsCount&&E.ULS.sendTraceTag(509613387,0,50,`DataCleansingHostManager.activeSheetSuggestionsCount: suggestionsCount is ${jc.suggestionsCount}, but we have ${qb} suggestions.`);
return qb}beh(qb){return y(qb).reduce((Kb,jc)=>{var Ac,Jc;return Kb+(null!==(Jc=null===(Ac=null===jc||void 0===jc?void 0:jc.suggestions)||void 0===Ac?void 0:Ac.length)&&void 0!==Jc?Jc:0)},0)}ceh(qb,Kb){qb=y(qb).map(jc=>{var Ac;return null===(Ac=null===jc||void 0===jc?void 0:jc.suggestions)||void 0===Ac?void 0:Ac.filter(Jc=>!(null===Kb||void 0===Kb||!Kb.xe(Ea(Jc.suggestionRange))))}).reduce((jc,Ac)=>jc+Ac.length,0);E.ULS.sendTraceTag(509219844,0,50,`DataCleansingHostManager.countSuggestionsForRange: ${qb} suggestions found for range: ${Kb}`);
return qb}rKh(qb){if(!bb.m(this.$.na))return[];const Kb=this.nHa.RNb(this.$.na.sheetId);return t(Kb)?y(Kb).filter(jc=>{var Ac;return 0<(null===(Ac=null===jc||void 0===jc?void 0:jc.suggestions)||void 0===Ac?void 0:Ac.filter(Jc=>!(null===qb||void 0===qb||!qb.xe(Ea(Jc.suggestionRange)))).length)}).map(jc=>jc.tableName):[]}WHi(qb,Kb){Kb=l(y(Kb));E.ULS.sendTraceTag(509698241,0,50,`DataCleansingHostManager.logPotentialSuggestionsInfo: ${JSON.stringify({["sheetId"]:qb,["suggestionsInfo"]:Kb})}`)}tGd(qb,
Kb){if(I.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.DataCleansingTaskPaneDiscoverability",0)===Kb){const jc=new kb.a(-1190551534,U.a.zb,this.$.xc,0,null);this.$.Ia.Hb(jc,{["discoverabilityOptions"]:{type:Kb,range:qb}});E.ULS.sendTraceTag(0,0,50,`DataCleansingHostManager:openDataCleansingTaskPane discoverability type: ${Kb}. with active range: ${qb}.`)}}}ob.fYd="scek";Object(C.a)(ob,"DataCleansingHostManager",xa.a,[]);class qa extends rb{constructor(){super();this.errorCategory=this.errorType=
this.investigationTelemetry=this.columnName=this.columnTitle=null;this.H_=Object.assign(new xb.a,{T_:qa.getTypeName(),B_:qa.Pd()})}static getTypeName(){return"AugLoop_Tablelint_TableLintErrorAnnotation"}static Pd(){return["AugLoop_Tablelint_TableLintAnnotationBase","AugLoop_Core_Annotation"]}}Object(C.a)(qa,"TableLintErrorAnnotation",rb,[]);class ma extends rb{constructor(){super();this.unsupportedFeatures=this.investigationTelemetry=this.columnName=this.columnTitle=null;this.H_=Object.assign(new xb.a,
{T_:ma.getTypeName(),B_:ma.Pd()})}static getTypeName(){return"AugLoop_Tablelint_TableLintUnsupportedFeatureAnnotation"}static Pd(){return["AugLoop_Tablelint_TableLintAnnotationBase","AugLoop_Core_Annotation"]}}Object(C.a)(ma,"TableLintUnsupportedFeatureAnnotation",rb,[]);class Ga extends xa.a{constructor(qb,Kb){super();this.tha=!1;this.HVj=(jc,Ac)=>{if(jc=Ac.VG)switch(Ac.operationType){case 1:case 2:this.raiseEvent("carek",jc);break;case 3:this.raiseEvent("caiek",jc);break;default:E.ULS.sendTraceTag(537163396,
306,15,`TableLintManager.TableLintColumnAnnotationHandler Received unexpected OperationType:${Ac.operationType}`)}else E.ULS.sendTraceTag(537163397,306,50,"TableLintManager.TableLintColumnAnnotationHandler TableLintColumnAnnotation is null.")};this.JVj=(jc,Ac)=>{if(Ac.VG)switch(Ac.operationType){case 1:case 2:this.raiseEvent("aarek",Ac.VG);break;case 3:break;default:E.ULS.sendTraceTag(537163394,306,15,`TableLintManager.TableLintAnnotationHandler Received unexpected OperationType:${Ac.operationType}`)}else E.ULS.sendTraceTag(537163395,
306,50,"TableLintManager.TableLintWorksheetAggregateAnnotationHandler TableLintWorksheetAggregateAnnotation is null.")};this.IVj=(jc,Ac)=>{E.ULS.sendTraceTag(537163393,306,50,`TableLintManager.TableLintColumnAnnotationStateUpdateHandler Received state update: ${jc}->${Ac}`)};this.augmentationLoopManager=qb;this.OSi=Kb}aXc(){this.tha?E.ULS.sendTraceTag(537163398,0,50,"TableLintManager.ActivateEvents: Events are already registered"):(this.tlj(),this.tha=!0)}dispose(){this.tha&&(this.Z2j(),this.tha=
!1)}mPg(qb){this.addHandler("carek",qb)}Xnj(qb){this.removeHandler("carek",qb)}NOg(qb){this.addHandler("aarek",qb)}Enj(qb){this.removeHandler("aarek",qb)}tlj(){E.ULS.sendTraceTag(574482312,0,50,"TableLintManager.RegisterTableLintEvents: activate annotations");this.augmentationLoopManager.register(this.augmentationLoopManager.O4a().xeb("DataCleansing").ueb(this.OSi).activateAnnotation({annotationType:za.getTypeName(),Au:!0,eve:this.IVj,j8:this.HVj}).activateAnnotation({annotationType:Aa.getTypeName(),
Au:!0,j8:this.JVj}).activateAnnotation({annotationType:qa.getTypeName(),Au:!0}).activateAnnotation({annotationType:ma.getTypeName(),Au:!0}).build())}Z2j(){this.augmentationLoopManager.unregister("DataCleansing")}}Object(C.a)(Ga,"TableLintManager",xa.a,[3]);class vb extends xa.a{constructor(qb){super();this.$=qb;this.Yzc=new Map;this.O4c=new Map;this.N4c=new Map;this.Jpc=(Kb="Unknown",jc)=>{E.ULS.sendTraceTag(520987272,0,50,`DataCleansingAnnotationsManager.onAugmentationLoopSessionClose: Received augmentation loop session close. ${JSON.stringify({["closeReason"]:pb.a[Kb],
["errorCode"]:jc})}`);this.raiseEvent(vb.W0d,[Kb,jc])};this.rDf=(Kb,jc)=>{this.O4c.set(jc.id,jc);E.ULS.sendTraceTag(512354457,0,100,`DataCleansingAnnotationsManager.onColumnAnnotationReceived: Received ${jc.id}`)};this.SBf=(Kb,jc)=>{Kb=this.Yzc.get(jc.worksheetId);E.ULS.sendTraceTag(512354456,0,50,`DataCleansingAnnotationsManager.onAggregateAnnotationReceived: Received ${JSON.stringify({["id"]:jc.id,["sheetId"]:jc.worksheetId,["previous"]:null===Kb||void 0===Kb?void 0:Kb.id,["errorCount"]:jc.errorCount,
["suggestionsCount"]:jc.suggestionsCount})}`);(null===Kb||void 0===Kb?void 0:Kb.id)===jc.id&&E.ULS.sendTraceTag(512354455,0,50,`DataCleansingAnnotationsManager.onAggregateAnnotationReceived: Received duplicate ${jc.id}`);this.Yzc.set(jc.worksheetId,jc);Kb=this.w5h(jc);Kb.forEach(Ac=>{this.O4c.delete(Ac.id)});this.N4c.set(jc.id,Kb);this.BUg(jc.worksheetId)}}$Rg(qb){this.addHandler(vb.GUd,qb)}jqj(qb){this.removeHandler(vb.GUd,qb)}nSg(qb){this.addHandler(vb.W0d,qb)}uqj(qb){this.removeHandler(vb.W0d,
qb)}dispose(){this.dUa&&(this.dUa.Xnj(this.rDf),this.dUa.Enj(this.SBf),this.dUa.dispose());super.dispose()}aXc(){return Object(G.a)(this,void 0,void 0,function*(){const qb=yield L.GetServiceTaskFactory.n4(this.$.da,328,327,1);qb?(this.dUa=new Ga(qb,this.Jpc),this.dUa.mPg(this.rDf),this.dUa.NOg(this.SBf),this.dUa.aXc(),E.ULS.sendTraceTag(520987274,0,50,"DataCleansingAnnotationsManager.activateEvents: events activated")):E.ULS.sendTraceTag(520987273,0,10,"DataCleansingAnnotationsManager.activateEvents: no augmentationLoopManager")})}RNb(qb){var Kb;
if(qb=this.Yzc.get(qb)){const jc=null!==(Kb=this.N4c.get(qb.id))&&void 0!==Kb?Kb:[];return[qb,...jc]}return[]}KTg(){const qb=[];this.Yzc.forEach(Kb=>{var jc;const Ac=null!==(jc=this.N4c.get(Kb.id))&&void 0!==jc?jc:[];qb.push(Kb,...Ac)});return qb}BUg(qb){qb={sheetId:qb,annotations:this.RNb(qb)};this.raiseEvent(vb.GUd,qb)}w5h(qb){var Kb=Array.from(this.O4c.values()).filter(Jc=>Jc.worksheetId===qb.worksheetId);if(!I.EwaSettings.isChangeGateEnabled("OfficeVSO:7403186_DataCleansingUseAggregatedAnnotations"))return Kb;
if(!Kb.length)return E.ULS.sendTraceTag(509682374,0,50,"DataCleansingAnnotationsManager.getRelatedPendingAnnotations: No pending sheet annotations"),[];if(!Array.isArray(qb.aggregatedAnnotations))return E.ULS.sendTraceTag(509682373,0,20,"DataCleansingAnnotationsManager.getRelatedPendingAnnotations: No aggregated annotations IDs"),Kb;const jc=new Set(qb.aggregatedAnnotations),Ac=Kb.filter(Jc=>jc.has(Jc.id));Kb=Kb.filter(Jc=>!jc.has(Jc.id));Kb.length&&E.ULS.sendTraceTag(509682372,0,50,`DataCleansingAnnotationsManager.getRelatedPendingAnnotations: Found ${Kb.length} unrelated annotations`);
return Ac}}vb.GUd="sacek";vb.W0d="ueoek";Object(C.a)(vb,"DataCleansingAnnotationsManager",xa.a,[]);var Ka=a(717),Pa=a(153),fb=a(54);class Wa extends oa.a{constructor(qb){super();this.$=qb;this.Gb()}create(){this.lhh().then(qb=>{const Kb=Object(Ka.a)(this.$.da,494,()=>{const jc=new vb(this.$);return new ob(this.$,jc,qb)});this.qb(Kb)},()=>{E.ULS.sendTraceTag(509613385,0,10,"DataCleansingHostManagerFactory.Create: failed to create formatCellsAction")})}lhh(){return I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormatCellsActionNewService",
!1)?Pa.a.resolve(fb.r,{Wb:this.Na}):Y.d(L.GetServiceTaskFactory.create(this.$.da,18,this.$.ka,this.Na))}static la(qb){qb.da.Ha(495,new Wa(qb))}}Object(C.a)(Wa,"DataCleansingHostManagerFactory",oa.a,[]);var Ma=a(38),lb=a(86),Na=a(4),X=a(132),F=a(133),na;(function(qb){qb[qb.success=0]="success";qb[qb.featureDisabled=1]="featureDisabled";qb[qb.rangeNotInGrid=2]="rangeNotInGrid";qb[qb.emptyRange=3]="emptyRange";qb[qb.rangeTooLarge=4]="rangeTooLarge";qb[qb.successWithMergedCells=5]="successWithMergedCells"})(na||
(na={}));Object(C.b)("ResultCode",na);var hb=a(22),Ib=a(197),vc=a(165),nc=a(171),Pb=a(59),oc;(function(qb){qb.FormatAsTable="FormatAsTable";qb.ExplicitClose="ExplicitClose";qb.ESC="Dismiss";qb.CommandExecution="CommandExecution";qb.Undo="Undo";qb.SelectionEnd="SelectionEnd";qb.LearnMore="LearnMore";qb.EditedOutOfRange="EditedOutOfRange"})(oc||(oc={}));Object(C.b)("IgnoreSource",oc);class Ic{constructor(qb,Kb,jc,Ac,Jc="OnDemand"){this.G6i=()=>{this.Qgc(oc.LearnMore);var hd=new kb.a(-859308420,U.a.zb,
this.$.xc,9,null);this.$.Ia.Hb(hd,{[U.a.Sf]:"HelpID=22118",["InputMethod"]:U.a.zb,["ShouldCanvasTakeFocus"]:!0,[U.a.Pc]:da.a.mV,[da.a.Zoa]:!0});hd=this.dataFields;hd.suggestionType="table";F.b(this.$).qd(X.a.eRj,hd,{},!0);F.b(this.$).qd(X.a.fRj,hd,{},!0)};this.xdh=()=>{const hd=V.v(this.lpe.PD,this.$);var Cd=V.E(hd);this.Txa(Cd)||this.grid.ha.JD([Cd],0,Cd.topLeft,0);v({level:50,methodName:"convertToTable",message:"Create table initiated",dataFields:this.dataFields,DF:this.DF});Cd={};Cd.TableRange=
hd;Cd.HasHeader=!0;this.$.Yc(71074531,U.a.zb,9,Cd).continueWith(ac=>{vc.b(ac)&&ac.result?(v({level:50,methodName:"convertToTable",message:"Create table complete",dataFields:this.dataFields,DF:this.DF}),F.b(this.$).qd(X.a.bRj,this.dataFields,{},!0),F.b(this.$).qd(X.a.cRj,this.dataFields,{},!0),this.pza(()=>{nc.a(this.$).yp.activateRibbonTab(da.a.RJb)})):v({level:10,methodName:"convertToTable",message:"Create table failed",dataFields:this.dataFields,DF:this.DF});this.Qgc(oc.FormatAsTable);this.eyd()})};
this.onClose=()=>{this.Qgc(oc.ExplicitClose);this.eyd()};this.onDismiss=hd=>{(hd=hd?new Sys.UI.DomEvent(hd):null)&&"keydown"===hd.type&&27===hd.keyCode&&this.Qgc(oc.ESC);v({level:50,methodName:"onDismiss",message:"OnDismiss called for Table Invitation",dataFields:this.dataFields,DF:this.DF})};this.eyd=()=>{lb.a.instance.Tb("Common.ISystemInitiatedFeedback").execute(hd=>{hd.logActivity("Office_Excel_SmartView_FormatAsTableOnPasteFloodgate",null)})};this.$=qb;this.Qgc=jc;this.proactiveSuggestionCard=
Kb;this.dataFields={["Class"]:"TableSuggestionCardUtil",["LaunchSource"]:"Default"};this.grid=pa.h(this.$);this.isVisible=!1;this.dea=Ac;this.DF=Jc;this.oXc="Table"}tcg(qb,Kb){this.dataFields.LaunchSource=Kb;this.lpe=qb;var jc=W.a.instance.Ua(716);Kb=W.a.instance.Ua(710);Na.AFrameworkApplication.Qq("XLS-SmartView-AlternateCardStrings-Treatment;XLS-SmartView-AlternateCardStrings-Control");I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.AlternateCardStrings",!1)&&(jc=W.a.instance.Ua(718),
Kb=W.a.instance.Ua(717));jc=[{key:"learnMessage",text:jc,onClick:this.G6i}];(this.isVisible=this.proactiveSuggestionCard.show(qb.PD,Kb,W.a.instance.Ua(711),W.a.instance.Ua(712),W.a.instance.Ua(713),()=>{this.xdh()},this.onClose,jc,()=>{this.vza(!0)},()=>{this.vza(!1)},"TableDesignIdeas",I.EwaSettings.isChangeGateEnabled("OfficeVSO:6472403_FallbackCardLocation")?13:void 0,I.EwaSettings.isChangeGateEnabled("OfficeVSO:6472403_FallbackCardLocation")?[10,11,8]:void 0,5,this.onDismiss,void 0,!0))?(F.b(this.$).qd(X.a.hRj,
this.dataFields,{},!0),F.b(this.$).qd(X.a.iRj,this.dataFields,{},!0),v({level:50,methodName:"showTableSuggestionCard",message:"Proactive suggestion card displayed",dataFields:this.dataFields,DF:this.DF}),this.oXc="Table"):v({level:15,methodName:"showTableSuggestionCard",message:"Proactive suggestion card failed to show",dataFields:this.dataFields,DF:this.DF})}get visible(){return this.isVisible}set visible(qb){this.isVisible=qb}hide(qb){this.visible&&(this.proactiveSuggestionCard.hide(),this.isVisible=
!1,I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.EnableRoamingServiceIntegration",!1)&&qb!==oc.LearnMore&&(qb===oc.FormatAsTable?this.dea.zLb(this.oXc):this.dea.wAb(this.oXc)))}jba(qb){return Object(G.a)(this,void 0,void 0,function*(){return this.dea.jba(qb)})}static sui(qb){var Kb=qb.properties;qb=Kb.SourceControlId&&Kb.SourceControlId.includes("Sensitivity");Kb=Kb.ShouldCanvasTakeFocus;return qb&&!Kb}static qui(qb){return[1928326585,1833782813,-1059615499,-1027730316,-1104934572,
-28797232,71074531,1237877382,974713501].includes(qb)}static lPe(qb){return!(Ic.qui(qb.Ud.command)||Ic.sui(qb))}static Ash(qb,Kb){return pa.h(qb).tb.o5(Kb)?(v({level:50,methodName:"doesRangeContainTable",message:"Last paste was a table.",dataFields:this.dataFields}),!0):pa.h(qb).tb.n5(Kb)?(v({level:50,methodName:"doesRangeContainTable",message:"Last paste was a pivot table.",dataFields:this.dataFields}),!0):!1}pza(qb){if(this.b5())qb();else{const Kb=()=>{this.b5()&&(qb(),this.grid.QKb(Kb))};this.grid.mpb(Kb)}}dispose(){this.proactiveSuggestionCard&&
this.proactiveSuggestionCard.dispose()}vza(qb){qb?(qb=[],qb.push(this.lpe.PD),qb=Za.a.qUa(bb.d(this.$.na),qb),this.grid.Eb.CB(qb,[0],!0)):this.grid.Eb.iRa()}b5(){return this.grid.Ca.hN(4,this.$.na)}Txa(qb){return qb.vd(this.grid.ha.ra.activeRange)}}Object(C.a)(Ic,"TableSuggestionCardUtil",null,[]);class ec{constructor(qb,Kb,jc,Ac){this.Xnc=I.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.SmartView.MaxDismissCount",3);this.Gba=Jc=>{this.Qff.add(this.tZa);this.QD.hide(Jc);this.$.Ia.Ena(this.qD);
"ExplicitClose"===Jc&&F.b(this.$).qd(X.a.mdg,this.dataFields,{},!0);v({level:50,methodName:"ignoreActiveRange",message:"Ignore Current Range",dataFields:this.dataFields,DF:"IntelligentMetadata",fields:{["ignoreSource"]:Jc}})};this.gh=()=>{I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.DismissOnEditingOutOfRangeCell",!1)?this.QD.visible&&null!==this.tZa&&!this.Txa(this.tZa)&&this.grid.eb&&this.Gba("EditedOutOfRange"):this.QD.visible&&null!==this.tZa&&!this.Txa(this.tZa)&&this.Gba("SelectionEnd")};
this.qD=(Jc,hd)=>{Ic.lPe(hd)&&this.Gba("CommandExecution")};this.$=qb;this.tZa=null;this.tableIntelligenceManager=Kb;this.Qff=new Ib.a;this.dataFields={["Class"]:"IntelligentMetadataTableManager",["LaunchSource"]:"Default"};this.grid=pa.h(this.$);this.Mlj();this.proactiveSuggestionCard=jc;this.dea=Ac;this.QD=new Ic(this.$,this.proactiveSuggestionCard,this.Gba,this.dea,"IntelligentMetadata");this.FVj=.75}w_j(qb,Kb){var jc;return Object(G.a)(this,void 0,void 0,function*(){I.EwaSettings.isChangeGateEnabled("OfficeVSO:7480949_SVLogFlightUsage")||
Na.AFrameworkApplication.Qq("XLS-IntelligentMetadataTableProactiveSuggestions-Treatment;XLS-IntelligentMetadataTableProactiveSuggestions-Control");this.dataFields.LaunchSource=Kb;if(I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.IntelligentMetadataTableProactiveSuggestions",!1)){Na.AFrameworkApplication.Qq("XLS-SmartView-EnableRoamingServiceIntegration-Treatment;XLS-SmartView-EnableRoamingServiceIntegration-Control");if(I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.EnableRoamingServiceIntegration",
!1)){var Ac=yield this.QD.jba("Table"),Jc={yaa:Ac};v({level:50,methodName:"triggerIntelligentMetadataTableHandRaise",message:"Dismiss count.",dataFields:this.dataFields,DF:"IntelligentMetadata",fields:Jc});if(Ac>=this.Xnc){v({level:50,methodName:"triggerIntelligentMetadataTableHandRaise",message:"Exceeded maximum dismiss count.",dataFields:this.dataFields,DF:"IntelligentMetadata",fields:Jc});return}}for(let Cd of this.Qff)if(Cd.sheetId===qb.sheetId&&Cd.range.vd(qb.range))return;Ac=this.q5h(qb,Kb);
if(1===Ac.length){Ac=null===(jc=Ac[0])||void 0===jc?void 0:jc.table;var hd=this.dZh(Ac);if(hd){if(this.p0h(Kb)){Jc=this.$9h(Kb,hd.PD);if(!Jc)return;hd.PD=Jc}this.tZa=new Za.a(hd.PD,Ac.Ry.sheetId);this.QD.pza(()=>{this.QD.tcg(hd,Kb);this.$.Ia.Gsa(this.qD)})}}}else v({level:50,methodName:"triggerIntelligentMetadataTableHandRaise",message:"Microsoft.Office.Excel.IntelligentMetadataTableProactiveSuggestions is disabled",dataFields:this.dataFields,DF:"IntelligentMetadata"})})}q5h(qb,Kb){let jc=this.tableIntelligenceManager.pwa().F5a(qb,
6);I.EwaSettings.isChangeGateEnabled("OfficeVSO:7450190_PSCardMaxRevisions")&&(Kb="BorderActions"===Kb?0:1,qb=this.tableIntelligenceManager.pwa().F5a(qb,6,Kb),0<jc.length&&0===qb.length&&v({level:50,methodName:"getRecognizedTableRecords",message:"Suppressed card, table records were invalid",dataFields:this.dataFields,DF:"IntelligentMetadata"}),jc=qb);return jc}Mlj(){this.grid.ha.HT(this.gh)}$9h(qb,Kb){const jc=Kb.clone();switch(qb){case "InsertColumn":case "InsertCellShiftRight":jc.nea(4,jc.right+
1);break;case "InsertRow":case "InsertCellShiftDown":jc.nea(2,jc.bottom+1);break;case "DeleteColumn":qb=Kb.right-1;if(1>qb||qb<Kb.left)return null;jc.nea(4,qb);break;case "DeleteRow":qb=Kb.bottom-1;if(1>qb||qb<Kb.top)return null;jc.nea(2,qb)}return jc}p0h(qb){return"InsertColumn InsertRow InsertCellShiftDown InsertCellShiftRight DeleteColumn DeleteRow".split(" ").includes(qb)}dZh(qb){for(let Kb of qb.interpretations)if(Kb.confidence>=this.FVj&&2===Kb.orientation&&1===Kb.headerRowCount&&!qb.tableName)return Kb;
return null}Txa(qb){return qb.range.contains(this.grid.ha.ra.activeRange)}dispose(){this.QD&&this.QD.dispose()}}Object(C.a)(ec,"IntelligentMetadataTableManager",null,[3]);var mb=a(255),Ob=a(193),Ta=a(117);class sb{constructor(){this.version=3;this.optOut=this.table=0}}Object(C.a)(sb,"SmartViewTableHandRaiseSetting",null,[]);class zb{constructor(qb){this.b1f=new sb;this.wAb=Kb=>{if(this.smartViewTableHandRaiseSetting){let jc=this.rhd(Kb);jc++;this.gmg(Kb,jc);v({level:50,methodName:"incrementDismissCount",
message:"Incremented smartViewTableHandRaiseSetting dismiss count.",dataFields:this.dataFields,fields:{smartViewTableHandRaiseSetting:this.smartViewTableHandRaiseSetting}});this.yng()}else v({level:50,methodName:"incrementDismissCount",message:"Can't increment smartViewTableHandRaiseSetting dismiss count.",dataFields:this.dataFields})};this.zLb=Kb=>{this.smartViewTableHandRaiseSetting?(this.gmg(Kb,0),v({level:50,methodName:"resetDismissCount",message:"Reset smartViewTableHandRaiseSetting dismiss count.",
dataFields:this.dataFields,fields:{smartViewTableHandRaiseSetting:this.smartViewTableHandRaiseSetting}}),this.yng()):v({level:50,methodName:"resetDismissCount",message:"Can't reset smartViewTableHandRaiseSetting dismiss count.",dataFields:this.dataFields})};this.Ruj=()=>{v({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"Reading latest roaming setting.",dataFields:this.dataFields});return new Promise(Kb=>{Eb.w(this.$.pa.va,2,jc=>{v({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",
message:"OnReadRoamingStringSuccess called.",dataFields:this.dataFields});if(ya.a.Zf(jc.Errors))jc={errors:ya.a.qc(jc.Errors)},v({level:10,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"onReadRoamingSuccessCallback encountered an error.",dataFields:this.dataFields,fields:jc}),Kb(null);else if(jc.Result){if(jc=this.$oh(jc.Result))v({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"Successfully retrieved smartViewTableHandRaiseSetting.",
dataFields:this.dataFields,fields:{smartViewTableHandRaiseSetting:jc}}),3>jc.version?(v({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"Version mismatch. Resetting smartViewTableHandRaiseSetting",dataFields:this.dataFields}),Kb(this.b1f)):Kb(jc)}else v({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"onReadRoamingSuccessCallback received null result. Returning default value.",dataFields:this.dataFields}),Kb(this.b1f)},
jc=>{jc={ewaErrors:Ta.a.Ue(jc.data)};v({level:10,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"Roaming operation failed.",dataFields:this.dataFields,fields:jc});Kb(null)},null,null)})};this.yng=()=>{const Kb=this.YAj(this.smartViewTableHandRaiseSetting);Kb?(v({level:50,methodName:"updateSmartViewTableHandRaiseSettingFromRoamingService",message:"Updating roaming setting.",dataFields:this.dataFields,fields:{hek:Kb}}),Eb.C(this.$.pa.va,2,Kb,jc=>{v({level:50,methodName:"onWriteRoamingStringSuccess",
message:"OnWriteRoamingStringSuccess called.",dataFields:this.dataFields});ya.a.Zf(jc.Errors)?(jc={errors:ya.a.qc(jc.Errors)},v({level:10,methodName:"onWriteRoamingStringSuccess",message:"OnWriteRoamingStringSuccess encountered an error.",dataFields:this.dataFields,fields:jc})):jc.Result&&(jc.Result||v({level:10,methodName:"onWriteRoamingStringSuccess",message:"Failed to write to the roaming service.",dataFields:this.dataFields}))},jc=>{jc={ewaErrors:Ta.a.Ue(jc.data)};v({level:10,methodName:"updateSmartViewTableHandRaiseSettingFromRoamingService",
message:"Roaming operation failed.",dataFields:this.dataFields,fields:jc})},null,null)):v({level:15,methodName:"updateSmartViewTableHandRaiseSettingFromRoamingService",message:"Empty serialized roaming setting.",dataFields:this.dataFields})};this.$oh=Kb=>{if(!Kb)return v({level:15,methodName:"deserializeToSmartViewTableHandRaiseSetting",message:"Received an empty roamingXml.",dataFields:this.dataFields}),null;let jc;try{jc=JSON.parse(Kb)}catch(Ac){return v({level:10,methodName:"deserializeToSmartViewTableHandRaiseSetting",
message:"Error while deserializing SmartViewTableHandRaiseSetting.",dataFields:this.dataFields,fields:{errorMessage:Ac.message}}),null}return jc};this.YAj=Kb=>{if(!Kb)return v({level:50,methodName:"serializeFromSmartViewTableHandRaiseSetting",message:"Empty roaming setting.",dataFields:this.dataFields}),null;Kb=Pb.a.Ec(Kb);return 100<Kb.length?(v({level:10,methodName:"serializeFromSmartViewTableHandRaiseSetting",message:"Exceeded the MaxSize for smartViewTableHandRaiseSettingMaxSize.",dataFields:this.dataFields}),
null):Kb};this.$=qb;this.smartViewTableHandRaiseSetting=null;this.dataFields={["Class"]:"SmartViewTableHandRaiseRoamingHandler",["smartViewTableHandRaiseSetting"]:this.smartViewTableHandRaiseSetting}}jba(qb){return Object(G.a)(this,void 0,void 0,function*(){if(this.smartViewTableHandRaiseSetting)return v({level:50,methodName:"getDismissCount",message:"Returning existing smartViewTableHandRaiseSetting.",dataFields:this.dataFields,fields:{smartViewTableHandRaiseSetting:this.smartViewTableHandRaiseSetting}}),
this.rhd(qb);v({level:50,methodName:"getDismissCount",message:"Fetching smartViewTableHandRaiseSetting from roaming service.",dataFields:this.dataFields});const Kb=yield this.Ruj();if(Kb)return this.smartViewTableHandRaiseSetting=Kb,v({level:50,methodName:"getDismissCount",message:"Received setting from roaming service.",dataFields:this.dataFields,fields:{smartViewTableHandRaiseSetting:this.smartViewTableHandRaiseSetting}}),this.rhd(qb);v({level:50,methodName:"getDismissCount",message:"Received null setting. Returning infinity.",
dataFields:this.dataFields});return Number.POSITIVE_INFINITY})}rhd(qb){return{["Table"]:this.smartViewTableHandRaiseSetting.table,["OptOut"]:this.smartViewTableHandRaiseSetting.optOut}[qb]}gmg(qb,Kb){switch(qb){case "Table":this.smartViewTableHandRaiseSetting.table=Kb;break;case "OptOut":this.smartViewTableHandRaiseSetting.optOut=Kb;break;default:this.smartViewTableHandRaiseSetting.optOut=Kb,this.smartViewTableHandRaiseSetting.table=Kb}}}Object(C.a)(zb,"SmartViewTableHandRaiseRoamingHandler",null,
[]);class db{constructor(qb,Kb,jc){this.Wpd=!1;this.fCa=this.cab=null;this.q8a=this.Rog=!1;this.Xnc=I.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.SmartView.MaxDismissCount",3);this.zei=(Ac,Jc)=>{v({level:50,methodName:"handleSmartViewActivationCallback",message:"handleSmartViewActivationCallback invoked.",dataFields:this.dataFields});if(!Jc)return v({level:10,methodName:"handleSmartViewActivationCallback",message:"surveyParams is null.",dataFields:this.dataFields}),null;if(!Jc.contextInfo||
0===Jc.contextInfo.length)return v({level:10,methodName:"handleSmartViewActivationCallback",message:"no valid contextInfo in surveyParams.",dataFields:this.dataFields,fields:{["contextInfo"]:Jc.contextInfo}}),null;Ac=Jc.contextInfo[Jc.contextInfo.length-1];if(!Ac.context.sheetRange)return v({level:10,methodName:"handleSmartViewActivationCallback",message:"no valid sheetRange in surveyParams.",dataFields:this.dataFields,fields:{["contextInfo"]:Jc.contextInfo}}),null;Jc=Ac.context.sheetRange;let hd=
!1;Ac.context.Nfi&&(hd=Ac.context.Nfi);this.v7e(Jc,hd);return null};this.jMf=()=>{this.Gba("Undo");this.$.ea.GZf(this.jMf)};this.gh=()=>{I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.DismissOnEditingOutOfRangeCell",!1)?this.QD.visible&&null!=this.Uca&&!this.Txa(this.Uca.Ry.range)&&this.grid.eb?this.Gba("EditedOutOfRange"):this.q8a||void this.V1d():this.QD.visible&&null!=this.Uca&&!this.Txa(this.Uca.Ry.range)?this.Gba("SelectionEnd"):this.q8a||void this.V1d()};this.Gba=Ac=>
{this.Pff=this.Uca.Ry;this.QD.hide(Ac);this.MDj();this.$.Ia.Ena(this.qD);this.grid.ha.PR(this.gh);"ExplicitClose"===Ac&&(F.b(this.$).qd(X.a.dRj,this.dataFields,{},!0),F.b(this.$).qd(X.a.mdg,this.dataFields,{},!0));v({level:50,methodName:"ignoreActiveRange",message:"Ignore Current Range",dataFields:this.dataFields,fields:{["ignoreSource"]:Ac}})};this.eyd=()=>{lb.a.instance.Tb("Common.ISystemInitiatedFeedback").execute(Ac=>{Ac.logActivity("Office_Excel_SmartView_FormatAsTableOnPasteFloodgate",null)})};
this.qD=(Ac,Jc)=>{Ic.lPe(Jc)&&this.Gba("CommandExecution")};this.MDj=()=>{const Ac=this.grid.ha.ra.activeRange;this.grid.ha.updateSelection(Ac,Ac,0,0)};this.$=qb;this.tableIntelligenceManager=Kb;this.Pff=this.SHc=this.Uca=null;this.dataFields={["Class"]:"IntelligentMetadataOverlayManager",["LaunchSource"]:"Default"};this.proactiveSuggestionCard=jc;this.grid=pa.h(this.$);this.dea=new zb(this.$);this.QD=new Ic(this.$,this.proactiveSuggestionCard,this.Gba,this.dea);I.EwaSettings.isChangeGateEnabled("OfficeVSO:7567828_RemoveSVTableLicenseCheck")?
I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.IntelligentMetadataTableProactiveSuggestions",!1)&&(this.Z6a=new ec(this.$,this.tableIntelligenceManager,this.proactiveSuggestionCard,this.dea)):lb.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Ac=>{void Ac.isFeatureEnabled("SmartViewIntelligentMetadataTableHandRaise",!1).then(Jc=>{this.Wpd=Jc;I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.IntelligentMetadataTableProactiveSuggestions",
!1)&&Jc&&!this.Z6a&&(this.Z6a=new ec(this.$,this.tableIntelligenceManager,this.proactiveSuggestionCard,this.dea));return Jc});Ac.FAa("SmartViewIntelligentMetadataTableHandRaise",Jc=>{this.Wpd=Jc.isEnabled;I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.IntelligentMetadataTableProactiveSuggestions",!1)&&this.Wpd&&!this.Z6a&&(this.Z6a=new ec(this.$,this.tableIntelligenceManager,this.proactiveSuggestionCard,this.dea))})});this.Rog=["en-US","en-GB","en-CA","en-AU","en_IN"].includes(this.$.EUa);
(qb=lb.a.instance.Tb("Common.ISystemInitiatedFeedback"))&&qb.execute(Ac=>{Ac.fKb("SmartViewSuggestion",this.zei)});this.$.Mb&&(this.cab=this.$.Mb.vg("WebServiceCall","onDemandStopWatch"),this.fCa=this.$.Mb.vg("WebServiceCall","getTableInfoStopwatch"))}get npe(){return this.SHc}i6j(qb,Kb=!1){this.Uca=null;qb.tableName||(this.Uca=qb);qb={["Duration"]:-1};this.cab&&(this.cab.stop(),qb.Duration=this.cab.Fc);v({level:50,methodName:"updateOnDemandRecognizedTable",message:"OnDemand request succeeded",dataFields:this.dataFields,
fields:qb});void this.V1d(Kb);this.$.ea.Ete(this.jMf)}Qea(qb,Kb){return Object(G.a)(this,void 0,void 0,function*(){if(!Ic.Ash(this.$,qb.range)){this.dataFields.LaunchSource=Kb;var jc=qb;jc||v({level:10,methodName:"triggerHandRaise",message:"sheetRange is null or undefined",dataFields:this.dataFields});if(this.Rog)if(this.$.ya.IsMeetingLiveSession)v({level:50,methodName:"triggerHandRaise",message:"User is in Teams live.",dataFields:this.dataFields});else if(Ob.a.Bxa()||Ob.a.Axa())v({level:50,methodName:"triggerHandRaise",
message:"User is in Excel hosted in Teams.",dataFields:this.dataFields});else{Na.AFrameworkApplication.Qq("XLS-SmartView-EnableRoamingServiceIntegration-Treatment;XLS-SmartView-EnableRoamingServiceIntegration-Control");if(I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.EnableRoamingServiceIntegration",!1)){var Ac=yield this.QD.jba("Table");const Jc={yaa:Ac};v({level:50,methodName:"triggerHandRaise",message:"Dismiss count.",dataFields:this.dataFields,fields:Jc});if(Ac>=this.Xnc){v({level:50,
methodName:"triggerHandRaise",message:"Exceeded maximum dismiss count.",dataFields:this.dataFields,fields:Jc});return}}Ac=!1;Na.AFrameworkApplication.Qq("XLS-SmartView-GetTableInfo-Treatment;XLS-SmartView-GetTableInfo-Control");if(!this.yzi(jc)){v({level:50,methodName:"triggerHandRaise",message:"Surrounding Cells contain values, update boundary required",dataFields:this.dataFields});if(!I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.GetTableInfo",!1))return;jc=yield this.jqd(jc);
if(!jc){v({level:50,methodName:"triggerHandRaise",message:"Expanded Range is null or undefined",dataFields:this.dataFields});return}Ac=!0}this.Zbh(jc)?v({level:50,methodName:"triggerHandRaise",message:"Header contains links or formulas.",dataFields:this.dataFields}):this.Fla(jc.range)?v({level:50,methodName:"triggerHandRaise",message:"Specified range is empty",dataFields:this.dataFields}):I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.DisableLPP",!1)?(v({level:50,methodName:"triggerHandRaise",
message:"LPP Disabled, requesting OnDemandMetadata",dataFields:this.dataFields}),this.v7e(jc,Ac)):this.IIi(jc,Ac)}else v({level:50,methodName:"triggerHandRaise",message:"Invalid language for TriggerHandRaise.",dataFields:this.dataFields})}})}$Dc(qb,Kb){return Object(G.a)(this,void 0,void 0,function*(){this.Z6a&&void this.Z6a.w_j(qb,Kb)})}IIi(qb,Kb=!1){const jc=lb.a.instance.Tb("Common.ISystemInitiatedFeedback");jc&&(v({level:50,methodName:"logSmartViewEventToLpp",message:"logged event to LPP",dataFields:this.dataFields}),
jc.execute(Ac=>{Ac.logActivity("SmartViewProactiveSuggestionActivity",null,{sheetRange:qb,hasSurroundingCells:Kb})}))}v7e(qb,Kb=!1){this.q8a||this.grid.ha.HT(this.gh);this.QD.pza(()=>{this.getMetadata(qb,Kb)})}dispose(){this.QD&&this.QD.dispose()}V1d(qb=!1){return Object(G.a)(this,void 0,void 0,function*(){if(I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&null!=this.Uca){var Kb=this.Uca.Ry;if(this.Pff!==Kb&&Kb.sheetId===this.$.ua.na.sheetId){Kb=.5;let Ac=
null;this.q8a=!1;for(var jc of this.Uca.interpretations)jc.confidence>=Kb&&2===jc.orientation&&(Kb=jc.confidence,Ac=jc);if(!Ac)this.grid.ha.PR(this.gh),this.q8a=!0,v({level:50,methodName:"updateOnDemandActionButton",message:"The recognition contained no interpretations",dataFields:this.dataFields});else if(1!==Ac.headerRowCount||Ac.headerColumnCount)this.grid.ha.PR(this.gh),this.q8a=!0,v({level:50,methodName:"updateOnDemandActionButton",message:"The recognition cannot be converted to a table",dataFields:this.dataFields});
else if(this.SHc!==Ac||!this.QD.visible){this.SHc=Ac;jc=this.dataFields.LaunchSource;if(I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.EnableAutomaticFormatting",!1)&&1===Kb&&this.Txa(this.npe.PD)&&!qb){Kb=yield this.QD.jba("OptOut");if(!Kb||Kb>=this.Xnc){v({level:50,methodName:"updateOnDemandActionButton",message:"AutoFormat Exceeded Max Dismiss Count",Ffg:"OptOut",dataFields:this.dataFields,fields:{dismiss:Kb}});return}v({level:50,methodName:"updateOnDemandActionButton",message:"Automatically formatting table",
Ffg:"OptOut",dataFields:this.dataFields})}this.QD.tcg(this.npe,jc);this.$.Ia.Gsa(this.qD)}}}})}Zbh(qb){qb=new La.Range(qb.range.top,qb.range.left,qb.range.top,qb.range.right,!0,!1);for(qb=pa.h(this.$).Qj("IntelligenceMetadataOverlay.containsFormulasInHeader",qb,1);qb.$$mn();)if(qb.$$cu().WA)return!0;return!1}getMetadata(qb,Kb=!1){this.cab.start();qb=this.tableIntelligenceManager.H1h(qb,jc=>{this.i6j(jc,Kb)});v({level:50,methodName:"getMetadata",message:"OnDemand metadata requested",dataFields:this.dataFields});
qb&&(v({level:50,methodName:"getMetadata",message:"getMetadataForRange unsuccessful",dataFields:this.dataFields,fields:{["resultCode"]:na[qb]}}),this.cab.stop())}yzi(qb){qb=new La.Range(1<qb.range.top-1?qb.range.top-1:1,1<qb.range.left-1?qb.range.left-1:1,qb.range.bottom+1,qb.range.right+1,!0,!1);const Kb=1===qb.top,jc=1===qb.left,Ac=pa.h(this.$).Qj("IntelligenceMetadataOverlay",qb,1);for(;Ac.$$mn();){const Jc=Ac.$$cu();if((Jc.range.top===qb.top&&!Kb||Jc.range.left===qb.left&&!jc||Jc.range.bottom===
qb.bottom||Jc.range.right===qb.right)&&Jc.Nr.value)return!1}return!0}Txa(qb){return qb.vd(this.grid.ha.ra.activeRange)}Fla(qb){for(qb=pa.h(this.$).Qj("IntelligentMetadataOverlayManager.isRangeEmpty",qb,1);qb.$$mn();){const Kb=qb.$$cu();if(Kb&&(0!==Kb.Nr.type||!hb.a.Pq(Kb.Nr.value)))return!1}return!0}jqd(qb){return Object(G.a)(this,void 0,void 0,function*(){this.fCa||(this.fCa=this.$.Mb.vg("WebServiceCall","getTableInfoStopwatch"));this.fCa.start();const Kb=V.v(qb.range.topLeft,this.$),jc=this.$.pa.va.$b(),
Ac={Duration:-1};return new Promise(Jc=>{const hd=new la.a(260,0,(Cd,ac,Lc)=>ua.s(this.$.pa.va,Kb,Object(ja.b)(Cd,rd=>{this.fCa.stop();!rd||mb.a(rd)?(v({level:50,methodName:"invokeGetTableInfoAction",message:"Result returned with errors",dataFields:this.dataFields}),Jc(null)):(rd=V.E(rd.Result.TableRange),Ac.Duration=this.fCa.Fc,v({level:50,methodName:"invokeGetTableInfoAction",message:"GetTableRange Succeeded",dataFields:this.dataFields,fields:Ac}),Jc(new Za.a(rd,qb.sheetId)))}),Object(ja.a)(ac,
()=>{this.fCa.stop();Ac.Duration=this.fCa.Fc;v({level:50,methodName:"invokeGetTableInfoAction",message:"GetTableRange Failed",dataFields:this.dataFields,fields:Ac});Jc(null)}),Lc,null,jc),88);hd.zBa(()=>!0);this.$.userOperationManager.Oc(hd,null)})})}}Object(C.a)(db,"IntelligentMetadataOverlayManager",null,[271,3]);class jb extends oa.a{constructor(qb){super();this.$=qb;this.Gb();this.dataFields={["Class"]:"IntelligentMetadataOverlayManagerFactory"}}create(){const qb=L.GetServiceTaskFactory.Pa(this.$.da,
20,404,1),Kb=L.GetServiceTaskFactory.Pa(this.$.da,486,487,1);Ma.TaskExtensions.za(Ma.TaskExtensions.Md([qb,Kb],this.$.ka),()=>{const jc=qb.result,Ac=Kb.result;if(jc&&Ac){let Jc=this.$.da.Ba(426);Jc||(Jc=new db(this.$,jc,Ac),this.$.da.Ha(426,Jc));this.qb(Jc);v({level:50,methodName:"Create",message:"Initialized successfully",dataFields:this.dataFields})}else null==jc&&v({level:10,methodName:"Create",message:"TableIntelligenceManager instance null.",dataFields:this.dataFields}),null==Ac&&v({level:10,
methodName:"Create",message:"ProactiveSuggestionCard instance null.",dataFields:this.dataFields}),this.qb(null)},this.$.ka,3)}static la(qb){qb.da.Ha(427,new jb(qb))}}Object(C.a)(jb,"IntelligentMetadataOverlayManagerFactory",oa.a,[]);var Ub=a(13),xd=a(84),ne=a(463);class fe{constructor(qb,Kb){this.text=this.cardViewManager=null;this.$=qb;this.Vo=Kb}Vih(){const qb=this.Wih();ne.a(this.$,243,242,0,Kb=>{this.cardViewManager=Kb;Kb.kbg(this.Vo,4,qb)})}Pgi(){this.cardViewManager&&this.cardViewManager.iMa(-1,
-1,this.Vo)}Wih(){const qb={};qb.description=this.text;const Kb={fieldType:0};Kb.display=this.text;qb.fields=[Kb];return qb}}Object(C.a)(fe,"PivotTableHandRaiseCardManager",null,[]);var Bd=a(732);class Ue extends xd.a{constructor(qb,Kb,jc){super();this.K_b=null;this.isVisible=this.wod=this.n_=this.oN=!1;this.ybb=null;this.vza=(Ac,Jc)=>{Jc?this.rfb():this.sgc()};this.onKeyUp=Ac=>{const Jc=Ac.Gs;Ac=Ac.Ea;switch(Ac.keyCode){case 27:return this.oN?(this.sgc(),this.Zda(Jc),!0):!1;case 121:return Ac.altKey&&
Ac.shiftKey?(this.oN?(this.sgc(),this.Zda(Jc)):(this.rfb(),this.uNb(Jc)),!0):!1;case 17:return this.n_||this.wod?!1:(this.wod=!0,window.setTimeout(()=>{this.wod=!1},30),this.oN?(this.sgc(),this.Zda(Jc)):(this.rfb(),this.uNb(Jc)),!0);default:return!1}};this.onKeyDown=Ac=>{Ac=Ac.Ea;this.n_=Ac.ctrlKey&&17!==Ac.keyCode;return 13===Ac.keyCode&&this.oN?(this.kNf(),!0):!1};this.$=qb;this.qo=Kb.e7b(qb,jc,()=>{this.kNf()},"","","","PivotTableHandRaisePointerDown",W.a.instance.ga(1828))}setRange(qb){this.K_b=
qb}get kz(){return this.qo.kz}dispose(){this.qo.dispose();this.$=null;super.dispose()}LBa(){this.hide();const qb=pa.h(this.$),Kb=qb.jb.Li(this.K_b),jc=qb.Eg(this.K_b,Kb),Ac=qb.Vf(Kb).Dn;var Jc=this.$.da.Ba(271);if((!Jc||!Jc.hqi())&&jc&&Ac&&0<=jc.x&&0<=jc.y&&Ac.width>jc.width+160){Jc=jc.bottomRight.x+this.kz;const hd=jc.bottomRight.y;let Cd=!1;Jc+160>Ac.bottomRight.x&&(Jc=jc.topLeft.x-this.kz,Cd=!0);this.qo.Bmg(Bd.a.ozj,null,Kb);this.qo.e$b(this.vza,Kb);this.eo(Jc,hd,qb.rtl,Kb,Cd);I.EwaSettings.isChangeGateEnabled("OfficeVSO:5449290_RichTooltip")||
(this.qo.domElement(Kb).title=W.a.instance.Ua(690));this.$.frame.Ut.KR(Ub.a.Qd,this.$.domElement,this.onKeyUp,Kb);this.$.frame.Ut.xs(Ub.a.Vb,this.$.domElement,this.onKeyDown,!0);this.$.da.hb(211,ac=>{const Lc=W.a.instance.ga(1828)+" "+W.a.instance.ga(1750);ac.setEnabled(!0);ac.readText(Lc)});this.isVisible=!0}}rfb(){E.ULS.sendTraceTag(537154657,306,50,"PivotTableHandRaiseLaunchButton:ShowRichToolTip Show tooltip");I.EwaSettings.isChangeGateEnabled("OfficeVSO:5449290_RichTooltip")&&(this.ybb||(this.ybb=
new fe(this.$,this.qo.domElement(1)),this.ybb.text=W.a.instance.Ua(690)),this.ybb.Vih())}sgc(){this.ybb&&this.ybb.Pgi()}hide(){this.isVisible&&(this.qo.hide(),E.ULS.sendTraceTag(537154656,306,50,"PivotTableHandRaiseLaunchButton:Hide Dismissing Pivot table hand rasie OOUI."),this.$.frame.Ut.Aa(Ub.a.Qd,this.$.domElement,this.onKeyUp),this.$.frame.Ut.Fs(Ub.a.Vb,this.$.domElement,this.onKeyDown,!0),this.isVisible=this.oN=this.n_=!1)}Zda(qb){this.qo.getButton(qb).zdb();this.oN=!1}uNb(qb){this.qo.getButton(qb).TIb();
this.oN=!0;this.$.da.hb(211,Kb=>{const jc=W.a.instance.Ua(690)+" "+W.a.instance.ga(1829);Kb.setEnabled(!0);Kb.readText(jc)})}kNf(){E.ULS.sendTraceTag(537154655,306,50,"PivotTableHandRaiseLaunchButton:OpenPane Pivot table hand rasie OOUI clicked.");const qb={SourceControlId:"PivotTableHandRaise"};qb.StartingRanges=[this.K_b];this.$.Yc(2137617149,0,0,qb).continueWith(()=>{this.hide()})}eo(qb,Kb,jc,Ac,Jc){this.qo.eo(qb,Kb,jc,Ac,!1,Jc);E.ULS.sendTraceTag(556615632,306,50,"PivotTableHandRaiseLaunchButton:ShowAt Pivot table hand raise OOUI shown.")}}
Object(C.a)(Ue,"PivotTableHandRaiseLaunchButton",xd.a,[]);var mc=a(271);class Fc{constructor(){this.yaa=0;this.localStorage=new mc.a;this.yaa=this.wXh()}jba(){return this.yaa}zLb(){this.yaa=0;this.x3f()}wAb(){this.yaa++;this.x3f()}wXh(){try{if(!this.localStorage.Me())return 0;const qb=this.localStorage.getItem("PivotTableHandRaiseDismissCount");return qb?Number.parseLocale(qb):0}catch(qb){return E.ULS.sendTraceTag(522311635,306,10,"PivotTableHandRaiseLocalStorageLoaderSaver:getDismissCountFromCache failure"),
0}}x3f(){try{this.localStorage.Me()&&this.localStorage.setItem("PivotTableHandRaiseDismissCount",this.yaa.toString())}catch(qb){E.ULS.sendTraceTag(522311634,306,10,"PivotTableHandRaiseLocalStorageLoaderSaver:saveDismissCountToCache failure")}}}Object(C.a)(Fc,"PivotTableHandRaiseLocalStorageLoaderSaver",null,[]);class bd{constructor(qb){this.version=1;this.mSd=0;this.$=qb}jba(){return Object(G.a)(this,void 0,void 0,function*(){this.l2f||(this.l2f=this.xXh());return(yield this.l2f)+this.mSd})}zLb(){this.mSd=
0;this.H3f(0)}wAb(){Object(G.a)(this,void 0,void 0,function*(){this.mSd++;this.H3f(yield this.jba())})}xXh(){return new Promise(qb=>{Eb.w(this.$.pa.va,3,Kb=>{ya.a.Zf(Kb.Errors)?(E.ULS.sendTraceTag(520370311,0,10,`readRoamingString encountered an error. Errors: ${ya.a.qc(Kb.Errors)}`),qb(Number.POSITIVE_INFINITY)):Kb.Result?(Kb=JSON.parse(Kb.Result),!Kb||null==Kb.version||null==Kb.yaa||Kb.version<this.version?qb(0):qb(Kb.yaa)):(E.ULS.sendTraceTag(520370310,0,50,"readRoamingString - Received null"),
qb(0))},(Kb,jc,Ac)=>{Kb=Ta.a.Ue(Kb.data);E.ULS.sendTraceTag(520370309,0,10,`OnRoamingOperationFailure: Encountered errors for ${Ac}. Errors: ${ya.a.qc(Kb)}.`);qb(Number.POSITIVE_INFINITY)},null,null)})}H3f(qb){qb!==Number.POSITIVE_INFINITY&&(qb=JSON.stringify({version:this.version,yaa:qb}),Eb.C(this.$.pa.va,3,qb,Kb=>{ya.a.Zf(Kb.Errors)?E.ULS.sendTraceTag(520370308,0,10,`writeRoamingString encountered an error. Errors: ${ya.a.qc(Kb.Errors)}`):Kb.Result||E.ULS.sendTraceTag(520370307,0,10,"writeRoamingString failed to write to roaming service.")},
(Kb,jc,Ac)=>{Kb=Ta.a.Ue(Kb.data);E.ULS.sendTraceTag(520370306,0,10,`OnRoamingOperationFailure: Encountered errors for ${Ac}. Errors: ${ya.a.qc(Kb)}.`)},null,null))}}Object(C.a)(bd,"PivotTableHandRaiseRoamingHandler",null,[312]);var de=a(83),Md=a(840);class se extends Md.a{constructor(){super();this.userCommands=null;this.H_=Object.assign(new xb.a,{T_:se.getTypeName(),B_:se.Pd()})}static getTypeName(){return"AugLoop_ExcelProactiveSuggestion_ProactiveSuggestionSignal"}static Pd(){return["AugLoop_Signals_Signal"]}}
Object(C.a)(se,"ProactiveSuggestionSignal",Md.a,[]);class tc extends se{constructor(){super();this.interpretations=null;this.H_=Object.assign(new xb.a,{T_:tc.getTypeName(),B_:tc.Pd()})}static getTypeName(){return"AugLoop_ExcelProactiveSuggestion_PivotTableProactiveSuggestionSignal"}static Pd(){return["AugLoop_ExcelProactiveSuggestion_ProactiveSuggestionSignal","AugLoop_Signals_Signal"]}}Object(C.a)(tc,"PivotTableProactiveSuggestionSignal",se,[]);class dd{constructor(){this.confidence=0;this.orientation=
this.location=null;this.headerColumnCount=this.headerRowCount=0;this.fields=null}}Object(C.a)(dd,"ExcelRecognizedTableInterpretationNew",null,[]);class Hd{constructor(){this.headerReferences=this.aggregations=this.classification=null}}Object(C.a)(Hd,"ExcelRecognizedTableFieldNew",null,[]);class Xc{constructor(){this.left=this.top=0}}Object(C.a)(Xc,"ExcelRecognizedTableCellReferenceNew",null,[]);var gd=a(1166);class je{constructor(){this.type=null;this.timestamp=0}}Object(C.a)(je,"UserCommand",null,
[]);class Ee extends wb.a{constructor(){super();this.suggestPivotTable=!1;this.H_=Object.assign(new xb.a,{T_:Ee.getTypeName(),B_:Ee.Pd()})}static getTypeName(){return"AugLoop_ExcelProactiveSuggestion_ProactiveSuggestionAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(C.a)(Ee,"ProactiveSuggestionAnnotation",wb.a,[]);class ae{constructor(qb,Kb,jc,Ac,Jc,hd=null){this.VLi=I.EwaSettings.getIntFeatureGate("Microsoft.Office.ExcelOnline.MaxPivotTableHandRaiseCount",1);this.qxf=I.EwaSettings.getIntFeatureGate("Microsoft.Office.ExcelOnline.MaxPivotTableHandRaiseDismissCount",
20);this.Eh=null;this.kxd=!1;this.Zsc=this.Ysc=null;this.ydi=(Cd,ac)=>{Cd=this.xdi(ac);a:{switch(Cd){case "InvalidContextInfo":case "SurveyParamsNull":ac="Error";break a;case "Success":ac="Success";break a}ac=void 0}E.ULS.sendTraceTag(521441668,306,50,`PivotTableHandRaiseManager.handlePivotTableActivationCallback Results: ${JSON.stringify({result:Cd,status:ac})}`);return null};this.Zc=(Cd,ac)=>{ac&&ac.lpf||(pa.h(this.$).ha.xB(this.Zc),I.EwaSettings.isChangeGateEnabled("OfficeVSO:6238554_PTPSRemoveCardUXFlight")||
I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseCardUX",!1)?(E.ULS.sendTraceTag(526984154,306,50,"PivotTableProactiveSuggestion: selection changed, hide hand raise card"),this.b$c()):this.Eh.hide())};this.$=qb;this.tableIntelligenceManager=Kb;this.augmentationLoopManager=Jc;this.Afe=this.CKc=0;I.EwaSettings.isChangeGateEnabled("OfficeVSO:6238554_PTPSRemoveCardUXFlight")||(this.Eh=new Ue(this.$,Ac,hd));this.proactiveSuggestionCard=jc;lb.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Cd=>
{Cd.isFeatureEnabled("ExcelIdeasPivotTableHandRaise",!1).then(ac=>this.kxd=ac);Cd.FAa("ExcelIdeasPivotTableHandRaise",ac=>{this.kxd=ac.isEnabled})});(qb=lb.a.instance.Tb("Common.ISystemInitiatedFeedback"))&&qb.execute(Cd=>{Cd.fKb("PivotTableHandRaiseSurface",this.ydi)});if(I.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",!1))this.Zsc=new bd(this.$);I.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&
(this.Ysc=new Fc);I.EwaSettings.isChangeGateEnabled("OfficeVSO:7530057_PTPSIntelligentTriggering")&&this.activateAnnotation()}activateAnnotation(){this.augmentationLoopManager.register(this.augmentationLoopManager.O4a().xeb("PivotTableProactiveSuggestions").activateAnnotation({annotationType:Ee.getTypeName(),Au:!1,JK:()=>{E.ULS.sendTraceTag(509449989,306,50,"PivotTableHandRaiseManager: Received annotation");return this.byd()}}).ueb((qb,Kb)=>{E.ULS.sendTraceTag(509449990,306,50,JSON.stringify({ndk:qb,
errorCode:Kb}))}).build())}get hvf(){return this.Afe}Qea(qb){return Object(G.a)(this,void 0,void 0,function*(){const Kb=Date.now(),jc=yield this.s_j(qb);a:{switch(jc){case "Success":case "SuccessWithLppDisabled":var Ac="Success";break a;case "DismissCountAboveLimit":case "IncorrectLicense":case "NotInEditMode":case "NotPivotable":case "NoTableMetadata":case "RangeTooLarge":case "TriggerCountAboveMax":Ac="Aborted";break a;case "ActiveRangeNull":case "SystemInitiatedFeedbackNull":Ac="Error";break a}Ac=
void 0}E.ULS.sendTraceTag(521441669,306,50,`PivotTableHandRaiseManager.triggerHandRaise Results: ${JSON.stringify({result:jc,status:Ac,duration:Date.now()-Kb})}`)})}s_j(qb){return Object(G.a)(this,void 0,void 0,function*(){I.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&F.b(this.$).qd(X.a.f$i,{},void 0,!0);if(!this.kxd)return E.ULS.sendTraceTag(537154654,306,50,"PivotTableHandRaiseManager:TriggerHandRaise License is not enabled."),"IncorrectLicense";if(!qb)return E.ULS.sendTraceTag(537154653,
306,10,"PivotTableHandRaiseManager:TriggerHandRaise activeRangeForHandRaise is null."),"ActiveRangeNull";if(I.EwaSettings.isChangeGateEnabled("OfficeVSO:6212469_PTPSReadOnly")&&!this.$.ea.isEditMode)return E.ULS.sendTraceTag(523100545,306,50,"PivotTableHandRaiseManager:TriggerHandRaise not in edit mode."),"NotInEditMode";if(I.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",
!1)){if((yield this.Zsc.jba())>=this.qxf)return E.ULS.sendTraceTag(520370312,306,50,"PivotTableHandRaiseManager:TriggerHandRaise dismiss count above limit"),"DismissCountAboveLimit"}else if(I.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&this.Ysc.jba()>=this.qxf)return E.ULS.sendTraceTag(522311633,306,50,"PivotTableHandRaiseManager:TriggerHandRaise dismiss count above limit"),"DismissCountAboveLimit";if(I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseTestOnly",
!1))return this.CKc<this.VLi?(this.acg(new Za.a(qb,bb.d(this.$.ua.na))),"SuccessWithLppDisabled"):"TriggerCountAboveMax";const Kb=this.B5h(qb);if(!Kb)return"NoTableMetadata";if(!I.EwaSettings.isChangeGateEnabled("OfficeVSO:7530057_PTPSIntelligentTriggering")&&!this.Dzi(Kb))return E.ULS.sendTraceTag(537154652,306,50,"PivotTableHandRaiseManager:TriggerHandRaise table data is not pivotable."),"NotPivotable";if(I.EwaSettings.isChangeGateEnabled("OfficeVSO:7188570_PTPSUseXLIMRange")){if(176E4<Kb.Ry.range.hw)return E.ULS.sendTraceTag(523776329,
306,50,"PivotTableHandRaiseManager.triggerHandRaise range is too large to generate suggestions"),"RangeTooLarge";if(I.EwaSettings.isChangeGateEnabled("OfficeVSO:7530057_PTPSIntelligentTriggering"))return this.yAj(Kb),"Success";this.sheetRange=Kb.Ry;return this.byd()}this.sheetRange=new Za.a(qb,bb.d(this.$.ua.na));return this.byd()})}dispose(){this.Eh&&this.Eh.dispose();this.proactiveSuggestionCard&&this.proactiveSuggestionCard.dispose()}B5h(qb){var Kb;E.ULS.sendTraceTag(537154651,306,50,"PivotTableHandRaiseManager:GetRelevantRecognizedTable get table metadata info.");
(qb=null===(Kb=this.tableIntelligenceManager.pwa().F5a(new Za.a(qb,bb.d(this.$.ua.na)),6)[0])||void 0===Kb?void 0:Kb.table)&&E.ULS.sendTraceTag(520147406,306,50,`PivotTableHandRaiseManager.getRelevantRecognizedTable Found metadata with ID: ${qb.id}`);return qb}yAj(qb){this.sheetRange=qb.Ry;const Kb=new tc;Kb.interpretations=Object(de.toArray)(qb.interpretations).map(jc=>{const Ac=new dd;Ac.confidence=jc.confidence;Ac.fields=Object(de.toArray)(jc.fields).map(Jc=>{const hd=new Hd;hd.aggregations=Object(de.toArray)(Jc.aggregations).map(Cd=>
{switch(Cd){case 2:return"average";case 1:return"count";case 5:return"distinctCount";case 4:return"max";case 3:return"min";case 6:return"stdDev";case 0:return"sum";case 7:return"variance"}});switch(Jc.classification){case 1:hd.classification="dimension";break;case 2:hd.classification="measure"}hd.headerReferences=Object(de.toArray)(Jc.headerReferences).map(Cd=>{const ac=new Xc;ac.left=Cd.left;ac.top=Cd.top;return ac});return hd});Ac.headerColumnCount=jc.headerColumnCount;Ac.headerRowCount=jc.headerRowCount;
switch(jc.orientation){case 1:Ac.orientation="rowMajor";break;case 2:Ac.orientation="columnMajor"}Ac.location=new gd.a;Ac.location.bottom=jc.PD.bottom;Ac.location.left=jc.PD.left;Ac.location.right=jc.PD.right;Ac.location.top=jc.PD.top;return Ac});qb=new je;qb.type="SortAscending";qb.timestamp=Date.now();Kb.userCommands=[qb];E.ULS.sendTraceTag(509450059,306,50,"PivotTableHandRaiseManager.sendPivotTableProactiveSuggestionSignal: Submit operation signal");this.augmentationLoopManager.mPb(Kb)}byd(){return Object(G.a)(this,
void 0,void 0,function*(){const qb=lb.a.instance.Tb("Common.ISystemInitiatedFeedback");return qb?(this.Afe=this.hvf+1,E.ULS.sendTraceTag(537154648,306,50,`PivotTableHandRaiseManager:TriggerHandRaise PivotTableHandRaiseActivity LPP activity log count: ${this.hvf}`),(yield new Promise(Kb=>{qb.execute(Kb)})).logActivity("PivotTableHandRaiseActivity",null,this.sheetRange),"Success"):"SystemInitiatedFeedbackNull"})}xdi(qb){E.ULS.sendTraceTag(537154647,306,50,"PivotTableHandRaiseManager:HandlePivotTableActivationCallback HandlePivotTableActivationCallback invoked.");
return qb?!qb.contextInfo||!qb.contextInfo.length||1<qb.contextInfo.length?(E.ULS.sendTraceTag(537154645,306,10,"PivotTableHandRaiseManager:HandlePivotTableActivationCallback no valid contextInfo in surveyParams."),"InvalidContextInfo"):this.acg(qb.contextInfo[0].context):(E.ULS.sendTraceTag(537154646,306,10,"PivotTableHandRaiseManager:HandlePivotTableActivationCallback surveyParams is null."),"SurveyParamsNull")}acg(qb){I.EwaSettings.isChangeGateEnabled("OfficeVSO:7505157_PTPSPreloadIdeas")&&void this.pbj();
I.EwaSettings.isChangeGateEnabled("OfficeVSO:6238554_PTPSRemoveCardUXFlight")||I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseCardUX",!1)?(I.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&F.b(this.$).qd(X.a.e$i,{},void 0,!0),E.ULS.sendTraceTag(526984158,306,50,"PivotTableProactiveSuggestion: show pivot table hand raise."),this.proactiveSuggestionCard.show(qb.range,W.a.instance.ga(1833),W.a.instance.Ua(692),W.a.instance.ga(1831),W.a.instance.ga(1832),
()=>{var Kb,jc;I.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&F.b(this.$).qd(X.a.d$i,{},void 0,!0);E.ULS.sendTraceTag(526984157,306,50,"PivotTableProactiveSuggestion:OpenPane Pivot table hand raise OOUI clicked.");I.EwaSettings.isChangeGateEnabled("OfficeVSO:6423587_PTPSCardRaceConditionFix")&&this.proactiveSuggestionCard.hide();const Ac={SourceControlId:"PivotTableHandRaise"};I.EwaSettings.isChangeGateEnabled("OfficeVSO:7188570_PTPSUseXLIMRange")?(Ac.Qck=null!==(jc=null===
(Kb=pa.h(this.$).tb.uh(qb.range))||void 0===Kb?void 0:Kb.name)&&void 0!==jc?jc:Object(V.x)(qb.range,this.$.ua.rkd(qb.sheetId).name,!0),Kb=-1444574190):(Ac.Vtg=[qb.range],Kb=2137617149);this.$.Yc(Kb,0,0,Ac).continueWith(()=>{I.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",!1)?this.Zsc.zLb():I.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&this.Ysc.zLb();
I.EwaSettings.isChangeGateEnabled("OfficeVSO:6423587_PTPSCardRaceConditionFix")||this.proactiveSuggestionCard.hide()})},()=>{I.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&F.b(this.$).qd(X.a.c$i,{},void 0,!0);E.ULS.sendTraceTag(526984156,306,50,"PivotTableProactiveSuggestion: Not Now clicked.");this.b$c()},void 0,void 0,void 0,void 0,I.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")?11:void 0,I.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")?
[13,8,10,6,4,2,0]:void 0,void 0,Kb=>{Kb=Kb?new Sys.UI.DomEvent(Kb):null;"keydown"===(null===Kb||void 0===Kb?void 0:Kb.type)&&27===Kb.keyCode&&(I.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&F.b(this.$).qd(X.a.b$i,{},void 0,!0),this.b$c())},!1,!0)):(this.Eh.setRange(qb.range),this.Eh.LBa());pa.h(this.$).ha.jC(this.Zc);this.CKc+=1;return"Success"}pbj(){return Object(G.a)(this,void 0,void 0,function*(){(yield L.GetServiceTaskFactory.n4(this.$.da,374,375,1)).vQf()})}Dzi(qb){for(let Kb of qb.interpretations)if(.75<=
Kb.confidence&&2===Kb.orientation&&1===Kb.headerRowCount)return!0;return!1}b$c(){if(I.EwaSettings.isChangeGateEnabled("OfficeVSO:7071239_SwitchSheetWhenCardOpen")||!I.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")||this.proactiveSuggestionCard.isVisible)this.proactiveSuggestionCard.hide(),I.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",!1)?this.Zsc.wAb():
I.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&this.Ysc.wAb()}}Object(C.a)(ae,"PivotTableHandRaiseManager",null,[267,3]);var Yb=a(70);class Sc extends oa.a{constructor(qb){super();this.$=qb;this.Gb()}create(){const qb=L.GetServiceTaskFactory.Pa(this.$.da,20,404,1),Kb=L.GetServiceTaskFactory.Pa(this.$.da,486,487,1);let jc=null;I.EwaSettings.isChangeGateEnabled("OfficeVSO:6238554_PTPSRemoveCardUXFlight")||(jc=Object(Yb.b)("OfficeVSO:7629428_MigrateSharedUIControlsFactoryService")?
Object(Y.c)(Pa.a.resolve(fb.L,{Wb:1})):L.GetServiceTaskFactory.Pa(this.$.da,12,477,1));let Ac=null;I.EwaSettings.isChangeGateEnabled("OfficeVSO:6238554_PTPSRemoveCardUXFlight")||(Ac=L.GetServiceTaskFactory.Pa(this.$.da,388,387,1));let Jc;I.EwaSettings.isChangeGateEnabled("OfficeVSO:7530057_PTPSIntelligentTriggering")&&(Jc=L.GetServiceTaskFactory.Pa(this.$.da,328,327,1));const hd=[qb,Kb];jc&&hd.push(jc);Ac&&hd.push(Ac);Jc&&hd.push(Jc);Ma.TaskExtensions.za(P.Task.uG(...hd),()=>{if(!this.$.da.Ba(430)){var Cd=
qb.result;const ac=Kb.result,Lc=null===Jc||void 0===Jc?void 0:Jc.result,rd=null===jc||void 0===jc?void 0:jc.result,Yd=null===Ac||void 0===Ac?void 0:Ac.result;Cd&&ac?(Cd=new ae(this.$,Cd,ac,rd,Lc,Yd),this.qb(Cd),this.$.da.Ha(430,Cd)):(null==Cd&&E.ULS.sendTraceTag(537154644,306,10,"PivotTableHandRaiseManagerFactory.Create: TableIntelligenceManager instance null."),null==ac&&E.ULS.sendTraceTag(525620053,306,10,"PivotTableHandRaiseManagerFactory.Create: ProactiveSuggestionCard instance null."),this.qb(null))}},
this.$.ka)}static la(qb){qb.da.Ha(431,new Sc(qb))}dispose(){this.$=null;super.dispose()}}Object(C.a)(Sc,"PivotTableHandRaiseManagerFactory",oa.a,[]);var qd=a(1292),Id=a(1199),ic=a(27),Gc=a(242),jd=a(35),ed=a(51),Qd=a(28),te=a(49);class xe extends Gc.a{constructor(qb){super(document.createElement("div"));this.$=qb;this.isMac=ic.a.isMac;this.onKeyDown=Kb=>{Kb=Kb.Ea;switch(Kb.keyCode){case 27:if(this.$m.onDismiss)this.$m.onDismiss(Kb);this.hide();return!0;default:return!1}};this.onKeyUp=Kb=>{Kb=Kb.Ea;
switch(Kb.keyCode){case 121:return Kb.altKey&&Kb.shiftKey?(this.focus(),!0):!1;default:return!1}};this.Zif=(Kb,jc)=>Kb.x==jc.x&&Kb.y==jc.y&&Kb.width==jc.width&&Kb.height==jc.height;this.S2e=(Kb,jc)=>{const Ac=Kb.topLeft.y,Jc=Kb.bottomRight.y,hd=Kb.topLeft.x;Kb=Kb.bottomRight.x;switch(jc){case 0:return new ed.a(hd+320,Ac-166);case 1:return new ed.a(hd-(320-(Kb-hd))/2,Ac-166);case 2:return new ed.a(Kb-320,Ac-166);case 3:return new ed.a(hd,Ac);case 4:return new ed.a(hd+320,Jc+166);case 5:return new ed.a(hd-
(320-(Kb-hd))/2,Jc+166);case 6:return new ed.a(Kb-320,Jc+166);case 7:return new ed.a(hd,Jc);case 8:return new ed.a(hd-320,Ac+166);case 9:return new ed.a(hd-320,Ac-(166-(Jc-Ac))/2);case 10:return new ed.a(hd-320,Jc-166);case 11:return new ed.a(Kb+320,Ac+166);case 12:return new ed.a(Kb+320,Ac-(166-(Jc-Ac))/2);case 13:return new ed.a(Kb+320,Jc-166);default:throw Error(`Unhandled direction: ${jc}`);}};this.v1d=()=>{this.isVisible?(this.Y$j=Qd.a.Ya.ze.m,this.hide(),this.Llg=te.a.instance.create(()=>{this.m4j()},
this.Tpg,"ProactiveSuggestionCard.UpdateCardPosition",void 0,!0)):this.grid.view.Xq(this.v1d)};this.m4j=()=>{Qd.a.Ya.ze.m-this.Y$j>=this.Tpg&&(this.iwc(),this.C4f++,E.ULS.sendTraceTag(512266886,1,50,Pb.a.Ec({["message"]:"ProactiveSuggestionUIControl.updateCardPositionTick: calling AppChrome API to render card UI.",["updateCount"]:this.C4f})))};this.grid=pa.h(qb);this.uJd=null;this.x4b=this.LU=!1;this.Tpg=250;this.Xyc=!1}show(qb,Kb,jc,Ac,Jc,hd,Cd,ac,Lc,rd,Yd,ie,Je,ff,Ae,pf,he){this.rootBounds=Sys.UI.DomElement.getBounds(this.grid.Iwa.mc);
this.Xyc=he;this.jsi=!!ie;this.tKa=Je;this.C4f=0;this.$m={range:qb,container:this.domElement,title:Kb,description:jc,primaryButtonText:Ac,secondaryButtonText:Jc,v1i:hd,d3i:Cd,menuItems:ac,tHb:Lc,t6:rd,icon:Yd,direction:ie,gapSpace:ff,onDismiss:Ae,djh:Va=>{Va&&(this.uJd=Va)},setInitialFocus:pf,ariaLabel:this.isMac?Kb+" "+W.a.instance.ga(1835):Kb+" "+W.a.instance.ga(1834)};qb=this.iwc();this.LU||(this.$.frame.Ut.ta(Ub.a.Qd,this.$.domElement,this.onKeyUp),this.$.frame.Ut.xs(Ub.a.Vb,this.$.domElement,
this.onKeyDown,!0),this.LU=!0);this.$.da.hb(211,Va=>{const bc=this.isMac?W.a.instance.ga(1835):W.a.instance.ga(1834);Va.setEnabled(!0);Va.readText(bc)});return qb}hide(){E.ULS.sendTraceTag(527218006,1,50,"ProactiveSuggestionUIControl.Hide: calling AppChrome API to unmount card UI.");I.EwaSettings.isChangeGateEnabled("OfficeVSO:6423587_PTPSCardRaceConditionFix")&&this.Llg&&this.Llg.cancel();appChrome.unmountReactComponent(this.domElement);this.isVisible=!1;this.grid.view.Xq(this.v1d);this.LU&&(this.$.frame.Ut.Aa(Ub.a.Qd,
this.$.domElement,this.onKeyUp),this.$.frame.Ut.Fs(Ub.a.Vb,this.$.domElement,this.onKeyDown,!0),this.LU=!1)}focus(){this.uJd&&this.uJd.focus()}dispose(){super.dispose()}getDirectionalHint(qb){var Kb,jc,Ac=this.grid.jb.Li(qb);qb=this.grid.Eg(qb,Ac);Ac=this.grid.Vf(Ac).Dn;const Jc=this.S2e(qb,null!==(Kb=this.$m.direction)&&void 0!==Kb?Kb:13);if(Ac.pia(Jc))return null!==(jc=this.$m.direction)&&void 0!==jc?jc:13;if(void 0===this.$m.direction)return 11;if(this.tKa&&0<this.tKa.length)for(Kb=0;Kb<this.tKa.length;Kb++){if(jc=
this.S2e(qb,this.tKa[Kb]),Ac.pia(jc))return this.tKa[Kb]}else return this.$m.direction}getCellBounds(qb){if(qb=this.grid.Jb(qb))if(qb.cell.ek)if(this.grid.mba(qb.cell.zv.gd)){if(!I.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon"))return{bounds:this.grid.getCellBounds(qb.cell,!0),direction:void 0};var Kb=qb.range,jc=this.grid.jb.Li(Kb),Ac=this.grid.Eg(Kb,jc);if(this.grid.Vf(jc).Dn.vd(Ac))if(Kb=this.getDirectionalHint(Kb),void 0===Kb)E.ULS.sendTraceTag(512361876,1,15,"ProactiveSuggestionUIControl.GetCellBounds failed to show UI, direction is undefined");
else return{bounds:this.grid.getCellBounds(qb.cell,!0),direction:Kb};else E.ULS.sendTraceTag(512266887,0,15,"ProactiveSuggestionUIControl.GetCellBounds: Range not in visible area")}else E.ULS.sendTraceTag(525341026,1,15,"ProactiveSuggestionUIControl.GetCellBounds failed to show UI, gridViewBlock not found");else E.ULS.sendTraceTag(527218009,1,15,"ProactiveSuggestionUIControl.GetCellBounds: failed to show UI, formattedActiveCell is not in view.");else E.ULS.sendTraceTag(527218010,1,15,"ProactiveSuggestionUIControl.GetCellBounds: failed to show UI, formattedActiveCell is null.")}getRangeBounds(qb){var Kb=
this.grid.jb.Li(qb),jc=this.grid.Eg(qb,Kb);const Ac=this.grid.Vf(Kb);Kb=Ac.Dn;if(!Kb.vd(jc))return{bounds:this.rootBounds,direction:this.$m.direction};jc=Kb.xe(jc);var Jc=jc.topLeft.y;const hd=jc.bottomRight.y,Cd=jc.topLeft.x,ac=jc.bottomRight.x;jc=this.$m.direction;if(I.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")){if(jc=this.getDirectionalHint(qb),void 0===jc)return{bounds:this.rootBounds,direction:this.$m.direction}}else qb=new ed.a(ac,hd-134),this.x4b=!Kb.pia(qb);
qb=Sys.UI.DomElement.getLocation(Ac.domElement);Jc=new Sys.UI.Point(Cd+qb.x-Kb.topLeft.x,Jc+qb.y-Kb.topLeft.y);Kb=new Sys.UI.Point(ac+qb.x-Kb.topLeft.x,hd+qb.y-Kb.topLeft.y);Jc=jd.a(this.$).ska(Jc);Kb=jd.a(this.$).ska(Kb);return{bounds:new Sys.UI.Bounds(Jc.x,Jc.y,Kb.x-Jc.x,Kb.y-Jc.y),direction:jc}}uUh(){const qb=this.getRangeBounds(this.$m.range);return this.Xyc&&!this.Zif(qb.bounds,this.rootBounds)?qb:this.Xyc?void 0:this.getCellBounds(this.$m.range)}iwc(){if(!this.$m)return!1;if(I.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")){var qb=
this.uUh();if(!qb)return E.ULS.sendTraceTag(512361875,1,15,"ProactiveSuggestionUIControl.renderCard: cardLayoutInfo is undefined"),!1;var Kb=qb.bounds;qb=qb.direction;if(void 0===Kb)return E.ULS.sendTraceTag(512361874,1,15,"ProactiveSuggestionUIControl.renderCard: bounds is undefined"),!1}else this.Xyc?(Kb=this.getRangeBounds(this.$m.range).bounds,I.EwaSettings.isChangeGateEnabled("OfficeVSO:6472403_FallbackCardLocation")?this.$m.direction=this.x4b&&null!=this.tKa?this.tKa[0]:this.$m.direction:this.$m.direction=
this.jsi?this.$m.direction:this.x4b?11:13,this.x4b=!1):(Kb=this.getCellBounds(this.$m.range),Kb=null!=Kb?Kb[0]:void 0);if(this.Zif(Kb,this.rootBounds))return E.ULS.sendTraceTag(525341025,1,15,"ProactiveSuggestionUIControl.RenderCard failed to show UI, targetBounds set to root"),!1;E.ULS.shipAssertTag(527218008,1,!!Kb,"ProactiveSuggestionUIControl.RenderCard: target cell bounds should not be null.");E.ULS.sendTraceTag(527218007,1,50,"ProactiveSuggestionUIControl.RenderCard: calling AppChrome API to render card UI.");
appChrome.renderProactiveSuggestionCard(Kb.y,Kb.x,Kb.y+Kb.height,Kb.x+Kb.width,this.$m.container,this.$m.title,this.$m.description,this.$m.primaryButtonText,this.$m.secondaryButtonText,this.$m.v1i,this.$m.d3i,this.$m.menuItems,this.$m.tHb,this.$m.t6,this.$m.icon,I.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")?qb:this.$m.direction,this.$m.gapSpace,this.$m.onDismiss,this.$m.djh,this.$m.setInitialFocus,this.$m.ariaLabel);this.isVisible=!0;this.grid.view.Vs(this.v1d);return!0}}
Object(C.a)(xe,"ProactiveSuggestionCard",Gc.a,[263]);class He extends oa.a{constructor(qb){super();this.$=qb;this.Gb()}static la(qb){qb.da.Ha(487,new He(qb))}create(){var qb;this.qb(null!==(qb=this.$.da.Ba(486))&&void 0!==qb?qb:this.$.da.Ha(486,new xe(this.$)))}dispose(){this.$=null;super.dispose()}}Object(C.a)(He,"ProactiveSuggestionCardFactory",oa.a,[]);var We=a(120);class ye{constructor(qb){qb.jz(Kb=>{void Kb.eba(1).then(()=>{const jc=document.createElement("div"),Ac=Object(pa.h)(qb).zj;appChrome.renderProactiveSuggestionDebugPane(jc,
Ac,We.a.Ku)})});I.EwaSettings.xa(259)&&I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligence",!1)&&void L.GetServiceTaskFactory.n4(qb.da,510,511,1)}}Object(C.a)(ye,"ProactiveSuggestionDebugToolsManager",null,[]);class $e extends oa.a{constructor(qb){super();this.$=qb;this.Gb()}static la(qb){qb.da.Ha(509,new $e(qb))}create(){this.qb(Object(Ka.a)(this.$.da,508,()=>new ye(this.$)))}}Object(C.a)($e,"ProactiveSuggestionDebugToolsManagerFactory",oa.a,[]);var jf=a(1167);class gf{constructor(qb,
Kb){this.$=qb;this.tableIntelligenceManager=Kb;qb.ua.Yf(()=>this.H1d());this.tableIntelligenceManager.CZa("Valid",()=>{this.H1d()});this.tableIntelligenceManager.CZa("Invalid",()=>{this.H1d()})}H1d(){const qb=[],Kb=[],jc=[],Ac=this.$.ua.na;if(Ac){var Jc=this.tableIntelligenceManager.pwa().F5a(new Za.a(Object(V.f)(),Ac.sheetId),2);for(const hd of Jc){if(hd.table.Ry.sheetId!==Ac.sheetId)continue;Jc=this.kTh(hd.table);if(!Jc)continue;const Cd=Jc.PD.clone();Cd.left+=Jc.headerColumnCount;Cd.top+=Jc.headerRowCount;
let ac=!0,Lc=!0;for(let rd=0;rd<Jc.fields.count;rd++){const Yd=Cd.clone();2===Jc.orientation?(Yd.left+=rd,Yd.right=Yd.left):(Yd.top+=rd,Yd.bottom=Yd.top);1===Jc.fields.ma(rd).classification?(this.Wqe(qb,Yd,Lc),Lc=!1):(this.Wqe(Kb,Yd,ac),ac=!1)}Jc=this.w_h(Jc);null!=Jc&&jc.push(Jc)}this.NMd();0<qb.length&&this.mz(qb,[32]);0<Kb.length&&this.mz(Kb,[33]);0<jc.length&&this.mz(jc,[31])}else E.ULS.sendTraceTag(520147412,0,50,"GridHighlighter.updateGridHighlights: Active sheet null")}NMd(){const qb=[33,32,
31];Object(pa.h)(this.$).Eb.Tj(qb);Object(pa.h)(this.$).Eb.JSa(new Za.a(null,bb.d(this.$.na)),qb)}Wqe(qb,Kb,jc){!qb.length||jc?qb.push(Kb.clone()):(jc=qb[qb.length-1],jc.right+1===Kb.left?jc.right=Kb.right:jc.bottom+1===Kb.top?jc.bottom=Kb.bottom:qb.push(Kb.clone()))}kTh(qb){var Kb=qb.interpretations;return 0===(null===Kb||void 0===Kb?void 0:Kb.count)?null:1===Kb.count?Kb.ma(0):2===Kb.count?Kb.ma(0).confidence===Kb.ma(1).confidence?(qb=2===Kb.ma(0).orientation?Kb.ma(0):Kb.ma(1),Kb=1===Kb.ma(0).orientation?
Kb.ma(0):Kb.ma(1),new jf.a(qb.PD,qb.confidence,Kb.headerRowCount,qb.headerColumnCount,qb.orientation,qb.fields)):qb.interpretations.ma(0).confidence>qb.interpretations.ma(1).confidence?qb.interpretations.ma(0):qb.interpretations.ma(1):null}mz(qb,Kb){qb=Za.a.qUa(bb.d(this.$.na),qb);Object(pa.h)(this.$).Eb.CB(qb,Kb,!0)}w_h(qb){const Kb=qb.PD.clone();if(2===qb.orientation){if(0===qb.headerRowCount)return null;Kb.bottom=Kb.top+qb.headerRowCount-1}else{if(0===qb.headerColumnCount)return null;Kb.right=
Kb.left+qb.headerColumnCount-1}return Kb}}Object(C.a)(gf,"RecognizedTableGridHighlighter",null,[]);class rf extends oa.a{constructor(qb){super();this.$=qb;this.Gb()}static la(qb){qb.da.Ha(511,new rf(qb))}create(){void L.GetServiceTaskFactory.n4(this.$.da,20,404,1).then(qb=>{this.qb(Object(Ka.a)(this.$.da,510,()=>new gf(this.$,qb)))})}}Object(C.a)(rf,"RecognizedTableGridHighlighterFactory",oa.a,[]);var Mf=a(1002),Qa=a(256);class Zb extends Mf.a{constructor(qb){super(qb,Zb.featureName)}get ee(){return Qa.a.iHh}show(qb=
null,Kb,jc,Ac){this.Zag(qb,Jc=>{appChrome.renderExcelIntelligenceSuggestionCard(this.domElement,Jc.y,Jc.x,Jc.y+Jc.height,Jc.x+Jc.width,Kb,jc,Ac,this.L8f)})}}Object(C.a)(Zb,"ExcelIntelligenceUIControl",Mf.a,[285]);class nb{constructor(qb,Kb,jc){this.hKa=this.KCc=this.agaveCommandManager=null;this.jHh=I.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ExcelIntelligenceUsesLPP",!1);this.BBe=0;this.DLi=I.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.MaxExcelIntelligenceCalloutShownCount",
5);this.ryf=I.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.MininumTableRowsForExcelIntelligenceCallout",4);this.Zc=()=>{this.sbg()};this.qci=(Ac,Jc)=>{E.ULS.sendTraceTag(509633888,306,50,"handleExcelIntelligenceActivationCallback callback invoked");if(!Jc)return E.ULS.sendTraceTag(509633887,306,10,"handleExcelIntelligenceActivationCallback surveyParams is null"),null;if(!Jc.contextInfo||!Jc.contextInfo.length||1<Jc.contextInfo.length)return E.ULS.sendTraceTag(509633886,306,10,"handleExcelIntelligenceActivationCallback no valid contextInfo in surveyParams"),
null;this.hKa.show(Jc.contextInfo[0].context,()=>this.YBf(),()=>this.onIgnore(),()=>this.Pca());return null};this.$=qb;this.gridView=Object(pa.h)(qb);this.agaveCommandManager=Kb;this.hKa=null!==jc&&void 0!==jc?jc:new Zb(this.$);this.gridView.ha.jC(this.Zc);this.jHh&&(this.KCc=this.gkj())}gkj(){const qb=lb.a.instance.Tb("Common.ISystemInitiatedFeedback");qb?qb.execute(Kb=>{Kb.fKb("ExcelIntelligenceHandRaiseSurface",this.qci)}):E.ULS.sendTraceTag(509618381,306,10,"registerExcelIntelligenceLPPCallback failed, ISystemInitiatedFeedback is null");
return qb}dispose(){this.gridView.ha.xB(this.Zc)}sbg(){const qb=this.gridView.ha.ra.activeCell;this.hKa.hide();this.NLj(qb)&&(null!=this.KCc?this.KCc.execute(Kb=>{Kb.logActivity("ExcelIntelligenceHandRaiseActivity",null,qb)}):(this.BBe++,this.hKa.show(qb,()=>this.YBf(),()=>this.onIgnore(),()=>this.Pca())))}NLj(qb){var Kb;return(null===(Kb=this.agaveCommandManager)||void 0===Kb?0:Kb.oui())?!1:!this.KCc&&this.BBe>=this.DLi?(E.ULS.sendTraceTag(509618380,306,50,"ExcelIntelligence callout not shown as limit has been reached"),
!1):null!=this.gridView.tb.Lkd(qb,this.ryf)}YBf(){E.ULS.sendTraceTag(509659226,1,50,"ExcelIntelligenceSuggestionCard Applied");const qb={SourceControlId:"AnalyzeDataExcelIntelligenceHandRaise",tableName:this.gridView.tb.Lkd(this.gridView.ha.ra.activeCell,this.ryf).name};this.$.Yc(-167264441,0,0,qb).continueWith(()=>{this.hKa.hide()})}onIgnore(){this.hKa.hide();E.ULS.sendTraceTag(509659225,1,50,"ExcelIntelligenceSuggestionCard Ignored")}Pca(){this.hKa.hide();E.ULS.sendTraceTag(509659224,1,50,"ExcelIntelligenceSuggestionCard Cancelled")}}
Object(C.a)(nb,"ExcelIntelligenceCalloutManager",null,[262,3]);class Tb extends oa.a{constructor(qb){super();this.$=qb;this.Gb()}create(){const qb=L.GetServiceTaskFactory.Pa(this.$.da,374,375,1);Ma.TaskExtensions.za(Ma.TaskExtensions.Md([qb],this.ka),()=>{this.qb(Object(Ka.a)(this.$.da,530,()=>new nb(this.$,qb.result)))},this.ka)}static la(qb){qb.da.Ha(531,new Tb(qb))}}Object(C.a)(Tb,"ExcelIntelligenceCalloutManagerFactory",oa.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.DataCleansing");
Type.registerNamespace("_Ewa");A.a.ni('.DataCleansingPane{background:#edebe9;height:100%;overflow:hidden;display:flex;flex-direction:column}.DataCleansingPaneHeader{position:relative;overflow:hidden;padding:16px 16px 16px 16px}.DataCleansingPaneBody{flex:auto;position:relative}.DataCleansingPaneTitle{position:relative !important;max-width:230px;display:inline-block;text-overflow:ellipsis;overflow:hidden;height:22px;font-weight:normal;background:#edebe9;font-size:16px;color:#252423;font-family:"Segoe UI Semibold","Segoe UI Web",Arial,Verdana,sans-serif}.DataCleansingCloseButton{display:inline-block;padding:0 5px;font-size:16px}');
(()=>{z.a.Fa(qb=>{Wa.la(qb);wa.la(qb)})})();(()=>{z.a.Fa(qb=>{jb.la(qb)})})();(()=>{z.a.Fa(qb=>{Sc.la(qb)})})();(()=>{z.a.Fa(qb=>{Tb.la(qb)})})();Object(qd.a)();Object(Id.a)();(()=>{z.a.Fa(qb=>{He.la(qb)})})();(()=>{z.a.Fa(qb=>{$e.la(qb)})})();(()=>{z.a.Fa(qb=>{rf.la(qb)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.datacleansing.js.map/5c22586bd4512fdf29ef14c3b365c441/EwaDSEsNext.datacleansing.js.map