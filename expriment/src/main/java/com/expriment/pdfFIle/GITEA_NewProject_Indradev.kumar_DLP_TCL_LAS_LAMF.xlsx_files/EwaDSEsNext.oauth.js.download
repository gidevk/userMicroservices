'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1263:function(r,B,a){r=a(0);var c=a(970),b=a(4);class e{}Object(r.a)(e,"LokiTokenResult",null,[]);class f{constructor(n){this.aXb=n}Zid(){const n=this.o1h();return n?f.btd?new Promise((x,m)=>{this.aXb.continueWith(()=>{this.aXb.vh||this.aXb.Lf?m(Error.create("Error downloading auth library")):this.aXb.result.tL("Loki",n).then(u=>{u=b.AFrameworkApplication.fa.qa("ForceLokiFallbackToACLPTokenIsEnabled")?this.r1h():
u.IsSuccess&&u.Token?Object.assign(new e,{isSuccess:!0,token:u.Token,errorMessage:null}):Object.assign(new e,{isSuccess:!1,token:null,errorMessage:JSON.stringify(u)});x(u);return u})})}):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",c.a.u2e())}))}r1h(){const n=
b.AFrameworkApplication.fa.Wa("LokiUserDataSignature")||"";return Object.assign(new e,{isSuccess:!0,token:n,errorMessage:null})}o1h(){let n=null;const x=c.a.Gcc();2===x?n=b.AFrameworkApplication.fa.Wa("LokiAADAppId"):1===x&&(n=b.AFrameworkApplication.fa.Wa("LokiMSAAppId"));return n}static get btd(){return b.AFrameworkApplication.fa.qa("IsO365CommercialHost")||b.AFrameworkApplication.fa.qa("IsO365ConsumerHost")}}Object(r.a)(f,"LokiTokenManager",null,[682]);var d=a(257),h=a(86),l=a(524);class k{get name(){return"Common.App.LivePersonaUtils"}init(){h.a.instance.resolve("Common.ILokiTokenManager")}dispose(){}Kh(n){n.register(f,
"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").tc().Bc(()=>new f(l.a.gq(n.Tb("Common.App.OAuth.IOAuthManager"))))}static main(){d.a.instance.si(new k)}}Object(r.a)(k,"LivePersonaUtilsPackage",null,[4,5]);a.d(B,"a",function(){return w});const w=()=>{Type.registerNamespace("Common.App.LivePersonaUtils");k.main()}},1264:function(r,B,a){r={};a.r(r);a.d(r,"OAuthManagerWrapper",function(){return m});var c={};a.r(c);var b=a(9),e=a(0),f=a(86),d=a(228),h=a(155),l=a(7),k=a(15),
w=a(859),n=a(153),x=a(54);let m=class{constructor(A){this.oAuthManager=A}tL(A,z){return this.oAuthManager?this.oAuthManager.tL(A,z).then(C=>{C.IsSuccess||k.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+C.ErrorMessage+" Error code: "+C.ErrorCode+" App name: "+A);return Object(l.a)(new w.a,{IsSuccess:C.IsSuccess,Token:C.Token,ErrorCode:C.ErrorCode,ErrorMessage:C.ErrorMessage})}):(k.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(l.a)(new w.a,
{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))}j7a(){return this.oAuthManager?this.oAuthManager.j7a():null}};m=Object(h.b)([Object(n.d)(x.D),Object(h.c)(0,Object(x.C)())],m);Object(e.a)(m,"OAuthManagerWrapper",null,[406]);var u=a(717);class t extends d.a{constructor(A){super();this.$=A;this.Gb()}create(){this.qb(Object(u.a)(this.$.da,349,()=>new m(f.a.instance.resolve("Common.App.OAuth.IOAuthManager"))))}static la(A){A.da.Ha(350,
new t(A))}}Object(e.a)(t,"OAuthManagerWrapperFactory",d.a,[]);var y=a(70);Object(n.b)(x.C)(()=>f.a.instance.resolve("Common.App.OAuth.IOAuthManager"));a.d(B,"a",function(){return v});const v=()=>{b.a.Fa(A=>{Object(y.b)("OfficeVSO:7624847_MigrateOAuthToNewServiceInfra")||t.la(A)})};String(r);String(c);window.___1678693021175_closurehack=r;window.___1678693021175_closurehack=c},1310:function(r,B,a){r=a(0);var c=a(15),b=a(867),e=a(947),f=a(4),d=a(102),h=a(563),l=a(257),k=a(40),w=a(41),n=a(27),x=a(115),
m=a(86),u=a(199);class t{get name(){return"Common.App.OAuth.OAuthPackage"}Kh(v){v.register(404,"Common.App.OAuth.IOAuthManager").tc().Bc(()=>new b.OAuthManager)}init(){const v=m.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.v1j(v)}v1j(v){const A=f.AFrameworkApplication.fa.Wa("FileSource");if(f.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||f.AFrameworkApplication.fa.qa("IsO365CommercialHost")||"WopiTest"===A){var z=h.OAuthManagerSettings.r6c;if(z&&z.IsEnabled){var C=z.Application,
H=h.OAuthManagerSettings.authority;if(void 0!==C&&null!==C&&C.length&&void 0!==H&&null!==H&&H.length){var I=e.a[v.FS],S=n.a.ita,P=v.wv();try{var D=new Map;void 0!==D&&null!==D?(D.set("SupportStatus",I),D.set("Browser",S),D.set("AuthStrategy",P)):D=null}catch(E){D=null}d.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",D);var G=w.a.Yd();v.tL("Core",C).then(E=>{const O=Math.floor(w.a.Yd()-G);I=e.a[v.FS];S=n.a.ita;P=v.wv();c.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',
O,E.IsSuccess,I,E.ErrorCode,A,S,P);D&&(D.set("SupportStatus",I),D.set("Browser",S),D.set("AuthStrategy",P));var N=Object.assign(new u.a,{durationMs:O,extendedProperties:D});if(E.IsSuccess){if(d.Health.instance.recordKpiSuccess("WacCorePFT",N),E="Bearer "+E.Token,f.AFrameworkApplication.Hd.J3d=E,N=z.Endpoint){var J=w.a.Yd();f.AFrameworkApplication.Hd.bpb(N,1,null,{["Authorization"]:E},"OAuthManagerValidateAccess",void 0,void 0,void 0,2E4).continueWith(W=>{var ea=Math.floor(w.a.Yd()-J),R=null;W.vh?
W="Canceled":W.Lf?W="Faulted":(R=W.result,W=R.succeeded?"Completed":"Failed");ea={["TaskResult"]:W,["BrowserTokenDurationMS"]:O,["BrowserValidationDurationMS"]:ea};R&&(ea.HttpStatus=R.Kg.data.httpStatus,R.succeeded&&(R=k.a(R.Kg.data.me),ea.ServerValidationDurationMS=R.ElapsedMilliseconds,ea.ServerValidationResult=R.ValidatedToken,ea.KMSI=R.KMSI,ea.Scopes=R.Scopes,ea.TokenExpirationS=Math.floor(parseInt(R.Expiration)-(new Date).getTime()/1E3)));c.ULS.sendTraceTag(520632322,3E3,"Completed"===W?50:15,
x.a.toJSON(ea))})}}else d.Health.instance.recordKpiFailure("WacCorePFT",E.ErrorCode,!1,!1,N)}).catch(E=>{var O=Math.floor(w.a.Yd()-G);O=Object.assign(new u.a,{durationMs:O,extendedProperties:D});d.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+E.toString(),!1,!1,O)})}}}}dispose(){}static main(){l.a.instance.si(new t)}static Zkj(){l.a.instance.si(new t,0,!0)}}Object(r.a)(t,"OAuthPackage",null,[4,5]);a.d(B,"a",function(){return y});const y=v=>{Type.registerNamespace("Common.App.OAuth");
v?t.Zkj():t.main()}},1501:function(r,B,a){a.r(B);r=a(1310);B=a(1263);a=a(1264);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Object(r.a)();Object(B.a)();Object(a.a)()},867:function(r,B,a){a.r(B);r=a(0);var c=a(15),b=a(1435),e=a(947),f;(function(T){T[T.external=0]="external";T[T.msa=1]="msa";T[T.aad=2]="aad"})(f||(f={}));Object(r.b)("AuthorityType",f);var d=a(781);class h{constructor(T){this.KDg=T}initialize(){return Promise.resolve(0)}Nmc(){return Promise.resolve(0)}tL(){c.ULS.sendTraceTag(574239257,
3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new d.a,{IsSuccess:!0,Token:this.KDg}))}iEc(){return Promise.resolve(Object.assign(new d.a,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}ECc(){return!1}Pyb(){return"MockAuthTokenStrategy"}}Object(r.a)(h,"MockAuthTokenStrategy",null,[447]);var l=a(970);class k{static get(T,ka,L){if(!L)return T;let fa=
0;return Promise.race([T,new Promise(wa=>{fa=window.setTimeout(()=>{wa(ka)},L)})]).then(wa=>{window.clearTimeout(fa);return Promise.resolve(wa)}).catch(()=>{window.clearTimeout(fa);return Promise.resolve(ka)})}}Object(r.a)(k,"PromiseWithTimeout",null,[]);var w=a(4),n=a(563);class x{constructor(T,ka,L,fa,wa){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=T;this.scope=ka;this.silentLogin=L;this.options=fa;this.correlationId=wa}}Object(r.a)(x,"TokenRequestParameters",
null,[474]);var m=a(27),u=a(86);class t{constructor(){this.voe=null;let T=w.AFrameworkApplication.fa.Wa(w.AFrameworkApplication.Z7),ka=w.AFrameworkApplication.fa.Wa(w.AFrameworkApplication.okg);this.LYa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",T&&""!==T?T:"Unspecified",ka&&""!==ka?ka:"Unspecified")}initialize(){return new Promise(T=>{u.a.instance.Tb("Common.App.WopiIdentity.IWopiIdentity").execute(ka=>{this.voe=ka;T(0)})})}zi(T){const ka=["HTTPS:","API:"];let L=
!1;const fa=T.toLocaleUpperCase();for(const wa of ka)if(fa.startsWith(wa)){L=!0;break}return L||this.Yti(T)?T+"/.default":T}Yti(T){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(T)}Nmc(){return Promise.resolve(0)}tL(T,ka,L,fa,wa,oa,xa){if(m.a.Xxa){wa=n.OAuthManagerSettings.kak;if(!wa)return ka=Object.assign(new d.a,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(ka);if(!Array.contains(wa,T))return ka=
Object.assign(new d.a,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+T}),Promise.resolve(ka)}T=this.zi(L);L=new x(L,T,!fa,null,w.AFrameworkApplication.userSessionId);return this.voe.getAccessToken(L,ka,xa).then(bb=>Object.assign(new d.a,{IsSuccess:!0,Token:bb.accessToken}),bb=>Object.assign(new d.a,{IsSuccess:!1,ErrorCode:bb}))}iEc(){return Promise.resolve(Object.assign(new d.a,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}ECc(){return!1}Pyb(){return this.LYa}}
Object(r.a)(t,"ParentFrameTokenStrategy",null,[447]);var y=a(88),v=a(873),A=a(197);class z{constructor(){this.reject=this.resolve=null;this.startTime=0;this.rSf=this.Hye=null}}Object(r.a)(z,"PromiseWrapper",null,[]);class C{constructor(T=0){this.UB=0;this.ymb=!1;this.Lm=new A.a;this._timeout=T}enqueue(T){return new Promise((ka,L)=>{this.Lm.add(Object.assign(new z,{rSf:T,resolve:ka,reject:L}));this.process()})}process(){if(this.ymb||this.UB===this.Lm.count)return!1;const T=this.Lm.ma(this.UB++);try{this.ymb=
!0,T.rSf().then(ka=>{this.ymb=!1;this.q5c(T,ka,null,!0)}).catch(ka=>{this.ymb=!1;this.q5c(T,null,ka,!1)})}catch(ka){this.ymb=!1,this.q5c(T,null,ka,!1)}return!0}q5c(T,ka,L,fa){if(fa){const wa=()=>{T.resolve(ka);this.process()};0<this._timeout?window.setTimeout(()=>{wa()},this._timeout):wa()}else{const wa=()=>{T.reject(L);this.process()};0<this._timeout?window.setTimeout(()=>{wa()},this._timeout):wa()}}}Object(r.a)(C,"PromiseQueue",null,[]);class H{constructor(){this.correlationId=this.resolve=null}}
Object(r.a)(H,"ResolveWithCorrelation",null,[]);var I=a(87),S=a(156),P=a(842),D=a(172);class G extends S.a{constructor(T,ka,L,fa,wa,oa){super(!1,!1,!0);this.E9d=this.u1=null;this.dY=T;this.nFg=L;this.Vv=fa;this.YIg=wa;this.REa=oa;this.Qs=document.createElement("iframe");this.Qs.id="SharedAuthInteractiveFrame";this.Qs.setAttribute("name","SharedAuthInteractiveFrame");this.Qs.setAttribute("title","SharedAuthInteractiveFrame");this.Qs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");
this.Qs.style.border="0";this.Qs.style.height="48px";this.Qs.style.width="190px";$addHandler(this.Qs,"error",Object(y.a)(this,this.B3i,"onSharedAuthFrameError"));T=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",this.dY,ka,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",w.AFrameworkApplication.userType);this.Qs.src=T;this.Lyg=new Promise(xa=>{this.E9d=xa});this.F9d=!1}LAc(){this.u1={["id"]:"SharedAuthConsentDialog",["bodyControls"]:{["promptMessage"]:this.nFg,
["errorText"]:CommonUIStrings.l_InternalError,["rtl"]:w.AFrameworkApplication.isRtl,["frameLoaded"]:!1,["createFrame"]:Object(y.a)(this,this.Qgh,"createFrame"),["resolveDialogStyles"]:this.E9d}};this.Rb=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(y.a)(this,this.NIj,"sharedAuthConsentDialogHandler"),this.u1)}CFc(T=!1,ka=!1,L=5){this.u1&&this.u1.bodyControls&&(T!==Object(I.a)(Object,this.u1.bodyControls).frameLoaded&&(Object(I.a)(Object,this.u1.bodyControls).frameLoaded=T),ka!==Object(I.a)(Object,
this.u1.bodyControls).frameLoadSuccess&&(Object(I.a)(Object,this.u1.bodyControls).frameLoadSuccess=ka),L!==this.u1.dialogButtonsOption&&(this.u1.dialogButtonsOption=null,this.Rb=L),this.update(this.u1))}pPj(T,ka){const L=new P.a(D.a.RIj);L.Values={["signInLabel"]:CommonUIStrings.l_SignIn,["cancelLabel"]:CommonUIStrings.l_DialogCancel,["rtl"]:w.AFrameworkApplication.isRtl,["messageCorrelationId"]:T,["dialogStyles"]:ka};this.Vv.sSa(L,this.Qs.contentWindow,this.dY)}r0e(){this.CFc(!0,!1,6)}get W9f(){return this.Qs}get eqh(){return this.Lyg.then(T=>
{this.F9d=!0;return T})}get fqh(){return this.F9d}B3i(){this.r0e()}Qgh(){return this.Qs}NIj(T){0===T&&(this.YIg.reject(Object.assign(new d.a,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.REa(null))}}Object(r.a)(G,"SharedAuthConsentDialog",S.a,[473]);var E=a(1274),O=a(102),N=a(143),J=a(41),W=a(178),ea=a(199);class R{constructor(){this.Qs=null;this.qVb=0;this.Jlb=this.$Ya=this.IIc=this.REa=this.SL=this.tne=null;this.Vv=new E.a(null,null);this.LYa="SharedAuthTokenStrategy Unloaded";
this.dY=n.OAuthManagerSettings.PIj;this.sle=n.OAuthManagerSettings.OIj;this.r$d=n.OAuthManagerSettings.enableConsoleLogging;this.izg=w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.uHg=w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",!1);this.Nra={};this.IBg=new C(1500)}Pyb(){return this.LYa}initialize(){var {OAuthManager:T}=a(867);if("loadFrame"in this.Nra)return this.Nra.loadFrame.Hye;
if(!this.dY)return O.Health.instance.recordKpiFailure(T.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),c.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);T=this.jCc("loadFrame");this.qVb=J.a.Yd();var ka=this.dY+this.sle+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+w.AFrameworkApplication.userSessionId+"&WacUserType="+w.AFrameworkApplication.userType;this.Qs=document.createElement("iframe");this.ili(this.Qs);
this.Qs.style.cssText="height:0;width:0;display:none;";this.Qs.id="SharedAuthFrame";this.Qs.setAttribute("name","SharedAuthFrame");this.Qs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Qs.setAttribute("title","SharedAuthFrame");this.Qs.src=ka;document.body.appendChild(this.Qs);ka=J.a.Yd()-this.qVb;c.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",ka,this.Qs.src);return T}Nmc(T){this.IIc=
T;const ka=new P.a(D.a.Z9f);ka.Values=this.gye(T);T=this.jCc("initFrame");this.Vv.sSa(ka,this.Qs.contentWindow,this.dY);c.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return T}tL(T,ka,L,fa,wa,oa){const xa=new P.a(D.a.SIj),bb=this.G8e();xa.Values=this.Jjg(T,ka,L,fa,wa,oa,bb);T=this.jCc(bb);fa&&w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.IBg.enqueue(()=>new Promise(Za=>{this.M0j(oa,
xa,Za,bb)})):(this.Vv.sSa(xa,this.Qs.contentWindow,this.dY),c.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",ka));return T}M0j(T,ka,L,fa){const wa=this.Nra[fa];wa&&(this.$Ya=ka,this.REa=Object.assign(new H,{resolve:L,correlationId:fa}),this.SL=new G(this.dY,this.sle,T,this.Vv,wa,L),this.SL.LAc())}G8e(){return W.a.create().toString()}Jjg(T,ka,L,fa,wa,oa,xa){const bb={};bb.appName=T;bb.appId=ka;bb.target=L;bb.withPopup=fa;bb.claims=wa;bb.promptMessage=
oa;bb.messageCorrelationId=xa;return bb}ili(T){$addHandler(T,"load",Object(y.a)(this,this.yZi,"onIFrameLoaded"));$addHandler(T,"error",Object(y.a)(this,this.Cqc,"onIFrameError"));this.Vv.nY(this.dY);this.Vv.lo(D.a.b$f);this.Vv.Il(D.a.b$f,Object(y.a)(this,this.T2i,"onScriptLoaded"));this.Vv.lo(D.a.a$f);this.Vv.Il(D.a.a$f,Object(y.a)(this,this.S2i,"onScriptInitialized"));this.Vv.lo(D.a.X9f);this.Vv.Il(D.a.X9f,Object(y.a)(this,this.$Yi,"onGetTokenResponse"));this.Vv.lo(D.a.c$f);this.Vv.Il(D.a.c$f,Object(y.a)(this,
this.S_i,"onLoginResponse"));this.Vv.lo(D.a.$9f);this.Vv.Il(D.a.$9f,Object(y.a)(this,this.VZi,"onInteractiveFlowReady"));this.Vv.lo(D.a.Y9f);this.Vv.Il(D.a.Y9f,Object(y.a)(this,this.rZi,"onHideDialog"));this.Vv.lo(D.a.V9f);this.Vv.Il(D.a.V9f,Object(y.a)(this,this.pUi,"onCloseDialog"))}jCc(T){const ka=new z;ka.startTime=J.a.Yd();const L=new Promise((fa,wa)=>{ka.resolve=fa;ka.reject=wa});ka.Hye=L;this.Nra[T]=ka;return L}yZi(){const T=J.a.Yd()-this.qVb;c.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",
T)}Cqc(T){const {OAuthManager:ka}=a(867),L=J.a.Yd()-this.qVb,fa=Object.assign(new ea.a,{durationMs:L});O.Health.instance.recordKpiFailure(ka.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,fa);c.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",L,this.r$d?JSON.stringify(T):"")}T2i(T){const {OAuthManager:ka}=a(867),L=this.Nra.loadFrame;var fa=J.a.Yd()-L.startTime,wa=T.Values.AuthLibrary.toString();T=T.Values.Success.toString();c.ULS.sendTraceTag(573112902,3E3,
50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",T,wa,fa);wa&&(this.LYa="SharedAuthTokenStrategy "+wa);wa=Boolean.parse(T);wa||(T=N.a.Wr(),void 0!==T&&null!==T&&(T.set("AuthLibrary",this.Pyb()),fa=Object.assign(new ea.a,{durationMs:fa,extendedProperties:T}),O.Health.instance.recordKpiFailure(ka.kpiName,"SharedAuthStrategyInitFailed",!1,!0,fa)));L.resolve(wa?0:1)}S2i(T){if(T.Values.interactive&&this.$Ya&&this.$Ya.Values.messageCorrelationId){const L=this.$Ya.Values.messageCorrelationId.toString();
if(T.Values.interactive&&this.SL){this.SL.eqh.then(fa=>{this.Vv.sSa(this.$Ya,this.SL.W9f.contentWindow,this.dY);this.SL.pPj(L,fa);this.SL.CFc(!0,!0);this.$Ya=null});return}}T=this.Nra.initFrame;const ka=J.a.Yd()-T.startTime;c.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",ka);T.resolve(0)}$Yi(T){if(T.Values.messageCorrelationId&&T.Values.messageCorrelationId.toString()){var ka=T.Values.messageCorrelationId.toString(),L=this.Nra[ka];if(L){var fa=J.a.Yd()-
L.startTime;c.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",fa);T.Values.isSuccess&&T.Values.isSuccess?L.resolve(T.Values.response):L.reject(T.Values.response);this.Yjg(ka)}else c.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")}VZi(){if(this.SL.fqh)this.SL.r0e();
else if(this.IIc&&this.SL){const T=new P.a(D.a.Z9f);T.Values=this.gye(this.IIc,!0);this.Vv.sSa(T,this.SL.W9f.contentWindow,this.dY)}}rZi(){this.SL&&this.SL.Wzb()}pUi(T){T.Values.cancelled&&T.Values.cancelled&&T.Values.messageCorrelationId&&this.Yjg(T.Values.messageCorrelationId.toString());this.SL&&this.SL.hide()}gye(T,ka=!1){const L={};L.appIds=this.DSh();L.upn=T.loginHint;L.authority=T.authority;L.authorityType=Object(b.a)(f,T.authorityType);L.tenantId=T.tenantId;L.correlationId=w.AFrameworkApplication.userSessionId;
L.enableConsoleLogging=this.r$d;L.enablePopupFlash=this.izg;L.skipUpnCheck=this.uHg;L.interactive=ka;return L}DSh(){const T=[],ka=n.OAuthManagerSettings.b_c;for(let L in ka)Array.add(T,ka[L]);return T}iEc(T,ka,L,fa,wa,oa){const xa=new P.a(D.a.QIj),bb=this.G8e();xa.Values=this.Jjg(T,ka,L,fa,wa,oa,bb);this.tne=xa;T=this.jCc(bb);c.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",ka);this.aNj();return T}ECc(){return!0}aNj(){this.Jlb||(this.Jlb=new v.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,
CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Jlb.id=16,this.Jlb.Wsd=!1,this.Jlb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,()=>{c.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");this.Vv.sSa(this.tne,this.Qs.contentWindow,this.dY)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),c.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))}S_i(T){if(T.Values.messageCorrelationId&&
T.Values.messageCorrelationId.toString()){var ka=this.Nra[T.Values.messageCorrelationId.toString()];if(ka){var L=J.a.Yd()-ka.startTime;c.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",L);T.Values.isSuccess&&T.Values.isSuccess?ka.resolve(T.Values.response):ka.reject(T.Values.response)}else c.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")}Yjg(T){this.REa&&
this.REa.correlationId===T&&(this.REa.resolve(null),this.REa=null)}}Object(r.a)(R,"SharedAuthTokenStrategy",null,[447]);class Y{constructor(T){this.WSc=T;this.LYa="UnsupportedAuthTokenStrategy Reason="+e.a[this.WSc]}initialize(){return Promise.resolve(0)}Nmc(){return Promise.resolve(0)}tL(){return Promise.resolve(Object.assign(new d.a,{IsSuccess:!1,ErrorCode:e.a[this.WSc],ErrorMessage:"Unable to get a token. Reason: ["+e.a[this.WSc]+"]"}))}iEc(){return Promise.resolve(Object.assign(new d.a,{IsSuccess:!1,
ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}ECc(){return!1}Pyb(){return this.LYa}}Object(r.a)(Y,"UnsupportedAuthTokenStrategy",null,[447]);var U=a(736);a.d(B,"OAuthManager",function(){return da});class da{constructor(T=null){this.FS=0;this.dP=null;this.TFg=0;const ka=J.a.Yd();this.xBg=this.vph(T).then(L=>L?this.tji():(c.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",
this.wv(),Math.floor(J.a.Yd()-ka)),L=N.a.Wr(),void 0!==L&&null!==L&&(L.set("AuthLibrary",this.wv()),L=Object.assign(new ea.a,{durationMs:Math.floor(J.a.Yd()-ka),extendedProperties:L}),O.Health.instance.recordKpiFailure(da.kpiName,"StrategyPickFailed",!1,!0,L)),Promise.resolve(1))).then(L=>0!==L?Promise.resolve(L):this.JEi())}wph(){var T=n.OAuthManagerSettings.tNi;T&&0<T.length?(this.FS=1,this.dP=new h(T)):w.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||w.AFrameworkApplication.fa.qa("IsO365CommercialHost")?
w.AFrameworkApplication.fa.qa("IsAnonymousUser")?(this.FS=2,this.dP=new Y(this.FS)):(T=l.a.getAuthContext().loginHint)&&T.length?n.OAuthManagerSettings.aAb?(this.FS=1,this.dP=new t):(this.FS=1,this.dP=new R):(this.FS=3,this.dP=new Y(this.FS)):(this.FS=4,this.dP=new Y(this.FS))}wv(){return this.dP?this.dP.Pyb()||"Unknown":"None"}vph(T=null){c.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");const ka=J.a.Yd();return w.AFrameworkApplication.fa.hid().then(L=>{L?(this.wph(),T&&(this.dP=T),c.ULS.sendTraceTag(42084323,
3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",n.OAuthManagerSettings.clientVersion,n.OAuthManagerSettings.appVersion,n.OAuthManagerSettings.osh,this.wv(),Math.floor(J.a.Yd()-ka))):c.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(J.a.Yd()-ka));return Promise.resolve(L)},()=>{c.ULS.sendTraceTag(562128580,3E3,
15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(J.a.Yd()-ka));return Promise.resolve(!1)})}tji(){c.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.wv());const T=J.a.Yd();return k.get(this.dP.initialize(),2,n.OAuthManagerSettings.VJd).then(ka=>{if(0===ka)c.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",this.wv(),Math.floor(J.a.Yd()-T));else if(1===ka){c.ULS.sendTraceTag(527827291,
3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",this.wv(),Math.floor(J.a.Yd()-T));var L=N.a.Wr();void 0!==L&&null!==L&&(L.set("AuthLibrary",this.wv()),L=Object.assign(new ea.a,{durationMs:Math.floor(J.a.Yd()-T),extendedProperties:L}),O.Health.instance.recordKpiFailure(da.kpiName,"StrategyInitFailed",!1,!0,L))}else 2===ka&&(c.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.wv(),
Math.floor(J.a.Yd()-T)),L=N.a.Wr(),void 0!==L&&null!==L&&(L.set("AuthLibrary",this.wv()),L=Object.assign(new ea.a,{durationMs:Math.floor(J.a.Yd()-T),extendedProperties:L}),O.Health.instance.recordKpiFailure(da.kpiName,"StrategyInitTimedOut",!1,!0,L)));return Promise.resolve(ka)},()=>{c.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.wv(),Math.floor(J.a.Yd()-T));return Promise.resolve(1)})}JEi(){c.ULS.sendTraceTag(562128581,
3E3,50,"Loading {0}",this.wv());const T=J.a.Yd();return k.get(this.dP.Nmc(l.a.getAuthContext()),2,n.OAuthManagerSettings.VJd).then(ka=>{if(0===ka)c.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",this.wv(),Math.floor(J.a.Yd()-T));else if(1===ka){c.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.wv(),Math.floor(J.a.Yd()-T));var L=N.a.Wr();void 0!==L&&null!==L&&(L.set("AuthLibrary",this.wv()),L=Object.assign(new ea.a,
{durationMs:Math.floor(J.a.Yd()-T),extendedProperties:L}),O.Health.instance.recordKpiFailure(da.kpiName,"StrategyLoadFailed",!1,!0,L))}else 2===ka&&(c.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.wv(),Math.floor(J.a.Yd()-T)),L=N.a.Wr(),void 0!==L&&null!==L&&(L.set("AuthLibrary",this.wv()),L=Object.assign(new ea.a,{durationMs:Math.floor(J.a.Yd()-T),extendedProperties:L}),O.Health.instance.recordKpiFailure(da.kpiName,"StrategyLoadTimedOut",
!1,!0,L)));return Promise.resolve(ka)},()=>{c.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.wv(),Math.floor(J.a.Yd()-T));return Promise.resolve(1)})}tL(T,ka,L=null){return this.gEc(T,ka,!1,null,"",L)}Kjg(T,ka,L,fa,wa=null){return this.gEc(T,ka,!0,L,fa,wa)}gEc(T,ka,L,fa,wa,oa,xa=0){xa+=1;c.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",T,this.aSa(T,
ka),this.wv(),xa);var bb=N.a.Wr();void 0!==bb&&null!==bb&&(bb.set("AuthLibrary",this.wv()),bb.set("AppName",T),bb.set("Target",this.aSa(T,ka)),O.Health.instance.recordKpiUsage(da.kpiName,0,"WacOAuthFC",bb));if(!n.OAuthManagerSettings.isEnabled){var Za;return this.cyd((Za=new d.a,Za.IsSuccess=!1,Za.Token=null,Za.ErrorCode="NotEnabled",Za.ErrorMessage="OAuthManager is disabled.",Za),T)}const La=n.OAuthManagerSettings.b_c[T];if(void 0===La||null===La){c.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",
T);var va;return this.cyd((va=new d.a,va.IsSuccess=!1,va.Token=null,va.ErrorCode="DisallowedApp",va.ErrorMessage="Disallowed appName: "+T,va),T)}const Ba=J.a.Yd(),Ea=this;bb=this.xBg.then(ib=>Ea.lpi(T,La,ka,L,fa,wa,oa,ib));Za=L?0:n.OAuthManagerSettings.VJd;let pa;va=(pa=new d.a,pa.IsSuccess=!1,pa.Token=null,pa.ErrorCode="authTokenStrategy_timeout",pa.ErrorMessage="Auth Strategy timed out after ["+Za+"] ms when fetching token",pa);let $a=this,cb=this;return k.get(bb,va,Za).then(ib=>xa<=da.aMi&&(ib.ErrorCode===
da.Hhg||ib.ErrorCode===da.YTj)?(c.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",xa,Math.floor(J.a.Yd()-Ba)),$a.gEc(T,ka,L,fa,wa,oa,xa)):ib.ErrorCode===da.gqf&&!L&&(c.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",xa,da.pRe),da.svh&&$a.dP.ECc()&&$a.dP.iEc(T,La,ka,L,fa,wa).then(ta=>Promise.resolve($a.fnc(ta,T,ka,La,Ba))).catch(()=>{let ta;const Ya=(ta=new d.a,ta.IsSuccess=!1,ta.Token=
null,ta.ErrorCode="authTokenStrategy_failure",ta.ErrorMessage="LoginPopup failed, GetToken could not be called",ta);return Promise.resolve($a.fnc(Ya,T,ka,La,Ba))}),da.pRe)?$a.gEc(T,ka,!0,fa,wa,oa,xa):Promise.resolve($a.fnc(ib,T,ka,La,Ba))).catch(()=>{let ib;const ta=(ib=new d.a,ib.IsSuccess=!1,ib.Token=null,ib.ErrorCode="authTokenStrategy_failure",ib.ErrorMessage="Auth Strategy failed with an unknown error",ib);return Promise.resolve(cb.fnc(ta,T,ka,La,Ba))})}lpi(T,ka,L,fa,wa,oa,xa,bb){return 1===
bb||2===bb?this.cyd(Object.assign(new d.a,{IsSuccess:!1,Token:null,ErrorCode:1===bb?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),T):this.dP.tL(T,ka,L,fa,wa,oa,xa).then(Za=>Promise.resolve(this.aAf(Za,!0,T))).catch(Za=>Promise.resolve(this.aAf(Za,!1,T)))}fnc(T,ka,L,fa,wa){const oa={};wa=J.a.Yd()-wa;oa.IsSuccess=T.IsSuccess;oa.ErrorCode=T.IsSuccess?"Success":T.ErrorCode||"";oa.ErrorMessage=T.IsSuccess?"Success":this.aSa(ka,T.ErrorMessage||"");oa.Target=this.aSa(ka,
L||"");oa.TimeInMS=Math.floor(wa);oa.AuthLibrary=this.wv();oa.AppName=ka;oa.AuthorityType=Object(b.a)(f,l.a.Gcc());oa.UserType=this.r$h(l.a.getAuthContext());oa.IsAuthSupportedInSession=e.a[this.FS];oa.RequestCount=++this.TFg;oa.AppId=fa;c.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(oa));T.IsSuccess||(L=N.a.Wr(),void 0!==L&&null!==L&&(L.set("AppName",ka),L.set("AuthLibrary",this.wv()),L.set("ErrorCode",T.ErrorCode),L.set("ErrorMessage",this.aSa(ka,T.ErrorMessage)),ka=Object.assign(new ea.a,{durationMs:wa,
extendedProperties:L}),O.Health.instance.recordKpiFailure(da.kpiName,"TryGetTokenFailure",!1,!0,ka)));return T}cyd(T,ka){c.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",ka,this.aSa(ka,T.ErrorMessage));const L=N.a.Wr();void 0!==L&&null!==L&&(L.set("AppName",ka),L.set("AuthLibrary",this.wv()),L.set("ErrorCode",T.ErrorCode),L.set("ErrorMessage",this.aSa(ka,T.ErrorMessage)),ka=Object.assign(new ea.a,{extendedProperties:L}),O.Health.instance.recordKpiFailure(da.kpiName,
"FailureBeforeGetToken",!1,!0,ka));return Promise.resolve(T)}Xkf(T){return T===U.a.rDc}aSa(T,ka){return this.Xkf(T)&&ka?"REDACTED":ka}r$h(T){return w.AFrameworkApplication.fa.qa("IsAnonymousUser")?"anonymous":!T.loginHint||1>T.loginHint.length?"empty":-1<T.loginHint.indexOf("guest#")?"guest":-1<T.loginHint.indexOf("ext#")?"external":0>T.upn.indexOf("@")?"no-at":"supported"}j7a(){return 1===this.FS}aAf(T,ka,L){let fa=null,wa=null,oa=null,xa=null;T?T.ErrorCode||T.ErrorMessage?(wa=T.ErrorCode?T.ErrorCode:
da.GXe,oa=T.ErrorMessage?T.ErrorMessage:"No message"):T.Token?ka?fa=T.Token:(wa=da.Rlj,oa="A rejected promise returned a token."):(wa=da.GXe,oa=JSON.stringify(T)):(wa=da.LPi,oa="No result came from Auth Token Strategy");T&&T.Telemetry&&!this.Xkf(L)&&(xa=T.Telemetry,c.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(xa)));if(wa===da.DNi||wa===da.PYj)wa=da.Hhg,oa="Auth Library Timed Out";wa===da.WXg&&-1<oa.indexOf(da.RJg)&&(wa=da.gqf);if(wa||oa)fa=null;return Object.assign(new d.a,{IsSuccess:!!fa,Token:fa,
ErrorCode:wa,ErrorMessage:oa,Telemetry:xa})}static get pRe(){return w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}static get svh(){return w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}da.PYj="token_renewal_error";da.GXe="Exception";da.LPi="NoResult";da.Rlj="RejectToken";da.DNi="monitor_window_timeout";da.Hhg="Timeout";da.YTj="authTokenStrategy_timeout";da.WXg="login_required";
da.RJg="AADSTS50058";da.gqf="Cookies Disabled";da.kpiName="OAuthManager";da.aMi=2;Object(r.a)(da,"OAuthManager",null,[404])},947:function(r,B,a){a.d(B,"a",function(){return c});r=a(0);var c;(function(b){b[b.unknown=0]="unknown";b[b.supported=1]="supported";b[b.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";b[b.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";b[b.hostUnsupported=4]="hostUnsupported"})(c||(c={}));Object(r.b)("SupportStatus",c)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.oauth.js.map/61b771ce6dfee7b328a6d5897a3ee6b7/EwaDSEsNext.oauth.js.map