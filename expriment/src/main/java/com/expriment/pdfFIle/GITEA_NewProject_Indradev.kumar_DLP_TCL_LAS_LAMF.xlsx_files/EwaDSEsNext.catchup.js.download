'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[24],{1015:function(r,B,a){a.d(B,"a",function(){return e});r=a(0);var c=a(172);B=a(1274);var b=a(778);class e extends B.a{constructor(f,d){super(f,d);d!==b.a.f$&&this.nY(d);this.bha(e.iterateNext);this.bha(e.bya);this.e0b(c.a.kVa);this.e0b(c.a.lVa);this.e0b(c.a.fZ)}}e.iterateNext="IterateNext";e.bya="IteratePrevious";e.kQb="ToggleShowChanges";e.setCurrentChangeCount="SetCurrentChangeCount";e.setTotalChangesCount=
"SetTotalChangesCount";e.XPa="OnVHDiffReady";Object(r.a)(e,"VersionHistoryMessenger",B.a,[])},1295:function(r,B,a){r=a(0);var c=a(15),b=a(82),e=a(842),f=a(87),d=a(8),h=a(216),l=a(71),k=a(44),w=a(198),n=a(124),x=a(255),m=a(1),u=a(11),t=a(104),y=a(14),v=a(290),A=a(21),z=a(350);class C{constructor(E,O,N){this.FGa=E;this.Sk=O;this.H2d=N}}Object(r.a)(C,"UserActivityLocation",null,[]);var H=a(1015),I=a(63);const S=(E,O,N,J,W,ea=null)=>{ea=E.Oa(1,ea);return I.g(E,"GetVersionHistoryHighlightActivitiesData",
ea,O,N,J,W,4)};var P=a(778),D=a(58);a.d(B,"a",function(){return G});class G{constructor(E,O,N,J){this.authorColor=this.k2=this.$ea=null;this.M8a=!1;this.m2a=-1;this.u8c=0;this.sJa=100;this.C5=-1;this.m3d=null;this.Sqb=d.a.z$j;this.m9c=d.a.A$j;this.cGb=!1;this.cXh=()=>({DisplayName:d.a.B$j,Email:null,Id:null,Provider:null});this.nh=W=>{(W=x.a(W)?null:W.Result)?W.OperationWaitingForFileDownload?20>this.u8c?(this.sJa*=2,D.Task.delay(this.sJa).continueWith(()=>{this.u0d()})):(this.mFc(),c.ULS.sendTraceTag(537150406,
0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess Next Operation enqueue failed")):W.ActivityList?(this.initialize(W.ActivityList,W.VersionAuthors),m.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")?this.XPa():this.zOb(!0),this.m3d.stop(),c.ULS.sendTraceTag(41743369,0,50,`VersionHistoryHighlightManager: Time taken For showing diffs in Ms:${this.m3d.Fc.toString()}`)):(this.mFc(),c.ULS.sendTraceTag(537150407,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess no activity list found.")):
(this.sJa*=2,D.Task.delay(this.sJa).continueWith(()=>{this.u0d()}),c.ULS.sendTraceTag(537150408,0,10,"VersionHistoryHighlightManager::OnWebMethodSuccess call returned null result."))};this.Lza=()=>{this.mFc();c.ULS.sendTraceTag(537150405,0,10,"VersionHistoryHighlightManager::OnWebMethodFailure service call failed.")};this.Jvd=W=>{c.ULS.sendTraceTag(537150400,0,50,`VersionHistoryHighlightManager.IterateMessageHandler called with MessageID:${W.MessageId}`);switch(W.MessageId){case H.a.iterateNext:this.iterateNext();
this.C5=(this.C5+1)%this.sO.length;this.PMb(H.a.setCurrentChangeCount,this.C5+1);break;case H.a.bya:this.bya();this.C5=0>this.C5?0:this.C5;this.C5=(this.C5+this.sO.length-1)%this.sO.length;this.PMb(H.a.setCurrentChangeCount,this.C5+1);break;case H.a.kQb:this.zOb(W.Values.ToggleValue)}};this.zah=(W,ea)=>this.G5b(W.Sk,ea.Sk);this.xah=(W,ea)=>this.G5b(W.Sk,ea);this.Zc=()=>{m.EwaSettings.isChangeGateEnabled("OfficeVSO:7487107_XlOnlineVHRemovingDeselectOnSelectionChanged")||this.D8b()};this.Bn=()=>{this.D8b()};
this.Di=()=>{this.D8b()};c.ULS.sendTraceTag(537150411,0,50,"VersionHistoryHighlightManager::Constructor.");this.$=E;this.ariaLiveNotifier=J;this.gridView=A.h(this.$);this.gridView.ha.jC(this.Zc);this.gridView.uE(this.Bn);this.gridView.Xb.gl(this.Di);this.C5j();this.cGb=m.EwaSettings.isChangeGateEnabled("OfficeVSO:7468185_XlOnlineVHNewIterationAlgorithm");O&&(this.m3d=E.Mb.Kc("UserAction","VersionHistoryDiffManagerStopWatch"),this.u0d());if(this.ns=N)E=b.a.oba(this.$.ya.VersionHistoryActionUrl)||P.a.f$,
E!==P.a.f$&&this.ns.nY(E),this.ns.lo(H.a.iterateNext),this.ns.lo(H.a.bya),this.ns.lo(H.a.kQb),this.ns.Il(H.a.iterateNext,this.Jvd),this.ns.Il(H.a.bya,this.Jvd),this.ns.Il(H.a.kQb,this.Jvd)}get Ihb(){return this.k2}get LMb(){return-1===this.m2a?null:this.sO[this.m2a]}get sO(){this.M8a||(this.$ea.sort(this.zah),this.M8a=!0);return this.$ea}dispose(){this.iRa();this.$ea=this.k2=null;this.gridView&&(this.gridView.ha&&this.gridView.ha.xB(this.Zc),this.gridView.VF(this.Bn),this.gridView.Xb&&this.gridView.Xb.Zk(this.Di),
this.ns&&(this.ns.Sea(H.a.bya),this.ns.Sea(H.a.iterateNext),this.ns.Sea(H.a.kQb)))}initialize(E,O){E?(this.iRa(),this.m2a=-1,this.$ea=[],this.M8a=!1,this.k2={},this.authorColor={},this.QKi(O),this.b8c(E)):c.ULS.shipAssertTag(537150410,0,!1,"VersionHistoryHighlightManager.Initialize - userActivityList was Null")}u0d(){c.ULS.sendTraceTag(537150409,0,50,`VersionHistoryHighlightManager: TryFetchUserActivityandTriggerDiff triggered: ${this.u8c.toString()} --${this.sJa.toString()}`);this.u8c++;this.$.userOperationManager.Oc(new w.a(537,
0,(E,O,N)=>S(this.$.pa.va,v.b(E,this.nh),v.a(O,this.Lza),N,null),80),null)}zOb(E){const O=this.k2;for(let J in O){var N=J;const W=O[J];W?W.BOb(E):c.ULS.shipAssertTag(537150404,0,!1,"VersionHistoryHighlightManager.ShowOrHideAllHighlights -"+N+"view was Null")}}iRa(){const E=this.k2;for(let N in E){var O=N;const J=E[N];J?J.NMd():c.ULS.shipAssertTag(537150403,0,!1,"VersionHistoryHighlightManager.RemoveAllHighlights -"+O+"view was Null")}this.$ea=this.k2=null}V4f(E){let O;if(this.cGb)O=E?this.c7e(this.C5):
this.g8e(this.C5),E=this.sO[O];else if(!({kgf:O,nog:E}=this.B2h(E,this.m2a)).returnValue)return;c.ULS.shipAssertTag(537150402,0,!!E,"VersionHistoryHighlightManager.SelectNextOrPreviousChange - userActivityLocation is null");this.D8b();if(E.FGa.toString()in this.k2){this.k2[E.FGa.toString()].rzj(E.Sk);var N=k.E(E.Sk);this.ariaLiveNotifier.setEnabled(!1);this.ariaLiveNotifier.setEnabled(!0);this.ariaLiveNotifier.readText(String.format(y.a.instance.nb(158),O+1,this.sO.length,N.ZC(!1),E.H2d.DisplayName));
this.m2a=O}else c.ULS.shipAssertTag(537150401,0,!1,`VersionHistoryHighlightManager.SelectNextOrPreviousChange - ${E.FGa.toString()} view not present in views dictionary`)}PMb(E,O){if(m.EwaSettings.xa(279))if(this.ns){var N={};N.count=O;E=new e.a(E);E.Values=N;this.ns.send(E)}else c.ULS.sendTraceTag(537150370,0,10,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage hostPostmessenger is null");else c.ULS.sendTraceTag(537150371,0,50,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage VersionHistoryIterator BRS is turned off")}B2h(E,
O){let N,J=!1;N=null;let W=0;for(;!J&&W<this.sO.length;){O=E?this.c7e(O):this.g8e(O);N=this.sO[O];const ea=Object(f.a)(t.a,this.$.ua.getItemByName(N.Sk.SheetName));if(!ea)return c.ULS.shipAssertTag(537150369,0,!1,"VersionHistoryHighlightManager.GetNextorPreviousUserActivityLocationFromIndex - useractivitylocation contains sheetrange with null sheet"),{returnValue:!1,kgf:O,nog:N};ea.visible&&(J=!0);W++}return{returnValue:J,kgf:O,nog:N}}c7e(E){return this.cGb||-1!==E?(E+1)%this.sO.length:this.Y6e()}g8e(E){this.cGb&&
-1===E?E=0:-1===E&&(E=this.Y6e());return E=(E+this.sO.length-1)%this.sO.length}b8c(E){this.klh(E);this.H7c()}f$h(E,O){const N=[];if(!E.RangeList)return c.ULS.shipAssertTag(537150368,0,!1,"VersionHistoryHighlightManager.GetUserActivityLocationFromRangeActivityLocation - ActivityLocationType.Range RangeList Null "),N;for(const J of E.RangeList)if(!J||!this.$.ua.Kk(J.SheetName))c.ULS.shipAssertTag(537150367,0,!1,"Invalid sheet name "+J.SheetName);else if(!this.cGb||this.$.ua.getItemByName(J.SheetName).visible)E=
new C(0,J,O),N.push(E);return N}klh(E){for(const O of E)if(!O||n.e(O.LocationList))c.ULS.sendTraceTag(537150366,0,50,"Empty Location list");else for(const N of O.LocationList)if(N)switch(N.Type){case 0:this.$ea.push(...this.f$h(N,O.Person));break;default:c.ULS.sendTraceTag(537150364,0,50,"VersionHistoryHighlightManager.CreateViews Failed. Invalid ActivityLocationType")}else c.ULS.shipAssertTag(537150365,0,!1,"VersionHistoryHighlightManager.CreateUserActivityLocationList - LocationList contains Null")}H7c(){var E=
{};const O=[];for(const N of this.$ea){if(0!==N.FGa)continue;const J=new z.a(k.E(N.Sk),l.d(this.$.ua.getItemByName(N.Sk.SheetName))),W=G.bAc(J);W in E||O.push(J);E[W]=this.lVh(N.H2d);E[W]===this.m9c&&this.L7j(N)}c.ULS.sendTraceTag(42541534,0,15,`VersionHistoryHighlightManager.CreateRangeHighlightView. Total activities : ${this.$ea.length}, Highlightable activities: ${O.length},Total userlist in activities : ${this.$ea.length}, Total userlist from pane: ${O.length} `);this.mFc();0<O.length&&(E=new (a(1401).RangeVersionHistoryHighlightView)(this.$,
O,E,this.Sqb),this.k2["0"]=E)}L7j(E){m.EwaSettings.isChangeGateEnabled("OfficeVSO:7213684_NarratorReadsAuthorNameForChangesWithoutUserAttributionDuringIteration")&&(E.H2d=this.cXh())}mFc(){const E=this.$ea?this.sO.length:0;this.PMb(H.a.setCurrentChangeCount,0);this.PMb(H.a.setTotalChangesCount,E)}XPa(){this.PMb(H.a.XPa,0)}QKi(E){if(E)for(let W=0;W<E.length;++W)if(m.EwaSettings.isChangeGateEnabled("OfficeVSO:5140301_HandleEmptyInitialsColor")&&!E[W].InitialsColor)c.ULS.sendTraceTag(537150362,0,15,
"VersionHistoryHighlightManager.MapAuthorColorInfo: InitialsColor is null or empty for a version author");else{var O=E[W].EmailAddress;var N=E[W].UserName;var J=null;if(E[W].LoginName){const ea=E[W].LoginName.split("|");3===ea.length&&(J=ea[2])}J?this.authorColor[J]=E[W].InitialsColor:O?(c.ULS.sendTraceTag(537150361,0,15,"VersionHistoryHighlightManager Map Author Color: LoginName is null"),this.authorColor[O]=E[W].InitialsColor):N?(c.ULS.sendTraceTag(537150360,0,15,"VersionHistoryHighlightManager Map Author Color: Email Address is null"),
this.authorColor[N]=E[W].InitialsColor):c.ULS.sendTraceTag(537150359,0,10,"VersionHistoryHighlightManager Map Author Color: User name is null")}else c.ULS.sendTraceTag(537150363,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: versionAuthors is null")}C5j(){if(this.$.ya.VersionHistoryHighlightsSettings){var E=Array.isArray(Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ya.VersionHistoryHighlightsSettings))?Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ya.VersionHistoryHighlightsSettings):
null;for(let N=0;N<E.length;N++){var O=E[N];const J=O.key?O.key:O.Key?O.Key:"";O=O.value?O.value:O.Value?O.Value:"";"DefaultColor"===J?this.m9c=O:"InitialTint"===J?this.Sqb=O:c.ULS.sendTraceTag(537150357,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are incorrect")}}else c.ULS.sendTraceTag(537150358,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are null")}lVh(E){if(E.Email in this.authorColor)return this.authorColor[E.Email];if(E.DisplayName in
this.authorColor)return this.authorColor[E.DisplayName];c.ULS.sendTraceTag(537150356,0,15,"VersionHistoryHighlightManager GetColorFromPerson - unable to associate corresponding author in dictionary");return this.m9c}G5b(E,O){var N=Object(f.a)(t.a,this.$.ua.getItemByName(E.SheetName));const J=Object(f.a)(t.a,this.$.ua.getItemByName(O.SheetName));return N&&J?(N=(N=u.HelperMethods.FF(N.index,J.index))||u.HelperMethods.FF(E.FirstRow,O.FirstRow))||u.HelperMethods.FF(E.FirstColumn,O.FirstColumn):(c.ULS.sendTraceTag(537150355,
0,10,"VersionHistoryHighlightManager.CompareSharedSheetRange - null sheet"),0)}Y6e(){var E=k.m(this.gridView.ha.ra.activeRange,this.$.ua.na);if(!E)return c.ULS.sendTraceTag(537150354,0,10,"VersionHistoryHighlightManager.GetNearestLocationIndexFromCurrentSelection - SelectedSharedSheetRange is null "),0;E=u.HelperMethods.Bx(new h.a(this.sO),0,this.sO.length,E,this.xah);0>E&&(E=~E);return E%this.sO.length}D8b(){if(this.LMb){if(!(this.LMb.FGa.toString()in this.k2)){c.ULS.shipAssertTag(537150353,0,!1,
`VersionHistoryHighlightManager.DeselectCurrentlySelectedView - ${this.LMb.FGa.toString()} view not present in views dictionary`);return}this.k2[this.LMb.FGa.toString()].Soh(this.LMb.Sk)}this.m2a=-1}iterateNext(){this.V4f(!0)}bya(){this.V4f(!1)}static bAc(E){return`${E.range}${E.sheetId}`}}Object(r.a)(G,"VersionHistoryHighlightManager",null,[543,3])},1401:function(r,B,a){a.r(B);r=a(0);var c=a(15),b=a(8);class e{}e.VCh="ewa-vhr-rectinnerborder";Object(r.a)(e,"CssClassNames",null,[]);var f=a(71),d=
a(44),h=a(206),l=a(21),k=a(350),w=a(1295);a.d(B,"RangeVersionHistoryHighlightView",function(){return n});class n{constructor(x,m,u,t){this.xkb=null;this.$=x;this.NGg=m;this.YSa=u;this.ZSa={};this.Sqb=t;this.xmi()}get mF(){return[n.G4]}get Eb(){return this.xkb||(this.xkb=l.h(this.$).Eb)}BOb(x){x?this.Eb.$q(this.mF):this.Eb.Tj(this.mF)}NMd(){this.BOb(!1);this.Eb.JSa(new k.a(null,f.d(this.$.na)),this.mF)}rzj(x){if(this.YSa){var m=new k.a(d.E(x),f.d(this.$.ua.getItemByName(x.SheetName))),u=w.a.bAc(m);
if(u in this.YSa)if(u in this.ZSa){m=h.a.cp(this.YSa[u]);u=this.ZSa[u];for(let t in u)u[t].style.backgroundColor=`rgba(${m.r},${m.g},${m.b},${b.a.C$j})`;l.h(this.$).ha.Sa.hH(null);l.h(this.$).Maf(x,60,!0,"RangeVersionHistoryHighlightViewSelectView.SelectView")}else c.ULS.sendTraceTag(537150426,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToDivMap doesn't contain entry for "+u);else c.ULS.sendTraceTag(537150427,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap doesn't contain entry for "+
u)}else c.ULS.sendTraceTag(537150428,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap is null")}Soh(x){x=new k.a(d.E(x),f.d(this.$.ua.getItemByName(x.SheetName)));var m=w.a.bAc(x);if(m in this.ZSa)if(m in this.YSa){x=h.a.cp(this.YSa[m]);m=this.ZSa[m];for(let u in m)m[u].style.backgroundColor=`rgba(${x.r},${x.g},${x.b},${this.Sqb})`}else c.ULS.sendTraceTag(537150424,0,10,"RangeVersionHistoryHighlightView.DeselectView sheetRangeToColorMap doesn't contain entry for "+m);else c.ULS.sendTraceTag(537150425,
0,10,"RangeVersionHistoryHighlightView.DeSelectView sheetRangeToDivMap doesn't contain entry for "+m)}xmi(){this.Eb.CB(this.NGg,[n.G4],!1,(x,m)=>{if(x&&x.range&&x.sheetId&&m){var u=new k.a(x.range,x.sheetId);u=w.a.bAc(u);u in this.ZSa||(this.ZSa[u]={});this.ZSa[u][x.paneType.toString()]=m;u in this.YSa?(x=this.YSa[u],u=h.a.cp(x),m.style.borderColor=x,m.style.backgroundColor=`rgba(${u.r},${u.g},${u.b},${this.Sqb})`,x=document.createElement("div"),x.className=e.VCh,m.appendChild(x)):c.ULS.sendTraceTag(537150419,
0,10,"RangeVersionHistoryHighlightView.InitializeSheetRangeList sheetRangeToColorMap doesn't contain entry for "+u)}else c.ULS.shipAssertTag(537150423,0,!!x,"RangeVersionHistoryHighlightView.AddSheetRangeList: state is null"),c.ULS.shipAssertTag(537150422,0,!x||!!x.range,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.Range is null"),c.ULS.shipAssertTag(537150421,0,!x||!!x.sheetId,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.SheetId is null"),c.ULS.shipAssertTag(537150420,
0,!!m,"RangeVersionHistoryHighlightView.AddSheetRangeList: div is null")})}}n.G4=23;Object(r.a)(n,"RangeVersionHistoryHighlightView",null,[569])},1465:function(r,B,a){function c(Qb,zc){return zc.isUserProfilePictureResolutionEnabled?Qb.map(Yc=>{if(!Yc||!Yc.activityFeedItemPayload)return Yc;const zd=JSON.parse(Yc.activityFeedItemPayload);var ke=zd.actor;if(!ke||ke.pictureUrl)return Yc;const Td=ke.userPrincipalName||ke.email;if(!Td)return Yc;ke=zc.Aia(Td,ke.provider,d.AFrameworkApplication.xi,0);if(!ke)return Yc;
zd.actor.pictureUrl=ke;return Object.assign(Object.assign({},Yc),{activityFeedItemPayload:JSON.stringify(zd)})}):Qb}function b(Qb,zc){const Yc=new Map,zd=new Map;Qb.forEach(ke=>{if(ke&&ke.activityFeedItemPayload&&(ke=JSON.parse(ke.activityFeedItemPayload).actor)){var Td=ke.email||ke.userPrincipalName;Td&&!zd.has(Td)&&zd.set(Td,new Zc.a(Td,void 0,ke.name))}});zd.forEach(ke=>{const Td=zc.Oec(ke,6);Yc.set(ke.UserId,Td)});return Yc}a.r(B);var e=a(9),f=a(0),d=a(4),h=a(228),l=a(15),k=a(122),w=a(150),n=
a(40);class x extends k.a{constructor(Qb,zc,Yc,zd,ke){super(Qb,zc);this.executionContext=null;this.retryCount=0;this.o2i=Td=>{({RPd:Td}=this.G0j(Td)).returnValue?Td.Success?(w.c(2138207060,!0),l.ULS.sendTraceTag(42287318,0,15,"RestoreVersionActivity:onRestoreSuccessCallback Restore version is successful")):(w.c(2138207060,!1),l.ULS.sendTraceTag(42287317,0,10,`RestoreVersionActivity:onRestoreSuccessCallback Restore version failed with message ${Td.Output}`),this.qh(this.UJ)):(w.c(2138207060,!1),this.qh(this.UJ));
(Td=this.executionContext.activityState[x.Lyd])&&Td();this.qp();this.executionContext.pM()};this.n2i=()=>{if(0<this.retryCount)l.ULS.sendTraceTag(537150418,0,15,`RestoreVersionActivity:onRestoreFailureCallback Retrying version restore, retry count : ${this.retryCount}`),this.retryCount--,this.F1f();else{l.ULS.sendTraceTag(42287320,0,10,"RestoreVersionActivity:onRestoreFailureCallback Restore version failed");w.c(2138207060,!1);this.qh(this.UJ);var Td=this.executionContext.activityState[x.Lyd];Td&&
Td();this.qp();this.executionContext.pM()}};this.UJ=Yc;this.c3=zd;this.baseUrl=ke}execute(Qb){this.executionContext=Qb;this.retryCount=3;this.F1f();return 1}F1f(){var Qb=this.executionContext.activityState[x.duc];const zc=`${this.baseUrl}${"restoreversion.ashx"}`,Yc={};Yc.VersionId=this.executionContext.activityState[x.vpg];Yc.QuerySignature=Qb;Qb=n.c(Yc);this.c3.Mm(zc,2,Qb,{"Content-Type":"application/json; charset=utf-8"},!1,2,this.o2i,this.n2i,null)}G0j(Qb){let zc;zc=null;Qb=Qb?Qb.data?Qb.data.me:
null:null;return Qb&&Qb.length?({ot:zc}=n.d(Qb)).returnValue?{returnValue:!0,RPd:zc}:(l.ULS.sendTraceTag(537150416,0,10,"RestoreVersionActivity:TryGetRestoreResult Failed in deserialization of returned data from restore version"),{returnValue:!1,RPd:zc}):(l.ULS.sendTraceTag(537150417,0,10,"RestoreVersionActivity:TryGetRestoreResult data returned from restoreversion call is null or empty"),{returnValue:!1,RPd:zc})}}x.vpg="RVAvi";x.duc="RVAqs";x.Lyd="RVlvrt";Object(f.a)(x,"RestoreVersionActivity",k.a,
[]);var m=a(6);class u extends h.a{constructor(Qb,zc,Yc){super();this.activityName=Qb;this.OJ=zc;this.UJ=Yc;this.Gb()}create(){this.qb(new x(this.activityName,this.OJ,this.UJ,d.AFrameworkApplication.Hd,d.AFrameworkApplication.sa.Qa.C_))}static la(Qb){Qb.da.Ha(320,new u(m.a.UPd,m.a.Pi,m.a.VPd))}}Object(f.a)(u,"RestoreVersionActivityFactory",h.a,[]);class t extends k.a{constructor(Qb,zc){super(Qb,zc)}execute(Qb){(0,Qb.activityState[t.lcg])(()=>{this.qp();Qb.pM()});return 1}}t.lcg="RVEAssea";Object(f.a)(t,
"RestoreVersionErrorActivity",k.a,[]);class y extends h.a{constructor(Qb,zc){super();this.activityName=Qb;this.OJ=zc;this.Gb()}create(){this.qb(new t(this.activityName,this.OJ))}static la(Qb){Qb.da.Ha(321,new y(m.a.VPd,m.a.Pi))}}Object(f.a)(y,"RestoreVersionErrorActivityFactory",h.a,[]);var v=a(82),A=a(714),z=a(50),C=a(38),H=a(196),I=a(380),S=a(58);class P{constructor(Qb,zc){this.$=Qb;this.F$j=zc}Mc(){return d.AFrameworkApplication.fa.qa("IsAnonymousUser")?(l.ULS.sendTraceTag(537150415,0,15,"Verison History Command Handler: Anonymous user."),
!0):!1}executeCommand(Qb,zc){l.ULS.sendTraceTag(537150414,0,50,"VersionHistoryCommandHandler:ExecuteCommand called.");Qb=!1;switch(zc.command){case -1112508866:I.a(this.$)&&this.$.da.Ba(423).$Ac(!1),Qb=this.F$j.JPj()}l.ULS.sendTraceTag(537150413,0,50,`VersionHistoryCommandHandler:ExecuteCommand response${Qb}.`);return Qb?S.Task.Ta(Qb):H.a(zc.command)}Ac(Qb,zc){return-1112508866===zc.command&&this.$.isVersionHistoryEnabled()}Rc(){return!1}}Object(f.a)(P,"VersionHistoryCommandHandler",null,[222]);var D=
a(7),G=a(261),E=a(172),O=a(392);class N{static addAppPLTEventToLog(Qb){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(Qb)}catch(zc){}}static setIsPageLoadForFirstTime(Qb){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(Qb)}catch(zc){}}}Object(f.a)(N,"VersionHistoryLogConnector",null,[]);var J=a(27),W=a(842),ea=a(1274),R=a(164),Y=a(96),U=a(29),da=a(1),T=a(46),ka=a(259),L=a(1015),fa=a(269),wa=a(256),oa=a(12);class xa{constructor(Qb){this.Rw=Qb}fi(){fa.a(this.Rw.$).zw(this.ee)||
fa.a(this.Rw.$).fi(this)}b8(){fa.a(this.Rw.$).zw(this.ee)&&fa.a(this.Rw.$).Nz(this)}get ee(){return wa.a.spg}get mc(){return document.querySelector('[id="vhHeader"]')}get If(){return!0}Bh(Qb){return oa.DOMElementExtensions.Df(this.mc,Qb)}Bj(){this.Rw.$.frame.Se.rk(this.Rw.$.frame.Se.ZE)}ik(){}eg(Qb,zc){zc||this.Rw.GQb.then(Yc=>{Yc.enterHeaderFocusTrapZone();return null});return!zc}}Object(f.a)(xa,"VersionHistoryHeader",null,[63]);class bb{constructor(Qb){this.Rw=Qb}fi(){fa.a(this.Rw.$).zw(this.ee)||
fa.a(this.Rw.$).fi(this)}b8(){fa.a(this.Rw.$).zw(this.ee)&&fa.a(this.Rw.$).Nz(this)}get ee(){return wa.a.tpg}get mc(){return document.querySelector('[aria-describedby="versionHistoryPane"]')}get If(){return!0}Bh(Qb){return oa.DOMElementExtensions.Df(this.mc,Qb)}Bj(){this.Rw.$.frame.Se.rk(this.Rw.$.frame.Se.ZE)}ik(){}eg(Qb,zc){zc||this.Rw.GQb.then(Yc=>{Yc.enterFocusTrapZone();return null});return!zc}}Object(f.a)(bb,"VersionHistoryPane",null,[63]);class Za{constructor(Qb){this.Rw=Qb}fi(){fa.a(this.Rw.$).zw(this.ee)||
fa.a(this.Rw.$).fi(this)}b8(){fa.a(this.Rw.$).zw(this.ee)&&fa.a(this.Rw.$).Nz(this)}get ee(){return wa.a.upg}get mc(){return document.querySelector('[id="vhViewer"]')}get If(){return!0}Bh(Qb){return oa.DOMElementExtensions.Df(this.mc,Qb)}Bj(){this.Rw.$.frame.Se.rk(this.Rw.$.frame.Se.ZE)}ik(){}eg(Qb,zc){zc||this.Rw.GQb.then(Yc=>{Yc.enterViewerFocusTrapZone();return null});return!zc}}Object(f.a)(Za,"VersionHistoryViewer",null,[63]);var La=a(152),va=a(262),Ba=a(74),Ea=a(430),pa=a(778);class $a{constructor(){this.actionUrl=
this.ulsLogger=null;this.useFetch=this.hideEmbedFooter=!1}}Object(f.a)($a,"AppBootSettings",null,[]);class cb{constructor(){this.rootDiv=this.appBootSettings=null}}Object(f.a)(cb,"AppVersionControllerFactoryParameters",null,[]);class ib{constructor(){this.telemetryCollector=this.baseVersionInfo=this.selectedVersionInfo=null}}Object(f.a)(ib,"OnVersionSelectedParams",null,[]);class ta{constructor(){this.appName=0;this.wdEnableDownloadTokens=!1;this.retryCount=0;this.wdEnableIterator=this.wdEnableRestore=
this.wdEnableSaveACopy=!1;this.uiLocale=this.wacCluster=this.userSessionId=null;this.disableSaveACopy=this.wdEnableShowVersionChanges=this.wdEnableHiddenButtonsUntilVersionLoadComplete=this.viewerRootPositionRelative=this.useXhr=this.isRtl=!1;this.disabledChangeGates=null;this.wdEnableDeleteVersions=this.wdEnableSaveACopyOverFlowMenu=!1;this.wdDisableSPOFileCache=this.wdExperimentWithIteratorLocation=this.wdEnableAppColorUpdate=null}}Object(f.a)(ta,"AppSettings",null,[]);class Ya{constructor(){this.perfTelemetryInfos=
this.appSettings=this.docId=this.latestStreamServiceBase=this.serviceBase=this.ulsLogger=null}}Object(f.a)(Ya,"ControllerFactoryParameters",null,[]);var Da;(function(Qb){Qb[Qb.none=0]="none";Qb[Qb.vhUnknown=1]="vhUnknown";Qb[Qb.vhFailedToLoadVersionList=100]="vhFailedToLoadVersionList";Qb[Qb.vhFailedToGetDownloadToken=101]="vhFailedToGetDownloadToken";Qb[Qb.vhFailedToParseVersionList=102]="vhFailedToParseVersionList";Qb[Qb.vhFetchFailed=103]="vhFetchFailed";Qb[Qb.vhVersioningNotEnabled=104]="vhVersioningNotEnabled";
Qb[Qb.vhFileNotFound=105]="vhFileNotFound";Qb[Qb.vhVersionTooOld=106]="vhVersionTooOld";Qb[Qb.vhFetchException=107]="vhFetchException";Qb[Qb.vhServiceUnavailable=108]="vhServiceUnavailable";Qb[Qb.vhBadGateway=109]="vhBadGateway";Qb[Qb.vhUnauthorized=110]="vhUnauthorized";Qb[Qb.vhInternalServerError=111]="vhInternalServerError";Qb[Qb.vhEmptyVersionMetadatas=112]="vhEmptyVersionMetadatas";Qb[Qb.vhFailedHostDownload=113]="vhFailedHostDownload";Qb[Qb.vhFailedToAddDownloadToVersionStore=114]="vhFailedToAddDownloadToVersionStore";
Qb[Qb.vhFailedToCacheParts=115]="vhFailedToCacheParts";Qb[Qb.vhFailedToDownloadVersionMetadata=116]="vhFailedToDownloadVersionMetadata";Qb[Qb.vhFailedToDownloadParts=117]="vhFailedToDownloadParts";Qb[Qb.vhInvalidDocID=118]="vhInvalidDocID";Qb[Qb.vhMissingDocID=119]="vhMissingDocID";Qb[Qb.vhNullDocID=120]="vhNullDocID";Qb[Qb.vhNullHashedDocID=121]="vhNullHashedDocID";Qb[Qb.vhNullGetDownloadAccessTokenRequest=122]="vhNullGetDownloadAccessTokenRequest";Qb[Qb.vhFailedToDownloadVersionFromHost=123]="vhFailedToDownloadVersionFromHost";
Qb[Qb.vhNullResponseFromFetch=124]="vhNullResponseFromFetch";Qb[Qb.vhGetTipVersionException=125]="vhGetTipVersionException";Qb[Qb.vhGetVersionsException=126]="vhGetVersionsException";Qb[Qb.vhGetDownloadTokenException=127]="vhGetDownloadTokenException";Qb[Qb.vhFetchRetryException=128]="vhFetchRetryException";Qb[Qb.vhNullResponseFromRequestVersionHistory=129]="vhNullResponseFromRequestVersionHistory";Qb[Qb.vhNullResponseFromRequestDownloadToken=130]="vhNullResponseFromRequestDownloadToken";Qb[Qb.vhXhrJsonParseFailed=
131]="vhXhrJsonParseFailed";Qb[Qb.vhXhrException=132]="vhXhrException";Qb[Qb.vhNullResponseFromXhr=133]="vhNullResponseFromXhr";Qb[Qb.vhFileGone=134]="vhFileGone";Qb[Qb.vhNullRevisionIDs=135]="vhNullRevisionIDs";Qb[Qb.vhRequestDeleteVersionsException=136]="vhRequestDeleteVersionsException";Qb[Qb.vhNullResponseFromRequestDeleteVersions=137]="vhNullResponseFromRequestDeleteVersions";Qb[Qb.vhVersionInfoFromTipVersionException=138]="vhVersionInfoFromTipVersionException"})(Da||(Da={}));Object(f.b)("VersionHistoryFullAppErrorCode",
Da);var ba=a(311);class ya{constructor(Qb){this.baseVersionInfo=this.u3=this.Ipa=this.wl=this.ewaAccessibilityManager=this.GQb=null;this.wMd=this.Wzf=!1;this.LLe=!0;this.dialog=this.accessTokenExpirationManager=this.Gy=this.u_e=this.GD=this.p3d=this.n3d=this.o3d=null;this.NJf=zc=>{l.ULS.sendTraceTag(42553885,0,50,"VersionHistoryPaneActor:OnRestoreVersionSelected - Restore is triggered");if(this.xMj()){var Yc=ke=>{w.c(2138207060,!1);this.wl.setRestoreFailedAtServer(ke)};this.GD&&this.GD.startTimer(ya.zhg);
var zd=()=>{this.GD.endTimer(ya.zhg);this.FCe(this.GD)};this.wl.setRestoreInProgress();T.a(this.$).Br(new ka.a(m.a.tw,5,()=>{const ke=Ba.a(this.$).kd.activityState;ke[va.a.Fp]=m.a.xFe;ke[La.a.mY]=!0;ke[La.a.vT]=0;ke[x.vpg]=zc;ke[x.duc]=d.AFrameworkApplication.xi;ke[x.Lyd]=zd;ke[t.lcg]=Yc;da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RestoreVersionForConvergenceExcelOnline",!1)&&(ke[ba.a.asc]=!0)}))}else w.c(2138207060,!1)};this.uMf=zc=>{this.GQb.then(Yc=>{Yc.enterFocusTrapZone();return null});
l.ULS.sendTraceTag(537150349,0,50,"VersionHistoryPaneActor: OnVersionsReady called");this.GD.endTimer(ya.ZZd);this.GD.incrementCounter(ya.$dh);l.ULS.sendTraceTag(537150348,0,50,`VersionHistoryPaneActor: OnVersionsReady TimeTakenGetVersionsToOnVersionsReady Ms:${this.GD.getTimerDuration(ya.ZZd)}`);this.Xsj(zc.containerDiv);zc.versions&&0<zc.versions.length&&(this.u_e=ya.jF(zc.versions[zc.versions.length-1]));this.u3&&this.Ipa&&this.BRd(this.u3);l.ULS.sendTraceTag(537150346,0,50,"VersionHistoryPaneActor:OnVersionsReady Exit")};
this.onVersionSelected=zc=>{l.ULS.sendTraceTag(537150345,0,50,`VersionHistoryPaneActor:OnVersionSelected called. for Version:${ya.jF(zc.currentVersion)}, LastSelected:${ya.jF(this.u3)}`);this.GD.incrementCounter(ya.Zdh);this.u3=zc.currentVersion;this.baseVersionInfo=zc.baseVersion;this.Wzf=zc.noBaseToCompareTo;this.Ipa&&this.U9j()&&(this.BRd(zc.currentVersion),l.ULS.sendTraceTag(537150344,0,50,"VersionHistoryPaneActor:OnVersionSelected Exit"))};this.pEf=zc=>{l.ULS.sendTraceTag(537150337,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady called. for Version:${(null===
zc||void 0===zc?0:zc.versionSelected)?ya.jF(zc.versionSelected.currentVersion):null} UpdatedVersionsCount${(null===zc||void 0===zc?0:zc.updatedVersions)?zc.updatedVersions.length:0}, LastSelected:${ya.jF(this.u3)}`);this.GD.incrementCounter(ya.Ydh);if(this.baseVersionInfo){if((null===zc||void 0===zc?0:zc.updatedVersions)&&2<=zc.updatedVersions.length){let Yc=null,zd=null;const ke=ya.jF(this.u3),Td=ya.jF(this.baseVersionInfo);for(const Ge of zc.updatedVersions)if(zc=ya.jF(Ge),ke===zc?Yc=Ge:Td===zc&&
(zd=Ge),Yc&&zd)break;Yc&&zd?(this.u3=Yc,this.baseVersionInfo=zd,l.ULS.sendTraceTag(537150307,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady -Calling versionsViewController:OnVersionSelected RevisionID[N]: ${ya.jF(this.u3)}, RevisionID[N-1]: ${ya.jF(this.baseVersionInfo)}.`),this.BRd(this.u3)):l.ULS.sendTraceTag(537150306,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady - does not find currentVersion or baseVersion from UpdatedVersions. RevisionID[N]: ${ke}, RevisionID[N-1]: ${Td}.`)}else l.ULS.sendTraceTag(537150305,
0,50,"VersionHistoryPaneActor:OnDownloadTokenReady - no diff call due to downloadTokenReadyObject or downloadTokenReadyObject.UpdatedVersions objects are null or not enough.");l.ULS.sendTraceTag(537150304,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady")}else l.ULS.sendTraceTag(537150336,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady baseVersionInfo is null in OnDownloadTokenReady callback.")};this.mDf=()=>{l.ULS.sendTraceTag(537150303,0,50,"VersionHistoryPaneActor:OnCloseVersionHistoryDialog Called");
this.H9g();const zc=new Y.a(1470556788,0,this.$.xc,0,null);this.$.Ia.Hb(zc)};this.dKf=zc=>{l.ULS.sendTraceTag(41739662,0,50,"VersionHistoryPaneActor:OnSaveACopy Called");let Yc=new Y.a(-1244760097,0,this.$.xc,0,null);this.$.ke.get(51)&&(l.ULS.sendTraceTag(537150301,0,50,"VersionHistoryPaneActor:OnSaveACopy for ODConsumer Called"),Yc=new Y.a(-309686558,0,this.$.xc,0,null));w.c(1604651619,!0);this.$.Ia.Hb(Yc,{["FileDownloadUrl"]:zc})};this.qEf=zc=>{l.ULS.sendTraceTag(537150300,0,50,"VersionHistoryPaneActor:OnDownloadVersion Called");
if(!da.EwaSettings.isChangeGateEnabled("OfficeVSO:6794681_VHDisableDownloadACopy")||this.wMj())zc=new G.QueryStringBuilder(zc),zc.hj("fn",d.AFrameworkApplication.fileName),l.ULS.sendTraceTag(537150299,0,50,"VersionHistoryPaneActor:OnDownloadVersion URL Length is "+zc.toString().length),8===this.$.frame.z$a(zc.toString(),!0)?(l.ULS.sendTraceTag(587830283,0,10,"VersionHistoryPaneActor:OnDownloadVersion failed"),w.c(1316171850,!1)):w.c(1316171850,!0)};this.TBf=zc=>{this.wl.setFullAppErrorCode(zc);da.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&
this.wl.setViewerError(!0)};this.Sxe=zc=>{const Yc=document.getElementById(ya.EXe);!Yc||this.Gy&&!zc||(l.ULS.sendTraceTag(537150293,0,50,"VersionHistoryPaneActor: SelectVersion Lazy instantiate VersionHistoryMessenger"),this.Gy=new L.a(Yc.contentWindow,v.a.oba(this.$.ya.VersionHistoryActionUrl)||pa.a.f$),this.Gy.Il(E.a.kVa,this.Dcb),this.Gy.Il(E.a.lVa,this.Dcb),this.Gy.Il(E.a.fZ,this.Dcb),this.Gy.lo(L.a.setCurrentChangeCount),this.Gy.lo(L.a.setTotalChangesCount),da.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.Gy.lo(L.a.XPa),this.Gy.Il(L.a.setCurrentChangeCount,this.Dcb),this.Gy.Il(L.a.setTotalChangesCount,this.Dcb),da.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.Gy.Il(L.a.XPa,this.Dcb))};this.FFf=zc=>{if(da.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes"))zc=Da[zc]?Da[zc]:"None";else switch(zc){case 101:zc="VHFailedToGetDownloadToken";break;case 100:zc="VHFailedToLoadVersionList";break;case 104:zc="VHVersioningNotEnabled";
break;case 105:zc="VHFileNotFound";break;case 106:zc="VHVersionTooOld";break;default:zc="None"}this.GD.addEvent("OnFullAppError",zc);l.ULS.sendTraceTag(537150291,0,10,`FullApp Error Event: ${zc}`)};this.YFd=zc=>{this.LLe=zc;l.ULS.sendTraceTag(537150290,0,50,`VersionHistoryPaneActor:Show Changes toggled to:${zc.toString()}`);this.XRd(L.a.kQb,{["ToggleValue"]:zc})};this.bHf=zc=>{l.ULS.sendTraceTag(50405840,0,50,`VersionHistoryPaneActor:OnIteratorSelected next: ${zc}`);w.c(1488635506,!0);const Yc={};
zc?this.XRd(L.a.iterateNext,Yc):this.XRd(L.a.bya,Yc)};this.Dcb=zc=>{switch(zc.MessageId){case E.a.kVa:l.ULS.sendTraceTag(537150289,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppCompleted ");da.EwaSettings.xa(370)&&this.wl.setVersionLoadComplete();break;case E.a.lVa:l.ULS.sendTraceTag(51128035,0,10,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppFailed");break;case L.a.setCurrentChangeCount:zc=zc.Values.count;l.ULS.sendTraceTag(537150288,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetCurrentChangeCount : ${zc}`);
this.wl.setCurrentChangeCount(zc);break;case L.a.setTotalChangesCount:zc=zc.Values.count;l.ULS.sendTraceTag(537150287,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetTotalChangesCount : ${zc}`);this.wl.setTotalChangesCount(zc);break;case L.a.XPa:this.YFd(this.LLe);break;case E.a.fZ:if(!da.EwaSettings.isChangeGateEnabled("OfficeVSO:7402639_ExcelVHAccessTokenExpiredRefreshFix"))break;l.ULS.sendTraceTag(509682466,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession DocumentRefresh");
this.aSi();break;default:l.ULS.sendTraceTag(537150286,0,15,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession MessageID:${zc.MessageId}`)}};this.$=Qb;this.pac=this.$.Cb+ya.qHh;this.vMd=!1;da.EwaSettings.xa(341)&&this.plh();da.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&this.$.da.hb(38,zc=>{this.accessTokenExpirationManager=zc;this.VPa=this.VPa.bind(this);this.accessTokenExpirationManager.rpb(this.VPa)});this.YDb="";this.Awd=0;this.perfTelemetryInfos=
[]}VPa(){null!=this.wl&&(this.wl.updateDocId(d.AFrameworkApplication.xi),l.ULS.sendTraceTag(509699330,0,50,"VersionHistoryPaneActor:onTokenRefreshed completed Successfully"))}dispose(){da.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&this.accessTokenExpirationManager.Wvc(this.VPa);this.jEe()}vaj(){this.$.da.hb(15,Qb=>{this.ewaAccessibilityManager=Qb;this.ewaAccessibilityManager.mode=2})}plh(){this.o3d=new bb(this);this.n3d=new xa(this);this.p3d=new Za(this)}JPj(){l.ULS.sendTraceTag(41739649,
0,15,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction called");d.AFrameworkApplication.pN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryEnableODCSaveACopy");d.AFrameworkApplication.pN("Microsoft.Office.Excel.Server.Flighting.IDenyListVersionHistorySaveACopyOverFlowMenu");d.AFrameworkApplication.pN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryRestoreSkipCoauthCheck");d.AFrameworkApplication.Qq("8492a557;72ff4572");this.GD=excelVersionHistory.FactoryGlobal.getTelemetryCollector();
this.perfTelemetryInfos=[];this.GD.startTimer(ya.yhg);if(!this.wl&&(Ea.a(()=>{this.wl=versionHistory.FactoryGlobal.getVersionHistoryControllerInstance(Object(D.a)(new Ya,{ulsLogger:new O.a,docId:d.AFrameworkApplication.xi,appSettings:Object(D.a)(new ta,{appName:120,userSessionId:d.AFrameworkApplication.userSessionId,wdEnableSaveACopy:da.EwaSettings.xa(312),wdEnableDownloadTokens:da.EwaSettings.xa(309),wacCluster:d.AFrameworkApplication.Hd.YO,uiLocale:d.AFrameworkApplication.uiCulture||"en-us",wdEnableRestore:da.EwaSettings.xa(281)&&
this.$.isEditMode,wdEnableIterator:da.EwaSettings.xa(278)&&da.EwaSettings.xa(279),useXhr:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:da.EwaSettings.xa(370),disableSaveACopy:this.bVd(),wdEnableShowVersionChanges:da.EwaSettings.xa(278)&&da.EwaSettings.xa(280),disabledChangeGates:this.$.ya.VHSDisabledChangeGates,wdEnableSaveACopyOverFlowMenu:da.EwaSettings.xa(466),isRtl:d.AFrameworkApplication.isRtl,wdExperimentWithIteratorLocation:da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryIteratorInPane",
!1)}),perfTelemetryInfos:this.perfTelemetryInfos}))}),!this.wl))return l.ULS.sendTraceTag(537150352,0,10,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction - VersionHistoryController should not be null"),w.c(429638140,!1),!1;this.KPj();this.GD.endTimer(ya.yhg);this.GD.startTimer(ya.Bhg);l.ULS.sendTraceTag(537150351,0,50,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction Returned Success");w.c(429638140,!0);return!0}KPj(){var Qb;this.Ilj();if(!document.getElementById(this.pac)){const zc=
document.createElement("div");zc.id=this.pac;zc.style.width="100%";zc.style.zIndex="998";zc.style.display="block";zc.style.position="absolute";if(d.AFrameworkApplication.sa.Qa.kf){const Yc=(null===(Qb=document.getElementById("HeaderRegion"))||void 0===Qb?void 0:Qb.offsetHeight)||0;zc.style.top=Yc+"px";zc.style.bottom="0px";zc.style.height=`calc(100vh - ${Yc}px)`}else zc.style.height="100%";this.$.Hp.insertBefore(zc,this.$.Hp.firstChild);this.GQb=this.wl.createVersionHistoryDialog(zc)}document.getElementById(this.pac).style.display=
"block";this.lMd();this.GD.startTimer(ya.ZZd);this.wl.getVersions("")}lMd(){da.EwaSettings.xa(341)&&(this.o3d.fi(),this.n3d.fi(),this.p3d.fi(),this.vaj())}e1d(){da.EwaSettings.xa(341)&&(this.o3d.b8(),this.n3d.b8(),this.p3d.b8(),this.ewaAccessibilityManager&&(this.ewaAccessibilityManager.mode=0))}Ilj(){this.wl.getVersionsReadyEvent().addListener(this.uMf);this.wl.getVersionSelectedEvent().addListener(this.onVersionSelected);this.wl.getCloseSelectedEvent().addListener(this.mDf);this.wl.getFullAppErrorEvent().addListener(this.FFf);
this.wl.getIteratorSelectedEvent().addListener(this.bHf);this.wl.getShowVersionChangesToggledEvent().addListener(this.YFd);da.EwaSettings.xa(309)&&(this.wl.getDownloadTokenReadyEvent().addListener(this.pEf),this.vMd=!0);da.EwaSettings.xa(312)&&(this.wl.getSaveACopySelectedEvent().addListener(this.dKf),this.wl.getDownloadVersionSelectedEvent().addListener(this.qEf));da.EwaSettings.xa(281)&&this.$.isEditMode&&(this.wl.getRestoreVersionSelectedEvent().addListener(this.NJf),this.wMd=!0)}Jlj(){this.Ipa.getAppErrorEvent().addListener(this.TBf)}Xj(){this.wl.getVersionsReadyEvent().removeListener(this.uMf);
this.wl.getVersionSelectedEvent().removeListener(this.onVersionSelected);this.wl.getCloseSelectedEvent().removeListener(this.mDf);this.wl.getFullAppErrorEvent().removeListener(this.FFf);this.wl.getIteratorSelectedEvent().removeListener(this.bHf);this.wl.getShowVersionChangesToggledEvent().removeListener(this.YFd);da.EwaSettings.xa(312)&&(this.wl.getSaveACopySelectedEvent().removeListener(this.dKf),this.wl.getDownloadVersionSelectedEvent().removeListener(this.qEf));this.vMd&&(this.wl.getDownloadTokenReadyEvent().removeListener(this.pEf),
this.vMd=!1);this.wMd&&(this.wl.getRestoreVersionSelectedEvent().removeListener(this.NJf),this.wMd=!1);this.Ipa&&this.Ipa.getAppErrorEvent().removeListener(this.TBf)}aKj(){return this.bVd()||!d.AFrameworkApplication.hZ}wMj(){return this.aKj()?(l.ULS.sendTraceTag(520180169,0,15,"VersionHistoryPaneActor:OnDownloadVersion blocked"),w.c(1316171850,!1),!1):!0}xMj(){let Qb=!0;if(da.EwaSettings.xa(521)&&!this.$.ZM)return l.ULS.sendTraceTag(537150350,0,15,"VersionHistoryPaneActor:ShouldTriggerRestore - Skipping coauth check with status "+
this.$.ea.amIAlone.toString()),!0;if(!this.$.ea.amIAlone&&!da.EwaSettings.xa(277)){this.kGi();this.wl.setCoauthRestoreError();Qb=!1;const zc=new Y.a(-729359593,0,this.$.xc,0,null);this.$.Ia.Hb(zc)}this.$.ZM&&(l.ULS.sendTraceTag(42522439,0,10,"VersionHistoryPaneActor:ShouldTriggerRestore - Restore failed, Unsaved changes present"),Qb&&(Qb=!1,this.IPj()));return Qb}IPj(){var Qb=U.a.hd(1,0,1903,1902,0,-1603358883,"RestoreVersionUnsavedChangesError");Qb=this.dialog||new R.ErrorDialog(this.$,Qb);Qb.initialize();
Qb.fg()}U9j(){l.ULS.sendTraceTag(537150343,0,50,`VersionHistoryPaneActor:ValidateDiffDiffParameters called for BaseVersion${this.baseVersionInfo?ya.jF(this.baseVersionInfo):""}`);if(ya.jF(this.u3)===this.u_e)return l.ULS.sendTraceTag(537150342,0,15,"VersionHistoryPaneActor:ValidateDiffDiffParameters for last version"),!0;if(da.EwaSettings.isChangeGateEnabled("OfficeVSO:4381797_XLVHSkipBaseVersionValidateForGroupingUI")&&!this.baseVersionInfo&&this.Wzf)return l.ULS.sendTraceTag(537150341,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters skipping diff last version"),
!0;if(!this.baseVersionInfo)return l.ULS.sendTraceTag(537150340,0,10,"VersionHistoryPaneActor:ValidateDiffDiffParameters for null BaseVersion"),!1;const Qb=ya.JXh(this.baseVersionInfo);l.ULS.sendTraceTag(537150339,0,50,`downloadURL length ${Qb?Qb.length:0}`);return Qb?!0:(l.ULS.sendTraceTag(537150338,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters downloadURL is null"),!1)}bVd(){return!this.$.nla}H9g(){document.getElementById(this.pac).style.display="none";const Qb=new Y.a(-1423792966,0,
this.$.xc,0,null);this.$.Ia.Hb(Qb);this.jEe()}jEe(){this.GD&&(this.GD.endTimer(ya.Bhg),this.FCe(this.GD),this.GD=null);this.Xj();this.e1d();this.perfTelemetryInfos&&(l.ULS.sendTraceTag(537150302,0,15,this.perfTelemetryInfos.map(Qb=>JSON.stringify(Qb)).toString()),this.perfTelemetryInfos=null);this.Gy&&(this.Gy.Sea(E.a.kVa),this.Gy.Sea(E.a.lVa),this.Gy.Sea(L.a.setCurrentChangeCount),this.Gy.Sea(L.a.setTotalChangesCount),this.Gy.Sea(E.a.fZ),da.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.Gy.Sea(L.a.XPa),this.Gy.dispose(),this.Gy=null)}Xsj(Qb){try{this.Ipa?(N.setIsPageLoadForFirstTime(!1),da.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&!document.getElementById(ya.EXe)&&(this.Ipa.resetContainer(Qb),this.Sxe(!0))):(N.setIsPageLoadForFirstTime(!0),Ea.a(()=>{const zc=new $a;zc.ulsLogger=new O.a;zc.actionUrl=this.$.ya.VersionHistoryActionUrl;zc.hideEmbedFooter=!0;zc.useFetch=da.EwaSettings.xa(365)&&!J.a.Cw;this.Ipa=excelVersionHistory.FactoryGlobal.getAppVersionControllerInstance(Object(D.a)(new cb,
{appBootSettings:zc,rootDiv:Qb}))})),this.Jlj()}catch(zc){l.ULS.sendTraceTag(41239239,0,10,`VersionHistoryPaneActor: ResetAppVersionController failed due to exception. ${zc}`)}}BRd(Qb){l.ULS.sendTraceTag(537150298,0,50,`VersionHistoryPaneActor:SelectVersion called. for Version:${ya.jF(Qb)}, LastSelected:${this.YDb}`);if(Qb)if(ya.jF(Qb).length){var zc=(new Date).getTime();if(ya.jF(Qb)===this.YDb&&1E3>zc-this.Awd)l.ULS.sendTraceTag(537150295,0,50,"VersionHistoryPaneActor:SelectVersion reattempt within 1 sec");
else{ya.jF(Qb)!==this.YDb&&(l.ULS.sendTraceTag(537150294,0,50,"VersionHistoryPaneActor:Reset Iterator states if user clicks on different version"),this.wl.setTotalChangesCount(-1),this.wl.setCurrentChangeCount(-1));var Yc=excelVersionHistory.FactoryGlobal.getTelemetryCollector();Yc.addEvent("SelectVersion",ya.jF(Qb));try{this.Cbk(Yc);this.Awd=zc;this.YDb=ya.jF(Qb);const zd=new ib;zd.selectedVersionInfo=this.u3;zd.baseVersionInfo=this.baseVersionInfo;zd.telemetryCollector=Yc;this.Ipa.onVersionSelectedWithParams(zd);
this.wl&&da.EwaSettings.xa(312)&&this.wl.setDisableSaveACopy(this.bVd());this.Sxe(!1)}catch(zd){this.Awd=0,this.YDb="",Yc.addEvent("Exception",zd.toString()),l.ULS.sendTraceTag(42016832,0,10,`VersionHistoryPaneActor: OnVersionSelected failed due to exception. ${zd}`)}finally{l.ULS.sendTraceTag(537150292,0,50,Yc?Yc.getJsonForLogging():"")}}}else l.ULS.sendTraceTag(537150296,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion RevisionId is null");else l.ULS.sendTraceTag(537150297,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion is null")}Cbk(Qb){for(const zc of this.perfTelemetryInfos){const Yc=
zc.TelemetryEventKey?zc.TelemetryEventKey:zc.telemetryEventKey?zc.telemetryEventKey:"",zd=zc.TelemetryEventData?zc.TelemetryEventData:zc.telemetryEventData?zc.telemetryEventData:"";Yc&&zd&&Qb.addEvent(Yc,zd)}this.perfTelemetryInfos.length=0}FCe(Qb){l.ULS.sendTraceTag(42553886,0,15,`VersionHistoryPaneActor:CaptureSessionTelemetry - ${Qb?Qb.getJsonForLogging():""} `)}kGi(){const Qb=this.$.ea.Do,zc={};let Yc=null;for(const zd of Qb)zd.UserEmail&&(zc[zd.UserEmail]=zd.UserEmail in zc?zc[zd.UserEmail]+
1:1),zd.User.UserID===this.$.ea.clientId&&(Yc=zd.UserEmail);l.ULS.sendTraceTag(42522438,0,10,`VersionHistoryPaneActor:LogCoauthorsTelemetry Restore failed, TotalAuthors: ${Qb.length}, TotalAuthorsAsYourself ${Yc?zc[Yc]:-1}`)}aSi(){T.a(this.$).Br(new ka.a(m.a.tw,5,()=>{const Qb=Ba.a(this.$).kd.activityState;Qb[va.a.Fp]=m.a.Pi;Qb[ba.a.asc]=!0}))}XRd(Qb,zc){l.ULS.sendTraceTag(537150285,0,50,`VersionHistoryPaneActor.SendPostMessageToTheVHSession called with MessageID:${Qb}`);if(this.Gy){Qb=new W.a(Qb);
Qb.Values[ea.a.r8c]=this.$.ya.UserSessionId;if(zc)for(let Yc in zc)Qb.Values[Yc]=zc[Yc];this.Gy.send(Qb)}else l.ULS.sendTraceTag(537150284,0,10,"VersionHistoryPaneActor.SendPostMessageToTheVHSession versionHistoryMessenger is null")}static jF(Qb){return Qb?Qb.RevisionID?Qb.RevisionID:Qb.revisionID?Qb.revisionID:"":""}static JXh(Qb){return Qb?Qb.DownloadUrl?Qb.DownloadUrl:Qb.downloadUrl?Qb.downloadUrl:"":""}}ya.qHh="_excelVersionHistoryOverlay";ya.EXe="vhs_frame";ya.yhg="TimeTakenShowVersionHistoryDialogAction";
ya.Bhg="TimeTillVersionHistoryDialogWasOpenMs";ya.ZZd="TimeTakenGetVersionsToOnVersionsReady";ya.Zdh="CountOnVersionSelectedCalledinOneVHSession";ya.$dh="CountOnVersionsReadyCalledinOneVHSession";ya.Ydh="CountOnDownloadTokenReadyCalledinOneVHSession";ya.zhg="TimeTakenVersionRestore";Object(f.a)(ya,"VersionHistoryPaneActor",null,[3]);var V=a(108),Z=a(153),ja=a(54);class la extends A.a{constructor(Qb){super(Qb)}ld(){const Qb=this.rFi(),zc=z.GetServiceTaskFactory.Pa(this.$.da,21,137,this.Na);C.TaskExtensions.za(C.TaskExtensions.Md([Qb,
zc],this.ka,3),()=>{var Yc=zc.result;const zd=v.a.oba(this.$.ya.VersionHistoryActionUrl);zd!==pa.a.f$&&Yc.nY(zd);Yc=new ya(this.$);this.fd([new P(this.$,Yc)])},this.ka,3)}rFi(){if(da.EwaSettings.isChangeGateEnabled("OfficeVSO:7457857_DynamicScriptLoaderNewService"))return V.c(Z.a.resolve(ja.l,{Wb:this.Na}).then(zc=>zc("excelVersionHistory")));const Qb=z.GetServiceTaskFactory.n4(this.$.da,283,284,this.Na).then(zc=>zc.Ll.loadScript("excelVersionHistory"),zc=>{l.ULS.sendTraceTag(537150412,0,10,`versionHistoryManagerFactory: Dynamic Script Loading failed due to exception. ${zc}`);
return Promise.reject(zc)});return V.c(Qb)}static la(Qb){A.a.Rd(304,new la(Qb))}}Object(f.a)(la,"VersionHistoryCommandHandlerFactory",A.a,[]);var ua=a(1295),eb=a(717);class Eb extends h.a{constructor(Qb){super();this.$=Qb;this.Gb()}create(){const Qb=z.GetServiceTaskFactory.Pa(this.$.da,211,212,this.Na),zc=z.GetServiceTaskFactory.Pa(this.$.da,21,137,this.Na);C.TaskExtensions.za(C.TaskExtensions.Md([Qb,zc],this.$.ka),()=>{const Yc=Object(eb.a)(this.$.da,305,()=>new ua.a(this.$,!0,zc.result,Qb.result));
this.qb(Yc)},this.$.ka,3)}static la(Qb){Qb.da.Ha(306,new Eb(Qb))}}Object(f.a)(Eb,"VersionHistoryHighlightManagerFactory",h.a,[]);var Wb=a(517),Ab=a(5),Jb=a(171),Gb=a(14);class Nb extends k.a{constructor(Qb,zc,Yc){super(Qb,zc);this.lineageManager=Yc}execute(Qb){this.lineageManager.lineageHidePreviousHistory();return super.execute(Qb)}}Object(f.a)(Nb,"LineageClearHistoryConfirmedActivity",k.a,[]);var Ja=a(16),ab=a(147);class wb{constructor(Qb,zc){this.$=Qb;this.lineageManager=zc;Qb=[new Ja.a(m.a.qxd,
1038647878,0,0,2244),new Ja.a(m.a.idle,1038647878,0,1)];Ba.a(this.$).ZLd(new ab.a(m.a.pxd,m.a.idle,Qb),new Nb(m.a.qxd,m.a.idle,zc))}Mc(){return!1}executeCommand(Qb,zc,Yc){Qb=!1;switch(zc.command){case 1834994092:9===zc.Ve&&this.hVj();this.jNj(zc,Yc);Qb=!0;break;case -409942531:this.lNj(),Qb=!0}return Qb?S.Task.Ta(!0):H.a(zc.command)}Ac(Qb,zc){return 1834994092===zc.command||-409942531===zc.command}Rc(){return!1}jNj(Qb,zc){l.ULS.sendTraceTag(537155483,0,50,`LineageActivityCommandHandler::ShowChangesCore command location: ${zc.MenuItemId||
Qb.Ve}`);this.lineageManager.Ibg(19===Qb.Ve&&!!zc.MenuItemId,zc.MenuItemId,Qb.Ve,zc)}hVj(){const Qb=Ab.a.vuc;Qb!==Jb.a(this.$).yp.Vz&&Jb.a(this.$).yp.activateRibbonTab(Qb)}lNj(){T.a(this.$).Br(new ka.a(m.a.pxd,5,()=>{const Qb=Ba.a(this.$).kd,zc=U.a.hd(3,1,2241,2242,2243,1038647878,"LineageConfirmClearHistory");zc.HelpTopicId="a1493bf9-25c3-470a-b970-60eceb0136e5";zc.HelpDescription=Gb.a.instance.ga(1319);Qb.ir([zc])}))}}Object(f.a)(wb,"LineageActivityCommandHandler",null,[222]);class xb extends A.a{constructor(Qb){super(Qb)}ld(){C.TaskExtensions.za(z.GetServiceTaskFactory.Pa(this.$.da,
366,367,this.Na),Qb=>{this.fd([new wb(this.$,Qb.result)])},this.ka,3)}static la(Qb){A.a.Rd(363,new xb(Qb))}}Object(f.a)(xb,"LineageActivityCommandHandlerFactory",A.a,[]);class rb{constructor(Qb){this.rTa=!0;rb.ejf()?rb.yqi()?this.rTa=!1:rb.pjf()?(l.ULS.sendTraceTag(526434368,0,50,`LineageCatchUpExperimentManager is running in hybrid mode. TUI exhausted: ${!Qb}`),this.rTa=Qb):this.rTa=!1:this.rTa=!0}V7a(){return!this.rTa}static pjf(){return rb.ejf()&&da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationTeachingUXTreatmentToControl",
!1)}static ejf(){return da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationSummaryStringTreatment",!1)}static yqi(){return da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)}}Object(f.a)(rb,"LineageCatchUpExperimentManager",null,[649]);class za extends h.a{constructor(Qb){super();this.$=Qb;this.Gb()}create(){rb.pjf()?C.TaskExtensions.za(z.GetServiceTaskFactory.Pa(this.$.da,456,457,this.Na),Qb=>{C.TaskExtensions.za(Qb.result.ILj(),zc=>{this.zJe(zc.result)},
this.$.ka,3)},this.$.ka,3):this.zJe(!0)}zJe(Qb){this.qb(this.$.da.Ba(458)||this.$.da.Ha(458,new rb(Qb)))}static la(Qb){Qb.da.Ha(459,new za(Qb))}}Object(f.a)(za,"LineageCatchUpExperimentManagerFactory",h.a,[]);var Aa=a(425),pb=a(33),kb=a(86),Cb=a(158),ob=a(127);class qa{}Object(f.a)(qa,"LineageClientParams",null,[]);class ma{}Object(f.a)(ma,"LineageFilter",null,[]);var Ga=a(71),vb=a(73),Ka=a(132),Pa=a(44),fb=a(198),Wa=a(117),Ma=a(124),lb=a(255),Na=a(290),X=a(21),F=a(133),na=a(63);const hb=(Qb,zc,Yc,
zd,ke,Td,Ge,bf=null)=>{bf=Qb.Oa(1,bf);bf.clientParams=zc;bf.lineageFilter=Yc;return na.g(Qb,"LineageOpenPaneOrChangeFilter",bf,zd,ke,Td,Ge,0)},Ib=(Qb,zc,Yc,zd,ke,Td,Ge=null)=>{Ge=Qb.Oa(1,Ge);Ge.fetchFromBelow=zc;return na.g(Qb,"LineageLoadMore",Ge,Yc,zd,ke,Td,0)},vc=(Qb,zc,Yc,zd,ke,Td=null)=>{Td=Qb.Oa(1,Td);return na.g(Qb,"LineageRefreshView",Td,zc,Yc,zd,ke,0)},nc=(Qb,zc,Yc,zd,ke,Td=null)=>{Td=Qb.Oa(1,Td);return na.g(Qb,"LineageUpdateView",Td,zc,Yc,zd,ke,0)},Pb=(Qb,zc,Yc,zd,ke,Td=null)=>{Td=Qb.Oa(1,
Td);return na.g(Qb,"LineageClosePane",Td,zc,Yc,zd,ke,0)},oc=(Qb,zc,Yc,zd,ke,Td=null)=>{Td=Qb.Oa(1,Td);return na.g(Qb,"LineageHidePreviousHistory",Td,zc,Yc,zd,ke,0)},Ic=(Qb,zc,Yc,zd,ke,Td=null)=>{Td=Qb.Oa(1,Td);return na.g(Qb,"LineageLoadInGridBlueDots",Td,zc,Yc,zd,ke,0)},ec=(Qb,zc,Yc,zd,ke,Td=null)=>{Td=Qb.Oa(1,Td);return na.g(Qb,"LineageGetOriginalBlueDotsUidList",Td,zc,Yc,zd,ke,4)};var mb=a(53),Ob=a(351);class Ta{constructor(){this.activityList=null;this.oldestActivityId=this.latestActivityId=0;
this.lastSearchedActivityTimestamp=null;this.serverLastActivityId=this.serverFirstActivityId=this.serverMessageCode=0;this.docId=null;this.showLoadPrevious=!1;this.eolPersonHideHistory=this.eolDateHideHistory=this.eolCorrelationId=null}}Object(f.a)(Ta,"LineageActivitiesResponseDTO",null,[]);class sb extends Ta{constructor(){super();this.hasNewActivities=!1;this.filterSheetMultiRange=null}}Object(f.a)(sb,"LineageActivitiesUpdateResponseDTO",Ta,[]);class zb{constructor(){this.shouldShowBlueDot=this.onDisplayInGridHighlightsChanged=
this.areInGridHighlightsEnabled=this.areInGridHighlightsAvailable=this.onDegradedCardGiveFeedbackButtonClicked=this.onLearnMoreLinkClicked=this.isFeatureEnabled=this.onRangeFilterInputEnabled=this.tryParseRangeInfo=this.onVersionHistoryButtonClicked=this.onCardSelected=this.lineageUpdateViewRequest=this.lineageRefreshViewRequest=this.lineageLoadMoreRequest=this.lineageOpenPaneOrChangeFilterRequest=null}}Object(f.a)(zb,"LineageAppCallbacks",null,[]);class db{constructor(){this.imageUrl=this.email=
this.displayName=this.provider=this.id=null}}Object(f.a)(db,"LineageAuthorDTO",null,[]);class jb{constructor(){this.logger=this.uiCulture=this.dataCulture=null;this.clientBatchSize=0;this.lineageAppCallbacks=this.filterableSheetList=null}}Object(f.a)(jb,"LineageControllerFactoryParams",null,[]);class Ub{constructor(){this.lastCol=this.firstCol=this.lastRow=this.firstRow=0}}Object(f.a)(Ub,"LineageSharedRangeDTO",null,[]);class xd{constructor(){this.sheetName=this.rangeList=null}}Object(f.a)(xd,"LineageSheetMultiRangeDTO",
null,[]);class ne{constructor(){this.activityId=0;this.displayTimestamp=this.author=this.activityGuid=null;this.activityType=0;this.rangeHighlightLocation=this.isBulkEditOverflow=this.valueChanges=this.gridLocation=this.sheetName=this.nestedActivityList=null;this.degradedCardTypeBits=0}}Object(f.a)(ne,"LineageUserActivityDTO",null,[]);class fe{constructor(){this.hasOldValue=this.hasNewValue=!1;this.cellLocation=this.oldValue=this.newValue=null}}Object(f.a)(fe,"LineageValueChangeDTO",null,[]);var Bd;
(function(Qb){Qb[Qb.default=0]="default";Qb[Qb.D48X48=1]="D48X48";Qb[Qb.D64X64=2]="D64X64";Qb[Qb.D96X96=3]="D96X96";Qb[Qb.D120X120=4]="D120X120";Qb[Qb.D240X240=5]="D240X240";Qb[Qb.D360X360=6]="D360X360";Qb[Qb.D432X432=7]="D432X432";Qb[Qb.D504X504=8]="D504X504";Qb[Qb.D648X648=9]="D648X648"})(Bd||(Bd={}));Object(f.b)("ProfilePhotoDimension",Bd);const Ue=(Qb,zc)=>{let Yc=[];for(const De of Qb){Qb=De;var zd=zc,ke=Object(D.a),Td=new ne,Ge=Number.parseLocale(Qb.UserActivity.Id),bf=Qb.Uid,Fa=Qb.UserActivity.Type;
var aa=Qb.UserActivity.Person;var Xa=zd;if(aa){var Lb=null;d.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(Lb=Xa.Aia(aa.Email,aa.Provider,d.AFrameworkApplication.xi,Bd.default));aa=Object(D.a)(new db,{id:aa.Id,provider:aa.Provider,displayName:aa.DisplayName,email:aa.Email,imageUrl:Lb})}else aa=null;Xa=Qb.SheetName;Lb=new Date(Qb.UserActivity.DisplayTimestamp);var kc=Qb.DisplayLocation,Nc=Qb.LineageValueChangeList;var ad=[];for(const le of Nc)Nc=Object(D.a)(new fe,{hasNewValue:le.HasNewValue,
hasOldValue:le.HasOldValue,newValue:le.HasNewValue?le.NewValue:null,oldValue:le.HasOldValue?le.OldValue:null,cellLocation:le.CellLocation}),ad.push(Nc);Nc=Qb.IsBulkEditOverFlow;a:{var sd=Qb.UserActivity.LocationList;var ce=Qb.UserActivity.Type;if(!sd){l.ULS.sendTraceTag(512259102,0,15,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is null");ce=null;break a}if(!sd.length){l.ULS.sendTraceTag(512259101,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is empty");
ce=null;break a}var Ce=[],ve=[];let le="";21===ce?ve.push(sd[0]):ve=sd;for(const qf of ve)switch(qf.Type){case 1:break;case 2:le=qf.SheetName;break;case 0:sd=qf;if(!sd.RangeList){l.ULS.sendTraceTag(512259099,0,50,"LineageManagerUtil:: RangeHighlightLocation.RangeActivityLocation is null");break}le=sd.RangeList[0].SheetName;ve=[];21===ce?ve.push(sd.RangeList[0]):ve=sd.RangeList;for(const Nf of ve)sd=Object(D.a)(new Ub,{firstCol:Nf.FirstColumn,firstRow:Nf.FirstRow,lastRow:Nf.LastRow,lastCol:Nf.LastColumn}),
Ce.push(sd);break;default:l.ULS.sendTraceTag(512259098,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is of type: ",qf.Type)}ce=Object(D.a)(new xd,{sheetName:le,rangeList:Ce})}zd=(Ce=Qb.NestedActivityList)?Ue(Ce,zd):null;Qb=ke(Td,{activityId:Ge,activityGuid:bf,activityType:Fa,author:aa,sheetName:Xa,displayTimestamp:Lb,gridLocation:kc,valueChanges:ad,isBulkEditOverflow:Nc,rangeHighlightLocation:ce,nestedActivityList:zd,degradedCardTypeBits:Qb.DegradedCardTypeBits});25===Qb.activityType?
(ke=[],mc(Qb,ke),Yc=[...Yc,...ke]):Yc.push(Qb)}return Yc},mc=(Qb,zc)=>{25===Qb.activityType?Qb.nestedActivityList.forEach(Yc=>{Yc&&mc(Yc,zc)}):zc.push(Qb)};class Fc{constructor(Qb,zc,Yc,zd,ke){this.b4a=this.hD=null;this.qE=this.tOa=0;this.oHb=()=>{this.A7&&(this.A7.stop(),this.A7=null);this.sOb.start();this.hD.createLineageTaskPane(this.oxd,this.b4a,this.activityGuid)};this.onBlueDotDismissed=()=>{this.hD.onBlueDotDismissed()};this.lineageOpenPaneOrChangeFilterRequest=(Td,Ge)=>{this.sOb.stop();F.b(this.$).qd(Ka.a.G_i,
{});this.GWd();const bf=Object(D.a)(new qa,{ClientViewCapacity:Td.clientViewCapacity});let Fa=null;Ge&&(Fa=Object(D.a)(new ma,{FilterSheetMultiRange:this.h_j(Ge.filterSheetMultiRange)}));const aa=Xa=>{Xa=Wa.a.Ue(Xa.data);l.ULS.sendTraceTag(537155481,0,50,`LineageManager::LineageOpenPaneOrChangeFilter service call failed. Errors: [${U.a.qc(Xa)}]`)};this.$.userOperationManager.Oc(new fb.a(1010,0,(Xa,Lb,kc)=>hb(this.$.pa.va,bf,Fa,Na.b(Xa,this.Xid("LineageOpenPaneOrChangeFilter")),Na.a(Lb,aa),kc,null),
80),null)};this.lineageLoadMoreRequest=Td=>{F.b(this.$).qd(Ka.a.F_i,{});const Ge=bf=>{bf=Wa.a.Ue(bf.data);l.ULS.sendTraceTag(537155480,0,50,`LineageManager::LineageLoadMore service call failed. Errors: [${U.a.qc(bf)}]`)};this.$.userOperationManager.Oc(new fb.a(1011,0,(bf,Fa,aa)=>Ib(this.$.pa.va,Td,Na.b(bf,this.Xid("LineageLoadMore")),Na.a(Fa,Ge),aa,null),80),null)};this.lineageRefreshViewRequest=()=>{F.b(this.$).qd(Ka.a.H_i,{});const Td=Ge=>{Ge=Wa.a.Ue(Ge.data);l.ULS.sendTraceTag(537155479,0,50,`LineageManager::LineageRefreshView service call failed. Errors: [${U.a.qc(Ge)}]`)};
this.$.userOperationManager.Oc(new fb.a(1012,0,(Ge,bf,Fa)=>vc(this.$.pa.va,Na.b(Ge,this.Xid("LineageRefreshView")),Na.a(bf,Td),Fa,null),80),null)};this.lineageUpdateViewRequest=()=>{nc(this.$.pa.va,Td=>{if(Td=lb.a(Td)?null:Td.Result){var Ge={["CountOfUpdatedActivities"]:Td.LineageActivitiesResponse.ActivityList.length};F.b(this.$).qd(Ka.a.I_i,Ge);Td=Object(D.a)(new sb,{activityList:da.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?Ue(Td.LineageActivitiesResponse.ActivityList,
this.mna):this.KJd(Td.LineageActivitiesResponse.ActivityList),latestActivityId:Td.LineageActivitiesResponse.LastSearchedActivityId,oldestActivityId:Td.LineageActivitiesResponse.FirstSearchedActivityId,serverMessageCode:Td.LineageActivitiesResponse.LineageResponseCode,lastSearchedActivityTimestamp:new Date(Td.LineageActivitiesResponse.EcmaLastSearchedDate),hasNewActivities:Td.HasNewActivities,filterSheetMultiRange:this.YZj(Td.LineageActivitiesResponse.FilterSheetMultiRange),serverFirstActivityId:Td.LineageActivitiesResponse.ServerFirstActivityId,
serverLastActivityId:Td.LineageActivitiesResponse.ServerLastActivityId,showLoadPrevious:Td.LineageActivitiesResponse.ShowLoadPrevious,eolCorrelationId:Td.LineageActivitiesResponse.EolCorrelationId,eolDateHideHistory:new Date(Td.LineageActivitiesResponse.EolDateHideHistory),eolPersonHideHistory:this.vyb(Td.LineageActivitiesResponse.EolPersonHideHistory)});this.hD.onLineageActivitiesUpdateResponse(Td)}else l.ULS.shipAssertTag(537155475,0,!!Td,"LineageManager.LineageUpdateView returned null response.")},
Td=>{Td=Wa.a.Ue(Td.data);l.ULS.sendTraceTag(537155474,0,50,`LineageManager::LineageUpdateView service call failed. Errors: [${U.a.qc(Td)}]`)},null,null)};this.areInGridHighlightsAvailable=()=>pb.a.wic(this.$)&&this.blueDotManager&&this.blueDotManager.areInGridHighlightsAvailable();this.areInGridHighlightsEnabled=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled();this.onDisplayInGridHighlightsChanged=Td=>{this.blueDotManager&&this.blueDotManager.pEj(Td)};this.onCardSelected=
(Td,Ge)=>{var bf,Fa;if(null===(bf=this.blueDotManager)||void 0===bf?0:bf.shouldShowBlueDot(Td.activityGuid))null===(Fa=this.blueDotManager)||void 0===Fa?void 0:Fa.DJa(Td.activityGuid,1);if(Td=Td.rangeHighlightLocation){if(Ge){if(({range:bf}=Pa.ab(Ge,da.EwaSettings.isChangeGateEnabled("OfficeVSO:7236999_passEwaSheetsInLineageManager")?this.$.ua:null)).returnValue){this.Eef(Td.sheetName,this.Eyb([Pa.j(bf)]));return}l.ULS.shipAssertTag(537155472,0,!1,"The produced subCellLocation string "+Ge+" is not valid.")}Td.rangeList.length?
this.Eef(Td.sheetName,Td.rangeList):this.khi(Td.sheetName)}};this.onLearnMoreLinkClicked=()=>{const Td=new Y.a(-859308420,vb.a.zb,this.$.xc,12,null);this.$.Ia.Hb(Td,{[vb.a.Sf]:"HelpID=XLO_LineageTS",["InputMethod"]:vb.a.zb,[vb.a.Pc]:Ab.a.mV,["ShouldCanvasTakeFocus"]:!0})};this.onVersionHistoryButtonClicked=Td=>{this.$.Ia.Hb(new Y.a(-1112508866,Td,this.$.xc,12,null))};this.onDegradedCardGiveFeedbackButtonClicked=()=>{const Td={};Td[Ab.a.VJ]="LineageDegradedCard";this.$.Yc(802602464,0,12,Td)};this.isFeatureEnabled=
Td=>{switch(Td){case "FlattenListInLineageManager":return da.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager");default:return!1}};this.xf=()=>{const Td=this.$.ea.Tm.LineageVersion;Td!==this.tOa&&(l.ULS.sendTraceTag(537155470,0,50,`LineageManager.OnWorkbookMetadataChanged: lineageVersion: ${Td}, this.lineageVersion: ${this.tOa}`),this.tOa=Td,this.Bjj())};this.Wc=(Td,Ge)=>{this.hD&&!this.lineageTaskPane.Ijc&&Ge.GH&&(l.ULS.sendTraceTag(587220563,0,15,"LineageManager::SessionIdChanged detected."),
this.onStaleActivitiesDetected())};this.Io=()=>{this.hD&&!this.lineageTaskPane.Ijc&&(l.ULS.sendTraceTag(587220562,0,15,"LineageManager::LoadOnDemandOccurred detected."),this.onStaleActivitiesDetected())};this.uD=()=>{const Td=this.J5a();this.hD.onFilterableSheetListChange(Td)};this.Hza=()=>{const Td=this.J5a();this.hD.onFilterableSheetListChange(Td)};this.Frc=()=>{const Td=this.J5a();this.hD.onFilterableSheetListChange(Td)};this.onPaneClosed=()=>{this.hD.onPaneClosed();Pb(this.$.pa.va,null,Td=>{Td=
Wa.a.Ue(Td.data);l.ULS.sendTraceTag(537155469,0,50,`LineageManager::OnLineageClosePaneFailed service call failed. Errors: [${U.a.qc(Td)}]`)},null,null)};this.onRangeFilterInputEnabled=Td=>{Td?this.gridView.ha.HT(this.Zc):this.gridView.ha.PR(this.Zc)};this.Zc=()=>{var Td=Pa.q(this.gridView.ha.ra.activeRange,this.$);Td=Object(D.a)(new xd,{rangeList:this.Eyb(Td.Ranges),sheetName:Td.SheetName});this.hD.onSelectedRangeUpdated(Td)};this.tryParseRangeInfo=Td=>{let Ge;if(({sheetName:Ge,range:Td}=Pa.ab(Td,
this.$.ua)).returnValue){Ge||(Ge=this.$.ua.na.sheetName);const bf=[];bf.push(Td);Td=Pa.u(Ge,null,bf);return Object(D.a)(new xd,{rangeList:this.Eyb(Td.Ranges),sheetName:Td.SheetName})}return null};this.Ez=()=>{const Td=this.qE!==this.$.ea.se;this.hD&&this.lineageTaskPane.isVisible&&Td&&(this.qE=this.$.ea.se,this.hD.onRefreshRequired())};this.$=Qb;zc.Ha(366,this);this.blueDotManager=zd;this.gridView=X.h(this.$);this.lineageTaskPane=Yc;this.oxd=this.lineageTaskPane.jU();this.batchSize=50;this.A7=ke;
this.sOb=this.$.Mb.vg("UserAction","LineagePaneLoadingShimmerStopWatch");this.mna=kb.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.Tli();this.YLg()}dispose(){this.Fmj();this.$=null;this.lineageTaskPane&&(this.lineageTaskPane.zW(this.onPaneClosed),this.lineageTaskPane.WF(this.Ez),this.lineageTaskPane=null);this.sOb=this.mna=this.b4a=this.oxd=this.hD=null}Ibg(Qb,zc,Yc,zd){this.activityGuid=null;if(this.lineageTaskPane.isVisible){if(9===Yc){l.ULS.sendTraceTag(560989858,0,50,"LineageManager::ShowLineageTaskPane open from callout was invoked with an opened pane");
return}if(!Qb&&16!==Yc&&18!==Yc&&30!==Yc){this.lineageTaskPane.w4c();return}}pb.a.Gd(this.$)||(this.sOb.start(),this.A7&&(mb.b().hC(this.sOb.id,this.A7.id,"actions","actions"),this.A7.stop(),this.A7=null));this.lineageTaskPane.Ijc||l.ULS.sendTraceTag(537155482,0,50,`LineageManager::ShowLineageTaskPane pane reopened by user via ${Qb?zc:Yc}`);this.qE=this.$.ea.se;this.b4a=null;Qb?(Qb=Pa.r(this.gridView.ha.ra.selectedRanges,this.$),this.b4a=Object(D.a)(new xd,{rangeList:zc.toString()===Ab.a.bbg?this.Eyb(Qb.Ranges):
null,sheetName:Qb.SheetName})):da.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&30===Yc&&this.zbj(zd);pb.a.Gd(this.$)&&this.lineageTaskPane.Ijc?this.lineageTaskPane.LEj(this.oHb):this.hD.createLineageTaskPane(this.oxd,this.b4a,this.activityGuid);this.lineageTaskPane.Sg(!0);this.$.Yc(-71295319,-1,0,null)}zbj(Qb){var zc;if(Qb){var Yc=Qb.sheetRanges;Qb=Qb.activityGuid;Yc&&Qb?(null===(zc=this.blueDotManager)||void 0===zc?void 0:zc.DJa(Qb,2),
this.activityGuid=Qb,this.b4a=this.QYh(Yc)):l.ULS.shipAssertTag(509752709,0,!1,"Blue dot gridLocation/activityGuid is not set.")}else l.ULS.shipAssertTag(509752710,0,!1,"Blue dot unexpected undefined properties for command handling.")}lineageHidePreviousHistory(){const Qb={["paneVisible"]:this.lineageTaskPane.isVisible};Cb.a.sendTelemetryEvent(Object(D.a)(new Ob.a,{name:"Office.Excel.Online.Lineage.ClearHistoryConfirmed",dataFields:ob.a.ki(Qb)}));this.$.userOperationManager.Oc(new fb.a(1018,0,(zc,
Yc,zd)=>oc(this.$.pa.va,zc,Yc,zd,null),64),null);this.lineageTaskPane.isVisible||this.Ibg(!1,null,4,void 0)}Tli(){const Qb=Object(D.a)(new zb,{tryParseRangeInfo:this.tryParseRangeInfo,isFeatureEnabled:this.isFeatureEnabled,onCardSelected:this.onCardSelected,onVersionHistoryButtonClicked:this.onVersionHistoryButtonClicked,onRangeFilterInputEnabled:this.onRangeFilterInputEnabled,onLearnMoreLinkClicked:this.onLearnMoreLinkClicked,onDegradedCardGiveFeedbackButtonClicked:this.onDegradedCardGiveFeedbackButtonClicked,
lineageOpenPaneOrChangeFilterRequest:this.lineageOpenPaneOrChangeFilterRequest,lineageLoadMoreRequest:this.lineageLoadMoreRequest,lineageRefreshViewRequest:this.lineageRefreshViewRequest,lineageUpdateViewRequest:this.lineageUpdateViewRequest,areInGridHighlightsAvailable:this.areInGridHighlightsAvailable,areInGridHighlightsEnabled:this.areInGridHighlightsEnabled,onDisplayInGridHighlightsChanged:this.onDisplayInGridHighlightsChanged,shouldShowBlueDot:zc=>{var Yc,zd;return null!==(zd=null===(Yc=this.blueDotManager)||
void 0===Yc?void 0:Yc.shouldShowBlueDot(zc))&&void 0!==zd?zd:!1}});Ea.a(()=>{this.hD=cellLineage.LineageActivityControllerFactoryGlobal.createLineageActivityController(Object(D.a)(new jb,{clientBatchSize:this.batchSize,filterableSheetList:this.J5a(),uiCulture:this.$.ya.UICultureTag,dataCulture:this.$.ya.DataCultureTag,logger:new O.a,lineageAppCallbacks:Qb}))})}QYh(Qb){const zc=[],Yc=this.$.ua.na;for(const zd of Qb)zd.sheetId===Yc.sheetId&&(Qb=Pa.j(zd.range),Qb=Object(D.a)(new Ub,{firstCol:Qb.FirstColumn,
firstRow:Qb.FirstRow,lastCol:Qb.LastColumn,lastRow:Qb.LastRow}),zc.push(Qb));return Object(D.a)(new xd,{rangeList:zc,sheetName:Yc.sheetName})}Xid(Qb){return zc=>{if(zc=lb.a(zc)?null:zc.Result){var Yc={["CountOfActivities"]:zc.ActivityList.length};Yc.WebRequestName=Qb;F.b(this.$).qd(Ka.a.kYi,Yc);zc=Object(D.a)(new Ta,{activityList:da.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?Ue(zc.ActivityList,this.mna):this.KJd(zc.ActivityList),latestActivityId:zc.LastSearchedActivityId,
oldestActivityId:zc.FirstSearchedActivityId,serverMessageCode:zc.LineageResponseCode,lastSearchedActivityTimestamp:new Date(zc.EcmaLastSearchedDate),serverFirstActivityId:zc.ServerFirstActivityId,serverLastActivityId:zc.ServerLastActivityId,showLoadPrevious:zc.ShowLoadPrevious,eolCorrelationId:zc.EolCorrelationId,eolDateHideHistory:new Date(zc.EolDateHideHistory),eolPersonHideHistory:this.vyb(zc.EolPersonHideHistory)});this.hD.onLineageActivitiesResponse(zc)}else l.ULS.shipAssertTag(537155477,0,!!zc,
"LineageManager."+Qb+" returned null response.")}}YZj(Qb){return Ma.e(Qb.Ranges)&&!Qb.SheetName?null:Object(D.a)(new xd,{rangeList:this.Eyb(Qb.Ranges),sheetName:Qb.SheetName})}Eyb(Qb){const zc=[];for(const Yc of Qb)Qb=Object(D.a)(new Ub,{firstCol:Yc.FirstColumn,firstRow:Yc.FirstRow,lastRow:Yc.LastRow,lastCol:Yc.LastColumn}),zc.push(Qb);return zc}h_j(Qb){if(!Qb)return null;const zc={};zc.Ranges=this.Ujd(Qb.rangeList);zc.SheetName=Qb.sheetName;return zc}Ujd(Qb){const zc=[];if(Ma.e(Qb))return zc;for(const Yc of Qb)Qb=
{},Qb.FirstColumn=Yc.firstCol,Qb.FirstRow=Yc.firstRow,Qb.LastRow=Yc.lastRow,Qb.LastColumn=Yc.lastCol,zc.push(Qb);return zc}khi(Qb){(Qb=this.$.ua.getItemByName(Qb))&&Qb.visible&&Qb.activate(!0)}Eef(Qb,zc){const Yc=[];for(var zd of zc)zc={},zc.FirstColumn=zd.firstCol,zc.FirstRow=zd.firstRow,zc.LastRow=zd.lastRow,zc.LastColumn=zd.lastCol,Yc.push(Pa.E(zc));zd=Yc.length-1;zc=Yc[zd].topLeft;X.h(this.$).KZ(Yc,zd,Qb,null,zc,null,null,3,"LineageManager.OnCardSelected",void 0,void 0,void 0,!0)}Bjj(){this.hD&&
this.lineageTaskPane.isVisible&&(this.qE=this.$.ea.se,this.hD.onRefreshRequired())}YLg(){var Qb;this.lineageTaskPane.DT(this.onPaneClosed);this.lineageTaskPane.vE(this.Ez);this.$.ea.ju(this.xf);this.$.ea.Oj(this.Wc);this.$.ea.ZL(this.Io);const zc=this.$.ua;zc.sY(this.uD);zc.iha(this.Frc);zc.RGa(this.Hza);zc.NZa(this.Frc);null===(Qb=this.blueDotManager)||void 0===Qb?void 0:Qb.ose(this.onBlueDotDismissed)}Fmj(){var Qb;this.$.ea.Lv(this.xf);this.gridView.ha.PR(this.Zc);this.$.ea.pk(this.Wc);this.$.ea.MR(this.Io);
const zc=this.$.ua;zc.b7(this.uD);zc.Gna(this.Frc);zc.qRa(this.Hza);zc.RKb(this.Frc);null===(Qb=this.blueDotManager)||void 0===Qb?void 0:Qb.OYf(this.onBlueDotDismissed)}onStaleActivitiesDetected(){this.hD.onStaleActivitiesDetected()}J5a(){const Qb=this.$.ua.items,zc=[];for(const Yc of Qb)Yc.visible&&!Ga.e(Yc)&&zc.push(Yc.sheetName);return zc}GWd(){if(da.EwaSettings.xa(527)){var Qb=this.$.da.Ba(403);Qb&&Qb.disable();Qb=new Y.a(-847286761,vb.a.zb,this.$.xc,0,Ab.a.a0);this.$.Ia.Hb(Qb,{["InputMethod"]:vb.a.zb,
CalloutName:5})}}KJd(Qb){const zc=[];for(const Yc of Qb)Qb=Object(D.a)(new ne,{activityId:Number.parseLocale(Yc.UserActivity.Id),activityGuid:Yc.Uid,activityType:Yc.UserActivity.Type,author:this.vyb(Yc.UserActivity.Person),sheetName:Yc.SheetName,displayTimestamp:new Date(Yc.UserActivity.DisplayTimestamp),gridLocation:Yc.DisplayLocation,valueChanges:this.Ddj(Yc.LineageValueChangeList),isBulkEditOverflow:Yc.IsBulkEditOverFlow,rangeHighlightLocation:this.pdj(Yc.UserActivity.LocationList,Yc.UserActivity.Type),
nestedActivityList:this.idj(Yc.NestedActivityList),degradedCardTypeBits:Yc.DegradedCardTypeBits}),zc.push(Qb);return zc}pdj(Qb,zc){if(!Qb)return l.ULS.sendTraceTag(537155468,0,15,"LineageManager:: RangeHighlightLocation.ActivityLocationList is null"),null;if(!Qb.length)return l.ULS.sendTraceTag(537155467,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is empty"),null;const Yc=[];var zd=[];let ke="";21===zc?zd.push(Qb[0]):zd=Qb;for(const Td of zd)switch(Td.Type){case 1:break;case 2:ke=
Td.SheetName;break;case 0:Qb=Td;if(!Qb.RangeList){l.ULS.sendTraceTag(537155465,0,50,"LineageManager:: RangeHighlightLocation.RangeActivityLocation is null");break}ke=Qb.RangeList[0].SheetName;zd=[];21===zc?zd.push(Qb.RangeList[0]):zd=Qb.RangeList;for(const Ge of zd)Qb=Object(D.a)(new Ub,{firstCol:Ge.FirstColumn,firstRow:Ge.FirstRow,lastRow:Ge.LastRow,lastCol:Ge.LastColumn}),Yc.push(Qb);break;default:l.ULS.sendTraceTag(537155464,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is of type: ")}return Object(D.a)(new xd,
{sheetName:ke,rangeList:Yc})}Ddj(Qb){const zc=[];for(const Yc of Qb)Qb=Object(D.a)(new fe,{hasNewValue:Yc.HasNewValue,hasOldValue:Yc.HasOldValue,newValue:Yc.HasNewValue?Yc.NewValue:null,oldValue:Yc.HasOldValue?Yc.OldValue:null,cellLocation:Yc.CellLocation}),zc.push(Qb);return zc}idj(Qb){return Qb?this.KJd(Qb):null}vyb(Qb){if(!Qb)return null;let zc=null;d.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(zc=this.mna.Aia(Qb.Email,Qb.Provider,d.AFrameworkApplication.xi,0));return Object(D.a)(new db,
{id:Qb.Id,provider:Qb.Provider,displayName:Qb.DisplayName,email:Qb.Email,imageUrl:zc})}}Object(f.a)(Fc,"LineageManager",null,[648,3]);class bd extends h.a{constructor(Qb){super();this.A7=this.lineageTaskPane=null;this.$=Qb;this.Gb()}Usf(Qb,zc){C.TaskExtensions.za(Qb,()=>{this.qb(this.$.da.Ba(366)||new Fc(this.$,this.$.da,this.lineageTaskPane,zc,this.A7))},this.$.ka,3)}create(){this.A7=this.$.Mb.Kc("UserAction","LineagePaneSeenStopwatch");this.A7.start();const Qb=z.GetServiceTaskFactory.Pa(this.$.da,
365,364,this.Na),zc=Aa.a(this.$);let Yc;Yc=da.EwaSettings.isChangeGateEnabled("OfficeVSO:7457857_DynamicScriptLoaderNewService")?V.c(Z.a.resolve(ja.m,{Wb:this.Na})):z.GetServiceTaskFactory.Pa(this.$.da,283,284,this.Na);if(da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)){const zd=z.GetServiceTaskFactory.Pa(this.$.da,501,500,0);C.TaskExtensions.za(C.TaskExtensions.Md([Qb,zc,Yc,zd],this.$.ka),()=>{this.lineageTaskPane=Qb.result;pb.a.Gd(this.$)||zc.result.VQ(this.lineageTaskPane);
this.Usf(V.c(Yc.result.Ll.loadScript("cellLineage")),zd.result)},this.$.ka,3)}else C.TaskExtensions.za(C.TaskExtensions.Md([Qb,zc,Yc],this.$.ka),()=>{this.lineageTaskPane=Qb.result;pb.a.Gd(this.$)||zc.result.VQ(this.lineageTaskPane);this.Usf(V.c(Yc.result.Ll.loadScript("cellLineage")),null)},this.$.ka,3)}static la(Qb){Qb.da.Ha(367,new bd(Qb))}}Object(f.a)(bd,"LineageManagerFactory",h.a,[]);var de=a(807),Md=a(229),se=a(13),tc=a(113),dd=a(270),Hd=a(90),Xc=a(242),gd=a(18),je=a(724);const Ee=Ab.a.AZd+
"LineageActivityPaneTitle",ae=Ab.a.JPb+"LineageActivityCloseButton";class Yb extends Xc.a{constructor(Qb,zc,Yc){super(Qb);this.oHb=this.oFe=this.De=null;this.itd=!0;this.Qv=0;this.Is=!1;this.yc=(zd,ke)=>{ke.Ef||this.w4c()};this.tl=()=>{this.w4c();return!0};this.$=zc;this.taskPaneManager=Yc;this.$.ij(this.yc);fa.a(this.$).fi(this);pb.a.Gd(this.$)&&(this.isVisible=!1)}ET(Qb){this.get_events().addHandler("LineageTaskPaneRemove",Qb)}AW(Qb){this.get_events().removeHandler("LineageTaskPaneRemove",Qb)}vE(Qb){this.addHandler("LineageTaskPaneVisibilityChanged",
Qb)}WF(Qb){this.removeHandler("LineageTaskPaneVisibilityChanged",Qb)}DT(Qb){this.get_events().addHandler("LineageTaskPaneClose",Qb)}zW(Qb){this.get_events().removeHandler("LineageTaskPaneClose",Qb)}get isVisible(){return super.isVisible}set isVisible(Qb){super.isVisible!==Qb&&(super.isVisible=Qb,this.raiseEvent("LineageTaskPaneVisibilityChanged"))}get Ijc(){return this.itd}get If(){return this.isVisible}get Qh(){return 15}get ee(){return wa.a.tEi}get jk(){return gd.a.vEh}get QQ(){return Gb.a.instance.ga(1077)}get Xp(){return 300}get isResizable(){return!1}get mc(){return this.domElement}get height(){return this.taskPaneManager.DO.offsetHeight}get titleText(){return Gb.a.instance.ga(1294)}get IB(){return this.taskPaneManager.Ava(this.mc,
this.titleText,this.Xp,this.isResizable,()=>{this.isVisible=!0;this.oHb?this.oHb():l.ULS.shipAssertTag(537155462,0,!1,"OnLineagePaneOpened callback not set.")},()=>{this.isVisible=!1},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.Xp)}Oq(){return this.Is}Et(){return this.Is}ZV(){}jV(){return!1}Bj(){}ik(){}dispose(){this.$&&(this.$.$k(this.yc),fa.a(this.$).Nz(this));this.De&&(Md.a.instance.Aa(se.a.click,this.De,this.tl),tc.KeyInputManager.instance.ix(this.De,this.oFe));this.De=this.taskPaneManager=
this.$=null;super.dispose()}eg(Qb,zc){if(!zc){Qb=oa.DOMElementExtensions.getElementById(this.domElement,"LineagePaneFilterButton");if(!Qb)return!1;oa.DOMElementExtensions.setFocus(Qb)}return!zc}Bh(Qb){return oa.DOMElementExtensions.Df(this.mc,Qb)}Sg(Qb){this.Is=Qb;const zc=this.taskPaneManager;if(this.isVisible=Qb)this.$.frame.Se.Vj("LineagePane"),this.itd=!1;if(pb.a.Gd(this.$))Qb?zc.E6("LineageTaskPane",this.IB):zc.hideTaskPane("LineageTaskPane");else{this.taskPaneManager.KB();const Yc=!!this.taskPaneManager.Lh&&
15===this.taskPaneManager.Lh.taskPane.Qh;Qb&&0<zc.RD.length&&(!Yc||zc.isCollapsed)&&zc.yI(this,!0)}this.$.tf()}jU(){var Qb=this.$.Cb;Qb=pb.a.Gd(this.$)?this.domElement:document.getElementById(Qb+Ab.a.sxd);var zc=this.vM();Qb.appendChild(zc);zc=je.b("div","LineagePaneBodyId","LineageActivityBody");Qb.appendChild(zc);this.MEj();return zc}w4c(){this.$.frame.Se.Vj(this.$.frame.Se.ZE||dd.AFrame.OT);this.itd=!0;this.Sg(!1);this.raiseEvent("LineageTaskPaneClose")}LEj(Qb){this.oHb=Qb}MEj(){this.$.frame.Se.rk("LineagePane");
const Qb=this.$.frame.Se.zi("LineagePane");Qb.parent=dd.AFrame.OT;Qb.nN=!0}vM(){const Qb=je.b("div","LineagePaneHeaderId","LineageActivityPaneHeader"),zc=je.b("h1","LineagePaneTitleId",Ee);zc.innerText=this.titleText;this.De=de.a.ob("LineagePaneCloseButtonId",ae,Gb.a.instance.ga(10),"ClosePaneGlyph_16x16x32",!1);this.De.classList.add(d.AFrameworkApplication.isRtl?Ab.a.yja:Ab.a.zja);Md.a.instance.ta(se.a.click,this.De,this.tl);this.oFe=tc.KeyInputManager.instance.Mt(this.De,this.tl,Hd.a.Sh);Qb.appendChild(zc);
Qb.appendChild(this.De);return Qb}static la(Qb,zc){const Yc=Qb.Cb;let zd=document.getElementById(Yc+Ab.a.sxd);zd||(zd=document.createElement("div"),zd.id=Qb.Cb+Ab.a.sxd,zd.classList.add("LineageActivityPane"),pb.a.Gd(Qb)||document.getElementById(Yc+Ab.a.SV).appendChild(zd));return Qb.da.Ba(365)||Qb.da.Ha(365,new Yb(zd,Qb,zc))}}Object(f.a)(Yb,"LineageTaskPane",Xc.a,[647,3,457,63]);class Sc extends h.a{constructor(Qb){super();this.hh=this.gi=null;this.$=Qb;this.Gb()}get yD(){this.gi||(this.gi=C.TaskExtensions.za(Aa.a(this.$),
Qb=>{this.hh=Yb.la(this.$,Qb.result)},this.ka,3));return this.gi}create(){const Qb=z.GetServiceTaskFactory.create(this.$.da,203,this.ka,this.Na),zc=z.GetServiceTaskFactory.create(this.$.da,155,this.ka,this.Na);C.TaskExtensions.za(C.TaskExtensions.ts(C.TaskExtensions.Md([Qb,zc],this.ka),()=>this.yD,this.ka),()=>{this.qb(this.hh)},this.ka,3)}dispose(){this.hh=this.gi=this.$=null;super.dispose()}static la(Qb){Qb.da.Ha(364,new Sc(Qb))}}Object(f.a)(Sc,"LineageTaskPaneFactory",h.a,[]);class qd{constructor(Qb,
zc){this.Mtd=!1;this.xf=()=>{this.djg()};this.$=Qb;da.EwaSettings.xa(527)&&this.$.ea.H9a&&!qd.xzb&&(zc&&!zc.rTa||this.p$j(),qd.Lcf?l.ULS.sendTraceTag(537155461,0,50,"LineageTeachingCalloutTriggerManager will not trigger WYWA waterline check as it was already checked in session"):zc&&!zc.rTa||this.w$j());l.ULS.sendTraceTag(537155460,0,50,"LineageTeachingCalloutTriggerManager is initialized.")}dispose(){this.UMd();this.$=null;l.ULS.sendTraceTag(537155459,0,50,"LineageTeachingCalloutTriggerManager is disposed.")}disable(){qd.xzb||
(qd.xzb=!0,l.ULS.sendTraceTag(578557781,0,50,"LineageTeachingCalloutTriggerManager.Disable as the pane was opened."));this.UMd()}w$j(){da.EwaSettings.xa(523)&&!this.$.isAnonymousUser()&&na.i(this.$.pa.va,Qb=>{this.$?(Qb=Qb.Result,l.ULS.sendTraceTag(578557780,0,50,`CheckLineageWywaChanges service call succeeded, hasnewchanges = ${Qb}.`),qd.Lcf=!0,Qb&&this.zQb(0)):l.ULS.sendTraceTag(537155458,0,50,"LineageTeachingCalloutTriggerManager.VerifyWaterlineTrigger ignoring server response as class is disposed.")},
()=>{l.ULS.sendTraceTag(537155457,0,10,"CheckLineageWywaChanges service call failed.")},null,null)}p$j(){da.EwaSettings.xa(522)&&!this.djg()&&(this.$.ea.ju(this.xf),this.Mtd=!0)}djg(){return this.$.ea&&this.$.ea.Tm&&this.$.ea.Tm.ShouldTriggerLineageCalloutOnMerge?(l.ULS.sendTraceTag(578557778,0,50,"LineageTeachingCalloutTriggerManager.TriggerLineageCalloutOnMerge"),this.zQb(1),!0):!1}zQb(Qb){qd.xzb?l.ULS.sendTraceTag(537155456,0,50,"LineageTeachingCalloutTriggerManager.TriggerCallout Will not trigger dialog as it was already shown in session"):
(qd.xzb=!0,l.ULS.sendTraceTag(578557776,0,50,`LineageTeachingCalloutTriggerManager.TriggerCallout triggering callout due to reason ${Qb}.`),this.UMd(),da.EwaSettings.xa(418)&&(Qb=new Y.a(-847286761,vb.a.zb,this.$.xc,0,Ab.a.a0),this.$.Ia.Hb(Qb,{["CalloutName"]:4})))}UMd(){this.Mtd&&(this.Mtd=!1,this.$.ea.Lv(this.xf))}}qd.xzb=!1;qd.Lcf=!1;Object(f.a)(qd,"LineageTeachingCalloutTriggerManager",null,[646,3]);class Id extends h.a{constructor(Qb){super();this.$=Qb;this.Gb()}create(){C.TaskExtensions.za(z.GetServiceTaskFactory.Pa(this.$.da,
458,459,this.Na),Qb=>{const zc=Qb.result;Qb=Object(eb.a)(this.$.da,403,()=>new qd(this.$,zc));this.qb(Qb)},this.$.ka,3)}static la(Qb){Qb.da.Ha(402,new Id(Qb))}}Object(f.a)(Id,"LineageTeachingCalloutTriggerManagerFactory",h.a,[]);var ic=a(900),Gc=a(83);class jd{constructor(Qb,zc){this.rh=Qb;this.Zu=zc}QW(Qb,zc,Yc,zd=null){return this.ksh(Qb,zd,ke=>this.rh.bpb(ke,2,Yc,zc,void 0,void 0,void 0,void 0,void 0,"2"))}ksh(Qb,zc,Yc){const zd=!!zc&&""!==zc;let ke=Qb;zd&&(ke=v.a.yT(Qb,"perfTag",zc));const Td=
new Date;return ic.a.then(Yc(ke),Ge=>{const bf=+new Date-+Td;if(!Ge||!Ge.Kg||!Ge.Kg.data)return Ge;zd&&Ge.Kg.data.request&&this.wAj(Ge.Kg.data.request.getResolvedUrl(),zc,bf);return Ge})}wAj(Qb,zc,Yc){Qb=this.Zu.V5h(Qb);if(Qb.count&&(Qb=Gc.last(Qb))){const zd={Message:"Request durations for activities calls."};zd.PerfTag=zc;zd.CustomDuration=Yc;zd.PerformanceDuration=Qb.duration;l.ULS.sendTraceTag(592189641,3012,50,JSON.stringify(zd))}}}Object(f.a)(jd,"CatchUpNetworkingWrapper",null,[727]);var ed=
a(249);class Qd extends ed.a{constructor(Qb,zc){super(Qb,zc)}gba(){return 6}}Object(f.a)(Qd,"GetActivityFeedRequest",ed.a,[]);class te extends ed.a{constructor(Qb,zc,Yc,zd,ke,Td){super(Qb,zc);this.ItemIds=null;this.ActivityStatesToReset=this.ActivityStatesToSet=0;this.ResetUnseenCount=!1;this.ItemIds=Yc;this.ActivityStatesToSet=zd;this.ActivityStatesToReset=ke;this.ResetUnseenCount=Td}gba(){return 7}}Object(f.a)(te,"UpdateActivityFeedStateRequest",ed.a,[]);var xe=a(394);class He{constructor(Qb,zc,
Yc){this.Fge=Qb;this.FDa=zc;this.XDa=Yc}getActivityFeed(Qb){return ic.a.then(this.XDa.execute(new Qd(this.FDa(),null),(zc,Yc,zd)=>this.Fge.QW(zc,Yc,zd,"ActivityFeed"),Qb),zc=>{if(!zc)return l.ULS.sendTraceTag(572846937,3012,10,"GetActivityFeed: Response is null"),null;if(!zc.Kg)return l.ULS.sendTraceTag(572846938,3012,10,"GetActivityFeed: Response.Args is null"),null;if(!zc.Kg.data)return l.ULS.sendTraceTag(572846939,3012,10,"GetActivityFeed: Response.Args.Data is null"),null;if(!zc.Kg.data.me)return l.ULS.sendTraceTag(572846940,
3012,10,"GetActivityFeed: Response.Args.Data.ResponseData is null"),null;zc=xe.a.tJa(zc.Kg.data.me);return zc?zc:(l.ULS.sendTraceTag(572846941,3012,10,"GetActivityFeed: Deserialized response is null"),null)})}E3j(Qb,zc,Yc,zd){return ic.a.then(this.XDa.execute(new te(this.FDa(),null,Qb,zc,Yc,zd),(ke,Td,Ge)=>this.Fge.QW(ke,Td,Ge,"UpdateActivityFeedState"),null),ke=>{try{return ke.succeeded}catch(Td){return l.ULS.sendTraceTag(523121054,3012,10,"UpdateActivityFeed: Exception: "+Td.message),!1}})}}Object(f.a)(He,
"CatchUpRequestHandler",null,[726]);var We=a(469);class ye{constructor(Qb){this.Ega=Qb;this.pfe=new We.a}iGi(){this.WGi()}WGi(){if(this.Ega){var Qb=zc=>{this.pfe.contains("CatchUpChangesFeedback")||(this.pfe.add("CatchUpChangesFeedback"),zc.logActivity("CatchUpChangesFeedback",null))};this.Ega.execute(zc=>{window.setTimeout(()=>{Qb(zc)},2E4)})}else l.ULS.sendTraceTag(571586199,383,15,"FloodgateEventLogger: IFuture<ISystemInitiatedFeedback> was null")}}Object(f.a)(ye,"FloodgateEventLogger",null,[]);
var $e=a(197);class jf{constructor(Qb){this.PEg=Qb}get duration(){return this.PEg.duration}}Object(f.a)(jf,"PerformanceResourceTimingWrapper",null,[]);class gf{constructor(Qb){this.Zu=Qb}V5h(Qb){const zc=new $e.a;if(!this.Zu)return zc;Qb=this.Zu.getEntriesByName(Qb,"resource");if(!Qb)return zc;for(const Yc of Qb)zc.add(new jf(Yc));return zc}}Object(f.a)(gf,"PerformanceWrapper",null,[]);var rf=a(257);class Mf{constructor(){this.$a=null}get name(){return"Common.App.CatchUpActivity"}Kh(Qb){this.$a=Qb;
this.$a.register(jd,"Common.App.CatchUpActivity.CatchUpNetworkingWrapper").as("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper").tc().Bc(()=>new jd(d.AFrameworkApplication.Hd,new gf(window.performance)));this.$a.register(He,"Common.App.CatchUpActivity.CatchUpRequestHandler").as("Common.App.CatchUpActivity.ICatchUpRequestHandler").tc().Bc(()=>new He(this.$a.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper"),()=>d.AFrameworkApplication.xi,new xe.a));this.$a.register(ye,"Common.App.CatchUpActivity.FloodgateEventLogger").tc().Bc(()=>
new ye(this.$a.Tb("Common.ISystemInitiatedFeedback")))}init(){this.$a.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper");this.$a.resolve("Common.App.CatchUpActivity.ICatchUpRequestHandler")}dispose(){}static main(){rf.a.instance.si(new Mf)}}Object(f.a)(Mf,"CatchUpActivityPackage",null,[4,5]);class Qa{constructor(Qb,zc){this.$=Qb;this.catchUpActivityManager=zc}Mc(Qb,zc){return this.catchUpActivityManager?-876699925===zc?!this.catchUpActivityManager.djf:!1:!0}executeCommand(Qb,zc){Qb=!1;
switch(zc.command){case -876699925:Qb=this.catchUpActivityManager.V4i();break;case 950288339:return this.catchUpActivityManager.showHideInGridHighlights(),S.Task.Ta(!0)}return Qb?S.Task.Ta(!0):H.a(zc.command)}Ac(Qb,zc){return da.EwaSettings.xa(382)?-876699925===zc.command||950288339===zc.command:!1}Rc(){return!1}}Object(f.a)(Qa,"CatchUpActivityCommandHandler",null,[222]);class Zb extends A.a{constructor(Qb){super(Qb)}ld(){this.$.da.hb(286,Qb=>{this.fd([new Qa(this.$,Qb)])})}static la(Qb){A.a.Rd(285,
new Zb(Qb))}}Object(f.a)(Zb,"CatchUpActivityCommandHandlerFactory",A.a,[]);var nb=a(155),Tb=a(274),qb=a(524),Kb=a(91),jc=a(87),Ac=a(25);class Jc{constructor(Qb){this.Uh=Qb}doesContentExist(Qb){if(!Qb)return l.ULS.sendTraceTag(537168066,3012,10,"Null activity: DoesContentExist. Default to false."),!1;switch(Qb.type){case 2:case 3:case 4:case 6:case 8:case 9:case 7:case 10:if(!Qb.navigationId)return l.ULS.sendTraceTag(537168065,3012,10,"Null activity.NavigationId: DoesContentExist. Default to false."),
!1;const zc={};zc.NavigationId=atob(Qb.navigationId);return 32===this.Uh.$d(Ac.a.IJa,2,zc);default:return!1}}}Object(f.a)(Jc,"CatchUpActivityContentManager",null,[657]);var hd=a(843),Cd=a(1271);class ac{constructor(Qb){this.kHb=()=>{switch(this.Av.model.state){case 1:this.Vbg(!0);break;case 0:this.BOb(!1);break;case 2:case 3:this.BOb(!0);break;default:l.ULS.shipAssertTag(537167968,0,!1,"RangeCatchUpActivityView.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+this.Av.model.state)}};
this.cBg=Qb;this.Av.Zre(this.kHb);this.lz=[]}get Av(){return this.cBg}dispose(){this.Av.BYf(this.kHb);this.lz=null}gEj(Qb){this.lz.push(Qb)}K8g(){this.lz.length=0}Vbg(Qb){for(const zc of this.lz){zc.className=hd.a.B5g;const Yc=document.getElementById(`${zc.id}-${Ab.a.KCe}`);oa.DOMElementExtensions.setVisible(Yc,Qb)}}BOb(Qb){for(const zc of this.lz)zc&&(Qb?zc.className=2===this.Av.model.state?hd.a.Cgj:hd.a.Dgj:this.Vbg(!1))}}Object(f.a)(ac,"RangeCatchUpActivityView",null,[723,3]);var Lc=a(22);class rd extends Cd.a{constructor(Qb,
zc,Yc){super(Qb,zc,Yc);this.gridView=X.h(Qb);this.pna=zc}dispose(){this.gridView=null;super.dispose()}yOg(Qb){const zc=this.Ihb[0];zc?zc.gEj(Qb):l.ULS.shipAssertTag(537168004,0,!1,"RangeCatchUpActivityHighlightController.AddViewElement - RangeCatchUpActivityView is null for activityId"+this.pna.activityId)}Htj(){const Qb=this.Ihb[0];Qb&&Qb.K8g()}JMg(Qb){this.pna.addRange(Qb)}CVh(){if(3!==this.pna.activityType)return null;l.ULS.shipAssertTag(537168003,0,1===this.pna.ZOb.length,"RangeCatchUpActivityHighlightController::GetCommentActivityRange Range Information Length should be 1.");
return Pa.E(this.pna.ZOb[0])}vRd(Qb){if(Qb){if(!this.pna)return;this.FBd(this.Quj())}super.vRd(Qb)}b8c(){const Qb=this.H7c();this.Ihb.push(Qb)}H7c(){return new ac(this)}FBd(Qb){Qb?Qb.SheetName?(this.gridView.ha.Sa.hH(null),this.gridView.focus(),this.gridView.Maf(Qb,3,!1,"RangeCatchUpActivityHighlightController.NavigateToRange")):l.ULS.shipAssertTag(537168E3,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: SheetName in the range is null."):l.ULS.shipAssertTag(537168001,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: Range is null. Either the location list is empty or sheet is hidden.")}Quj(){if(Ma.e(this.pna.ZOb))return l.ULS.shipAssertTag(537167971,
0,!1,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : SortedRanges is either null or empty."),null;var Qb=this.$.ua.na;l.ULS.shipAssertTag(537167970,0,!!Qb,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : currentSheet is null.");Qb=this.m0j(Qb.sheetName,this.pna.ZOb);if(!Qb&&(Qb=this.K$h(this.pna.ZOb),!Qb))return null;const zc={};zc.SheetName=Qb.SheetName;zc.FirstColumn=Qb.FirstColumn;zc.FirstRow=Qb.FirstRow;zc.LastColumn=Qb.FirstColumn;
zc.LastRow=Qb.FirstRow;return zc}K$h(Qb){if(Ma.e(Qb))return null;let zc=null;for(let zd=0;zd<Qb.length;zd++){var Yc=Qb[zd].SheetName;if(!Lc.a.equals(Yc,zc,!1)&&(zc=Yc,Yc=this.$.ua.getItemByName(Yc),null===Yc||void 0===Yc?0:Yc.visible))return Qb[zd]}return null}m0j(Qb,zc){if(zc)for(const Yc of zc)if(Lc.a.equals(Yc.SheetName,Qb,!1))return Yc;return null}}Object(f.a)(rd,"RangeCatchUpActivityHighlightController",Cd.a,[]);var Yd=a(84);class ie extends Yd.a{constructor(Qb,zc,Yc,zd,ke){super();this.$=Qb;
this.U5d=zc;this.svg=Yc;this.PG=zd;this.state=ke?1:0}get type(){return this.PG}get activityId(){return this.U5d}get activityType(){return this.svg}dispose(){this.U5d=null;super.dispose()}}Object(f.a)(ie,"CatchUpActivityHighlightModelBase",Yd.a,[]);class Je extends ie{constructor(Qb,zc,Yc,zd,ke,Td){super(Qb,zc,Yc,zd,Td);this.ranges=ke;this.M8a=!1}get ZOb(){this.M8a||(this.ranges.sort(Je.G5b),this.M8a=!0);return this.ranges}addRange(Qb){for(const zc of Qb)this.ranges.push(zc)}dispose(){this.ranges=
null;super.dispose()}static G5b(Qb,zc){if(!Qb.SheetName||!zc.SheetName)return l.ULS.shipAssertTag(537167969,0,!1,"RangeCatchUpActivityHighlightModel.CompareSharedSheetRange : SheetName is null."),0;const Yc=Qb.SheetName.localeCompare(zc.SheetName);return Yc?Yc:Qb.FirstColumn<zc.FirstColumn||Qb.FirstColumn===zc.FirstColumn&&Qb.FirstRow<zc.FirstRow?-1:Qb.FirstColumn===zc.FirstColumn&&Qb.FirstRow===zc.FirstRow?0:1}}Object(f.a)(Je,"RangeCatchUpActivityHighlightModel",ie,[]);var ff=a(350);class Ae{constructor(){this.s5c=
[];this.Reb={};this.rXc={}}dispose(){this.rXc=this.Reb=this.s5c=null}OZf(Qb,zc){zc?X.h(Qb).Eb.$q([24]):X.h(Qb).Eb.Tj([24])}bmj(Qb){this.UJe(Qb,[new ff.a(null,null)],this.Reb,!1)}Rfh(Qb,zc,Yc,zd){const ke={};for(const Ge of zc){if(!Ge||Ma.e(Ge.LocationList))continue;zc=[];const bf={},Fa=[];for(const aa of Ge.LocationList){if(!aa){l.ULS.shipAssertTag(537168013,0,!1,"CatchUpActivityHighlightManagerHelper.CreateControllersAndHighlights - Location is Null for activityId : "+Ge.Id);break}switch(aa.Type){case 0:var Td=
aa;let Xa;"0"in bf?(Xa=bf["0"],Xa.JMg(Td.RangeList)):(Xa=new rd(Qb,new Je(Qb,Ge.Id,Ge.Type,0,Td.RangeList,zd),Yc),zc.push(Xa),bf["0"]=Xa);for(const Lb of Td.RangeList){Td=new ff.a(Pa.E(Lb),Ga.d(Qb.ua.getItemByName(Lb.SheetName)));if(this.aAc(Td)in this.Reb)this.Reb[this.aAc(Td)].push(Xa);else{let kc=[];kc.push(Xa);this.Reb[this.aAc(Td)]=kc}Fa.push(Td);this.s5c.push(Td)}break;default:l.ULS.sendTraceTag(537168012,0,10,"CatchUpHighlightControllersCreator.CreateControllersAndHighlights(): Failed.Invalid ActivityLocationType")}}l.ULS.shipAssertTag(537168011,
0,!(Ge.Id in ke),"CatchUpHighlightControllersCreator.CreateAndUpdateControllers - highlightControllers already has activity: "+Ge.Id);this.rXc[Ge.Id]=Fa;ke[Ge.Id]=zc}this.UJe(Qb,this.s5c,this.Reb,zd);return ke}Oyb(Qb){return this.rXc[Qb]}D8g(Qb){for(let zc in Qb){const Yc=Qb[zc];for(const zd of Yc)zd.Htj()}}aAc(Qb){return`${Qb.range}-${Qb.sheetId}`}UJe(Qb,zc,Yc,zd){this.D8g(Yc);X.h(Qb).Eb.CB(zc,[24],zd,(ke,Td)=>{if(null==ke.range){for(var Ge of ke.yY)Ge.dispose();ke.yY=[]}else{Ge=new ff.a(ke.range,
ke.sheetId);Ge=this.aAc(Ge);var bf=Yc[Ge];if(bf)for(const Fa of bf)Fa.yOg(Td),ke.metadata=Fa;else l.ULS.shipAssertTag(537168010,0,!1,"CatchUpHighlightControllersCreator.CreateHighlightsAndUpdateControllers(), Missing Controller for SheetRangeKey "+Ge)}})}}Object(f.a)(Ae,"CatchUpHighlightControllersCreator",null,[]);class pf{constructor(){this.activityIds=this.container=this.target=null;this.isSticky=!1;this.dirHint=0;this.onHoverLeave=this.onHoverEnter=this.activityNavigationManager=null}}Object(f.a)(pf,
"CreateIndicatorTooltipParameters",null,[]);class he{constructor(){this.clearSticky=!1}}Object(f.a)(he,"DismissIndicatorTooltipParameters",null,[]);class Va{constructor(){this.target=null;this.isSticky=!1}}Object(f.a)(Va,"UpdateIndicatorTooltipParameters",null,[]);class bc{constructor(Qb,zc,Yc){this.$=Qb;this.Uh=zc;this.Oyb=Yc}navigateToActivity(Qb){if(Qb.fromSummaryString){var zc=new Y.a(1834994092,vb.a.zb,this.$.xc,18,null);this.$.Ia.Hb(zc);return this.oDa(1)}Qb=Qb.activity;if(da.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&
Qb&&1===Qb.type){var Yc=new Y.a(1834994092,vb.a.zb,this.$.xc,30,null);const zd={["activityGuid"]:Qb.activityId,["sheetRanges"]:null===(zc=this.Oyb)||void 0===zc?void 0:zc.call(this,Qb.activityId)};this.$.Ia.Hb(Yc,zd);return this.oDa(1)}if(!this.Bpi(Qb))return this.oDa(4);if(!this.tzi(Qb))return this.oDa(7);zc={};try{Yc=window.self.atob(Qb.navigationId);if(!Yc)return this.oDa(5);zc.NavigationId=Yc}catch(zd){return l.ULS.sendTraceTag(537168023,3012,10,`Exception thrown when trying to decode activity NavigationID: ${zd}`),
this.oDa(5)}if(8===this.Uh.$d(Ac.a.IJa,2,zc))return this.Uh.processAction(Ac.a.M$a,2),this.oDa(2);zc=32===this.Uh.$d(Ac.a.A1a,2,zc)?1:6;return this.oDa(zc)}Bpi(Qb){return Qb&&Qb.navigationId?!0:!1}tzi(Qb){switch(Qb.type){case 3:case 4:case 6:case 7:case 9:case 8:case 10:return!0;default:return!1}}oDa(Qb){return Promise.resolve(Qb)}}Object(f.a)(bc,"CatchUpActivityNavigationManager",null,[658]);var yc=a(35);class Hc{constructor(Qb,zc){this.r6b=this.Ypa=null;this.Ued=!1;this.kSa=null;this.Qwa={};this.tEa=
null;this.Knd=!1;this.Oyb=Yc=>this.Ota.Oyb(Yc);this.kHb=(Yc,zd)=>{switch(zd.state){case 0:case 1:3===zd.sJd&&(this.Agi(),this.kSa=null);break;case 2:break;case 3:this.pNe();this.kSa=zd.activityId;this.mNj();break;default:l.ULS.shipAssertTag(537168030,0,!1,"CatchUpActivityHighlightManager.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+zd.state)}};this.$l=()=>{this.yub()};this.Zc=()=>{this.yub()};this.Bn=()=>{this.yub()};this.Di=()=>{this.yub()};this.$4i=()=>{this.Z4b()};this.a5i=
()=>{this.yEe();this.T_e=setTimeout(()=>{this.Gub()},200)};this.Tag=(Yc,zd)=>{zd.gri?(this.Z4b(),this.Gub()):(this.LEe(),this.Ded=setTimeout(()=>{this.Z4b();this.Gub();const ke=this.D0j(zd.Bba);ke?(this.Ypa.createActivityIndicatorTooltip(Object(D.a)(new pf,{target:this.mwh(zd.Bba),container:ke,activityIds:[zd.activityId],isSticky:!1,dirHint:this.gridView.rtl?12:9,activityNavigationManager:da.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")?this.f4b:
void 0,onHoverEnter:this.$4i,onHoverLeave:this.a5i})),this.wgc=zd.Bba,l.ULS.sendTraceTag(51172353,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Hover/Unhover Event."),this.cjc||(this.gridView.view.Vs(this.JEc),this.gridView.ev(this.JEc),this.cjc=!0)):l.ULS.shipAssertTag(537168027,0,!1,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler FlyoutContainer is null.")},150))};this.rFf=()=>{this.Z4b();this.T_e=setTimeout(()=>{this.Gub()},200)};this.JEc=
()=>{this.Ypa?(this.u6a&&this.Ypa.updateActivityIndicatorTooltip(Object(D.a)(new Va,{target:this.u6a,isSticky:!0})),this.wgc&&this.Ypa.updateActivityIndicatorTooltip(Object(D.a)(new Va,{target:this.u6a,isSticky:!1}))):l.ULS.shipAssertTag(537168024,0,!1,"CatchUpActivityHighlightManager::UpdateActivityFlyouts ActivityIndicatorTooltipManager is null.")};this.$=Qb;this.gridView=X.h(this.$);this.ha=this.gridView.ha;this.gb=this.gridView.Xb;this.ha.D0b(this.$l);this.ha.jC(this.Zc);this.gridView.uE(this.Bn);
this.gb.gl(this.Di);this.u6a=this.wgc=null;this.cjc=!1;this.yed={};this.f4b=new bc(this.$,d.AFrameworkApplication.rb,this.Oyb);this.blueDotManager=zc}get xpe(){return this.Ypa}set xpe(Qb){this.Ypa=Qb}get excelCommentManager(){this.tEa||(this.tEa=this.$.da.Ba(65));return this.tEa}get Ota(){this.r6b||(this.r6b=new Ae);return this.r6b}set Ota(Qb){this.r6b=Qb}dispose(){this.ha.Hvc(this.$l);this.ha.xB(this.Zc);this.gridView.VF(this.Bn);this.gb.Zk(this.Di);this.yNe();this.yed=this.u6a=this.wgc=this.kSa=
this.gb=this.ha=this.gridView=null}wSd(Qb){const zc=this.Y1b();this.yNe();if(Ma.e(Qb))this.Ota.bmj(this.$);else{l.ULS.sendTraceTag(537168035,0,50,"In CatchUpActivityHighlightManager:ProcessActivityPayloadHighlights().");if(this.Qwa=this.Ota.Rfh(this.$,Qb,this,zc)){Qb=this.Qwa;for(let Yc in Qb){const zd=Qb[Yc];for(const ke of zd)this.fXg(ke)}}this.Ota.OZf(this.$,zc)}}zOb(){const Qb=this.Y1b();Qb&&this.Knd?l.ULS.shipAssertTag(537168034,0,!1,"CatchUpActivityHighlightManager.ShowOrHideAllHighlights - Trying to show all highlights when marked as read"):
(Qb||this.yub(),this.Ota.OZf(this.$,Qb))}DJa(Qb){this.blueDotManager&&this.blueDotManager.DJa(Qb,0)}E7f(Qb){if(this.Ued!==Qb){var zc=this.Y1b();this.Ued=Qb;zc!==this.Y1b()&&this.zOb()}}yNe(){if(this.Qwa){const Qb=this.Qwa;for(let zc in Qb){const Yc=Qb[zc];for(const zd of Yc)this.Gmj(zd),zd.dispose()}}this.Qwa={};this.Ota.dispose();this.Ota=null}mNj(){if(this.excelCommentManager){var Qb=this.Qwa[this.kSa];Qb&&0<Qb.length&&3===Qb[0].model.activityType&&((Qb=Qb[0])?this.excelCommentManager.RNj(Qb.CVh()):
l.ULS.shipAssertTag(537168029,0,!1,"RangeCatchUpActivityHighlightController::ShowCommentFlyoutOnSelectedActivity RangeController is Null."))}}Agi(){this.excelCommentManager&&this.excelCommentManager.tvb()}pNe(){if(this.kSa){const Qb=this.Qwa[this.kSa];if(Qb){for(const zc of Qb)zc.vRd(!1);this.kSa=null}else l.ULS.sendTraceTag(537168028,0,50,"CatchUpActivityHighlightManager.DeselectCurrentlySelected - Controllers not found for deselection")}}yub(){this.pNe();this.Gub()}D0j(Qb){if(!Qb)return l.ULS.shipAssertTag(537168026,
0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer HighlightDot is null."),null;Qb=`${Qb.id}-${Ab.a.z5g}`;let zc=this.yed[Qb];if(!zc){if(!this.gridView.domElement)return l.ULS.shipAssertTag(537168025,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer gridView.DOMElement is null."),null;zc=document.createElement("Div");zc.className=hd.a.A5g;zc.id=Qb;this.gridView.domElement.appendChild(zc);this.yed[Qb]=zc}return zc}Gub(){if(this.Ypa&&(this.Ypa.dismissActivityIndicatorTooltips(Object(D.a)(new he,
{clearSticky:!0})),this.u6a=this.wgc=null,this.cjc&&!this.u6a&&(this.gridView.view.Xq(this.JEc),this.gridView.ty(this.JEc),this.cjc=!1),this.flyoutAnchorTarget)){const Qb=this.flyoutAnchorTarget.parentElement;null===Qb||void 0===Qb?void 0:Qb.removeChild(this.flyoutAnchorTarget);this.flyoutAnchorTarget=null}}fXg(Qb){Qb.Zre(this.kHb);Qb.cPg(this.Tag);Qb.bPg(this.rFf)}Gmj(Qb){Qb.BYf(this.kHb);Qb.Onj(this.Tag);Qb.Nnj(this.rFf)}LEe(){this.Ded&&clearTimeout(this.Ded)}yEe(){this.Ded&&clearTimeout(this.T_e)}Z4b(){this.LEe();
this.yEe()}Y1b(){return this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled()&&!this.Ued}mwh(Qb){if(this.flyoutAnchorTarget){l.ULS.debugAssertTag(509225110,0,!1,"CatchUpActivityHighlightManager::ensureFlyoutAnchorTarget got non-null flyoutAnchorTarget.");var zc=this.flyoutAnchorTarget.parentElement;null===zc||void 0===zc?void 0:zc.removeChild(this.flyoutAnchorTarget);this.flyoutAnchorTarget=null}var Yc=Qb.getBoundingClientRect();this.flyoutAnchorTarget=document.createElement("div");
this.flyoutAnchorTarget.className=hd.a.E5g;this.$.wC.appendChild(this.flyoutAnchorTarget);Qb=yc.a(this.$).Jh(Yc.left);zc=yc.a(this.$).Jh(Yc.top);const zd=yc.a(this.$).Jh(Yc.width);Yc=yc.a(this.$).Jh(Yc.height);this.flyoutAnchorTarget.style.left=`${Qb}px`;this.flyoutAnchorTarget.style.top=`${zc}px`;this.flyoutAnchorTarget.style.width=`${zd}px`;this.flyoutAnchorTarget.style.height=`${Yc}px`;return this.flyoutAnchorTarget}}Object(f.a)(Hc,"CatchUpActivityHighlightManager",null,[668,3]);var Zc=a(450);
class Sd{}Object(f.a)(Sd,"GetRelevantActivitiesDataRequest",null,[]);class ue{constructor(){this.activityFeedItemId=this.activityId=null;this.type=0;this.collectionId=this.state=this.navigationId=this.relevancy=this.displayTimestamp=this.location=this.actors=null}}Object(f.a)(ue,"Activity",null,[]);class Fe{constructor(){this.collectionId=this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(f.a)(Fe,"ActivityFeedItem",null,[]);class Be{constructor(){this.personaColorMap=
this.activityFeedItems=null}}Object(f.a)(Be,"ActivityFeedPayload",null,[]);class Ua{constructor(){this.lowWaterline=this.highWaterline=this.wywaWaterline=this.actors=this.activities=null;this.hasMore=!1;this.isFirstDocumentOpen=null}}Object(f.a)(Ua,"ActivityRequestPayload",null,[]);class Rb{constructor(){this.color=this.imageUrl=this.email=this.givenName=this.displayName=this.provider=this.id=null}}Object(f.a)(Rb,"Person",null,[]);class sc extends ue{constructor(){super();this.relationship=0}}Object(f.a)(sc,
"TaskActivity",ue,[]);const Mc=(Qb,zc,Yc,zd,ke,Td=null)=>{Td=Qb.Oa(1,Td);return na.g(Qb,"GetLineageWywaAuthors",Td,zc,Yc,zd,ke,4)},id=(Qb,zc,Yc,zd,ke,Td,Ge=null)=>{Ge=Qb.Oa(1,Ge);Ge.getRelevantActivitiesDataRequest=zc;return na.g(Qb,"GetRelevantActivitiesData",Ge,Yc,zd,ke,Td,0)};class Ed{}Object(f.a)(Ed,"FeedItemPayloadActor",null,[]);class ee{}Object(f.a)(ee,"FeedItemPayload",null,[]);class oe{constructor(Qb,zc,Yc=!1,zd=null){this.G2d=null;this.$=Qb;this.g4b=zc;this.sbb=kb.a.instance.resolve("Common.App.People.IPeopleColorUtils");
this.mna=kb.a.instance.resolve("Common.App.People.IUserProfilePictureUtilsV2");this.V7a=Yc;this.blueDotManager=zd}requestWYWAActivities(){return this.V7a?new Promise((Qb,zc)=>{Mc(this.$.pa.va,Yc=>{var zd;Yc=lb.a(Yc)?null:Yc.Result;if(da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)){const ke=null===(zd=null===Yc||void 0===Yc?void 0:Yc.WywaAuthors)||void 0===zd?void 0:zd.length;if(null!=ke&&0<ke){const Td={activities:[],actors:Yc?this.kec(Yc.WywaAuthors):null,hasMore:!1,highWaterline:oe.Lia,
lowWaterline:oe.Lia,wywaWaterline:oe.Lia};this.Dmg(Ge=>{Td.activities=Ge;Qb(Td)},Ge=>{l.ULS.sendTraceTag(509638481,0,10,`updateInGridBlueDots failed: reason: "${Ge}"`);Qb(Td)})}else Qb(oe.oub)}else zd=Object(D.a)(new Ua,{activities:[],actors:Yc?this.kec(Yc.WywaAuthors):null,hasMore:!1,highWaterline:oe.Lia,lowWaterline:oe.Lia,wywaWaterline:oe.Lia}),Qb(zd)},()=>{l.ULS.sendTraceTag(537168022,0,10,"CatchUpActivityRequestManager::GetLineageWywaAuthors service call failed.");zc(null)},null,null)}):Promise.resolve(oe.oub)}requestActivities(){return Promise.resolve(oe.oub)}requestRelevantActivities(){if(!this.$.ea.Yb||
this.$.ea.l6a)return l.ULS.sendTraceTag(537168021,3012,15,`CatchUpActivityRequestManager.RequestRelevantActivities: RequestRelevantActivities skipped [IsSessionActive: ${this.$.ea.Yb}, HasRaisedSessionEnded: ${this.$.ea.l6a}]`),Promise.resolve(oe.oub);const Qb=Object(D.a)(new Sd,{SetDaysBack:d.AFrameworkApplication.fa.Ad("AppWaterlineOverrideDaysValue",0),SetTimestamp:d.AFrameworkApplication.fa.Ad("AppWaterlineOverrideTimestampValue",0)});return new Promise((zc,Yc)=>{id(this.$.pa.va,Qb,zd=>{let ke=
oe.oub;zd?lb.a(zd)?(zd=U.a.qc(zd.Errors),l.ULS.sendTraceTag(578353159,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call returned errors codes: ${zd}`)):ke=this.A5h(zd.Result):l.ULS.sendTraceTag(537168020,3012,10,"CatchUpActivityRequestManager::GetRelevantActivitiesData call returned Null result.");zc(ke)},zd=>{zd=Wa.a.Ue(zd.data);zd=U.a.qc(zd);l.ULS.sendTraceTag(537168019,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call has failed - Errors: [${zd}]`);Yc(null)},
null,null)})}requestActivityFeed(){return V.b(this.getActivityFeed()).then(Qb=>{Qb=this.WZj(Qb);return Object(D.a)(new Be,{activityFeedItems:c(Qb,this.mna),personaColorMap:b(Qb,this.sbb)})})}updateActivityState(Qb){return this.g4b?V.b(this.g4b).then(zc=>{var Yc,zd;return V.b(zc.E3j(Qb.itemIds,null!==(Yc=Qb.activityStatesToSet)&&void 0!==Yc?Yc:0,null!==(zd=Qb.activityStatesToReset)&&void 0!==zd?zd:0,Qb.resetUnseenCount))}):Promise.resolve(!1)}getActivityFeed(){return this.g4b?ic.a.TZd(this.g4b,Qb=>
Qb.getActivityFeed(null)):S.Task.Ta([])}A5h(Qb){if(!Qb)return l.ULS.sendTraceTag(537168018,3012,10,"CatchUpActivityRequestManager::GetRelevantActivityRequestPayload response is null."),Object(D.a)(new Ua,{activities:[]});const zc=this.Nig(Qb.NewActivities,2);Qb=this.Nig(Qb.OutstandingActivities,3);for(const Yc of Qb)zc.push(Yc);return Object(D.a)(new Ua,{activities:zc})}Nig(Qb,zc=1){const Yc=[];if(!Qb||!Qb.length)return Yc;for(const zd of Qb)zd?(Qb=oe.c_j(zd.Type),6===Qb||7===Qb||9===Qb||8===Qb?Yc.push(Object(D.a)(new sc,
{activityId:zd.Id,type:Qb,displayTimestamp:new Date(zd.DisplayTimestamp),navigationId:zd.NavigationId,actors:this.kec(zd.People),relevancy:zc,relationship:this.b_j(zd.Relationship)})):Yc.push(Object(D.a)(new ue,{activityId:zd.Id,type:Qb,displayTimestamp:new Date(zd.DisplayTimestamp),navigationId:zd.NavigationId,actors:this.kec(zd.People),relevancy:zc}))):l.ULS.shipAssertTag(537168017,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivitiesToActivities: relevantActivity is null");return Yc}b_j(Qb){switch(Qb){case 1:return 1;
case 2:return 2;case 3:return 3}l.ULS.sendTraceTag(537168016,0,10,"Unexpected Relationship.");return 1}WZj(Qb){const zc=[];for(const Yc of Qb)Qb=Object(D.a)(new Fe,{id:Yc.id,type:Yc.type,collectionId:Yc.collectionId,activityState:Yc.activityState,activityFeedItemPayload:Yc.activityFeedItemPayload,timestamp:Yc.timestamp}),zc.push(Qb);return zc}kec(Qb){const zc=[];if(!Qb||!Qb.length)return zc;for(const Yc of Qb)Yc&&zc.push(this.vyb(Yc));return zc}vyb(Qb){return Object(D.a)(new Rb,{id:Qb.Id,provider:Qb.Provider,
displayName:Qb.DisplayName,email:Qb.Email,imageUrl:this.mna.Aia(Qb.Email,Qb.Provider,d.AFrameworkApplication.xi,0),color:this.sbb.Oec(new Zc.a(null,void 0,Qb.DisplayName),6)})}static c_j(Qb){switch(Qb){case 1:return 3;case 2:return 4;case 3:return 6;case 4:return 7;case 6:return 8;case 5:return 9;case 7:return 10;default:return l.ULS.shipAssertTag(537168015,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivityTypeToActivityType: unknown RelevantActivityType"),1}}rHc(){if(this.blueDotManager){const Qb=
this.blueDotManager.e1c;return this.G2d.filter(zc=>!Qb.has(zc.Id))}return this.G2d}Ucj(Qb,zc){const Yc=Qb.map(zd=>({activityId:zd.activityGuid,activityFeedItemId:null,type:1,actors:[{id:zd.author.id,provider:zd.author.provider,displayName:zd.author.displayName,givenName:null,email:zd.author.email,imageUrl:zd.author.imageUrl,color:null}],location:{type:105,region:null,subregion:null},displayTimestamp:zd.displayTimestamp,relevancy:null,navigationId:null,state:0,collectionId:null}));this.G2d=Qb.map(zd=>
{var ke,Td;const Ge=null!==(Td=null===(ke=zd.rangeHighlightLocation)||void 0===ke?void 0:ke.rangeList.map(bf=>({Type:0,RangeList:[{SheetName:zd.sheetName,FirstRow:bf.firstRow,LastRow:bf.lastRow,FirstColumn:bf.firstCol,LastColumn:bf.lastCol}]})))&&void 0!==Td?Td:[];return{Id:zd.activityGuid,Type:null,Person:null,DisplayTimestamp:null,LocationList:Ge}});zc(Yc)}Dmg(Qb,zc){this.blueDotManager?this.blueDotManager.jOj().then(Yc=>{this.Ucj(Yc,Qb)},Yc=>{zc&&zc(Yc)}):l.ULS.shipAssertTag(509703879,3012,!1,
"CatchUpActivityRequestManager.updateInGridBlueDots: Missing blue dot manager in blue dot method")}}oe.Lia="<WywaWaterline>DefaultWaterline</WywaWaterline>";oe.oub=Object(D.a)(new Ua,{activities:[],actors:[],hasMore:!1,highWaterline:oe.Lia,lowWaterline:oe.Lia,wywaWaterline:oe.Lia});Object(f.a)(oe,"CatchUpActivityRequestManager",null,[659]);class Xe{constructor(Qb){this.$=Qb}shouldShowEmptyExperienceButton(){return this.$.ea.H9a?!0:!1}onButtonClick(){const Qb={["InputMethod"]:vb.a.zb};this.$.Ia.Hb(new Y.a(1834994092,
vb.a.zb,this.$.xc,16,null),Qb)}onInviteOthersButtonClick(){const Qb={["InputMethod"]:vb.a.zb};this.$.Ia.Hb(new Y.a(869186573,vb.a.zb,this.$.xc,16,null),Qb)}getExplanationText(){const Qb=this.$.da.Ba(365);return Gb.a.instance.Ua(Qb&&Qb.isVisible?657:656)}getCommandName(){return Gb.a.instance.ga(443)}}Object(f.a)(Xe,"CatchUpEmptyExperienceBehaviorManager",null,[660]);const mf=Qb=>{window.performance&&"function"===typeof window.performance.mark&&window.performance.mark("CatchUpInit."+Qb)};class wf{constructor(Qb,
zc=null){this.$=Qb;this.flyoutRibbonButton=zc;fa.a(this.$).fi(this);this.hasFocus=!1}dispose(){fa.a(this.$).Nz(this)}get mc(){return document.getElementById("catchUpFlyoutContainer")}get If(){return this.flyoutRibbonButton.Skf&&!this.hasFocus}get ee(){return wa.a.U2c}eg(Qb,zc){if(zc)return!1;Qb=document.getElementById("flyoutItem0");if(!Qb)return l.ULS.sendTraceTag(537168009,3012,10,"Could not find firstItem in flyout when setting up focus"),!1;Qb.focus();this.Xqh(Qb);return!0}Bh(Qb){return this.mc?
oa.DOMElementExtensions.Df(this.mc,Qb):!1}Bj(){this.hasFocus=!0}ik(){this.hasFocus=!1}Xqh(Qb){if(Sys.Browser.agent===Sys.Browser.Firefox){var zc=document.createEvent("KeyboardEvent");zc.initKeyEvent(se.a.Vb,!0,!0,window.self,!1,!1,!1,!1,Hd.a.zRb,0);Qb.dispatchEvent(zc)}else zc=document.createEvent("Events"),zc.initEvent(se.a.Vb,!0,!0),zc.keyCode=Hd.a.zRb,zc.which=Hd.a.zRb,Qb.dispatchEvent(zc)}}Object(f.a)(wf,"FlyoutFocus",null,[63,3]);var Kf=a(428);class af{constructor(Qb){this.buttonClickedCallback=
null;this.Vkb=this.NBb=!1;this.RMh=new Date;this.G_e=Qb}dispose(){this.Vkb=this.NBb=!1}registerButtonClickedEvent(Qb){this.buttonClickedCallback&&l.ULS.sendTraceTag(537168008,3012,15,"RegisterButtonClickedEvent: Button clicked callback should only be registered once.");this.buttonClickedCallback=Qb.buttonClickedCallback}onFlyoutInitialized(){this.NBb&&l.ULS.sendTraceTag(537168007,3012,15,"OnFlyoutInitialized: Flyout should only be initialized once.");const Qb=(new Date).getTime()-this.RMh.getTime();
l.ULS.sendTraceTag(593601546,3012,50,`Time from retrieve activities to initialize Flyout: ${Qb}`);w.c(Ac.a.F5g,!0,w.e,0,0,Qb);this.NBb=!0;Kf.a.nJ&&Kf.a.nJ.updateCommandUI(!0)}logFlightTriggers(){}toggleCatchUpFlyout(){this.NBb?this.buttonClickedCallback?this.buttonClickedCallback():l.ULS.sendTraceTag(537168005,3012,10,"ToggleCatchUpFlyout: User clicked the button before the buttonClickedCallback was registered."):l.ULS.sendTraceTag(537168006,3012,10,"ToggleCatchUpFlyout: User clicked the button before the flyout was initialized.")}get Skf(){return this.Vkb}onFlyoutVisibilityChanged(Qb){this.Vkb!==
Qb.flyoutIsVisible&&(this.Vkb=Qb.flyoutIsVisible,Kf.a.nJ&&Kf.a.nJ.updateCommandUI(!0),this.Vkb||this.G_e&&this.G_e.iGi())}}Object(f.a)(af,"FlyoutRibbonButton",null,[667]);var Wf=a(529);class Gf{constructor(){this.flyoutAnchorTarget=this.useCompactSummaryString=this.disableDismissOnClick=this.customDynamicEntryPointEnabled=this.dynamicEntryPointEnabled=this.activityFeedDataEnabled=this.includeRelevantAuthorsInSummaryString=this.summaryStringEnabled=this.flyoutEnabled=this.featuredActivityGroupsEnabled=
null}}Object(f.a)(Gf,"CatchUpConfiguration",null,[]);class cg{constructor(){this.emptyCatchUpBehaviorManager=this.ulsLogger=this.uiCulture=this.flyoutRibbonButton=this.flyoutFocus=this.dataCulture=this.changeSummariesDataProvider=this.appColorUpdateIsEnabled=this.activityRequestManager=this.activityNavigationManager=this.activityContentManager=null}}Object(f.a)(cg,"SharedControllerFactoryParameters",null,[]);class Ha{constructor(Qb,zc,Yc=null,zd=null,ke=null){this.eIa=null;this.Jcf=!1;this.yxd=this.tOa=
0;this.xf=()=>{const Td=this.$.ea.Tm.LineageVersion,Ge=da.EwaSettings.isChangeGateEnabled("OfficeVSO:7643204_BlueDotLiveUpdatePerfTelemetry")&&this.yxd<Ha.FEi;this.tOa!==Td&&(l.ULS.sendTraceTag(509645837,0,50,`CatchUpActivityManager.onWorkbookMetadataChanged: lineageVersion: ${Td}, this.lineageVersion: ${this.tOa}`),this.tOa=Td,this.Tha.E7f(!0),Ge&&this.qze.start(),this.Q0a.Dmg(()=>{this.Tha.wSd(this.Q0a.rHc());this.Tha.E7f(!1);Ge&&(this.qze.stop(),this.yxd+=1)}))};this.OMf=Td=>{var Ge;da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",
!1)&&!Tb.a.ah(Td.wywaActivities)&&2!==Td.wywaActivities[0].type&&(this.Tha.wSd(this.Q0a.rHc()),this.showHideInGridHighlights(),this.$.ea.ju(this.xf),null===(Ge=this.blueDotManager)||void 0===Ge?void 0:Ge.ose(this.onBlueDotDismissed))};this.onBlueDotDismissed=()=>{this.Tha.wSd(this.Q0a.rHc())};this.$=Qb;this.blueDotManager=ke;this.Tha=new Hc(this.$,this.blueDotManager);this.C7d=new Jc(d.AFrameworkApplication.rb,da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CatchUpMockDataEnabled",
!1));Qb=qb.a.qYj(kb.a.instance.Tb("Common.App.CatchUpActivity.ICatchUpRequestHandler"));this.ysf=zd;this.Q0a=new oe(this.$,Qb,this.V7a(),this.blueDotManager);this.f4b=new bc(this.$,d.AFrameworkApplication.rb);this.emptyCatchUpBehaviorManager=new Xe(this.$);this.LEi(Td=>{this.zTi(Td)},zc);this.PGi();zc=null;Yc||(zc=kb.a.instance.resolve("Common.App.CatchUpActivity.FloodgateEventLogger"));this.flyoutRibbonButton=Yc||new af(zc);this.flyoutFocus=new wf(this.$,this.flyoutRibbonButton);this.qze=this.$.Mb.vg("UserAction",
"BlueDotLiveUpdateIntervalStopwatch")}get djf(){const Qb=this.flyoutRibbonButton.NBb;Qb&&!this.Jcf&&(l.ULS.sendTraceTag(588129368,3012,50,"Catch Up Flyout is ready and button is enabled."),this.Jcf=!0);return Qb}get Rqi(){return this.flyoutRibbonButton.Skf}dispose(){var Qb;this.eIa&&this.eIa.getWywaEvent().removeListener(this.OMf);this.eIa=this.$=null;Kb.a.Ja(this.Tha);this.flyoutRibbonButton=this.flyoutFocus=this.C7d=this.f4b=this.Q0a=this.Tha=null;this.$.ea.Lv(this.xf);null===(Qb=this.blueDotManager)||
void 0===Qb?void 0:Qb.OYf(this.onBlueDotDismissed)}V4i(){this.flyoutRibbonButton.toggleCatchUpFlyout();return!0}showHideInGridHighlights(){this.Tha.zOb()}PGi(){l.ULS.sendTraceTag(589608192,3012,50,"Catch Up script is loaded and Flyout is enabled.");this.zif()&&l.ULS.sendTraceTag(526718752,3012,50,"ActivityFeedData is enabled")}LEi(Qb,zc){mf("ScriptDownload");da.EwaSettings.isChangeGateEnabled("OfficeVSO:7457857_DynamicScriptLoaderNewService")?void Z.a.resolve(ja.l,{Wb:zc}).then(Yc=>Object(nb.a)(this,
void 0,void 0,function*(){Qb(V.c(Yc("catchUpActivity")))})):C.TaskExtensions.za(z.GetServiceTaskFactory.Pa(this.$.da,283,284,zc),Yc=>{Qb(V.c(Yc.result.Ll.loadScript("catchUpActivity")))},this.$.da.ka,3)}V7a(){return!!this.ysf&&this.ysf.V7a()&&this.$.ea.H9a}zif(){return da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ActivityFeedIsEnabled",!1)}zTi(Qb){C.TaskExtensions.za(Qb,()=>{Ea.a(()=>{this.eIa=catchUpActivity.FactoryGlobal.getExcelCatchUpAppInstance(Object(D.a)(new cg,{activityContentManager:Object(jc.a)(657,
this.C7d),activityNavigationManager:Object(jc.a)(658,this.f4b),activityRequestManager:Object(jc.a)(659,this.Q0a),dataCulture:this.$.ya.DataCultureTag,flyoutFocus:null,flyoutRibbonButton:Object(jc.a)(af,this.flyoutRibbonButton),uiCulture:this.$.ya.UICultureTag,ulsLogger:new O.a,emptyCatchUpBehaviorManager:Object(jc.a)(660,this.emptyCatchUpBehaviorManager)}))});this.Tha.xpe=this.eIa.getActivityIndicatorTooltipManager();Wf.a(this.$);this.eIa.getWywaEvent().addListener(this.OMf);mf("InitializeCatchUpApp");
this.eIa.initialize(Object(D.a)(new Gf,{featuredActivityGroupsEnabled:!1,summaryStringEnabled:this.V7a(),includeRelevantAuthorsInSummaryString:!1,useCompactSummaryString:!0,activityFeedDataEnabled:this.zif()}))},this.$.ka,3)}}Ha.FEi=10;Object(f.a)(Ha,"CatchUpActivityManager",null,[661,3]);class yb extends h.a{constructor(Qb){super();this.$=Qb;this.Gb()}create(){let Qb=da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?z.GetServiceTaskFactory.Pa(this.$.da,501,500,1):S.Task.Ta(null),
zc=z.GetServiceTaskFactory.Pa(this.$.da,458,459,this.Na);C.TaskExtensions.za(C.TaskExtensions.Md([Qb,zc],this.$.ka),()=>{const Yc=zc.result,zd=Qb.result,ke=Object(eb.a)(this.$.da,286,()=>new Ha(this.$,this.Na,null,Yc,zd));this.qb(ke)},this.$.ka,3)}static la(Qb){Qb.da.Ha(287,new yb(Qb))}}Object(f.a)(yb,"CatchUpActivityManagerFactory",h.a,[]);var Xb=a(240),wc=a(167),Vc=a(291),yd=a(39);class Od extends yd.a{constructor(Qb,zc){super();this.blueDotSettings=0;this.JGd=null;this.areInGridHighlightsAvailable=
()=>!0;this.areInGridHighlightsEnabled=()=>0===(this.blueDotSettings&1);this.pEj=Yc=>{l.ULS.sendTraceTag(509732679,0,50,"User toggled in grid highlights, new value {0}.",Yc);this.blueDotSettings=Yc?0:1;Yc=new Y.a(950288339,0,2,12,null);this.$.Ia.Hb(Yc,{});this.wbk()};this.$=Qb;this.blueDotSettings=zc;this.mna=kb.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.a3b=new Set;this.e1c=new Set}dispose(){this.$=null}ose(Qb){this.addHandler("cubddek",Qb)}OYf(Qb){this.removeHandler("cubddek",
Qb)}DJa(Qb,zc){da.EwaSettings.isChangeGateEnabled("OfficeVSO:7633322_BlueDotDismissTelemetry")&&l.ULS.sendTraceTag(509167327,0,50,"BlueDotManager::dismissBlueDot: Blue dot dismissed by "+zc);this.e1c.add(Qb);da.EwaSettings.isChangeGateEnabled("OfficeVSO:7525040_BlueDotDismissal")&&this.raiseEvent("cubddek",Qb)}shouldShowBlueDot(Qb){return this.a3b.has(Qb)&&!this.e1c.has(Qb)}jOj(){return Object(nb.a)(this,void 0,void 0,function*(){return new Promise((Qb,zc)=>{l.ULS.sendTraceTag(512234945,0,50,"BlueDotManager::showInGridBlueDots");
F.b(this.$).qd(Ka.a.lineageLoadInGridBlueDots,{});const Yc=ke=>{ke=Wa.a.Ue(ke.data);l.ULS.sendTraceTag(512234944,0,50,`BlueDotManager::LineageLoadInGridBlueDots service call failed. Errors: [${U.a.qc(ke)}]`);zc("LoadInGridBlueDots failed")},zd=ke=>{if(ke=lb.a(ke)?null:ke.Result){var Td={["CountOfActivities"]:ke.ActivityList.length};F.b(this.$).qd(Ka.a.sEi,Td);var Ge=Ue(ke.ActivityList,this.mna);null==this.JGd?this.Yoi().then(bf=>{this.JGd=bf;this.wHe(Ge,bf);Qb(Ge)},bf=>{zc(bf)}):(this.wHe(Ge,this.JGd),
Qb(Ge))}else l.ULS.shipAssertTag(512234914,0,!!ke,"BlueDotManager LineageLoadInGridBlueDots returned null response.")};this.$.userOperationManager.Oc(new fb.a(1024,0,(ke,Td,Ge)=>Ic(this.$.pa.va,Na.b(ke,zd),Na.a(Td,Yc),Ge,null),80),null)})})}wHe(Qb,zc){this.a3b=new Set(Qb.map(Yc=>Yc.activityGuid));zc&&zc.forEach(Yc=>{Yc=`{${Yc.toUpperCase()}}`;this.a3b.has(Yc)||this.a3b.add(Yc)})}Yoi(){return Object(nb.a)(this,void 0,void 0,function*(){return new Promise((Qb,zc)=>{l.ULS.sendTraceTag(509645136,0,50,
"BlueDotManager::invokeOriginalBlueDotsUidList");const Yc=ke=>{ke=Wa.a.Ue(ke.data);l.ULS.sendTraceTag(509645135,0,50,`BlueDotManager  LineageGetOriginalBlueDotsUidList service call failed. Errors: [${U.a.qc(ke)}]`);zc("BlueDotUidList load failed")},zd=ke=>{(ke=lb.a(ke)?null:ke.Result)?Qb(ke):l.ULS.shipAssertTag(509645133,0,!!ke,"BlueDotManager LineageGetOriginalBlueDotsUidList returned null response.")};this.$.userOperationManager.Oc(new fb.a(1029,0,(ke,Td,Ge)=>ec(this.$.pa.va,Na.b(ke,zd),Na.a(Td,
Yc),Ge,null),80),null)})})}wbk(){da.EwaSettings.isChangeGateEnabled("OfficeVSO:7146345_bluedotroamingsetting")&&!da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1)&&Vc.C(this.$.pa.va,4,this.blueDotSettings.toString(),Qb=>{U.a.Zf(Qb.Errors)?l.ULS.sendTraceTag(509732678,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: encountered an error. Errors: ${U.a.qc(Qb.Errors)}`):Qb.Result||l.ULS.sendTraceTag(509732677,0,10,"BlueDotManager.writeBlueDotSettingsToRoamingService failed to write to roaming service.")},
(Qb,zc,Yc)=>{Qb=Wa.a.Ue(Qb.data);l.ULS.sendTraceTag(509732676,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: Encountered errors for ${Yc}. Errors: ${U.a.qc(Qb)}.`)},null,null)}}Object(f.a)(Od,"BlueDotManager",yd.a,[645,3]);class be extends h.a{constructor(Qb){super();this.Hcc=null;this.wXi=zc=>{zc=Wa.a.Ue(zc.data);l.ULS.sendTraceTag(509732673,0,10,`LineageBlueDotFactory: Encountered errors while reading roaming setting. Errors: ${U.a.qc(zc)}.`)};this.$=Qb;this.Gb()}create(){this.Hcc||
(this.Hcc=this.yTh());this.Hcc.continueWith(()=>{this.qb(Object(eb.a)(this.$.da,501,()=>new Od(this.$,this.Hcc.result)))})}static la(Qb){Qb.da.Ha(500,new be(Qb))}yTh(){if(da.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1))return Xb.a.Ta(0);let Qb=new wc.a;Object(Vc.w)(this.$.pa.va,4,zc=>{this.xXi(zc,Qb)},zc=>{this.wXi(zc);Qb.setResult(1)},null,null);return Qb.task}xXi(Qb,zc){U.a.Zf(Qb.Errors)?(l.ULS.sendTraceTag(509732675,0,10,`LineageBlueDotFactory encountered an error while reading roaming setting. Errors: ${U.a.qc(Qb.Errors)}`),
zc.setResult(1)):null==Qb.Result?zc.setResult(0):(Qb=parseInt(Qb.Result,10),l.ULS.sendTraceTag(509732674,0,50,`LineageBlueDotFactory read roaming setting. Value: ${Qb}`),zc.setResult(Qb))}}Object(f.a)(be,"BlueDotManagerFactory",h.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.Lineage");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.VersionHistory");Type.registerNamespace("_Ewa");e.a.Fa(la.la);e.a.Fa(Eb.la);
e.a.Fa(y.la);e.a.Fa(u.la);Wb.a.ni('.LineageActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden;background-color:#edebe9}.LineageActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding-right:16px;padding-left:16px;padding-top:16px;padding-bottom:11px;height:auto;background-color:#edebe9}.LineageActivityPaneTitle{max-width:240px;display:inline-flex;font-weight:bold;font-family:"Segoe UI Semi Bold","Segoe UI Web",Arial,Verdana,sans-serif;font-size:16px;line-height:16px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden;background-color:#edebe9;margin:0}.LineageActivityCloseButton{display:inline-flex;align-self:center}.LineageActivityBody{height:100%;padding-left:16px;overflow:hidden;background-color:#edebe9}');
(()=>{e.a.Fa(Qb=>{Sc.la(Qb);bd.la(Qb);za.la(Qb);Id.la(Qb);xb.la(Qb)})})();Type.registerNamespace("Common.App.CatchUpActivity");Mf.main();(()=>{e.a.Fa(Qb=>{mf("Begin");yb.la(Qb);Zb.la(Qb)})})();(()=>{e.a.Fa(Qb=>{be.la(Qb)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.catchup.js.map/d979de8e3478f74ee5f9711954df2567/EwaDSEsNext.catchup.js.map