'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[19],{1145:function(r,B,a){a.d(B,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertFile")}},1146:function(r,B,a){a.d(B,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertPicture")}},1148:function(r,B,a){a.d(B,"a",function(){return b});var c=a(517);const b=()=>{c.a.ni(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}")}},
1149:function(r,B,a){a.d(B,"a",function(){return c});r=a(0);class c{}c.iHc="b-ring_Apc_Trans";c.xrg="cdn_static_resource_ewa_image";Object(r.a)(c,"ResourceHosts",null,[])},1150:function(r,B,a){a.d(B,"a",function(){return e});r=a(0);var c=a(59),b=a(1328);class e{static Rfd(f,d,h,l=null){e.Roc||(e.Roc=Array.isArray(c.a.Yh(h.ya.NetworkMeasurementUrlList))?c.a.Yh(h.ya.NetworkMeasurementUrlList):null);const k=[];for(let w=0;w<e.Roc.length;w++){const n=e.Roc[w];let x=n.key;x||(x=n.Key);if(l&&!l.includes(x))continue;
let m=n.value;m||(m=n.Value);x&&m&&k.push(new b.a(h,x,m,f,d))}return k}}e.Roc=null;Object(r.a)(e,"NetworkConnectionHelpers",null,[])},1174:function(r,B,a){var c=a(0),b=a(7),e=a(15),f=a(228),d=a(31),h=a(27),l=a(358),k=a(178),w=a(361),n=a(4),x=a(24),m=a(1),u=a(39),t=a(8),y=a(292),v=a(14);class A extends y.a{constructor(Qa){super(Qa);this.j9g=()=>{e.ULS.sendTraceTag(537167827,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};e.ULS.sendTraceTag(537167828,0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");
this.Rb=0;this.wc(1,v.a.instance.ga(2260));Qa=v.a.instance.ga(2258);const Zb=this.NM();this.initializeAndShow(Qa,this.j9g,Zb)}get pc(){return"ClipboardReadPermissionAskDialog"}NM(){const Qa={};Qa.id=this.pc;const Zb=v.a.instance.ga(2259);Qa.DialogMessage=Zb;return Qa}}Object(c.a)(A,"ClipboardReadPermissionAskDialog",y.a,[]);var z=a(53);const C=(Qa,Zb,nb,Tb,qb)=>{const Kb=Qa.Stopwatch,jc={};jc.a=qb;jc.e=Kb.id;jc.c="RearrangeRowColumn";jc.b="mouse";jc.d=Qa.OperationId.toString();jc.f=nb.toString();
jc.g=Tb.toString();jc.h=Zb.toString();jc.i=Qa.DragDropIsShiftKeyDown;jc.j=!0;jc.o=Kb.Fc;jc.q=!1;jc.r=Qa.CopyPasteTargetType.toString();jc.s=Qa.EncounteredDeploymentErrors;return jc};class H{constructor(Qa,Zb){this.sPh=()=>{const nb={};nb.SourceItem=this.toString();return nb};this.sessionStateId=Qa;this.sessionId=Zb;this.toJSON=this.sPh}skf(Qa){return Qa?this.sessionStateId===Qa.sessionStateId&&this.sessionId===Qa.sessionId:!1}isFromCurrentSession(Qa){return this.sessionId===Qa.ya.UserSessionId}}Object(c.a)(H,
"SourceItem",null,[]);class I extends H{constructor(Qa,Zb,nb,Tb,qb){super(nb,Tb);this.activeFloatingObjectControlId=Qa;this.sheetName=Zb;this.type=qb}isEqual(Qa){return Qa&&Object.getType(Qa)===I?this.skf(Qa)&&this.activeFloatingObjectControlId===Qa.activeFloatingObjectControlId&&this.sheetName===Qa.sheetName:!1}toString(){return this.type.toString()}}Object(c.a)(I,"ArtSourceItem",H,[]);var S;(function(Qa){Qa[Qa.valid=0]="valid";Qa[Qa.notPairwiseDisjoint=1]="notPairwiseDisjoint";Qa[Qa.cutNotSupportedInDiscontinuousSelection=
2]="cutNotSupportedInDiscontinuousSelection";Qa[Qa.notValidForm=3]="notValidForm";Qa[Qa.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(S||(S={}));Object(c.b)("CopySourceValidationOptions",S);var P=a(44);class D extends H{constructor(Qa,Zb,nb,Tb,qb){super(Tb,qb);e.ULS.shipAssertTag(537167645,0,!!Zb&&0<Zb.length,"RangeSourceItem.ctor: ranges should not be null or empty");this.$=Qa;this.ranges=Zb;this.sheetName=nb}isEqual(Qa){return Qa&&Object.getType(Qa)===D?this.skf(Qa)&&P.R(this.ranges,Qa.ranges)&&
this.sheetName===Qa.sheetName:!1}toString(){return P.i(this.ranges,",",this.$,!1)}}Object(c.a)(D,"RangeSourceItem",H,[]);const G=Qa=>!!Qa&&Object.getType(Qa)===D;class E{}E.B8j="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(c.a)(E,"ExpectedErrorNames",null,[]);class O{}O.plainText="text/plain";O.html="text/html";O.png="image/png";O.shadowWorkbook="data/shadow-workbook";O.Zui="metadata/is-last-copy-was-external";O.iri="metadata/is-last-copy-was-external-XLO-source";O.L7g="metadata/chrome-extension-id";
O.jtb="copyId";O.TSg="metadata/additional-signature-data-attributes";Object(c.a)(O,"ClipboardDataFormat",null,[]);const N=Qa=>Qa.clipboardItems&&(Qa=Qa.clipboardItems.getItem(O.Zui))&&"1"===Qa?!0:!1,J=Qa=>N(Qa)&&!(void 0===Qa.clipboardItems||null===Qa.clipboardItems)&&!!Qa.clipboardItems.getItem(O.png)&&!Qa.clipboardItems.getItem(O.plainText),W=Qa=>Qa.clipboardItems&&(Qa=Qa.clipboardItems.getItem(O.iri))&&"1"===Qa?!0:!1,ea=Qa=>Qa&&(Qa=Qa.getCachedMetadata(),null===Qa||void 0===Qa?0:Qa.lastCopy)?Qa.lastCopy:
null;var R=a(51),Y=a(21),U=a(35);class da{constructor(Qa,Zb,nb,Tb){this.$=Qa;this.originalDestinations=Zb;this.xac=nb;this.Evg=Tb;this.DFg=this.originalDestinations;this.yzg=this.xac;this.$Cg="PasteRecoveryUI"}get SSg(){return this.Evg}get JDi(){return this.$Cg}get ejj(){return this.DFg}get oYe(){return this.yzg}gLa(){return da.g9i}yXh(){return this.xac&&1===this.xac.length?this.zXh(this.xac[0]):null}zXh(Qa){var Zb=Y.h(this.$);const nb=Zb.jb.Li(Qa);var Tb=Zb.Eg(Qa,nb);Zb=Zb.rtl;if(!Tb)return null;
Qa=Y.h(this.$).Vf(nb);const qb=Qa.Dn;if(!qb.vd(Tb))return null;Tb=qb.xe(Tb);const Kb=Tb.topLeft.y;var jc=Tb.bottomRight.y;const Ac=Zb?Tb.bottomRight.x:Tb.topLeft.x;Tb=Zb?Tb.topLeft.x:Tb.bottomRight.x;var Jc=new R.a(Tb+(Zb?-81:81),jc+38+6);if(qb.pia(Jc))return this.y5a(Qa,qb,nb,Tb,jc,Zb?12:-3,66);Jc=new R.a(Tb+(Zb?-81:81),jc);if(qb.pia(Jc))return this.y5a(Qa,qb,nb,Tb,jc,Zb?20:3,22);Jc=new R.a(Tb,jc+38+6);if(qb.pia(Jc))return this.y5a(Qa,qb,nb,Tb,jc,-81+(Zb?18:0),66);Tb=new R.a(Ac+(Zb?81:-81),jc);if(qb.pia(Tb))return this.y5a(Qa,
qb,nb,Ac,jc,-81+(Zb?12:-6),22);jc=new R.a(Ac,Kb-38-6);return qb.pia(jc)?this.y5a(Qa,qb,nb,Ac,Kb,Zb?15:0,16):this.y5a(Qa,qb,nb,Zb?qb.topLeft.x:qb.bottomRight.x,qb.bottomRight.y,-81+(Zb?15:-6),22)}y5a(Qa,Zb,nb,Tb,qb,Kb,jc){var Ac=Y.h(this.$);const Jc=Ac.rtl;Qa=Sys.UI.DomElement.getLocation(Qa.domElement);Tb=new Sys.UI.Point(Tb+(Jc?0:Qa.x)-Zb.topLeft.x,qb+Qa.y-Zb.topLeft.y);Jc&&(Ac=Ac.view.visibleArea,Tb.x=Ac.bottomRight.x-Ac.topLeft.x-Tb.x,2===nb||4===nb)&&(Tb.x+=Zb.bottomRight.x);Tb=U.a(this.$).ska(Tb);
return new Sys.UI.Point(Tb.x+Kb,Tb.y+jc)}}da.g9i=["PasteRecoveryUI"];Object(c.a)(da,"PasteRecoveryUI",null,[742]);var T=a(73),ka=a(384);class L{}L.KKg="ActiveSelection";L.shadowWorkbook="ShadowWorkbook";L.Isg="GVML";L.plainText="PlainText";L.html="Html";L.mZg="Bitmap";Object(c.a)(L,"PayloadType",null,[]);class fa{}fa.xQj="Slice6";Object(c.a)(fa,"SliceName",null,[]);class wa{}wa.ZPi="NotCalled";wa.success="Success";wa.failed="Failed";Object(c.a)(wa,"SucceededPopulatingSystemClipboardOptions",null,
[]);var oa=a(367);const xa=(Qa,Zb)=>Qa?Zb&&Zb.ya?Qa.sessionId!==Zb.ya.UserSessionId:(e.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),!1):(e.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1),bb=Qa=>{switch(Qa){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}},Za=Qa=>{if(!Qa)return"null";const Zb=[];for(const nb of Qa.get())Zb.push(`${nb.clipboardDataFormat}(${nb.data.length})`);Zb.sort();return Zb.join(",")};var La;(function(Qa){Qa[Qa.valid=
0]="valid";Qa[Qa.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";Qa[Qa.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";Qa[Qa.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";Qa[Qa.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";Qa[Qa.multipleDestinationsAreNotMultiplyOfSourceRange=5]="multipleDestinationsAreNotMultiplyOfSourceRange";
Qa[Qa.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";Qa[Qa.copySourceNotValid=7]="copySourceNotValid";Qa[Qa.cutNotSupportedInDiscontinuousSelection=8]="cutNotSupportedInDiscontinuousSelection";Qa[Qa.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";Qa[Qa.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";Qa[Qa.unknown=100]="unknown"})(La||(La={}));Object(c.b)("PasteValidationOptions",La);var va=a(50),Ba=a(151),Ea=a(38),pa=a(164),$a=a(352),
cb=a(29),ib=a(275),ta=a(11),Ya=a(22),Da=a(134),ba=a(118),ya=a(572),V=a(103),Z=a(58),ja=a(108),la=a(71),ua=a(350);class eb extends Sys.EventArgs{constructor(Qa,Zb,nb){super();this.command=Qa;this.destinationRange=Zb;this.sourceRange=nb}}Object(c.a)(eb,"PasteCSERenderedEventArgs",Sys.EventArgs,[]);var Eb=a(131),Wb=a(70),Ab=a(153),Jb=a(54),Gb;(function(Qa){Qa[Qa.source=0]="source";Qa[Qa.destination=1]="destination"})(Gb||(Gb={}));Object(c.b)("RangeType",Gb);class Nb extends u.a{constructor(Qa,Zb,nb,
Tb,qb,Kb,jc,Ac,Jc=null){super();this.pasteShortcutManager=null;this.sjf=m.EwaSettings.vb();this.Cxa=m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.jhg=null;this.E8a=!1;this.Qud=m.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix2");this.txa=m.EwaSettings.isChangeGateEnabled("OfficeVSO:7205979_DemoteDragDropNonEmptyRangeLogLevel");this.fFd=hd=>{this.MJj(hd)&&(this.so.jgc(),e.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};
this.DIi=(hd,Cd)=>{e.ULS.sendTraceTag(537167768,0,50,`CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [${hd}]. userPressedExtensionLink=${Cd}`);this.gridView.focus()};this.od=(hd,Cd)=>{Cd.jN||Cd.Ef||this.pr("OnWorkbookOpened",!1).catch(()=>{})};this.rj=(hd,Cd)=>{hd=ea(this.CK);const ac=this.so.Gyb(hd);ac&&(Cd.na&&Cd.na.sheetName===ac.sheetName&&ac.isFromCurrentSession(this.$)?this.so.Def(ac.ranges,hd.commandParameters.commandType):this.so.jgc())};this.Iqc=
(hd,Cd)=>{hd=ea(this.CK);(hd=this.so.Gyb(hd))&&Cd.item&&Cd.item.sheetName===hd.sheetName&&hd.isFromCurrentSession(this.$)&&this.pr("OnItemDeleting",!1).catch(()=>{})};this.Iza=(hd,Cd)=>{this.sjf?this.jhg(hd,Cd):this.CLf()};this.AR=(hd,Cd)=>{1===Cd.Uq&&Cd.Gf.operation.flags&2&&this.pr("OnQueueItemChanged/ItemRemoved",!1).catch(()=>{})};this.$=Qa;this.Zg=nb;this.gridView=Y.h(Qa);this.so=qb;this.kni=Kb;this.CK=Zb;this.t6b=Tb;this.getStringifiedError=Jc||copyPasteInfra.getStringifiedError;this.Cag=1===
Ac;this.Gj();this.copyPasteShortcutDialogFactory=this.$.da.Ba(85);e.ULS.shipAssertTag(537167825,0,!!this.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");jc||(e.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),jc=Nb.Vnh);this.userHash=d.a.mu(jc);this.OMi="CultureTag: "+v.a.instance.rub+" HASH: ";this.CK.addMetadataChangeListener(Nb.gyf,this.fFd);this.ALi=ka.a.rFb;this.Sya=this.Cxa?
m.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.ya.CopyPasteMaxPayloadLength):t.a.Sya;(this.Vn=m.EwaSettings.isChangeGateEnabled("OfficeVSO:7568646_PressEnterToPaste"))&&Qa.da.hb(478,hd=>{this.pasteShortcutManager=hd});this.sjf&&(this.jhg=ib.b(()=>{this.CLf()},1,this.$.ka,"CopyPasteInfrastructure.OnStartEditInternal",!0))}kPe(){var Qa=ea(this.CK);return Qa?(Qa=Qa.sourceItem)&&!Qa.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),
!1):!0:!1}get pasteIndicationManager(){return this.$.da.Ba(373)}lRg(Qa){this.addHandler(Nb.bGd,Qa)}ypj(Qa){this.removeHandler(Nb.bGd,Qa)}copy(Qa){Qa.stopwatch=this.$.Mb.Kc("UserAction",z.b().Ij(Qa.ribbonCommandInfo.command)+"ClientSide");if(this.Vn){const Kb=va.GetServiceTaskFactory.Pa(this.$.da,478,479,0);Ea.TaskExtensions.za(Kb,()=>{this.pasteShortcutManager=Kb.result},this.ka,3)}const Zb=!!ea(this.CK);m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&
!h.a.cB&&(this.E8a=!1);this.pr("Copy/before/"+l.a[Qa.ribbonCommandInfo.method],!1,void 0,!0,Qa.copyPasteTargetType).catch(()=>{});var nb=-1985798686===Qa.ribbonCommandInfo.command;if(1===this.gridView.Oe&&(nb=this.so.Hjf(this.gridView.ha.ra.selectedRanges,nb),0!==nb)){const Kb=Nb.Nch(nb);this.aAa(Kb,S[nb],!1);return Promise.reject(!1)}Qa.userHash=this.userHash;Qa.id=k.a.create().toString();let Tb=this,qb=this;return this.t6b.onCopy(Qa).then(Kb=>{Kb.isAsyncCopy||Qa.stopwatch.stop();Tb.pasteIndicationManager.GPe();
const jc=oa.d(Qa);e.ULS.sendTraceTag(24150883,0,50,`CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. ${jc}`);Tb.vGi(Kb,Zb);Kb=m.EwaSettings.isChangeGateEnabled("OfficeVSO:6591921_CheckTargetTypeForEnterToPaste")?1===Qa.copyPasteTargetType:!0;!Qa.isFormatPainter&&Tb.Vn&&Kb&&(Tb.pasteShortcutManager?Tb.pasteShortcutManager.tvh():e.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));return Promise.resolve(!0)},Kb=>{let jc=!1,Ac="none",Jc=Nb.nub,hd=!0,Cd=-1,ac=
Nb.copyErrorName+Nb.ZJa,Lc=!1,rd=null;if(Kb){rd=Kb.copyContext;Cd=Kb.reason;ac+=Nb.pLa(Kb);Kb.message&&(Jc=Kb.message);var Yd=Nb.Mch(Kb);if(Yd)if(3===Yd.copyErrorName)jc=!0,Jc=Ac="Async Copy canceled by the user.",hd=!1;else if(cb.a.wq(Yd.ewaErrors))if(Jc=qb.tdc(Yd.ewaErrors),cb.a.lh(Yd.ewaErrors,Nb.operationSucceededWithAlert))Lc=jc=!0;else if(cb.a.lh(Yd.ewaErrors,Nb.pasteDataLimitHit)||cb.a.lh(Yd.ewaErrors,Nb.copyThrottlingError))jc=!0;13===Kb.reason?(jc=!0,hd=!1):11===Kb.reason&&(hd=!1)}Yd=Kb?
qb.getStringifiedError(Kb):"null";jc?(Yd=oa.d(Qa),e.ULS.sendTraceTag(36304157,0,15,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: ${hd}, Friendly message: ${Ac}, Error Message: ${Jc}, CommandParameters: ${Yd}`)):e.ULS.sendTraceTag(24150912,0,10,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: ${hd}, Error Message: ${Yd}, CommandParameters: ${oa.d(Qa)}`);hd&&qb.pr("Copy/fail/"+l.a[Qa.ribbonCommandInfo.method],
!0,void 0,void 0,Qa.copyPasteTargetType).catch(()=>{});qb.uGi(Qa,jc,Jc,ac,Cd,Lc,rd);return Promise.reject(Kb)})}paste(Qa){Qa.stopwatch=this.$.Mb.Kc("UserAction",z.b().Ij(Qa.ribbonCommandInfo.command)+"ClientSide");m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.cB&&(e.ULS.sendTraceTag(537167822,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.E8a=!1,Qa.clipboardPicklingApiDataFormatsToRead=[O.shadowWorkbook]);
Y.h(this.$).Dh&&Y.h(this.$).Dh.M0(this.tjd(Qa.ribbonCommandInfo.command),Qa.stopwatch.id);if(Qa.isPasteCommandFromRecoveryUI){var Zb=this.$.da.Ba(406);var nb=P.d(Zb.twd);Zb=Zb.hwd;Qa.pasteRecoveryCachedClipboardItems=Zb?Zb[Nb.JOf]:null}else nb=P.d(this.gridView.ha.ra.selectedRanges);Qa.originalDestinations=nb;Qa.expandDestinations=this.c2c(Qa.originalDestinations,Qa.commandType);if(this.n2c(Qa.commandType,Qa.expandDestinations)||this.I4g())return Qa.userHash=this.userHash,Qa.id=k.a.create().toString(),
m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!h.a.cB&&(Qa.clipboardReadPermissionPromptShown=!1,Qa.clipboardAsyncApiDataFormatsToRead=[O.plainText+"Async"],this.t6b.shouldShowClipboardReadPermissionDialog().then(Tb=>{Tb&&(Qa.clipboardReadPermissionPromptShown=!0,new A(this.$));return Promise.resolve(!0)},()=>Promise.resolve(!0))),this.t6b.onPaste(Qa).then(Tb=>this.lrc(Tb,Qa),Tb=>this.BHb(Qa,Tb));this.$.Yc(927125067,T.a.zb,30,null);nb=P.i(Qa.expandDestinations,
",",this.$,!1);e.ULS.sendTraceTag(24150913,0,15,`CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: ${nb}, CommandType: ${Qa.commandType}, copyPasteTargetType="${Qa.copyPasteTargetType}"`);return Promise.resolve(!0)}tjd(Qa){switch(Qa){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8;default:return 3}}I4g(){return!!Y.h(this.$).ha.Sa.activeFloatingObjectControlId&&this.$.$s(null,!1,470)}TDb(){const Qa=
ea(this.CK);return Qa&&Qa.commandParameters?Qa.commandParameters.copyPasteTargetType:0}Yui(){return!!ea(this.CK)&&xa(ea(this.CK),this.$)}pr(Qa,Zb,nb=!1,Tb=!1,qb=0){try{this.Vn&&this.pasteShortcutManager&&this.pasteShortcutManager.Y8b();let Kb=qb;const jc=this.ECi();if(!Tb&&2===jc)return e.ULS.sendTraceTag(537167821,0,50,`CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '${Zb}', isExplicit = '${nb}', isForce = '${Tb}', Current CCP operation copyPasteTargetType = '${qb}', LastCopyPasteTargetType = '${jc}'`),
Promise.reject(null);0===Kb&&(Kb=jc);const Ac=this.$.Mb.Kc("UserAction","ClearCopyState"),Jc=Ac.id;e.ULS.sendTraceTag(537167820,0,50,`CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '${Zb}', isExplicit = '${nb}', isForce = '${Tb}', Current CCP operation copyPasteTargetType = '${qb}', LastCopyPasteTargetType = '${jc}'`);this.so.jgc();this.ngj();return this.t6b.onCancelCopy(Zb).then(()=>{Zb&&m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.cB&&(this.E8a=!1);Ac.stop();this.Ktf(Qa,Jc,!0,nb,Zb,"","",Ac.Fc,Kb);return Promise.resolve(!0)},hd=>{var Cd=hd?this.getStringifiedError(hd):"null";e.ULS.sendTraceTag(24150915,0,15,`CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: ${Cd}`);Ac.stop();Cd=Nb.Y4g+Nb.ZJa;let ac=Nb.nub;hd&&(Cd+=Nb.pLa(hd),hd.message&&(ac=hd.message));this.Ktf(Qa,Jc,!1,nb,Zb,ac,Cd,Ac.Fc,Kb);return Promise.reject(hd)})}catch(Kb){return Promise.reject(null)}}b4c(Qa,Zb,
nb=!1,Tb=!1,qb=0){return Tb||this.kPe()?this.pr(Qa,Zb,nb,Tb,qb):(e.ULS.sendTraceTag(537167819,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))}aAa(Qa,Zb,nb){e.ULS.sendTraceTag(590705172,0,50,`CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: ${Zb}`);const Tb=new V.a;Tb.ia("reason",Zb);ya.a(Da.a.discontinuousSelectionBlocking,
[nb?ba.a.$8i:ba.a.Idh],!0,!0,!1,!1,Tb);Qa=cb.a.hd(1,1,751,Qa,0,371863010,"DiscontinuousSelectionBlocking");m.EwaSettings.jy()?new $a.a(this.$,Qa):(Qa=new pa.ErrorDialog(this.$,Qa),Qa.initialize(),Qa.fg())}ECi(){const Qa=ea(this.CK);return Qa&&Qa.sourceItem?Object.getType(Qa.sourceItem)===I?2:1:0}dragDropCells(Qa,Zb,nb,Tb,qb=!1){Qa.stopwatch=this.$.Mb.Kc("UserAction","DragDropClientSide");Qa.isDragDrop=!0;this.pr("DragDrop/before/"+l.a[Qa.ribbonCommandInfo.method],!1,void 0,void 0,Qa.copyPasteTargetType).catch(()=>
{});const Kb=qb?2:1;let jc=0;jc=qb?4:Tb?256:128;const Ac={encounteredDeploymentErrors:!1};Ac.commandParameters=Qa;Qa.userHash=this.userHash;Qa.id=k.a.create().toString();return this.Qud?this.so.pasteRange(Qa.ribbonCommandInfo,P.q(Zb,this.$),P.q(nb,this.$),Kb,jc,[Qa.stopwatch],Ac,!1,()=>{e.ULS.sendTraceTag(537167818,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${Qa.copyPasteTargetType}"`);this.M9a(Qa,Kb,Zb,nb,Ac)},Jc=>{const hd=Jc?this.getStringifiedError(Jc):"null";this.txa||
e.ULS.sendTraceTag(537167817,0,10,`CopyPasteInfrastructure.DragDropCells: ${hd}, copyPasteTargetType="${Qa.copyPasteTargetType}"`);this.eab(Jc,Qa,Kb,Zb,nb,Ac)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},Jc=>Promise.reject(Jc)):this.so.pasteRange(Qa.ribbonCommandInfo,P.q(Zb,this.$),P.q(nb,this.$),Kb,jc,[Qa.stopwatch],Ac,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410075,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${Qa.copyPasteTargetType}"`);
this.gridView.ha.selectionType=-1;this.M9a(Qa,Kb,Zb,nb,Ac);return Promise.resolve(!0)},Jc=>{const hd=Jc?this.getStringifiedError(Jc):"null";this.txa||e.ULS.sendTraceTag(521410074,0,10,`CopyPasteInfrastructure.DragDropCells: ${hd}, copyPasteTargetType="${Qa.copyPasteTargetType}"`);this.eab(Jc,Qa,Kb,Zb,nb,Ac);return Promise.reject(Jc)})}Vsh(Qa,Zb,nb,Tb,qb=!1){Qa.stopwatch=this.$.Mb.Kc("UserAction","DragDropReplaceClientSide");Qa.isDragDrop=!0;this.b4c("DragDropReplace/before/"+l.a[Qa.ribbonCommandInfo.method],
!1,void 0,void 0,Qa.copyPasteTargetType).catch(()=>{});const Kb=qb?2:1;let jc=0;jc=qb?4:Tb?256:128;const Ac={encounteredDeploymentErrors:!1};Ac.commandParameters=Qa;m.EwaSettings.getBooleanFeatureGate(ka.a.F9b,!1)&&(Qa.isDragInsert=!1);Qa.userHash=this.userHash;Qa.id=k.a.create().toString();return this.Qud?this.so.pasteRange(Qa.ribbonCommandInfo,P.q(Zb,this.$),P.q(nb,this.$),Kb,jc,[Qa.stopwatch],Ac,!1,()=>{e.ULS.sendTraceTag(537167816,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${Qa.copyPasteTargetType}"`);
this.M9a(Qa,Kb,Zb,nb,Ac)},Jc=>{const hd=Jc?this.getStringifiedError(Jc):"null";this.txa||e.ULS.sendTraceTag(537167815,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${hd}, copyPasteTargetType="${Qa.copyPasteTargetType}"`);return this.eab(Jc,Qa,Kb,Zb,nb,Ac)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},Jc=>Promise.reject(Jc)):this.so.pasteRange(Qa.ribbonCommandInfo,P.q(Zb,this.$),P.q(nb,this.$),Kb,jc,[Qa.stopwatch],Ac,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410073,
0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${Qa.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.M9a(Qa,Kb,Zb,nb,Ac);return Promise.resolve(!0)},Jc=>{const hd=Jc?this.getStringifiedError(Jc):"null";this.txa||e.ULS.sendTraceTag(521410072,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${hd}, copyPasteTargetType="${Qa.copyPasteTargetType}"`);this.eab(Jc,Qa,Kb,Zb,nb,Ac);return Promise.reject(Jc)})}Ush(Qa,Zb,nb,Tb,qb=!1){Qa.stopwatch=this.$.Mb.Kc("UserAction",
"DragDropInsertClientSide");this.b4c("DragDropInsert/before/"+l.a[Qa.ribbonCommandInfo.method],!1,void 0,void 0,Qa.copyPasteTargetType).catch(()=>{});const Kb=qb?2:1,jc=P.L(this.c2c([nb],Kb));var Ac=this.$.ea.na.sheetName;const Jc=this.$.ea.na.sheetName,hd=P.v(Zb,this.$);hd.SheetName=Ac;Ac=P.v(jc,this.$);Ac.SheetName=Jc;Tb=jc.isRow||Zb.isRow||Tb?1:0;const Cd={encounteredDeploymentErrors:!1};Qa.isDragInsert=!0;Cd.commandParameters=Qa;Qa.userHash=this.userHash;Qa.id=k.a.create().toString();if(this.Qud)return qb=
this.so.PPe(Cd,hd,Ac,qb,Tb,Qa.ribbonCommandInfo,()=>{e.ULS.sendTraceTag(537167814,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${Qa.copyPasteTargetType}"`);this.M9a(Qa,Kb,Zb,nb,Cd)},Lc=>{const rd=Lc?this.getStringifiedError(Lc):"null";this.txa||e.ULS.sendTraceTag(537167813,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${rd}, copyPasteTargetType="${Qa.copyPasteTargetType}"`);this.eab(Lc,Qa,Kb,Zb,nb,Cd)}),ja.c(qb.then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},
Lc=>Promise.reject(Lc))).Yo(()=>!0);qb=this.so.PPe(Cd,hd,Ac,qb,Tb,Qa.ribbonCommandInfo,null,null);let ac=this;return ja.c(qb.then(()=>{e.ULS.sendTraceTag(521410071,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${Qa.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.M9a(Qa,Kb,Zb,nb,Cd);return Promise.resolve(!0)},Lc=>{const rd=Lc?ac.getStringifiedError(Lc):"null";this.txa||e.ULS.sendTraceTag(521410070,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${rd}, copyPasteTargetType="${Qa.copyPasteTargetType}"`);
ac.eab(Lc,Qa,Kb,Zb,nb,Cd);return Promise.reject(Lc)})).Yo(()=>!0)}mhf(Qa,Zb){var nb=ea(this.CK);if(!nb)return e.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),Z.Task.Ta(!1);if(!G(nb.sourceItem))return e.ULS.sendTraceTag(537167811,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),Z.Task.Ta(!1);var Tb=nb.sourceItem;if(!Tb)return e.ULS.shipAssertTag(537167810,0,!!Tb,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),Z.Task.Ta(!1);
if(!Tb.isFromCurrentSession(this.$))return e.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),Z.Task.Ta(!1);if(1<Tb.ranges.length)return e.ULS.sendTraceTag(537167808,0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.aAa(2192,"InsertCopiedCutCells",!0),Z.Task.Ta(!1);nb=P.L(Tb.ranges);var qb=this.gridView.ha.ra.xd.clone();Qa=P.L(this.c2c([qb],Qa));const Kb=this.yrf();Tb=Tb.sheetName;qb=this.$.ea.na.sheetName;const jc=P.v(nb,
this.$);jc.SheetName=Tb;const Ac=P.v(Qa,this.$);Ac.SheetName=qb;Tb=this.gridView.ha.ra.activeRange;return(Qa.Fg||nb.Fg||m.EwaSettings.isChangeGateEnabled("OfficeVSO:7578311_InsertCopiedCutCellsDefaultShiftInTable")&&this.so.BLj(this.$,nb,Tb)?Z.Task.Ta(0):Qa.isRow||nb.isRow||m.EwaSettings.isChangeGateEnabled("OfficeVSO:7578311_InsertCopiedCutCellsDefaultShiftInTable")&&this.so.CLj(this.$,nb,Tb)?Z.Task.Ta(1):this.kni.K6b(this.$,Y.h(this.$).rtl)).Yo(Jc=>this.so.executeInsertCopiedCutCellsOperation(jc,
Ac,Kb,Jc.result,Zb,null,null)).continueWith(()=>{!m.EwaSettings.isChangeGateEnabled("OfficeVSO:7646005_InsertCopiedCutCellsClearState")&&Kb?this.so.jgc():this.pr("InsertCopiedCutCells/success/"+l.a[Zb.method],!0)})}Bjc(){const Qa=ea(this.CK),Zb=this.gridView.ha.ra.eh;return!!Qa&&G(Qa.sourceItem)&&Zb&&1===Qa.sourceItem.ranges.length}yrf(){return this.zrf(-911352779)}gmc(){return this.zrf(-1985798686)}n2c(Qa,Zb){var nb=new Ba.a(this.$.ua),Tb=36===Qa;const qb=nb.Td(4);Qa=2===this.TDb()&&nb.Td(1);Tb=
Tb&&qb;nb=!nb.Xh||!this.gmc()||!Ba.a.t9b(Zb,Y.h(this.$));return Tb||Qa||this.$.$s(Zb,!0)&&nb}njc(Qa,Zb){return this.so.njc(Qa,Zb)}dispose(){super.dispose();this.Xj();this.CK.removeMetadataChangeListener(Nb.gyf)}r$c(Qa,Zb,nb,Tb,qb,Kb){if(!this.T8g(Qa.commandParameters.ribbonCommandInfo.command))return Qa.cseStatus=2,!1;if(Kb&&Zb.vd(Tb))return Qa.cseStatus=4,!1;if(nb!==qb)return Qa.cseStatus=6,!1;if(m.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")&&(Tb.width%Zb.width||Tb.height%
Zb.height))return Qa.cseStatus=16,!1;if(m.EwaSettings.getBooleanFeatureGate(ka.a.uLe,!1)){if(nb=Zb,Tb=Tb.xe(this.gridView.pi),Zb=null===Zb.xe(this.gridView.pi),qb=Qa.commandParameters.ribbonCommandInfo.command,Zb&&1804571062!==qb&&-185374993!==qb||!Tb)return Qa.cseStatus=7,!1}else if(nb=Zb.xe(this.gridView.pi),Tb=Tb.xe(this.gridView.pi),!nb||!Tb)return Qa.cseStatus=7,!1;if(ka.a.eze){Zb=this.dze(this.gridView,Qa.commandParameters.ribbonCommandInfo.command,nb,Gb.source);if(0!==Zb)return Qa.cseStatus=
Zb,!1;Zb=this.dze(this.gridView,Qa.commandParameters.ribbonCommandInfo.command,Tb,Gb.destination);if(0!==Zb)return Qa.cseStatus=Zb,!1}Zb=P.v(nb,this.$);Zb=this.Zg.e9i(this.gridView,Zb,P.v(Tb,this.$),Qa.commandParameters.ribbonCommandInfo.command,Qa.commandParameters.stopwatch);1===Zb&&(Kb&&(this.Zg.U3c(nb,!1),this.Zg.U3c(nb,!0)),Kb=new eb(Qa.commandParameters.ribbonCommandInfo.command,Tb,nb),Y.h(this.$).Vfj(Kb),this.pasteIndicationManager.und(Qa.commandParameters.id),this.nyc(Qa.commandParameters.expandDestinations,
Qa.commandParameters.isPasteCommandFromRecoveryUI),this.MEe("DoPasteClientEstimation/"+l.a[Qa.commandParameters.ribbonCommandInfo.method],Qa));Qa.cseStatus=Zb;return 1===Zb}dze(Qa,Zb,nb,Tb){const qb=new Eb.a("CopyPasteInfrastructure.blockCseForPaste",Qa,nb);try{for(;qb.moveNext();){let Kb=qb.get_current().cell;if(Kb.sz)return 8;if(237279923===Zb||-185374993===Zb){if(Kb.BS&&m.EwaSettings.isChangeGateEnabled("OfficeVSO:7148128_BlockWrapTextCseForPaste"))return 18;if(Kb.TM&&m.EwaSettings.isChangeGateEnabled("OfficeVSO:7327017_BlockCondFormattingForPaste"))return 19}if(Tb===
Gb.source){if(Kb.bca)return 23;if(Kb.Dud)return 24;if(Kb.hasIgnorableError)return 25;if((237279923===Zb||1804571062===Zb)&&this.fxi(Qa,nb))return 20;if(237279923===Zb){if(Kb.Ika)return 22;if(Kb.hasHyperlink||Kb.ula)return 21}}}}finally{qb&&qb.dispose()}return 0}VPf(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,!1,!1,this.DIi)}iIi(Qa,Zb,nb,Tb){Qa=C(Qa,Zb,nb,Tb,this.$.ya.UserSessionId);Qa.k=!0;z.b().Ze(45,Qa,!0)}R1i(Qa,Zb,nb,Tb,qb){var Kb=!1,jc=!1,Ac=Nb.nub,Jc=Nb.IPe+Nb.ZJa;Qa&&
(Jc+=Nb.pLa(Qa),cb.a.wq(Qa.ewaErrors)?(Ac=this.tdc(Qa.ewaErrors),cb.a.lh(Qa.ewaErrors,[-103190598])&&(Kb=!0)):Qa.message&&(Ac=Qa.message));jc||(jc=this.Qrd(Qa));Zb=C(Zb,nb,Tb,qb,this.$.ya.UserSessionId);Zb.k=!1;Zb.l=jc;Zb.n=Ac;Zb.p=Jc;Zb.q=Kb;z.b().Ze(45,Zb,!0);return Promise.reject(Qa)}fxi(Qa,Zb){const nb=Qa.Qj("CopyPasteInfrastructure.isRangeWithBottomOrRightBorder",new x.Range(Zb.top,Zb.right,Zb.bottom,Zb.right,!0,!0));for(;nb.$$mn();){let Tb=nb.$$cu();if(Tb&&Tb.Hwa())return e.ULS.sendTraceTag(509436432,
0,50,"CopyPasteInfrastructure.ShowInstantaneousFormattingFromRange: no instantaneous."),!0}for(Qa=Qa.Qj("CopyPasteInfrastructure.isRangeWithBottomOrRightBorder",new x.Range(Zb.bottom,Zb.left,Zb.bottom,Zb.right,!0,!0));Qa.$$mn();)if((Zb=Qa.$$cu())&&Zb.Cwa())return e.ULS.sendTraceTag(509436431,0,50,"CopyPasteInfrastructure.ShowInstantaneousFormattingFromRange: no instantaneous."),!0;return!1}T8g(Qa){switch(Qa){case 237279923:case 808159687:return m.EwaSettings.isChangeGateEnabled("OfficeVSO:7317055_PasteCse");
case -185374993:return!0;case 1804571062:return!0;default:return!1}}zrf(Qa){const Zb=ea(this.CK);if(!Zb)return!1;const nb=Zb.sourceItem;return nb&&!nb.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),!1):Zb.commandParameters.ribbonCommandInfo.command===Qa}MJj(Qa){return Qa&&Qa.lastCopy?xa(Qa.lastCopy,this.$):!0}r4e(Qa,Zb,nb,Tb,qb){const Kb={};Kb.a=this.$.ya.UserSessionId;Kb.e=Qa.stopwatch.id;
Kb.c=z.b().Ij(Qa.ribbonCommandInfo.command);Kb.b=l.a[Qa.ribbonCommandInfo.method];Kb.d=Qa.id;Kb.f=nb.toString();Kb.g=Tb.toString();Kb.h=Zb.toString();Kb.o=Qa.stopwatch.Fc;Kb.q=!1;Kb.r=Qa.copyPasteTargetType.toString();Kb.s=qb.encounteredDeploymentErrors;m.EwaSettings.getBooleanFeatureGate(ka.a.F9b,!1)&&(Kb.i=qb.commandParameters.dragDropIsShiftKeyDown,Kb.j=qb.commandParameters.isDragInsert);return Kb}M9a(Qa,Zb,nb,Tb,qb){Qa=this.r4e(Qa,Zb,nb,Tb,qb);Qa.k=!0;z.b().Ze(45,Qa,!0)}DGi(Qa,Zb,nb,Tb,qb,Kb,
jc,Ac,Jc){Qa=this.r4e(Qa,Zb,nb,Tb,Jc);Qa.k=!1;Qa.l=qb;Qa.n=Kb;Qa.p=jc;Qa.q=Ac;z.b().Ze(45,Qa,!0)}Ktf(Qa,Zb,nb,Tb,qb,Kb,jc,Ac,Jc){const hd={};hd.a=this.$.ya.UserSessionId;hd.b=Zb;hd.c=Qa;hd.f=nb;hd.e=Tb;hd.d=qb;hd.g=Kb;hd.h=jc;hd.i=Ac;hd.j=Jc.toString();z.b().Ze(46,hd,!0)}vGi(Qa,Zb){Qa=this.O3e(Qa.commandParameters,Qa);Qa.l=!0;Qa.j=Zb;z.b().Ze(43,Qa,!0)}uGi(Qa,Zb,nb,Tb,qb,Kb,jc){Qa=this.O3e(Qa,jc);Qa.l=!1;Qa.m=Zb;Qa.o=nb;Qa.y=Tb;Qa.x=qb;Qa.z=Kb;z.b().Ze(43,Qa,!0);e.ULS.sendTraceTag(537167776,0,15,
`CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName=${Qa.y},ErrorReason=${Qa.x},IsExpectedError=${Qa.m},IsSucceededWithAlert=${Qa.z},ErrorMessage=${Qa.o}`)}O3e(Qa,Zb){const nb={};nb.a=this.$.ya.UserSessionId;nb.f=Qa.stopwatch.id;nb.g=Qa.id;nb.c=z.b().Ij(Qa.ribbonCommandInfo.command);nb.b=l.a[Qa.ribbonCommandInfo.method];nb.q=Qa.stopwatch.Fc;nb.bd=Nb.Jcc();nb.bg=Qa.copyPasteHandlerName;nb.bj=void 0===Qa.ribbonCommandInfo.Ve||null===Qa.ribbonCommandInfo.Ve?null:w.a[Qa.ribbonCommandInfo.Ve];nb.bq=
Qa.uploadToClipService;nb.br=Qa.floatingObjectType;nb.s=Qa.copyPasteTargetType.toString();nb.bc=bb(Qa.copyPasteTargetType);nb.z=!1;if(Zb){nb.bk=Zb.id;nb.bl=Zb.serverRequestTimeInMs;Zb.requestTelemetryData&&(nb.bm=Zb.requestTelemetryData.EcsOperationDuration,nb.bn=Zb.requestTelemetryData.EcsRequestDuration,nb.bo=Zb.requestTelemetryData.WfeRequestDuration);nb.d=Zb.sourceItem?Zb.sourceItem.toString():null;nb.e=-1;if(G(Zb.sourceItem)){nb.e=0;Qa=Zb.sourceItem.ranges;for(const Tb of Qa)nb.e+=Tb.hw}nb.h=
Zb.isAsyncCopy;nb.i=Zb.isFromCache;nb.k=Zb.isSelectionAllowed;nb.r=Zb.plainTextPayloadSize;nb.u=Zb.htmlPayloadSize;nb.v=Zb.htmlSizeExceedsLimit;nb.w=Zb.copyTotalSizeExceedsLimit;nb.t=Zb.shadowWorkbookPayloadSize;nb.p=Zb.clientSideCopyTime;nb.ba=Zb.encounteredDeploymentErrors;nb.bb=Zb.shadowWorkbookSizeExceedsLimit;nb.be=Zb.syncClipboardItemsKeys;nb.bf=Zb.asyncClipboardItemsKeys;nb.bh=this.nIe(Zb.succeededPopulatingSystemClipboardSync);nb.bi=this.nIe(Zb.succeededPopulatingSystemClipboardAsync)}return nb}nyc(Qa,
Zb=!1){if(!this.gridView.eb&&!this.gridView.ei){var nb=this.gridView.ha.ra,Tb=!Zb&&1===Qa.length&&P.R(Qa,nb.selectedRanges),qb=Tb?nb.activeCell:Qa[0].topLeft;Qa[0].contains(qb)||(e.ULS.shipAssertTag(537167775,0,!1,`CopyPasteInfrastructure.SelectPastedRange: SelectedRanges ${nb.selectedRanges}, IndexOfActiveRange ${nb.Mq}, ActiveCell ${nb.activeCell}, calculatedDestinationRanges ${Qa}, keepThePreviousActiveCell ${Tb}, newActiveCell ${qb}, isPasteCommandFromRecoveryUI ${Zb}`),qb=Qa[0].topLeft);this.gridView.ha.JD(Qa,
0,qb,0,void 0,"CopyPasteInfrastructure.SelectPastedRange")}}N7e(Qa,Zb){const nb={};nb.a=this.$.ya.UserSessionId;nb.g=Qa.stopwatch.id;nb.t=Qa.stopwatch.Fc;nb.bz=!1;Zb&&(nb.bv=Zb.id,nb.bw=Zb.serverRequestTimeInMs,nb.n=Zb.commandParameters.clipboardFormatReadTimes,nb.o=Zb.commandParameters.clipboardFormatReadStatus,nb.p=Zb.commandParameters.clipboardReadPermissionPromptShown,nb.q=Zb.commandParameters.asyncApiReadTimedOut,Zb.requestTelemetryData&&(nb.cb=Zb.requestTelemetryData.EcsOperationDuration,nb.cc=
Zb.requestTelemetryData.EcsRequestDuration,nb.cd=Zb.requestTelemetryData.WfeRequestDuration));nb.x=Qa.copyPasteTargetType.toString();nb.bl=bb(Qa.copyPasteTargetType);nb.br=Qa.copyPasteHandlerName;nb.i=P.i(Qa.expandDestinations,",",this.$,!1);nb.h=P.i(Qa.originalDestinations,",",this.$,!1);nb.e=Qa.id;nb.d=Qa.commandType;nb.c=z.b().Ij(Qa.ribbonCommandInfo.command);nb.b=l.a[Qa.ribbonCommandInfo.method];nb.bf=!1;nb.bg=!1;nb.bp=Nb.Jcc();nb.bt=void 0===Qa.ribbonCommandInfo.Ve||null===Qa.ribbonCommandInfo.Ve?
null:w.a[Qa.ribbonCommandInfo.Ve];nb.cj=Qa.isPasteCommandFromEnterShortcut;if(nb.ca=Qa.isPasteCommandFromRecoveryUI)nb.cf=Qa.pasteRecoveryUndoStopwatch.id,nb.cg=Qa.pasteRecoveryUndoStopwatch.Fc;if(Zb){if((Qa=Zb.copyContextSnapshot)&&!Zb.wasLastCopyExternal){nb.f=Qa.commandParameters.id;nb.j=Qa.sourceItem.toString();nb.k=-1;if(G(Qa.sourceItem)){nb.k=0;const Tb=Qa.sourceItem.ranges;for(const qb of Tb)nb.k+=qb.hw}nb.bg=1===Qa.commandParameters.commandType}else Zb.clipboardItems?nb.f=Zb.clipboardItems.getItem(O.jtb):
e.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");nb.bz=Zb.pasteRecoveryUIDisplayed;nb.ci=Zb.cseStatus}else e.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");return nb}PHi(Qa,Zb,nb,Tb,qb,Kb,jc,Ac,Jc){Qa=this.N7e(Qa,Ac);Qa.l=!1;Qa.m=Zb;Qa.s=nb;Qa.bc=Tb;Qa.be=qb;Qa.bd=Kb;Qa.bf=jc;Ac?(Qa.y=N(Ac)||!Ac.copyContextSnapshot,Qa.bi=!Qa.y&&xa(Ac.copyContextSnapshot,this.$),Qa.bj=Ac.shadowWorkbookSizeExceedsLimit,
Qa.v=Ac.shadowWorkbookPayloadSize,Qa.w=Ac.htmlPayloadSize,Qa.bq=Za(Ac.clipboardItems),Qa.bb=Ac.activeSelectionType,Qa.bs=Ac.isSameSession,Qa.bn=Ac.payloadOrigin,Qa.bo=Ac.payloadType,Qa.bu=Ac.externalAppSource,Qa.bx=Ac.indicationDisplayScheduled,Qa.by=Ac.pasteIndicationDisplayStatus,Qa.ck=Ac.pasteDestinationHasMergedCells):Qa.bi=xa(Jc,this.$);z.b().Ze(44,Qa,!0);e.ULS.sendTraceTag(537167772,0,15,`CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName=${Qa.be},ErrorReason=${Qa.bd},IsExpectedError=${Qa.m},IsSucceededWithAlert=${Qa.bf},ErrorMessage=${Qa.s}`)}QHi(Qa){const Zb=
this.N7e(Qa.commandParameters,Qa);Zb.y=Qa.wasLastCopyExternal;Zb.l=!0;Zb.u=Qa.plainTextPayloadSize;Zb.v=Qa.shadowWorkbookPayloadSize;Zb.w=Qa.htmlPayloadSize;Zb.z=Qa.isClipboardDataContainShadowWorkbook;Zb.ba=Qa.isShadowWorkbookParsedSuccessfully;Zb.bb=Qa.activeSelectionType;Zb.bc=Qa.pasteResult;Zb.bh=Qa.encounteredDeploymentErrors;Zb.bj=Qa.shadowWorkbookSizeExceedsLimit;Zb.bk=W(Qa);Zb.bq=Za(Qa.clipboardItems);Zb.bs=Qa.isSameSession;Zb.bn=Qa.payloadOrigin;Zb.bo=Qa.payloadType;Zb.bu=Qa.externalAppSource;
Zb.bx=Qa.indicationDisplayScheduled;Zb.by=Qa.pasteIndicationDisplayStatus;Zb.ck=Qa.pasteDestinationHasMergedCells;Zb.bm=Qa.clipboardItems?Qa.clipboardItems.getItem(O.L7g):null;Zb.bi=!Qa.isSameSession&&!Qa.wasLastCopyExternal;z.b().Ze(44,Zb,!0)}Gj(){this.$.ua.Yf(this.rj);this.$.ua.tQg(this.Iqc);this.$.userOperationManager.jr(this.AR);this.$.hl(this.od);Y.h(this.$).Xb.gl(this.Iza)}Xj(){this.$&&this.$.ua&&(this.$.ua.yg(this.rj),this.$.ua.Roj(this.Iqc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.ao(this.AR);
this.gridView&&this.gridView.Xb&&this.gridView.Xb.Zk(this.Iza)}BHb(Qa,Zb){var nb=null;let Tb=!1;var qb=null;let Kb="UnknownFailure",jc=-1,Ac=Nb.nub,Jc=Nb.pasteErrorName+Nb.ZJa,hd=!1;this.pasteIndicationManager.und(Qa.id);this.pasteDestinationHasMergedCells(Qa.expandDestinations)&&(Zb.pasteContext.pasteDestinationHasMergedCells=!0);const Cd=ea(this.CK);(Qa.clearStateOnFinish||Qa.clearSystemClipboard)&&this.pr("Paste/fail/"+l.a[Qa.ribbonCommandInfo.method],!0,void 0,void 0,Qa.copyPasteTargetType).catch(()=>
{});if(Zb){jc=Zb.reason;Jc+=Nb.pLa(Zb);Zb.message&&(Ac=Zb.message);if(nb=Nb.$ch(Zb))if(1===nb.pasteErrorName)Tb=!0,Kb="CopyPasteLengthTooLongPopup",Ac=qb="The pasted content is too long. Popup a dialog to the user.",e.ULS.sendTraceTag(25216992,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${qb}, copyPasteTargetType="${Qa.copyPasteTargetType}"`),nb=cb.a.hd(1,0,26,690,0,1306609195,"CopyPasteOversizeError"),m.EwaSettings.jy()?new $a.a(this.$,nb):(nb=new pa.ErrorDialog(this.$,nb),nb.initialize(),nb.fg());
else if(7===nb.pasteErrorName)Tb=!0,Kb="No-Op",Ac=qb="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",e.ULS.sendTraceTag(33948251,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${qb}, copyPasteTargetType="${Qa.copyPasteTargetType}"`);else if(8===nb.pasteErrorName)Tb=!0,Kb="UseShortcutsPopup",Ac=qb="Unable to paste content from the system clipboard. Popup dialog to the user.",e.ULS.sendTraceTag(25216994,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${qb}, copyPasteTargetType="${Qa.copyPasteTargetType}"`),
this.VPf();else if(18===nb.pasteErrorName){Tb=!0;Kb="PasteExternalNotSupportMultipleSelectionPopup";Ac="Paste external not support multiple selection.";qb="Unknown";var ac=2192;100!==nb.validationFailureReason&&(qb=La[nb.validationFailureReason],ac=Nb.fIe(nb.validationFailureReason));this.aAa(ac,qb,!0)}else 20===nb.pasteErrorName||19===nb.pasteErrorName?(Tb=!0,20===nb.pasteErrorName?(Kb="PasteAcrossSessionNotSupportMultipleSelectionPopup",Ac="Paste across session does not support multiple selection."):
(Kb="PasteInSameSessionNotSupportMultipleSelectionPopup",Ac="This kind of multiple selection is not supported for same session paste."),qb="Unknown",ac=2192,100!==nb.validationFailureReason&&(qb=La[nb.validationFailureReason],ac=Nb.fIe(nb.validationFailureReason)),nb=6===nb.validationFailureReason,this.n2c(Qa.commandType,Qa.expandDestinations)&&nb&&this.nyc(Qa.expandDestinations),this.aAa(ac,qb,!0)):6===nb.pasteErrorName?(Tb=!0,Kb="No-Op",Ac=qb="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",
e.ULS.sendTraceTag(36263241,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${qb}, copyPasteTargetType="${Qa.copyPasteTargetType}"`)):17===nb.pasteErrorName?(Tb=!0,Kb="No-Op",Ac=qb="Paste text on Art is not yet a supported operation",e.ULS.sendTraceTag(0,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${qb}, copyPasteTargetType="${Qa.copyPasteTargetType}"`)):16===nb.pasteErrorName?(Tb=!0,Kb="No-Op",Ac=qb="Paste has failed because the previous copy has failed",nb=this.getStringifiedError(nb),e.ULS.sendTraceTag(537167771,
0,15,`CopyPasteInfrastructure.OnPasteFailed: ${qb}, copyPasteTargetType="${Qa.copyPasteTargetType}", error=${nb}`)):cb.a.wq(nb.ewaErrors)?(cb.a.i$(nb.ewaErrors)||cb.a.lh(nb.ewaErrors,cb.a.afc())?(Tb=!0,Kb="CommunicationError",qb=cb.a.qc(nb.ewaErrors),e.ULS.sendTraceTag(36304159,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ac} copyPasteTargetType="${Qa.copyPasteTargetType}"`)):cb.a.lh(nb.ewaErrors,Nb.zxj)?(Tb=!0,Kb="SavingWorkbookError",qb=cb.a.qc(nb.ewaErrors),e.ULS.sendTraceTag(36304160,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ac} copyPasteTargetType="${Qa.copyPasteTargetType}"`)):
cb.a.lh(nb.ewaErrors,Nb.operationSucceededWithAlert)&&(hd=Tb=!0,Kb="OperationSucceededWithAlert",qb=cb.a.qc(nb.ewaErrors),e.ULS.sendTraceTag(36304161,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ac} copyPasteTargetType="${Qa.copyPasteTargetType}"`)),Tb||(Ac=this.tdc(nb.ewaErrors),Tb=this.Qrd(Zb))):11===nb.pasteErrorName&&(Tb=!0,Kb="No-Op",Ac="Paste has failed because user try copy cross-session oart object");15===Zb.reason&&(Tb=!0,Kb="No-Op",Ac="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");
Ya.a.equals(Jc,E.B8j,!1)&&(Tb=!0,Kb="No-Op",Ac="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}Tb||(nb=Zb?this.getStringifiedError(Zb):"null",e.ULS.sendTraceTag(24150916,0,10,`CopyPasteInfrastructure.OnPasteFailed: ${nb}, copyPasteTargetType="${Qa.copyPasteTargetType}"`));this.PHi(Qa,Tb,Ac,Kb,Jc,jc,hd,Zb.pasteContext,Cd);return Promise.reject(Zb)}lrc(Qa,Zb){var nb,Tb,qb;e.ULS.sendTraceTag(24150917,0,50,`CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="${Zb.copyPasteTargetType}"`);
this.pasteIndicationManager.und(Zb.id);if(this.j9i(Zb.copyPasteTargetType,Qa)){m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.cB&&Qa.wasLastCopyExternal&&Qa.payloadType===L.shadowWorkbook&&(this.E8a=!0);let Kb=null;(null===(nb=Qa.pastedRange)||void 0===nb?0:nb.Ranges)&&0<Qa.pastedRange.Ranges.length?Kb=P.g(Qa.pastedRange.Ranges):Qa.wasLastCopyExternal||(Kb=Zb.expandDestinations);this.nzj(Qa,Kb);if(this.XLj(Qa,Kb)){let jc;nb=P.d(Zb.originalDestinations);
jc=1028===Zb.commandType?P.d(Zb.expandDestinations):P.d(Kb);let Ac=null;Qa.wasLastCopyExternal&&(Zb.isKeyboardEvent||Zb.isPasteCommandFromRecoveryUI)&&(Ac={[Nb.JOf]:Qa.clipboardItems});this.pasteDestinationHasMergedCells(Zb.expandDestinations)&&(Qa.pasteDestinationHasMergedCells=!0);Qa.pasteRecoveryUIDisplayed=!0;const Jc=new da(this.$,nb,jc,Ac),hd=va.GetServiceTaskFactory.Pa(this.$.da,406,405,0);Ea.TaskExtensions.za(hd,()=>{const Cd=hd.result;Cd.lZg(Jc);Cd.fPj(Zb.ribbonCommandInfo.method)},this.ka,
8)}nb=[237279923,-875588320,-185374993,-958589048];if(!Qa.pasteRecoveryUIDisplayed&&1===Kb.length&&nb.includes(null===(qb=null===(Tb=Qa.commandParameters)||void 0===Tb?void 0:Tb.ribbonCommandInfo)||void 0===qb?void 0:qb.command)&&(Tb=P.L(Kb),n.AFrameworkApplication.Qq("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&Tb)){qb=la.d(this.$.ua.na);const jc=new ua.a(Tb,qb);m.EwaSettings.isChangeGateEnabled("OfficeVSO:7666056_SVConsistentGridOnCut")?
this.pza(()=>{this.dEc(jc,"CutAndPaste")}):this.dEc(jc,"CutAndPaste")}}this.MEe("Paste/success/"+l.a[Zb.ribbonCommandInfo.method],Qa);this.QHi(Qa);this.Cag&&(!Zb.isKeyboardEvent||W(Qa))&&this.$.ea.Dg.get(66)&&(e.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),this.Cag=!1,this.Heh());return Promise.resolve(!0)}XLj(Qa,Zb){return!Zb||1!==Zb.length||Qa.commandParameters.clearSystemClipboard||Qa.commandParameters.clearStateOnFinish||Qa.commandParameters.skipClipboardAccess?
!1:N(Qa)&&(Zb=Qa.clipboardItems.getItem(O.plainText),Qa=Qa.clipboardItems.getItem(O.html),void 0===Zb||null===Zb||Zb.length>this.ALi||void 0===Qa||null===Qa||Qa.length>this.Sya)?(e.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),!1):!0}j9i(Qa,Zb){return 1===Qa||Zb.payloadType===L.plainText||m.EwaSettings.xa(151)&&Zb.payloadType===L.html||m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.cB&&Zb.payloadType===L.shadowWorkbook}pasteDestinationHasMergedCells(Qa){const Zb=Y.h(this.$).Ca.iz();if(!Zb||!Zb.length)return!1;for(const nb of Zb)if(nb.wu(Qa[0]))return!0;return!1}MEe(Qa,Zb){let nb;({lIa:nb}=this.fri(Zb)).returnValue&&this.pr(Qa,nb,void 0,void 0,Zb.commandParameters.copyPasteTargetType).catch(()=>{})}eab(Qa,Zb,nb,Tb,qb,Kb){const jc=Qa?this.getStringifiedError(Qa):"null";this.txa||e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${jc}`);
let Ac=!1,Jc=!1,hd=!1,Cd=Nb.nub,ac=Nb.IPe+Nb.ZJa;Qa&&(ac+=Nb.pLa(Qa),cb.a.wq(Qa.ewaErrors)?(Cd=this.tdc(Qa.ewaErrors),cb.a.lh(Qa.ewaErrors,Nb.operationSucceededWithAlert)&&(Ac=!0),cb.a.lh(Qa.ewaErrors,Nb.dragDropNonEmptyRange)&&(Jc=hd=!0)):Qa.message&&(Cd=Qa.message));hd||(hd=this.Qrd(Qa));Jc?this.gridView.ha.selectionType=-1:this.so.ijj(qb);this.txa&&!hd&&e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${jc}, copyPasteTargetType="${Zb.copyPasteTargetType}`);this.DGi(Zb,
nb,Tb,qb,hd,Cd,ac,Ac,Kb)}c2c(Qa,Zb){let nb=Qa;const Tb=this.P0h();if(null===Tb||void 0===Tb?0:Tb.ranges)nb=this.so.P3g(Zb,Tb.ranges,Qa);return nb}P0h(){const Qa=ea(this.CK);return Qa&&G(Qa.sourceItem)?Qa.sourceItem:null}ngj(){this.raiseEvent(Nb.bGd,null)}nzj(Qa,Zb){const nb=Qa.commandParameters.originalDestinations;Zb&&(P.R(this.gridView.ha.ra.selectedRanges,nb)?(this.nyc(Zb),Qa=ta.HelperMethods.sqb(Zb),e.ULS.sendTraceTag(537167767,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: ${Qa}`)):
Qa.commandParameters.isPasteCommandFromRecoveryUI?(this.nyc(Zb,!0),e.ULS.sendTraceTag(537167766,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: ${Zb}, active cell: ${Zb[0].topLeft}`)):(Qa=ta.HelperMethods.sqb(nb),e.ULS.sendTraceTag(537167765,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: ${Qa}`)))}fri(Qa){if(Qa.isPlainTextPaste||
Qa.isHtmlPaste||J(Qa)||Qa.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,lIa:!1};var Zb=Qa.copyContextSnapshot;if(Qa.commandParameters.clearStateOnFinish)return{returnValue:!0,lIa:!0};if(Zb&&G(Zb.sourceItem)){var nb=Zb.sourceItem;if(!nb.isFromCurrentSession(this.$))return{returnValue:!1,lIa:!0};Zb=-1985798686===Zb.commandParameters.ribbonCommandInfo.command;if(!(1<nb.ranges.length||1<Qa.commandParameters.expandDestinations.length)){const Tb=P.L(nb.ranges);Qa=P.L(Qa.commandParameters.expandDestinations);
const qb=this.$.ea.na.sheetName;nb=nb.sheetName;if(nb===qb&&Qa.equals(Tb))return{returnValue:!1,lIa:!0};if(nb===qb&&Qa.xe(Tb))return{returnValue:!0,lIa:!1}}return{returnValue:Zb,lIa:!0}}return{returnValue:!1,lIa:!0}}CLf(){var Qa=ea(this.CK);(Qa=this.so.Gyb(Qa))&&Qa.isFromCurrentSession(this.$)&&this.pr("OnStartEdit",!1).catch(()=>{})}tdc(Qa){Qa=cb.a.nYh(Qa,Nb.ZJa);return this.OMi+d.a.mu(Qa).toString()}Qrd(Qa){Qa=Nb.pLa(Qa);return!!Qa&&Ya.a.n3a(Qa,Nb.NMi)}Heh(){const Qa=cb.a.hd(1,2,327,328,h.a.kp?
329:h.a.MH?330:331,530046625,"ActivateLocalStorage"),Zb=Object(Wb.b)("OfficeVSO:7624544_ConvertBusinessBarManagerService")?Object(ja.c)(Ab.a.resolve(Jb.e,{Wb:0})):va.GetServiceTaskFactory.Pa(this.$.da,5,4,0);Ea.TaskExtensions.za(Zb,()=>{Zb.result.sh(43,Qa)},this.ka,3)}nIe(Qa){return void 0===Qa||null===Qa?wa.ZPi:Qa?wa.success:wa.failed}static $ch(Qa){const Zb=Qa.innerError;return Zb&&0!==Zb.pasteErrorName?Qa.innerError:null}static Mch(Qa){const Zb=Qa.innerError;return Zb&&0!==Zb.copyErrorName?Qa.innerError:
null}static pLa(Qa){let Zb="";if(!Qa)return Nb.BMe;Qa.errorName&&(Zb=Qa.errorName,Qa.innerError&&(Zb+=Nb.ZJa+Nb.pLa(Qa.innerError)));Zb||(Zb=Qa&&Qa.name?Qa.name:Nb.BMe);return Zb}static Jcc(){Nb.yb||(Nb.yb=fa.xQj);return Nb.yb}static fIe(Qa){switch(Qa){case 7:case 1:return 2199;case 5:return 2196;case 6:return 2195;case 8:case 3:case 2:case 4:case 9:case 10:return 2192;default:return e.ULS.shipAssertTag(537167764,0,!1,`CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = ${Qa}`),
2199}}static Nch(Qa){switch(Qa){case 3:return 2193;case 1:return 2194;case 2:case 4:return 2192;default:return e.ULS.shipAssertTag(537167763,0,!1,`CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = ${Qa}`),2199}}dEc(Qa,Zb){Ea.TaskExtensions.za(va.GetServiceTaskFactory.Pa(this.$.da,426,427,1),nb=>{void nb.result.Qea(Qa,Zb);e.ULS.sendTraceTag(512615303,0,50,"CopyPasteInfrastructure.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},
this.$.ka,3)}b5(){return this.gridView.Ca.hN(4,this.$.na)}pza(Qa){if(this.b5())Qa();else{const Zb=()=>{this.b5()&&(Qa(),this.gridView.QKb(Zb))};this.gridView.mpb(Zb)}}}Nb.gyf="EwaJsMetadataChangeListenerId";Nb.bGd="cpiOSC";Nb.Vnh="cpiDID";Nb.nub="Unknown";Nb.BMe="UnknownError";Nb.ZJa="_";Nb.IPe="DragAndDropError";Nb.pasteErrorName="PasteError";Nb.Y4g="CancelError";Nb.copyErrorName="CopyError";Nb.NMi="MergedCellOverlap";Nb.JOf="PasteRecoveryCachedClipboardItems";Nb.zxj=[1352631530,1679665408];Nb.operationSucceededWithAlert=
[-103190598];Nb.pasteDataLimitHit=[1306609195];Nb.copyThrottlingError=[-386183710];Nb.dragDropNonEmptyRange=[563945982];Nb.yb=null;Object(c.a)(Nb,"CopyPasteInfrastructure",u.a,[487,488,3]);class Ja{constructor(){this.j1a=this.ZEe=null}}Object(c.a)(Ja,"ClipboardPlatformInitializationResult",null,[]);var ab=a(197),wb=a(653),xb=a(559),rb=a(274),za=a(128),Aa=a(5),pb=a(63);const kb=(Qa,Zb,nb,Tb,qb,Kb,jc,Ac,Jc,hd=null)=>{Jc=Qa.Oa(9,Jc);Jc.sourceRanges=Zb;Jc.destinationRanges=nb;Jc.flags=Tb;return pb.g(Qa,
"PasteRange",Jc,qb,Kb,jc,Ac,64,hd)},Cb=(Qa,Zb,nb,Tb,qb,Kb,jc,Ac=null)=>{jc=Qa.Oa(1,jc);jc.pasteHtmlParameters=Zb;return pb.g(Qa,"PasteHtmlContent",jc,nb,Tb,qb,Kb,64,Ac)},ob=(Qa,Zb,nb,Tb,qb,Kb,jc,Ac,Jc=null)=>{Ac=Qa.Oa(9,Ac);Ac.destinationRange=Zb;Ac.source=nb;return pb.g(Qa,"PasteString",Ac,Tb,qb,Kb,jc,64,Jc)},qa=(Qa,Zb,nb,Tb,qb,Kb,jc=null,Ac=null)=>{jc=Qa.Oa(1,jc);jc.copyParameters=Zb;return pb.g(Qa,"Copy",jc,nb,Tb,qb,Kb,0,Ac)},ma=(Qa,Zb,nb,Tb,qb,Kb,jc=null,Ac=null)=>{jc=Qa.Oa(1,jc);jc.copyParameters=
Zb;return pb.g(Qa,"Cut",jc,nb,Tb,qb,Kb,0,Ac)},Ga=(Qa,Zb,nb,Tb,qb,Kb,jc=null,Ac=null)=>{jc=Qa.Oa(1,jc);jc.pasteParameters=Zb;return pb.g(Qa,"Paste",jc,nb,Tb,qb,Kb,64,Ac)};class vb{constructor(Qa,Zb,nb){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=Qa;this.destinationRange=Zb;this.pasteFlags=nb}}Object(c.a)(vb,"MacroRecorderPasteRangePayload",null,[123]);class Ka{constructor(Qa,Zb){this.content=this.destinationRange=null;this.destinationRange=Qa;this.content=Zb}getContent(){return this.content}}
Object(c.a)(Ka,"MacroRecorderPasteStringPayload",null,[123]);class Pa{constructor(Qa){this.pasteParameters=null;this.pasteParameters=Qa}}Object(c.a)(Pa,"MacroRecorderPastePayload",null,[123]);var fb=a(594),Wa=a(801),Ma=a(198),lb=a(33),Na=a(214),X=a(117),F=a(290);const na=(Qa,Zb,nb,Tb,qb,Kb,jc=null)=>{jc=Qa.Oa(41,jc);jc.insertCopiedCutCellsParameters=Zb;return pb.g(Qa,"InsertCopiedCutCells",jc,nb,Tb,qb,Kb,4)},hb=(Qa,Zb,nb,Tb,qb,Kb,jc=null)=>{jc=Qa.Oa(41,jc);jc.insertCopiedCutCellsParameters=Zb;return pb.g(Qa,
"InsertCopiedCutCellsV2",jc,nb,Tb,qb,Kb,0)};class Ib{constructor(Qa){this.parameters=null;this.parameters=Qa}getParameters(){return this.parameters}}Object(c.a)(Ib,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[123]);var vc=a(379);class nc{constructor(Qa,Zb,nb,Tb,qb,Kb,jc,Ac,Jc){this.destinationRange=Qa;this.jtb=nb;this.c9i=Tb;this.Ud=qb;this.uRb=Kb;this.pasteContext=jc;this.M4b=Ac;this.vig=Jc}}Object(c.a)(nc,"PasteHtmlRequestParams",null,[]);class Pb{constructor(Qa,Zb){this.Ulc=this.jOa=null;
this.oQa=ka.a.oQa;this.sHd=ka.a.sHd;this.rFb=ka.a.rFb;this.Hic=m.EwaSettings.getBooleanFeatureGate(ka.a.t7b,!1);this.Fui=m.EwaSettings.isChangeGateEnabled("OfficeVSO:7316963_InsertCopiedCutCellsV2Enabled");this.oqd=!1;this.Cxa=m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.Aui=m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimitsForPasteString",!1);this.Fz=(nb,Tb)=>{if(2===Tb.Uq)this.Jv.clear(),this.jOa=null;else if(1===
Tb.Uq&&this.Jv&&this.Jv.contains(Tb.Gf)){nb=za.a(Tb.Gf.operation.operationName);const qb=Tb.Gf.dequeueUtcTime.getTime()-Tb.Gf.enqueueUtcTime.getTime();e.ULS.sendTraceTag(526758673,0,50,`CopyPasteUtils.OnQueueChanged: web method ${nb} returned, it took ${qb} milliseconds to complete.`);this.Jv.remove(Tb.Gf);this.jOa=null}};this.$=Qa;this.gridView=Zb;this.oqd&&(this.$.userOperationManager.jr(this.Fz),this.Jv=new ab.a)}get Sya(){return this.Cxa?m.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",
this.$.ya.CopyPasteMaxPayloadLength):t.a.Sya}copy(Qa,Zb,nb,Tb=null,qb=null){const Kb=this.$.pa.va.$b();this.oqd&&this.hY();this.Ulc=Kb.ClientRequestId;var jc=new Ma.a(505,0,(Ac,Jc,hd)=>{const Cd={CopyPasteTargetType:1};Cd.SourceRanges=Qa;Cd.CopyOperationId=Zb.id;e.ULS.sendTraceTag(537167756,0,50,`CopyPasteInfrastructure.Copy served from CopyPasteProxy : ${this.Cxa}, CopyOperationId : ${Cd.CopyOperationId}`);return this.jOa=this.Cxa?qa(this.$.pa.ov,Cd,F.b(Ac,nb),Tb?F.a(Jc,Tb):Jc,hd,Zb.ribbonCommandInfo,
Kb,qb):qa(this.$.pa.va,Cd,F.b(Ac,nb),Tb?F.a(Jc,Tb):Jc,hd,Zb.ribbonCommandInfo,Kb,qb)},80);jc=this.$.userOperationManager.Oc(jc,Zb.ribbonCommandInfo);this.oqd&&this.Jv.add(jc)}IOf(Qa,Zb,nb,Tb,qb,Kb){return new Promise((jc,Ac)=>{var Jc;const hd=Kb.commandParameters.stopwatch.Fc;let Cd=2;20===Kb.commandParameters.commandType&&(Cd=16);36===Kb.commandParameters.commandType&&(Cd=32);68===Kb.commandParameters.commandType&&(Cd=64);lb.a.zvd(this.$)&&1028===Kb.commandParameters.commandType&&(Cd=1024);let ac=
null;if(null===(Jc=Kb.copyContextSnapshot)||void 0===Jc?0:Jc.commandParameters)ac=Kb.copyContextSnapshot.commandParameters.id;Pb.WRd(this.$,Qa,Tb,Zb,nb,null,Lc=>{Pb.Cfc(Lc,Kb,jc,Ac,hd,this.$,null,!0,null,null)},Lc=>{Kb.serverRequestTimeInMs=Kb.commandParameters.stopwatch.Fc-hd;Lc=X.a.Ue(Lc.data);Ac(new Wa.a(5,Lc))},qb,Cd,ac,Kb.commandParameters.id)})}pasteRange(Qa,Zb,nb,Tb,qb,Kb,jc,Ac,Jc,hd){return new Promise((Cd,ac)=>{const Lc=jc.commandParameters.stopwatch.Fc;Pb.uAj(this.$,Qa,Zb,nb,Tb|-5&qb,rd=>
{Pb.Cfc(rd,jc,Cd,ac,Lc,this.$,null,!0,Jc,hd)},rd=>{jc.serverRequestTimeInMs=jc.commandParameters.stopwatch.Fc-Lc;rd=X.a.Ue(rd.data);rd=new Wa.a(5,rd);null===hd||void 0===hd?void 0:hd(rd);ac(rd)},Kb,Ac)})}ndj(Qa,Zb,nb,Tb,qb,Kb,jc){return(new Promise((Ac,Jc)=>{if(Zb)if(Zb.length>this.Sya){var hd=jc.clipboardItems.getItem(O.plainText);let Cd=-1;void 0!==hd&&null!==hd&&(Cd=hd.length);ka.a.Dkf&&Zb.length<this.sHd&&Zb.length>this.oQa&&(this.NPf(Zb),this.fW=new nc(Qa,Zb,nb,Tb,qb,Kb,jc,0,this.Jsc.length),
window.requestIdleCallback&&window.requestIdleCallback(()=>this.JHd()));e.ULS.sendTraceTag(42071712,0,15,`CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: ${Zb.length}, MaxHtmlImportLength: ${this.Sya}, PlainTextLength: ${Cd}`);Jc(new Wa.a(1))}else hd=new Ma.a(204,0,(Cd,ac,Lc)=>{this.$.vy();const rd=jc.commandParameters.stopwatch.Fc;Cd=F.b(Cd,ff=>{Pb.Cfc(ff,jc,Ac,Jc,rd,this.$,Zb,!1,null,null)});ac=F.a(ac,ff=>{jc.serverRequestTimeInMs=jc.commandParameters.stopwatch.Fc-
rd;ff=X.a.Ue(ff.data);Jc(new Wa.a(3,ff))});const Yd=this.$.pa.va.$b(),ie=P.v(Qa,this.$),Je={};Je.SourceHtml=Zb;Je.DestinationRanges=ie?P.s(ie):null;Je.CopyOperationId=nb;Je.PasteId=Tb;e.ULS.sendTraceTag(537167755,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.Cxa}. PasteId : ${Je.PasteId}`);return this.Cxa?Cb(this.$.pa.ov,Je,Cd,ac,Lc,null,Yd,Kb):Cb(this.$.pa.va,Je,Cd,ac,Lc,null,Yd,Kb)},65),this.$.userOperationManager.Oc(hd,qb);else Ac("")})).then(()=>{ka.a.Dkf&&
Zb.length>this.oQa&&(this.NPf(Zb),this.fW=new nc(Qa,Zb,nb,Tb,qb,Kb,jc,0,this.Jsc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.JHd()))})}NPf(Qa){const Zb=this.$.Mb.Kc("Task","pasteHtmlChunkOperation"),nb=Math.floor(Qa.length/this.oQa)+1;this.Jsc=Array(nb);let Tb=0;for(;Tb<nb;)this.Jsc[Tb]=Qa.substring(Tb*this.oQa,(Tb+1)*this.oQa),Tb++;e.ULS.sendTraceTag(523257954,0,50,`CopyPasteUtils.populatePasteChunks Time taken for chunking: ${Zb.Fc}`)}JHd(){this.b9i(this.fW.destinationRange,
this.Jsc[this.fW.M4b],this.fW.jtb,this.fW.c9i,this.fW.Ud,this.fW.uRb,this.fW.pasteContext,this.fW.M4b,this.fW.vig);this.fW.M4b++;this.fW.M4b<this.fW.vig&&window.requestIdleCallback(()=>this.JHd())}b9i(Qa,Zb,nb,Tb,qb,Kb,jc,Ac,Jc){const hd=new Ma.a(204,0,(Cd,ac,Lc)=>{const rd=jc.commandParameters.stopwatch.Fc;Cd=F.b(Cd,()=>{e.ULS.sendTraceTag(512313415,0,15,`CopyPasteUtils.pasteHtmlServerCall succeeded serverRequestTimeInMs:${jc.commandParameters.stopwatch.Fc-rd},
             pasteid:${Tb},
             chunkIndex:${Ac},
             totalChunks:${Jc}`)});ac=F.a(ac,()=>{jc.serverRequestTimeInMs=jc.commandParameters.stopwatch.Fc-rd;e.ULS.sendTraceTag(512313414,0,15,`CopyPasteUtils.pasteHtmlServerCall failed serverRequestTimeInMs:${jc.serverRequestTimeInMs},
               pasteid:${Tb},
               chunkIndex:${Ac},
               totalChunks:${Jc}`)});const Yd=this.$.pa.va.$b();var ie=P.v(Qa,this.$);ie={SourceHtml:Zb,DestinationRanges:ie?P.s(ie):null,CopyOperationId:nb,PasteId:`${Tb}_chunk_${Ac}`,ChunkIndex:Ac,TotalChunks:Jc};e.ULS.sendTraceTag(523257952,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.Cxa}. PasteId : ${ie.PasteId}`);return Cb(this.$.pa.ov,ie,Cd,ac,Lc,null,Yd,Kb)},65);this.$.userOperationManager.Oc(hd,qb)}odj(Qa,Zb,nb,Tb,qb){return new Promise((Kb,jc)=>{e.ULS.sendTraceTag(537167754,
0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id=${qb.id}`);Zb&&(Zb=Ya.a.trimEnd(Zb,"\n","\r"));e.ULS.sendTraceTag(537167753,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id=${qb.id}`);if(Zb)if(Zb.length>this.rFb)e.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",Zb.length,this.rFb),jc(new Wa.a(1));
else{let Jc,hd;const Cd=P.v(Qa,this.$);e.ULS.sendTraceTag(537167752,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id=${qb.id}`);var Ac=!this.$.ea.isNamedObjectViewMode&&!Zb.includes("\n")&&!Zb.includes("\t");e.ULS.sendTraceTag(537167751,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id=${qb.id}. treatAsLink=${Ac}`);Ac=Ac&&Ya.a.cmf(Zb);e.ULS.sendTraceTag(537167750,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id=${qb.id}. treatAsLink=${Ac}`);
const ac=this.$.pa.va.$b();if(Ac){hd=526;e.ULS.sendTraceTag(537167749,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id=${qb.id}`);const Lc=Na.a.ped(Zb);e.ULS.sendTraceTag(537167748,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id=${qb.id}`);const rd=P.s(Cd);Ac=(Yd,ie,Je)=>{const ff=qb.commandParameters.stopwatch.Fc;Yd=F.b(Yd,Ae=>{e.ULS.sendTraceTag(537167747,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id=${qb.id}`);
qb.requestTelemetryData=Ae.RequestTelemetryData;qb.serverRequestTimeInMs=qb.commandParameters.stopwatch.Fc-ff;Ae.Errors&&0<Ae.Errors.length?jc(new Wa.a(2,Ae.Errors)):Kb(Zb)});ie=F.a(ie,Ae=>{qb.serverRequestTimeInMs=qb.commandParameters.stopwatch.Fc-ff;Ae=X.a.Ue(Ae.data);jc(new Wa.a(2,Ae))});this.$.vy();e.ULS.sendTraceTag(537167746,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id=${qb.id}`);return pb.b(this.$.pa.va,rd,Zb,Lc,!1,!1,63,Yd,ie,Je,Qa,
ac,Tb)};Jc=()=>new fb.a(rd,Zb,Lc)}else hd=180,Ac=(Lc,rd,Yd)=>{this.$.vy();const ie=qb.commandParameters.stopwatch.Fc;Lc=F.b(Lc,Je=>{e.ULS.sendTraceTag(537167745,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id=${qb.id}`);Pb.Cfc(Je,qb,Kb,jc,ie,this.$,Zb,!1,null,null)});rd=F.a(rd,Je=>{qb.serverRequestTimeInMs=qb.commandParameters.stopwatch.Fc-ie;Je=X.a.Ue(Je.data);jc(new Wa.a(4,Je))});e.ULS.sendTraceTag(537167744,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id=${qb.id}`);
return ob(this.Aui?this.$.pa.ov:this.$.pa.va,Cd,Zb,Lc,rd,Yd,null,ac,Tb)},Jc=()=>new Ka(Cd,Zb);e.ULS.sendTraceTag(537167715,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserWebMethodOperation. pasteContext.Id=${qb.id}`);Ac=new Ma.a(hd,0,Ac,65,Jc);e.ULS.sendTraceTag(537167714,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id=${qb.id}`);this.$.userOperationManager.Oc(Ac,nb)}else Kb("")})}Def(Qa,Zb){Zb=[1===Zb?4:5];this.gridView.Eb.CB(ua.a.qUa(la.d(this.$.na),
Qa),Zb,!0);this.gridView.Eb.$q(Zb);this.gridView.Eb.update(!0)}jgc(){const Qa=[4,5];this.gridView.Eb.Tj(Qa,!1,!1);this.gridView.Eb.Bk(null,Qa,!1);1===this.gridView.ha.Oe&&this.gridView.$q(!1,!1);this.gridView.Eb.update(!1,!1)}P3g(Qa,Zb,nb){const Tb=[];for(const qb of nb)Tb.push(this.V3g(Qa,Zb,qb));return Tb}hY(){if(this.Jv)for(let Qa of this.Jv)if(this.$&&this.$.userOperationManager){if(Qa.operation){const Zb=za.a(Qa.operation.operationName);e.ULS.sendTraceTag(526758675,0,50,`CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation ${Zb}.`)}this.W4g();
this.$.userOperationManager.rua(Qa)}}W4g(){if(this.jOa){const Qa=this.jOa.Xs;e.ULS.sendTraceTag(526758674,0,15,`Cancelling pending copy request with Id=${Qa}`);X.a.Wt(Qa);!m.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.Ulc&&pb.h(this.$.pa.va,this.Ulc,null,null,null);this.Ulc=this.jOa=null}}V3g(Qa,Zb,nb){e.ULS.shipAssertTag(537167713,0,!!Zb,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");e.ULS.shipAssertTag(537167712,0,0<Zb.length,
"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");let Tb=0,qb=0;var Kb=new Set;const jc=new Set;for(const Ac of Zb){Zb=`${Ac.left}_${Ac.right}`;const Jc=`${Ac.top}_${Ac.bottom}`;jc.has(Zb)||(jc.add(Zb),qb+=Ac.width);Kb.has(Jc)||(Kb.add(Jc),Tb+=Ac.height)}if(36===Qa)return nb.isSingle?Pb.lYe(qb,Tb,nb):nb.clone();516===Qa&&(Qa=Tb,Tb=qb,qb=Qa);Qa=!(nb.width%qb)&&!(nb.height%Tb);Kb=nb.g_&&!(nb.height%Tb);nb.v5&&!(nb.width%qb)||Kb?nb=Pb.lYe(qb,Tb,nb):Qa?nb=nb.clone():
(nb=nb.clone(),nb.bottom=Math.min(t.a.xg,nb.top+Tb-1),nb.right=Math.min(t.a.wg,nb.left+qb-1));return nb}rWg(Qa,Zb,nb,Tb,qb,Kb,jc,Ac,Jc,hd,Cd){if(!Tb||!Tb.length)return 1;if(1<Tb.length){if(!this.Hic&&Kb)return 3;if(hd)return 0;if(Ac)return 9;if(Jc)return 8;if(Cd)return 2;if(1<Zb.length)return 4;const ac=Zb[0];if(!jc&&!rb.a.all(Tb,Lc=>Lc.isSingle||!(Lc.width%ac.width)&&!(Lc.height%ac.height)))return 5;if((!this.Hic||!Kb)&&Ya.a.equals(Qa,nb,!0))for(const Lc of qb)if(Lc.vd(ac)&&!Lc.equals(ac))return 6}else if(Zb&&
0<Zb.length){if(0!==this.Hjf(Zb,Jc))return 7;if(1<Zb.length){if(!this.Hic&&Kb)return 3;if((!this.Hic||!Kb)&&Ya.a.equals(Qa,nb,!0))for(const ac of Zb)if(Qa=qb[0],ac.vd(Qa)&&!ac.equals(Qa))return 6}}return 0}Hjf(Qa,Zb){if(!Qa||1>=Qa.length)return 0;if(Zb)return 2;if(!P.T(Qa))return 1;Zb=new wb.a(xb.a.li());for(const nb of Qa)for(const Tb of Qa){const qb=nb.top===Tb.top&&nb.bottom===Tb.bottom,Kb=nb.left===Tb.left&&nb.right===Tb.right,jc=Math.max(nb.left,Tb.left)<Math.min(nb.right,Tb.right);if(Math.max(nb.top,
Tb.top)<Math.min(nb.bottom,Tb.bottom)&&!qb||jc&&!Kb)return 3;Zb.add(`${nb.top}-${nb.bottom}-${Tb.left}-${Tb.right}`);Zb.add(`${Tb.top}-${Tb.bottom}-${nb.left}-${nb.right}`)}for(const nb of Qa)Zb.remove(`${nb.top}-${nb.bottom}-${nb.left}-${nb.right}`);return 0<Zb.count?3:0}ijj(Qa){const Zb=this.gridView.ha;Zb.updateSelection(Qa,Qa.topLeft,0);Zb.selectionType=-1}Gyb(Qa){if(null===Qa||void 0===Qa?0:Qa.sourceItem){if(!G(Qa.sourceItem))return null;if((Qa=Qa.sourceItem)&&P.db(Qa.ranges,!0))return Qa}return null}njc(Qa,
Zb){e.ULS.shipAssertTag(537167711,0,!!Qa,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return Zb&&Aa.a.dG in Zb||Qa.tabName?!1:1===Qa.method}static uAj(Qa,Zb,nb,Tb,qb,Kb,jc,Ac,Jc){const hd=Qa.pa.va.$b(Jc?{ima:!0,$ka:1}:{ima:!1,$ka:0});Jc=new Ma.a(506,0,(Cd,ac,Lc)=>{Qa.vy();return kb(Qa.pa.va,nb,Tb,qb,F.b(Cd,Kb),F.a(ac,jc),Lc,null,hd,Ac)},65,()=>new vb(nb,Tb,qb));Qa.userOperationManager.Oc(Jc,Zb)}static Cfc(Qa,Zb,nb,Tb,qb,Kb,jc=null,Ac,Jc,hd){e.ULS.sendTraceTag(537167710,
0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id=${Zb.id}`);Zb.requestTelemetryData=Qa.RequestTelemetryData;Zb.serverRequestTimeInMs=Zb.commandParameters.stopwatch.Fc-qb;cb.a.Zf(Qa.Errors)?cb.a.sha(Qa.Errors)?(Zb&&(Zb.encounteredDeploymentErrors=!0),Qa=cb.a.qc(Qa.Errors),e.ULS.sendTraceTag(537167707,0,15,`CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Qa}`)):
(Qa=new Wa.a(5,Qa.Errors),null===hd||void 0===hd?void 0:hd(Qa),Tb(Qa)):Qa.Result?(Tb=!!Qa&&!!Qa.RequestTelemetryData,Y.h(Kb).Dh.kma(Zb.commandParameters.stopwatch.id,Qa.StateId,Tb?Qa.RequestTelemetryData.EcsOperationDuration:0,Tb?Qa.RequestTelemetryData.EcsRequestDuration:0,Tb?Qa.RequestTelemetryData.WfeRequestDuration:0),Zb.pastedRange=Qa.Result.SheetMultiRange,e.ULS.sendTraceTag(537167708,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id=${Zb.id}`),
null===Jc||void 0===Jc?void 0:Jc(),nb(!0),m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&Ac&&(Zb=Zb.commandParameters.isDragDrop?9:6,(Kb=Kb.da.Ba(465))&&Kb.X0(Zb,Qa))):(e.ULS.sendTraceTag(537167709,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id=${Zb.id}`),nb(jc||!0))}static WRd(Qa,Zb,nb,Tb,qb,Kb,jc,Ac,Jc,hd,Cd,ac){const Lc=Qa.pa.va.$b(),rd=Pb.Lih(nb,
Tb,qb,hd,Cd,ac);nb=new Ma.a(503,0,(Yd,ie,Je)=>{Qa.vy();return Ga(Qa.pa.va,rd,F.b(Yd,jc),F.a(ie,Ac),Je,Kb,Lc,Jc)},65,()=>new Pa(rd));Qa.userOperationManager.Oc(nb,Zb)}static Lih(Qa,Zb,nb,Tb,qb,Kb){const jc={};jc.ShadowWorkbookBase64=Qa.shadowWorkbookBase64;jc.SourceRanges={};jc.SourceRanges.Ranges=Array(1);jc.SourceRanges.Ranges[0]={};jc.SourceRanges.Ranges[0].FirstRow=Qa.rangeRowStart;jc.SourceRanges.Ranges[0].LastRow=Qa.rangeRowEnd;jc.SourceRanges.Ranges[0].FirstColumn=Qa.rangeColumnStart;jc.SourceRanges.Ranges[0].LastColumn=
Qa.rangeColumnEnd;m.EwaSettings.getBooleanFeatureGate(ka.a.t7b,!1)?nb?jc.DestinationRanges=P.u(nb.SheetName,nb.NamedObjectName,P.g(nb.Ranges)):(e.ULS.sendTraceTag(537167706,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),jc.DestinationRanges=null):jc.DestinationRanges=Zb?P.s(Zb):null;jc.CopyPasteTargetType=1;jc.PasteType=Tb;jc.CopyOperationId=qb;jc.PasteId=Kb;jc.SourceClientPath=Qa.sourceClientPath;jc.SourceSheetName=Qa.sourceSheetName;jc.SourceWorkbookName=Qa.sourceWorkbookName;
if(!Qa.originalSourceRangesCountExceedsLimit&&Qa.originalSourceRanges&&0<Qa.originalSourceRanges.length&&1024===Tb){jc.OriginalSourceMultiRange={};Zb=Array(Qa.originalSourceRanges.length);for(nb=0;nb<Zb.length;++nb)Zb[nb]={},Zb[nb].FirstRow=Qa.originalSourceRanges[nb][0],Zb[nb].FirstColumn=Qa.originalSourceRanges[nb][1],Zb[nb].LastRow=Qa.originalSourceRanges[nb][2],Zb[nb].LastColumn=Qa.originalSourceRanges[nb][3];jc.OriginalSourceMultiRange.Ranges=Zb}return jc}static lYe(Qa,Zb,nb){nb=nb.clone();nb.height<
Zb&&(nb.bottom=Math.min(t.a.xg,nb.top+Zb-1));nb.width<Qa&&(nb.right=Math.min(t.a.wg,nb.left+Qa-1));return nb}CLj(Qa,Zb,nb){return(Qa=Y.h(Qa).tb.uh(nb))?Zb.width===Qa.usedRange.width&&nb.left===Qa.usedRange.left||nb.left===Qa.usedRange.left&&nb.right===Qa.usedRange.right&&0===nb.width%Zb.width:!1}BLj(Qa,Zb,nb){return(Qa=Y.h(Qa).tb.uh(nb))?Zb.height===Qa.usedRange.height&&nb.top===Qa.usedRange.top||nb.top===Qa.usedRange.top&&nb.bottom===Qa.usedRange.bottom&&0===nb.height%Zb.height:!1}executeInsertCopiedCutCellsOperation(Qa,
Zb,nb,Tb,qb,Kb=null,jc=null){const Ac={};Ac.InsertDirection=Tb;Ac.SourceRange=Qa;Ac.DestRange=Zb;Ac.CopyCutOperation=nb?0:1;const Jc=this.$.pa.va,hd=this.$.pa.va.$b(),Cd=()=>new Ib(Ac);return vc.a(this.$.userOperationManager,(ac,Lc,rd)=>this.Fui?hb(Jc,Ac,Kb?F.b(ac,Kb):ac,jc?F.a(Lc,jc):Lc,rd,hd):na(Jc,Ac,Kb?F.b(ac,Kb):ac,jc?F.a(Lc,jc):Lc,rd,null),ac=>new Ma.a(104,0,ac,void 0,Cd),qb,m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MoveTaskCompletionToQueueItemLevelByOptingIn",!1))}PPe(Qa,
Zb,nb,Tb,qb,Kb,jc,Ac){return new Promise((Jc,hd)=>{this.executeInsertCopiedCutCellsOperation(Zb,nb,Tb,qb,Kb,Cd=>{Qa.requestTelemetryData=Cd.RequestTelemetryData;if(Cd.Errors&&0<Cd.Errors.length){const ac=new Wa.a(21,Cd.Errors);null===Ac||void 0===Ac?void 0:Ac(ac);hd(new Wa.a(21,Cd.Errors))}else null===jc||void 0===jc?void 0:jc(),Jc(!0)},Cd=>{Cd=X.a.Ue(Cd.data);Cd=new Wa.a(21,Cd);null===Ac||void 0===Ac?void 0:Ac(Cd);hd(Cd)})})}}Object(c.a)(Pb,"CopyPasteUtils",null,[485]);var oc=a(499),Ic;(function(Qa){Qa[Qa.range=
0]="range";Qa[Qa.art=1]="art"})(Ic||(Ic={}));Object(c.b)("SourceItemType",Ic);var ec=a(96);class mb{constructor(Qa){this.afg={["SourceItemType.Range"]:0,["SourceItemType.Art"]:1};this.$Ob={};this.Xeg={["FloatingObjectType.Unknown"]:99,["FloatingObjectType.CardView"]:6,["FloatingObjectType.Chart"]:0,["FloatingObjectType.Group"]:7,["FloatingObjectType.Image"]:1,["FloatingObjectType.Ink"]:8,["FloatingObjectType.InteractiveReport"]:4,["FloatingObjectType.ModernOfficeExtension"]:3,["FloatingObjectType.Shape"]:5,
["FloatingObjectType.Slicer"]:2,["FloatingObjectType.Unsupported"]:100};this.N_c={["99"]:"FloatingObjectType.Unknown",["6"]:"FloatingObjectType.CardView",["0"]:"FloatingObjectType.Chart",["7"]:"FloatingObjectType.Group",["1"]:"FloatingObjectType.Image",["8"]:"FloatingObjectType.Ink",["4"]:"FloatingObjectType.InteractiveReport",["3"]:"FloatingObjectType.ModernOfficeExtension",["5"]:"FloatingObjectType.Shape",["2"]:"FloatingObjectType.Slicer",["100"]:"FloatingObjectType.Unsupported"};this.$eg={["RibbonCommand.Copy"]:-911352779,
["RibbonCommand.Cut"]:-1985798686};this.fQd={["-911352779"]:"RibbonCommand.Copy",["-1985798686"]:"RibbonCommand.Cut"};this.Zeg={["InputManager.InputMethod.NotDefined"]:-1,["InputManager.InputMethod.Unknown"]:0,["InputManager.InputMethod.Keyboard"]:1,["InputManager.InputMethod.Mouse"]:2,["InputManager.InputMethod.Touch"]:3,["InputManager.InputMethod.CrossSlide"]:9};this.Yka={};this.Yeg={["FrameMode.None"]:0,["FrameMode.Reading"]:1,["FrameMode.Edit"]:2};this.v4a={};this.bfg={["UILocation.Unknown"]:0,
["UILocation.UpperRibbon"]:1,["UILocation.Ribbon"]:2,["UILocation.QAT"]:3,["UILocation.Jewel"]:4,["UILocation.NavigationPane"]:5,["UILocation.KeyboardShortcut"]:6,["UILocation.StatusBar"]:7,["UILocation.Dialog"]:8,["UILocation.Floatie"]:9,["UILocation.NotificationBar"]:10,["UILocation.StandaloneCuiRoot"]:11,["UILocation.TaskPane"]:12,["UILocation.HeroDock"]:13,["UILocation.SingleLineRibbon"]:14,["UILocation.MultilineRibbon"]:15,["UILocation.Overflow"]:16,["UILocation.TellMe"]:17,["UILocation.FarPeripheralControls"]:18,
["UILocation.ContextMenu"]:19,["UILocation.DialogMenu"]:20,["UILocation.Header"]:21,["UILocation.FileMenu"]:22,["UILocation.Toolbar"]:26,["UILocation.Canvas"]:30};this.Mr={};this.$=Qa;this.Yka.notDefined="InputManager.InputMethod.NotDefined";this.Yka.unknown="InputManager.InputMethod.Unknown";this.Yka.keyboard="InputManager.InputMethod.Keyboard";this.Yka.mouse="InputManager.InputMethod.Mouse";this.Yka.touch="InputManager.InputMethod.Touch";this.Yka.crossSlide="InputManager.InputMethod.CrossSlide";
this.v4a.none="FrameMode.None";this.v4a.reading="FrameMode.Reading";this.v4a.edit="FrameMode.Edit";this.Mr.unknown="UILocation.Unknown";this.Mr.upperRibbon="UILocation.UpperRibbon";this.Mr.ribbon="UILocation.Ribbon";this.Mr.QAT="UILocation.QAT";this.Mr.jewel="UILocation.Jewel";this.Mr.navigationPane="UILocation.NavigationPane";this.Mr.keyboardShortcut="UILocation.KeyboardShortcut";this.Mr.statusBar="UILocation.StatusBar";this.Mr.dialog="UILocation.Dialog";this.Mr.floatie="UILocation.Floatie";this.Mr.notificationBar=
"UILocation.NotificationBar";this.Mr.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.Mr.taskPane="UILocation.TaskPane";this.Mr.heroDock="UILocation.HeroDock";this.Mr.singleLineRibbon="UILocation.SingleLineRibbon";this.Mr.multilineRibbon="UILocation.MultilineRibbon";this.Mr.overflow="UILocation.Overflow";this.Mr.tellMe="UILocation.TellMe";this.Mr.farPeripheralControls="UILocation.FarPeripheralControls";this.Mr.header="UILocation.Header";this.Mr.fileMenu="UILocation.FileMenu";this.Mr.contextMenu=
"UILocation.ContextMenu";this.Mr.dialogMenu="UILocation.DialogMenu";this.Mr.toolbar="UILocation.Toolbar";this.Mr.canvas="UILocation.Canvas";this.$Ob.range="SourceItemType.Range";this.$Ob.art="SourceItemType.Art"}serializeSourceItem(Qa){const Zb={};if(Qa&&Object.getType(Qa)===D)Zb.sheetName=Qa.sheetName,Zb.topArray=rb.a.map(Qa.ranges,nb=>nb.top),Zb.leftArray=rb.a.map(Qa.ranges,nb=>nb.left),Zb.bottomArray=rb.a.map(Qa.ranges,nb=>nb.bottom),Zb.rightArray=rb.a.map(Qa.ranges,nb=>nb.right),Zb.sessionStateId=
Qa.sessionStateId,Zb.sessionId=Qa.sessionId,Zb.sourceItemType=this.P5f(0);else if(Qa&&Object.getType(Qa)===I)Zb.activeFloatingObjectControlId=Qa.activeFloatingObjectControlId,Zb.sheetName=Qa.sheetName,Zb.sessionStateId=Qa.sessionStateId,Zb.sessionId=Qa.sessionId,Zb.floatingObjectType=this.WAj(Qa.type),Zb.sourceItemType=this.P5f(1);else return e.ULS.shipAssertTag(537167705,0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),null;return JSON.stringify(Zb)}serializeCommandParameters(Qa){if(!Qa)return e.ULS.shipAssertTag(537167704,
0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;const Zb={};Zb.id=Qa.id;Zb.commandType=Qa.commandType;Zb.copyPasteTargetType=Qa.copyPasteTargetType;Qa.ribbonCommandInfo&&(Zb.ribbonCommandName=this.eBj(Qa.ribbonCommandInfo.command),Zb.inputMethodName=this.ZAj(Qa.ribbonCommandInfo.method),Zb.frameModeName=this.XAj(Qa.ribbonCommandInfo.mode),Zb.uiLocationName=this.iBj(Qa.ribbonCommandInfo.Ve),Zb.tabName=Qa.ribbonCommandInfo.tabName);return JSON.stringify(Zb)}deserializeSourceItem(Qa){if(!Qa)return null;
try{const Zb=JSON.parse(Qa);if(!Zb)return e.ULS.shipAssertTag(537167703,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;let nb=null;switch(this.Zoh(Zb.sourceItemType)){case 0:nb=new D(this.$,this.Woh(Zb),Zb.sheetName,Zb.sessionStateId,Zb.sessionId);break;case 1:nb=new I(Zb.activeFloatingObjectControlId,Zb.sheetName,Zb.sessionStateId,Zb.sessionId,this.Toh(Zb.floatingObjectType))}return nb}catch(Zb){return e.ULS.sendTraceTag(537167702,0,10,`EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: ${Qa?
Qa.length:0}, errror: ${Zb}`),null}}deserializeCommandParameters(Qa){if(!Qa)return null;try{const Zb=JSON.parse(Qa);if(!Zb)return e.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),null;const nb=oa.a();nb.id=Zb.id;nb.ribbonCommandInfo=this.Yoh(Zb);nb.commandType=Zb.commandType;nb.copyPasteTargetType=Zb.copyPasteTargetType;return nb}catch(Zb){return e.ULS.sendTraceTag(537167700,0,10,`EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: ${Qa?
Qa.length:0}, errror: ${Zb}`),null}}Woh(Qa){const Zb=[];e.ULS.shipAssertTag(537167699,0,!!Qa.topArray&&0<Qa.topArray.length,`EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be ${Qa.topArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167698,0,!!Qa.leftArray&&0<Qa.leftArray.length,`EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be ${Qa.leftArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167697,0,!!Qa.bottomArray&&0<Qa.bottomArray.length,`EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be ${Qa.bottomArray?
"empty":"null"}.`);e.ULS.shipAssertTag(537167696,0,!!Qa.rightArray&&0<Qa.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be ${Qa.rightArray?"empty":"null"}.`);if(!(Qa.topArray&&Qa.leftArray&&Qa.bottomArray&&Qa.rightArray))return Zb;e.ULS.shipAssertTag(537167695,0,Qa.topArray.length===Qa.bottomArray.length&&Qa.topArray.length===Qa.leftArray.length&&Qa.topArray.length===Qa.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray(${Qa.topArray.length}), BottomArray(${Qa.bottomArray.length}), LeftArray(${Qa.leftArray.length}), RightArray(${Qa.rightArray.length}) should be the same.`);
const nb=Math.min(Qa.topArray.length,Qa.bottomArray.length,Qa.leftArray.length,Qa.rightArray.length);for(let Tb=0;Tb<nb;Tb++)Zb.push(new x.Range(Qa.topArray[Tb],Qa.leftArray[Tb],Qa.bottomArray[Tb],Qa.rightArray[Tb],!1,!1));return Zb}Yoh(Qa){return new ec.a(this.Xoh(Qa.ribbonCommandName),this.Voh(Qa.inputMethodName),this.Uoh(Qa.frameModeName),this.aph(Qa.uiLocationName),Qa.tabName)}eBj(Qa){return void 0!==Qa&&null!==Qa&&Qa.toString()in this.fQd?this.fQd[Qa.toString()]:(e.ULS.shipAssertTag(537167694,
0,!1,`EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${Qa}`),this.fQd["-911352779"])}Xoh(Qa){return Qa&&Qa in this.$eg?this.$eg[Qa]:(e.ULS.shipAssertTag(537167693,0,!1,`EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${Qa}`),-911352779)}ZAj(Qa){return void 0!==Qa&&null!==Qa&&l.a[Qa]in this.Yka?
this.Yka[l.a[Qa]]:(e.ULS.shipAssertTag(537167692,0,!1,`EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value ${Qa}`),this.Yka.unknown)}Voh(Qa){return Qa&&Qa in this.Zeg?this.Zeg[Qa]:(e.ULS.shipAssertTag(537167691,0,!1,`EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value ${Qa}`),0)}XAj(Qa){return void 0!==Qa&&null!==Qa&&oc.a[Qa]in this.v4a?this.v4a[oc.a[Qa]]:(e.ULS.shipAssertTag(537167690,0,!1,`EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value ${Qa}`),
this.v4a.edit)}Uoh(Qa){return Qa&&Qa in this.Yeg?this.Yeg[Qa]:(e.ULS.shipAssertTag(537167689,0,!1,`EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value ${Qa}`),2)}P5f(Qa){return void 0!==Qa&&null!==Qa&&Ic[Qa]in this.$Ob?this.$Ob[Ic[Qa]]:(e.ULS.shipAssertTag(537167688,0,!1,`EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value ${Qa}`),this.$Ob.range)}Zoh(Qa){return Qa&&Qa in this.afg?this.afg[Qa]:(e.ULS.shipAssertTag(537167687,0,!1,`EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value ${Qa}`),
0)}WAj(Qa){return void 0!==Qa&&null!==Qa&&Qa.toString()in this.N_c?this.N_c[Qa.toString()]:(e.ULS.shipAssertTag(537167686,0,!1,`EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value ${Qa}`),this.N_c["99"])}Toh(Qa){return Qa&&Qa in this.Xeg?this.Xeg[Qa]:(e.ULS.shipAssertTag(537167685,0,!1,`EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value ${Qa}`),99)}iBj(Qa){return void 0!==Qa&&null!==Qa&&w.a[Qa]in this.Mr?this.Mr[w.a[Qa]]:(e.ULS.shipAssertTag(36229129,
0,!1,`EnvironmentSerializationHelper.SerializeUILocation: got unexpected value ${Qa}`),this.Mr.ribbon)}aph(Qa){return Qa&&Qa in this.bfg?this.bfg[Qa]:(e.ULS.shipAssertTag(537167684,0,!1,`EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value ${Qa}`),2)}}Object(c.a)(mb,"EnvironmentSerializationHelper",null,[]);class Ob{}Ob.i3f="SameSession";Ob.vLe="CrossSession";Ob.lsf="LegacyCrossSession";Ob.external="External";Object(c.a)(Ob,"PayloadOrigin",null,[]);const Ta=Qa=>Qa?Qa.shadowWorkbookSizeExceedsLimit&&
void 0!==Qa.shadowWorkbookBlockedSize&&null!==Qa.shadowWorkbookBlockedSize?Qa.shadowWorkbookBlockedSize:Qa.shadowWorkbookBase64?Qa.shadowWorkbookBase64.length:0:0,sb=Qa=>Qa.shadowWorkbookSizeExceedsLimit?!0:Ta(Qa)>t.a.Wnc;class zb{constructor(Qa,Zb){this._name=Zb;this.$=Qa;this.Fm=v.a.instance;this.so=new Pb(Qa,Y.h(Qa))}get name(){return this._name}get Q_c(){return this.Fm.Ua(5)}shouldWaitForCopyToComplete(){return!1}onDeferredPasteStarted(){}onDeferredPasteCompleted(){}beforePaste(){}a1j(Qa){let Zb;
Zb=null;try{const nb=Qa.getItem(O.shadowWorkbook);if(!nb)return{returnValue:!1,H0:Zb};Zb=JSON.parse(nb);return{returnValue:this.MAi(Zb),H0:Zb}}catch(nb){return e.ULS.sendTraceTag(537167835,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+nb),{returnValue:!1,H0:Zb}}}MAi(Qa){return!!Qa&&(!!Qa.shadowWorkbookBase64||Qa.shadowWorkbookSizeExceedsLimit)&&void 0!==Qa.rangeRowStart&&void 0!==Qa.rangeRowEnd&&void 0!==Qa.rangeColumnStart&&void 0!==Qa.rangeColumnEnd}Hsc(Qa){Qa.wasLastCopyExternal=
!0;m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SetDefaultPaste",!1)&&this.$.shortcutKeyManager&&(Qa.commandParameters.commandType=-185374993===this.$.shortcutKeyManager.q8b?20:4);if(m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.cB&&516!==Qa.commandParameters.commandType&&1028!==Qa.commandParameters.commandType){var Zb=null;if(({H0:Zb}=this.a1j(Qa.clipboardItems)).returnValue)return Qa.isShadowWorkbookParsedSuccessfully=!0,this.a9i(Qa,
Zb)}if(516!==Qa.commandParameters.commandType&&36!==Qa.commandParameters.commandType){if(m.EwaSettings.xa(151)&&20!==Qa.commandParameters.commandType&&(Zb=Qa.clipboardItems.getItem(O.html),void 0!==Zb&&null!==Zb&&Zb&&Zb.trim()!==this.Q_c&&(Zb.startsWith("<")||h.a.Ff&&Zb.startsWith("\n<")))){const nb=Qa.clipboardItems.getItem(O.jtb);return this.Z8i(Qa,Zb,void 0===nb?null:nb)}return this.EOf(Qa)}return Promise.reject(new Wa.a(6))}a9i(Qa,Zb){e.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");
Qa.pasteResult="SystemClipboardShadowWorkbookPaste";Qa.payloadType=L.shadowWorkbook;Qa.payloadOrigin=Ob.external;Qa.shadowWorkbookPayloadSize=Ta(Zb);Qa.shadowWorkbookSizeExceedsLimit=sb(Zb);let nb=null,Tb=null;const qb=Qa.commandParameters.originalDestinations;m.EwaSettings.getBooleanFeatureGate(ka.a.t7b,!1)?nb=P.r(qb,this.$):Tb=P.v(P.L(qb),this.$);Zb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(Qa.originalSourceRangesCountExceedsLimit=Zb.originalSourceRangesCountExceedsLimit);if(Qa.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(537167833,
0,15,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length(${Qa.shadowWorkbookPayloadSize}) is over the limit(${t.a.Wnc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Zb.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new Wa.a(1));e.ULS.sendTraceTag(537167832,0,50,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId=${Qa.commandParameters.id}`);return this.so.IOf(Qa.commandParameters.ribbonCommandInfo,Tb,nb,Zb,
[Qa.commandParameters.stopwatch],Qa)}EOf(Qa){var Zb=Qa.clipboardItems.getItem(O.plainText);if(void 0!==Zb&&null!==Zb&&Zb.trim()===this.Q_c)return Promise.reject(new Wa.a(7));void 0!==Zb&&null!==Zb&&(Qa.plainTextPayloadSize=Zb.length);Qa.isPlainTextPaste=!0;Qa.pasteResult="SystemClipboardPaste";Qa.payloadOrigin=W(Qa)?Ob.lsf:Ob.external;Qa.payloadType=L.plainText;e.ULS.sendTraceTag(537167831,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id=${Qa.id}, PasteOperationId=${Qa.commandParameters.id}`);
Zb=this.so.odj(P.L(Qa.commandParameters.originalDestinations),Zb,Qa.commandParameters.ribbonCommandInfo,[Qa.commandParameters.stopwatch],Qa);e.ULS.sendTraceTag(537167830,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id=${Qa.id}`);return Zb}Z8i(Qa,Zb,nb){Qa.htmlPayloadSize=Zb.length;Qa.isHtmlPaste=!0;Qa.pasteResult="SystemClipboardHtmlPaste";Qa.payloadType=L.html;Qa.payloadOrigin=W(Qa)?Ob.lsf:Ob.external;e.ULS.sendTraceTag(42071711,0,50,`BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId=${Qa.commandParameters.id}`);
return this.so.ndj(P.L(Qa.commandParameters.originalDestinations),Zb,nb,Qa.commandParameters.id,Qa.commandParameters.ribbonCommandInfo,[Qa.commandParameters.stopwatch],Qa)}TKe(Qa){const Zb={};Qa&&(Zb.shadowWorkbookBase64=Qa.ShadowWorkbookBase64,Zb.shadowWorkbookSizeExceedsLimit=Qa.ShadowWorkbookSizeExceedsLimit,Zb.originalSourceRangesCountExceedsLimit=Qa.OriginalSourceRangesCountExceedsLimit,Zb.originalSourceRangesCount=Qa.OriginalSourceRangesCount,Zb.shadowWorkbookBlockedSize=Qa.ShadowWorkbookBlockedSize);
return Zb}Wog(Qa,Zb){const nb=N(Qa),Tb=32===(Qa.commandParameters.commandType&32),qb=1024===(Qa.commandParameters.commandType&1024);let Kb=!1,jc=null,Ac=null,Jc=!1;if(!nb){Kb=-1985798686===Qa.commandParameters.ribbonCommandInfo.command;var hd=Qa.copyContextSnapshot;if(Zb)Jc=!hd.sourceItem.isFromCurrentSession(this.$);else if(hd=this.so.Gyb(hd))jc=hd.ranges,Ac=hd.sheetName,Jc=!Qa.isSameSession}return this.so.rWg(Ac,jc,this.$.na.sheetName,Qa.commandParameters.originalDestinations,Qa.commandParameters.expandDestinations,
Jc,Tb,qb,Kb,Zb,nb)}}Object(c.a)(zb,"BaseCopyPasteHandler",null,[614,615,616]);class db{constructor(Qa){this.clipboardItems=this.key=null;this.M$=Qa}twa(Qa){return this.key&&this.key.isEqual(Qa)?this.createClipboardItems(this.clipboardItems):null}setValue(Qa,Zb){this.key=Qa;this.clipboardItems=this.createClipboardItems(Zb)}createClipboardItems(Qa){const Zb=this.M$.create();var nb=Qa.getItem(O.plainText);nb&&Zb.setItem(O.plainText,nb);(nb=Qa.getItem(O.shadowWorkbook))&&Zb.setItem(O.shadowWorkbook,nb);
(Qa=Qa.getItem(O.html))&&Zb.setItem(O.html,Qa);return Zb}}Object(c.a)(db,"CopyCache",null,[]);var jb=a(68);class Ub extends zb{constructor(Qa,Zb,nb,Tb,qb=null){super(Qa,Tb);this.Mdh=Zb;this.M$=nb;this.o6c=qb||new db(this.M$);this.gridView=Y.h(Qa);this.ha=this.gridView.ha;this.clipboardRangeFactory=Qa.da.Ba(169)}getSourceItem(){const Qa=P.d(this.gridView.ha.ra.selectedRanges);return new D(this.$,Qa,this.$.ea.na.sheetName,this.$.ea.se,this.$.ya.UserSessionId)}beforeSerialize(Qa){Qa.isSelectionAllowed=
!1;Qa.isAsyncCopy=!1;Qa.isFromCache=!1;Qa.encounteredDeploymentErrors=!1;Qa.plainTextPayloadSize=0;Qa.shadowWorkbookPayloadSize=0;Qa.htmlPayloadSize=0;Qa.clientSideCopyTime=0;const Zb=new Ba.a(this.$.ua),nb=Qa.sourceItem;Qa.isSelectionAllowed=rb.a.all(nb.ranges,Tb=>this.isSelectionAllowed(Zb,Tb));Qa.isSelectionAllowed&&this.so.Def(nb.ranges,Qa.commandParameters.commandType)}BNa(Qa){return this.gridView.Ca.R4()&&Y.j(this.gridView,Qa)}y9i(Qa,Zb,nb,Tb){let qb=!1,Kb=1===Zb.commandParameters.commandType,
jc=Tb[0].hw;1===nb.ranges.length&&1===Tb.length?m.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&Kb&&1!==jc&&jc!==nb.ranges[0].hw?Qa.cseStatus=17:qb=this.Mdh.r$c(Qa,P.L(nb.ranges),nb.sheetName,P.L(Qa.commandParameters.expandDestinations),this.$.ea.na.sheetName,Kb):Qa.cseStatus=5;qb&&Y.h(this.$).Dh.lS(Qa.commandParameters.stopwatch.id,jb.BasicTelemetryCalculator.WQ);return this.h9i(Qa,nb,P.u(this.$.na.sheetName,null,Tb),Zb.commandParameters.commandType,qb)}isSelectionAllowed(Qa,
Zb){return Qa.TCb(Zb,this.gridView)}h9i(Qa,Zb,nb,Tb,qb){Zb=P.u(Zb.sheetName,null,Zb.ranges);Qa.pasteResult="SameSessionPaste";Qa.payloadOrigin=Ob.i3f;Qa.payloadType=L.KKg;e.ULS.sendTraceTag(537167829,0,50,`BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId=${Qa.commandParameters.id}`);return this.so.pasteRange(Qa.commandParameters.ribbonCommandInfo,Zb,nb,Tb,Qa.commandParameters.commandType,[Qa.commandParameters.stopwatch],Qa,qb,null,null)}}Object(c.a)(Ub,"BaseRangeCopyPasteHandler",
zb,[]);var xd=a(36);class ne{constructor(Qa){this.uU=new xd.a(!0);this.$=Qa}onDeferredPasteStarted(Qa){this.uU.kb(Qa.id)||this.uU.add(Qa.id,!0);if(0<this.uU.count){const Zb=Object(Wb.b)("OfficeVSO:7624544_ConvertBusinessBarManagerService")?Object(ja.c)(Ab.a.resolve(Jb.e,{Wb:0})):va.GetServiceTaskFactory.Pa(this.$.da,5,4,0);Ea.TaskExtensions.za(Zb,()=>{Zb.result.sh(28,null)},this.$.ka,3)}}onDeferredPasteCompleted(Qa){const Zb=0<this.uU.count;this.uU.kb(Qa.id)&&this.uU.remove(Qa.id);if(Zb&&!this.uU.count){const nb=
Object(Wb.b)("OfficeVSO:7624544_ConvertBusinessBarManagerService")?Object(ja.c)(Ab.a.resolve(Jb.e,{Wb:0})):va.GetServiceTaskFactory.Pa(this.$.da,5,4,0);Ea.TaskExtensions.za(nb,()=>{nb.result.removeEntry(28)},this.$.ka,3)}}}Object(c.a)(ne,"DeferredPasteTracker",null,[]);var fe;(function(Qa){Qa[Qa.none=0]="none";Qa[Qa.loadClipboardFromServerFailed=1]="loadClipboardFromServerFailed";Qa[Qa.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";Qa[Qa.asyncCopyCanceled=3]="asyncCopyCanceled";
Qa[Qa.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(fe||(fe={}));Object(c.b)("CopyErrorType",fe);var Bd=a(948),Ue=a(1147);class mc extends Bd.a{constructor(Qa,Zb=null){super(fe[Qa]);this.copyErrorName=0;this.ewaErrors=null;this.copyErrorName=Qa;this.ewaErrors=Zb;if(null===Zb||void 0===Zb?0:Zb.length)this.innerError=new Ue.a(Zb,null)}}Object(c.a)(mc,"CopyInnerError",Bd.a,[]);class Fc extends Ub{constructor(Qa,Zb,nb,Tb=null){super(Qa,Zb,nb,"AcrossSessionRangeCopyPasteHandler",
Tb);this.uU=new ne(Qa)}serialize(Qa){const Zb=Qa.sourceItem,nb={};let Tb=this.o6c.twa(Zb);if(Tb)nb.synchronousResult=Tb,Qa.isFromCache=!0,Qa.clientSideCopyTime=Qa.commandParameters.stopwatch.Fc;else{let Kb=null;var qb=P.G(Zb.ranges);if(!lb.a.ylf()&&this.BNa(qb)){e.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");qb=this.clipboardRangeFactory.create(qb);try{Kb=qb.toString(),Tb=this.M$.create(),Tb.setItem(O.plainText,
Kb),this.o6c.setValue(Zb,Tb),nb.synchronousResult=Tb,Qa.clientSideCopyTime=Qa.commandParameters.stopwatch.Fc}finally{qb&&qb.dispose()}}else Qa.isAsyncCopy=!0,nb.synchronousResult=this.M$.create(),nb.synchronousResult.setItem(O.plainText,this.Q_c);nb.asynchronousResult=this.dhd(Qa,Zb,Kb)}Qa.syncClipboardItemsKeys=Za(nb.synchronousResult);return nb}shouldWaitForCopyToComplete(Qa){if(!Qa||!Qa.copyContextSnapshot)return e.ULS.sendTraceTag(537167907,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),
!1;e.ULS.shipAssertTag(537167906,0,!!this.$.ya,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");if(Qa.copyContextSnapshot.sessionId===this.$.ya.UserSessionId)return e.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),!1;e.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(Qa){this.uU.onDeferredPasteStarted(Qa)}onDeferredPasteCompleted(Qa){this.uU.onDeferredPasteCompleted(Qa)}deserialize(Qa){Qa.isClipboardDataContainShadowWorkbook=
!(void 0===Qa.clipboardItems.getItem(O.shadowWorkbook)||null===Qa.clipboardItems.getItem(O.shadowWorkbook));if(Y.h(this.$).ha.Oe&326)return N(Qa)&&(Qa.wasLastCopyExternal=!0),Promise.reject(new Wa.a(17));var Zb=this.Wog(Qa,!1);if(0!==Zb)return Promise.reject(new Wa.a(N(Qa)?18:Qa.isSameSession?19:20,void 0,void 0,void 0,Zb));var nb=Qa.copyContextSnapshot,Tb=this.so.Gyb(nb);if(N(Qa))return this.Hsc(Qa);Zb=Qa.commandParameters.originalDestinations;if(Tb&&Qa.isSameSession)return this.y9i(Qa,nb,Tb,Zb);
if(516!==Qa.commandParameters.commandType){if(({H0:nb}=this.$0j(Qa.clipboardItems)).returnValue){Qa.isShadowWorkbookParsedSuccessfully=!0;let qb=Tb=null;m.EwaSettings.getBooleanFeatureGate(ka.a.t7b,!1)?Tb=P.r(Zb,this.$):qb=P.v(P.L(Zb),this.$);return this.X8i(Qa,qb,Tb,nb)}if(Qa.isClipboardInaccessible)return Promise.reject(new Wa.a(8));if(36!==Qa.commandParameters.commandType)return this.EOf(Qa)}return Promise.reject(new Wa.a(6))}beforePaste(Qa){this.$.da.Ba(373).Txj(Qa);Qa.indicationDisplayScheduled=
!0}r0j(Qa){let Zb;if(!(Qa&&Qa.SourceRanges&&Qa.SourceRanges.Ranges&&Qa.SourceRanges.Ranges.length&&(Qa.OriginalSourceRangesCountExceedsLimit||Qa.OriginalSourceMultiRange&&Qa.OriginalSourceMultiRange.Ranges&&Qa.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,H0:null};var nb=Qa.SourceRanges.Ranges[0];if(!Qa.ShadowWorkbookBase64&&!Qa.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,H0:null};Zb=this.TKe(Qa);Zb.rangeRowStart=nb.FirstRow;Zb.rangeRowEnd=nb.LastRow;Zb.rangeColumnStart=
nb.FirstColumn;Zb.rangeColumnEnd=nb.LastColumn;Zb.sourceClientPath=Qa.SourceClientPath;Zb.sourceSheetName=Qa.SourceSheetName;Zb.sourceWorkbookName=Qa.SourceWorkbookName;if(!Qa.OriginalSourceRangesCountExceedsLimit)for(Qa=Qa.OriginalSourceMultiRange.Ranges,Zb.originalSourceRanges=Array(Qa.length),nb=0;nb<Qa.length;++nb)Zb.originalSourceRanges[nb]=[Qa[nb].FirstRow,Qa[nb].FirstColumn,Qa[nb].LastRow,Qa[nb].LastColumn];return{returnValue:!0,H0:Zb}}$0j(Qa){let Zb;Zb=null;Qa=Qa.getItem(O.shadowWorkbook);
if(!Qa)return{returnValue:!1,H0:Zb};Zb=JSON.parse(Qa);return{returnValue:this.LAi(Zb),H0:Zb}}LAi(Qa){return!!Qa&&(!!Qa.shadowWorkbookBase64||Qa.shadowWorkbookSizeExceedsLimit)&&void 0!==Qa.rangeRowStart&&void 0!==Qa.rangeRowEnd&&void 0!==Qa.rangeColumnStart&&void 0!==Qa.rangeColumnEnd}X8i(Qa,Zb,nb,Tb){e.ULS.shipAssertTag(537167903,0,!!Tb,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");n.AFrameworkApplication.pN("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");
Qa.pasteResult="CrossSessionPaste";Qa.payloadOrigin=Ob.vLe;Qa.payloadType=L.shadowWorkbook;Qa.shadowWorkbookPayloadSize=Ta(Tb);Qa.shadowWorkbookSizeExceedsLimit=sb(Tb);Tb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(Qa.originalSourceRangesCountExceedsLimit=Tb.originalSourceRangesCountExceedsLimit);if(Qa.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(34415003,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length(${Qa.shadowWorkbookPayloadSize}) is over the limit(${t.a.Wnc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Tb.shadowWorkbookSizeExceedsLimit}`),
Promise.reject(new Wa.a(1));if(1028===Qa.commandParameters.commandType&&Qa.originalSourceRangesCountExceedsLimit)return e.ULS.sendTraceTag(572617859,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count(${Tb.originalSourceRangesCount}) is over the limit(${t.a.BLi}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: ${Tb.originalSourceRangesCountExceedsLimit}`),Promise.reject(new Wa.a(1));e.ULS.sendTraceTag(537167902,0,50,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId=${Qa.commandParameters.id}`);
return this.so.IOf(Qa.commandParameters.ribbonCommandInfo,Zb,nb,Tb,[Qa.commandParameters.stopwatch],Qa)}dhd(Qa,Zb,nb){e.ULS.shipAssertTag(537167901,0,!!Qa,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");const Tb=Qa.commandParameters.stopwatch.Fc;return new Promise((qb,Kb)=>{e.ULS.sendTraceTag(26035421,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: ${Qa.id}`);const jc=P.u(Zb.sheetName,
null,Zb.ranges);this.so.copy(jc,Qa.commandParameters,Ac=>{Qa.requestTelemetryData=Ac.RequestTelemetryData;Qa.serverRequestTimeInMs=Qa.commandParameters.stopwatch.Fc-Tb;if(cb.a.Zf(Ac.Errors))if(cb.a.sha(Ac.Errors))Qa.encounteredDeploymentErrors=!0,Ac=cb.a.qc(Ac.Errors),e.ULS.sendTraceTag(537167898,0,15,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Ac}. copy Id: ${Qa.id}`);else{var Jc=cb.a.qc(Ac.Errors);
e.ULS.sendTraceTag(26035419,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Jc}. copy Id: ${Qa.id}`);Kb(new mc(2,Ac.Errors))}else if(e.ULS.sendTraceTag(537167900,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: ${Qa.id}`),Qa.markForCancellation)Kb(new mc(3,Ac.Errors));else{Jc=Ac.Result;var hd=Jc.PlainTextResult;void 0!==nb&&null!==nb&&(hd=nb);void 0!==hd&&null!==hd&&(Qa.plainTextPayloadSize=
hd.length);var Cd=this.M$.create();if(({H0:ac}=this.r0j(Jc)).returnValue){Qa.shadowWorkbookPayloadSize=Ta(ac);Qa.shadowWorkbookSizeExceedsLimit=sb(ac);Qa.originalSourceRangesCountExceedsLimit=Jc.OriginalSourceRangesCountExceedsLimit;var ac=JSON.stringify(ac);Cd.setItem(O.shadowWorkbook,ac)}Cd.setItem(O.plainText,hd);lb.a.ylf()&&(hd=Jc.HtmlResult,Qa.htmlSizeExceedsLimit=Jc.HtmlSizeExceedsLimit,void 0!==hd&&null!==hd&&(Qa.htmlPayloadSize=hd.length),Cd.setItem(O.html,hd));Qa.copyTotalSizeExceedsLimit=
Jc.CopyTotalSizeExceedsLimit;Cd.setItem(O.jtb,Qa.commandParameters.id);this.o6c.setValue(Zb,Cd);Qa.asyncClipboardItemsKeys=Za(Cd);qb(Cd);m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&(Jc=1===Qa.commandParameters.commandType?8:7,(Cd=this.$.da.Ba(465))&&Cd.X0(Jc,Ac))}},Ac=>{Qa.serverRequestTimeInMs=Qa.commandParameters.stopwatch.Fc-Tb;Ac=X.a.Ue(Ac.data);const Jc=cb.a.qc(Ac);e.ULS.sendTraceTag(537167897,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Jc}. copy Id: ${Qa.id}`);
Kb(new mc(2,Ac))},[Qa.commandParameters.stopwatch])})}}Object(c.a)(Fc,"AcrossSessionRangeCopyPasteHandler",Ub,[]);class bd{constructor(Qa,Zb,nb,Tb,qb,Kb=null,jc=null){this.floatingObjectId=Qa;this.commandParameters=Zb;this.Tt=nb;this.jmh=Tb;this.Taa=Kb;this.uRb=jc;this.Cdh=qb}}Object(c.a)(bd,"CopyArtRequest",null,[]);class de{constructor(Qa,Zb,nb,Tb,qb,Kb,jc,Ac,Jc){this.promise=null;this.ribbonCommandInfo=Qa;this.destination=Zb;this.uNe=nb;this.uRb=qb;this.H0=Kb;this.item=jc;this.pasteContext=Ac;
this.KOa=nb||Zb.FirstRow+"_"+Zb.FirstColumn;this.Ulf=!0;this.VEe=Jc}}Object(c.a)(de,"PasteArtRequest",null,[]);class Md{constructor(Qa,Zb){this.xLb=new V.a;this.G_a=Qa;this.$=Zb;this.Qdj=nb=>Promise.resolve(nb);this.BHb=nb=>Promise.reject(nb)}Zdi(Qa){if(this.owi(Qa.KOa)){e.ULS.sendTraceTag(537167681,5,50,`PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: ${Qa.KOa}`);const Zb=this.xLb.ma(Qa.KOa);this.xLb.ia(Qa.KOa,Qa);const nb=Zb.promise;Zb.Ulf=
!1;return this.Rvh(Qa,nb)}this.xLb.ia(Qa.KOa,Qa);return this.CDi(Qa)}owi(Qa){return this.xLb.kb(Qa)}CDi(Qa){return new Promise((Zb,nb)=>{Qa.promise=this.G_a.DOf(Qa).then(Tb=>{Zb(null);return this.lrc(Qa,Tb)},Tb=>{nb(null);return this.BHb(Tb)})})}Rvh(Qa,Zb){return new Promise((nb,Tb)=>{Qa.promise=Zb.then(qb=>{this.x6j(Qa,qb);return this.G_a.DOf(Qa).then(Kb=>{nb(null);return this.lrc(Qa,Kb)},Kb=>{Tb(null);return this.BHb(Kb)})},qb=>this.BHb(qb))})}lrc(Qa,Zb){Qa.Ulf&&(this.r8g(Qa.KOa),this.zRd(Qa,Zb));
return this.Qdj(Zb)}r8g(Qa){this.xLb.remove(Qa)}zRd(Qa,Zb){const nb=this.L6h();Qa.KOa===nb&&this.G_a.zRd(Qa.destination,Zb,Qa.item.type)}L6h(){var Qa=Y.h(this.$).ha.Sa.activeFloatingObjectControlId;Qa||(Qa=P.v(Y.h(this.$).ha.ra.activeCell,this.$),Qa=Qa.FirstRow+"_"+Qa.FirstColumn);return Qa}x6j(Qa,Zb){Qa.destination=null;Qa.uNe=Zb}}Object(c.a)(Md,"PasteArtRequestManager",null,[]);var se=a(207),tc=a(119),dd=a(109);class Hd extends zb{constructor(Qa,Zb,nb,Tb,qb=null){super(Qa,"ArtCopyPasteHandler");
this.k9g="XLO";this.l9g="3";this.uU=new ne(Qa);this.M$=Zb;this.G_a=nb;this.ha=Y.h(Qa).ha;this.n6c=qb||new db(this.M$);this.Y8i=new Md(nb,Qa);this.uqb=Tb}getSourceItem(){e.ULS.shipAssertTag(537167896,0,!!this.ha.Sa.activeFloatingObjectControlId,"Expecting a floating object to be currently selected for copy");e.ULS.sendTraceTag(537167895,0,50,`ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[${this.ha.Sa.activeFloatingObjectControlId}]`);return new I(this.ha.Sa.activeFloatingObjectControlId,
this.$.ea.na.sheetName,this.$.ea.se,this.$.ya.UserSessionId,this.ha.Sa.jc.floatingObject.type)}beforeSerialize(Qa){Qa&&Qa.commandParameters?(Qa?(Qa.isAsyncCopy=!1,Qa.isSelectionAllowed=!1,Qa.isFromCache=!1,Qa.plainTextPayloadSize=0,Qa.shadowWorkbookPayloadSize=0,Qa.htmlPayloadSize=0,Qa.htmlSizeExceedsLimit=!1,Qa.clientSideCopyTime=0,Qa.encounteredDeploymentErrors=!1,Qa.shadowWorkbookSizeExceedsLimit=!1,Qa.originalSourceRangesCountExceedsLimit=!1,Qa.copyTotalSizeExceedsLimit=!1):e.ULS.sendTraceTag(537167826,
0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),Qa.commandParameters.copyPasteTargetType=2):e.ULS.sendTraceTag(537167894,0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")}serialize(Qa){const Zb=Qa.sourceItem,nb={};if(!Zb)return e.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),nb;if(!this.uzi())return e.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),
nb;e.ULS.sendTraceTag(537167892,0,50,`ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[${Zb.activeFloatingObjectControlId}]`);this.HId();let Tb=this.n6c.twa(Zb);if(Tb)nb.synchronousResult=Tb,Qa.isFromCache=!0,Qa.isAsyncCopy=!1,Qa.clientSideCopyTime=Qa.commandParameters.stopwatch.Fc,1===Qa.commandParameters.commandType&&this.$.Yc(2045211913,Qa.commandParameters.ribbonCommandInfo.method,Qa.commandParameters.ribbonCommandInfo.Ve,null);else{Qa.isFromCache=!1;Qa.isAsyncCopy=
!0;Tb=this.M$.create();if(Qa.commandParameters.uploadToClipService){const qb={};qb["data-clipservice-ccpid"]=Qa.commandParameters.id;qb["data-pkey"]=Qa.commandParameters.pKey;qb["data-clipservice-type"]=Qa.commandParameters.clipServiceDataType;qb["data-clipservice-count"]=Qa.commandParameters.objectCount.toString();qb["data-clipservice-dc"]=Qa.commandParameters.clipServiceDataCenter;qb["data-clipservice-client"]=this.k9g;qb["data-TimeStamp"]=(new Date).toUTCString();qb["data-clipservice-version"]=
this.l9g;Tb.setItem(O.TSg,JSON.stringify(qb))}nb.synchronousResult=this.rMg(Tb);nb.asynchronousResult=this.dhd(Qa,Zb,Tb)}Qa.syncClipboardItemsKeys=Za(nb.synchronousResult);return nb}rMg(Qa){e.ULS.shipAssertTag(537167891,0,!!this.ha.Sa.jc,"Expecting a floating object to be currently selected for copy");Qa||(Qa=this.M$.create());const Zb=this.ha.Sa.jc.$wb();Zb&&Qa.setItem(O.html,`<img src='${Zb}'>`);return Qa}HId(){const Qa=this.ha.Sa.jc;this.uqb.HId(tc.a.vsb(Qa.floatingObject),tc.a.n9g(Qa.Eq))}shouldWaitForCopyToComplete(){e.ULS.sendTraceTag(537167890,
0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(Qa){this.uU.onDeferredPasteStarted(Qa)}onDeferredPasteCompleted(Qa){this.uU.onDeferredPasteCompleted(Qa)}deserialize(Qa){var Zb=N(Qa),nb=null;let Tb=null;var qb=!1;if(!Zb){nb=Qa.copyContextSnapshot;Tb=nb.sourceItem;if(!Tb)return Promise.reject(new Wa.a(10));qb=Tb.isFromCurrentSession(this.$)}var Kb=this.Wog(Qa,!0);if(0!==Kb)return Promise.reject(new Wa.a(Zb?18:qb?19:20,void 0,void 0,void 0,Kb));
if(Zb)return this.Hsc(Qa);if(!qb&&!Hd.Mri(Tb))return Qa=`User attempted to paste art of type [${Tb.type}] between sessions.`,e.ULS.sendTraceTag(537167889,0,50,Qa),Promise.reject(new Wa.a(11,void 0,void 0,Qa));if(nb.isAsyncSerializeFailed)return Promise.reject(new Wa.a(16,void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));let jc;try{const Ac=Qa.clipboardItems.getItem(O.shadowWorkbook);jc=JSON.parse(Ac)}catch(Ac){return Qa=copyPasteInfra.getStringifiedError(Ac),
e.ULS.sendTraceTag(537167888,0,10,`ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: ${Qa}`),Promise.reject(new Wa.a(12,void 0,Ac))}jc.floatingObjectId!==Tb.activeFloatingObjectControlId?e.ULS.sendTraceTag(537167887,0,10,`ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Tb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${jc.floatingObjectId}]`):e.ULS.sendTraceTag(537167886,
0,50,`ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Tb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${jc.floatingObjectId}]`);if(!jc||!jc.shadowWorkbookBase64)return Promise.reject(new Wa.a(13,void 0,void 0,`shadowWorkbookPayload is null = ${!jc}`));Qa.isShadowWorkbookParsedSuccessfully=!0;Qa.shadowWorkbookPayloadSize=Ta(jc);Qa.shadowWorkbookSizeExceedsLimit=sb(jc);Qa.payloadOrigin=qb?Ob.i3f:Ob.vLe;Qa.payloadType=L.Isg;
if(sb(jc))return Qa=`Shadow workbook size [${Qa.shadowWorkbookPayloadSize}] is over the limit [${t.a.Wnc}]. ShadowWorkbookSizeExceedsLimit: ${jc.shadowWorkbookSizeExceedsLimit}`,e.ULS.sendTraceTag(36304156,0,15,`ArtCopyPasteHandler.Deserialize: ${Qa}`),Promise.reject(new Wa.a(1,void 0,void 0,Qa));nb=Zb=null;Y.h(this.$).ha.Oe&326?nb=Y.h(this.$).ha.Sa.activeFloatingObjectControlId:Zb=this.$.na&&this.$.na.activeCell?P.v(this.$.na.activeCell,this.$):P.v(P.L(Qa.commandParameters.originalDestinations),
this.$);qb=null;if(this.uqb.aag(Tb))try{qb=this.uqb.r$c()}catch(Ac){Kb=copyPasteInfra.getStringifiedError(Ac),e.ULS.sendTraceTag(537167885,0,10,`ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: ${Kb}`)}return this.Y8i.Zdi(new de(Qa.commandParameters.ribbonCommandInfo,Zb,nb,Qa.commandParameters.commandType,[Qa.commandParameters.stopwatch],jc,Tb,Qa,qb))}Hsc(Qa){Qa.wasLastCopyExternal=!0;if(Qa.clipboardItems.getItem("image/png")){const Zb=Qa.commandParameters.stopwatch.Fc;
Qa.payloadType=L.mZg;return ja.b(this.$.Yc(1403967063,Qa.commandParameters.ribbonCommandInfo.method,Qa.commandParameters.ribbonCommandInfo.Ve,{["dataUrl"]:Qa.clipboardItems.getItem("image/png")})).then(nb=>{Qa.serverRequestTimeInMs=Qa.commandParameters.stopwatch.Fc-Zb;return nb?Promise.resolve(null):Promise.reject(new Wa.a(15))},()=>{Qa.serverRequestTimeInMs=Qa.commandParameters.stopwatch.Fc-Zb;return Promise.reject(new Wa.a(15))})}e.ULS.shipAssertTag(537167884,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");
return super.Hsc(Qa)}uzi(){const Qa=Y.h(this.$).ha;return Qa.Sa.activeFloatingObjectControlId&&Qa.Sa.jc&&Qa.Sa.jc.floatingObject?Qa.Sa.jc.floatingObject.QYd():!1}dhd(Qa,Zb,nb){return new Promise((Tb,qb)=>{const Kb=Qa.commandParameters.stopwatch.Fc;e.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");this.G_a.Edh(new bd(Zb.activeFloatingObjectControlId,Qa.commandParameters,jc=>{Qa.requestTelemetryData=jc.RequestTelemetryData;
Qa.serverRequestTimeInMs=Qa.commandParameters.stopwatch.Fc-Kb;if(cb.a.Zf(jc.Errors))if(cb.a.sha(jc.Errors))Qa.encounteredDeploymentErrors=!0,jc=cb.a.qc(jc.Errors),e.ULS.sendTraceTag(537167879,0,15,`ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${jc}`);else{var Ac=cb.a.qc(jc.Errors);e.ULS.sendTraceTag(36229122,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Ac}`);qb(new mc(4,
jc.Errors))}else if(e.ULS.sendTraceTag(537167883,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[${Zb.activeFloatingObjectControlId}].`),Qa.markForCancellation)qb(new mc(3,jc.Errors));else{if(cb.a.wq(jc.Errors)){var Jc=cb.a.qc(jc.Errors);e.ULS.sendTraceTag(537167882,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: ${Jc}`)}if(Jc=jc.Result){Jc=this.TKe(Jc);Jc.floatingObjectId=Zb.activeFloatingObjectControlId;
Qa.shadowWorkbookPayloadSize=Ta(Jc);Qa.shadowWorkbookSizeExceedsLimit=sb(Jc);try{Ac=JSON.stringify(Jc)}catch(hd){qb(new Wa.a(14,void 0,hd,`Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [${Qa.shadowWorkbookPayloadSize}], shadowWorkbookPayload.FloatingObjectId: [${Jc.floatingObjectId}]`));return}e.ULS.shipAssertTag(537167881,0,!!nb,"Expecting syncClipboardItems to be defined");nb.setItem(O.shadowWorkbook,Ac);1===Qa.commandParameters.commandType&&(this.Dbj(Zb.type,Zb.activeFloatingObjectControlId,
jc.StateId),this.deleteFloatingObject(Zb.activeFloatingObjectControlId,Zb.type));this.n6c.setValue(Zb,nb);Qa.asyncClipboardItemsKeys=Za(nb);Tb(nb)}else e.ULS.sendTraceTag(537167880,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: ${Zb.activeFloatingObjectControlId}`),Tb(this.n6c.twa(Zb))}},Qa.commandParameters.commandType,Zb.type,jc=>{Qa.serverRequestTimeInMs=Qa.commandParameters.stopwatch.Fc-Kb;jc=X.a.Ue(jc.data);1===Qa.commandParameters.commandType&&
this.G_a.c2j(Zb.type,Zb.activeFloatingObjectControlId);const Ac=cb.a.qc(jc);e.ULS.sendTraceTag(537167878,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Ac}`);qb(new mc(4,jc))},[Qa.commandParameters.stopwatch]))})}deleteFloatingObject(Qa,Zb){Qa=se.a.ez(Zb,Qa);if(Qa=dd.a(this.$).vr(Qa))dd.a(this.$).deleteFloatingObject(Qa,14,!0),Y.h(this.$).ha.Sa.IA=null}Dbj(Qa,Zb,nb){const Tb=this.$.da.Ba(277);if(Tb){let Kb=null;Qa=se.a.ez(Qa,Zb);Qa=dd.a(this.$).vr(Qa);
if(null===Qa||void 0===Qa?0:Qa.Wi)Kb=Qa.Wi.block;if(Kb){var qb=Qa.floatingObject.Mg();Tb.k0b(()=>!Kb.Ki.kb(qb),nb,"CutArt")}}}static Mri(Qa){return 1===Qa.type||5===Qa.type}}Object(c.a)(Hd,"ArtCopyPasteHandler",zb,[]);var Xc=a(59);class gd extends Pa{constructor(Qa,Zb,nb,Tb){super(Qa);this.isFromCurrentSession=!1;this.left=this.top=0;this.isFromCurrentSession=Zb;this.top=nb;this.left=Tb}}Object(c.a)(gd,"MacroRecorderPasteArtPayload",Pa,[]);class je{constructor(Qa,Zb){this.$=Qa;this.uqb=Zb}zji(Qa,
Zb,nb,Tb,qb,Kb=null,jc=null){const Ac=this.$.pa.va.$b();let Jc=null;const hd={CopyPasteTargetType:2};hd.FloatingObjectId=Qa;hd.CopyOperationId=nb.id;nb.floatingObjectType=Zb;hd.UploadToClipService=nb.uploadToClipService;hd.PKey=nb.pKey;hd.ClipServiceDataCenter=nb.clipServiceDataCenter;let Cd=0;2===qb?(qb=505,Cd=16,Jc=(ac,Lc,rd)=>qa(this.$.pa.va,hd,F.b(ac,Tb),Kb?F.a(Lc,Kb):Lc,rd,nb.ribbonCommandInfo,Ac,jc)):(qb=179,Jc=(ac,Lc,rd)=>{this.Vrh(Zb,Qa);this.$.vy();return ma(this.$.pa.va,hd,F.b(ac,Tb),Kb?
F.a(Lc,Kb):Lc,rd,nb.ribbonCommandInfo,Ac,jc)});this.$.userOperationManager.Oc(new Ma.a(qb,0,Jc,Cd|64),nb.ribbonCommandInfo)}Vrh(Qa,Zb){var nb=se.a.ez(Qa,Zb);(nb=dd.a(this.$).vr(nb))?(Y.h(this.$).ha.Sa.hH(nb),nb.isVisible=!1):e.ULS.sendTraceTag(537167876,0,50,`ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : ${Qa}, FloatingObjectId: ${Zb}`)}c2j(Qa,Zb){Qa=se.a.ez(Qa,Zb);if(Qa=dd.a(this.$).vr(Qa))Qa.isVisible=!0}Edh(Qa){this.zji(Qa.floatingObjectId,Qa.Cdh,
Qa.commandParameters,Qa.Tt,Qa.jmh,Qa.Taa,Qa.uRb)}aki(Qa,Zb,nb,Tb,qb,Kb,jc,Ac=null,Jc=!0){return new Promise((hd,Cd)=>{const ac=Kb.commandParameters.stopwatch.Fc;this.WRd(Qa,qb,Zb,nb,Lc=>{Kb.requestTelemetryData=Lc.RequestTelemetryData;Kb.serverRequestTimeInMs=Kb.commandParameters.stopwatch.Fc-ac;if(cb.a.sha(Lc.Errors))Kb&&(Kb.encounteredDeploymentErrors=!0),Lc=cb.a.qc(Lc.Errors),e.ULS.sendTraceTag(537167875,0,15,`ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Lc}`);
else if(cb.a.Zf(Lc.Errors)){var rd=cb.a.qc(Lc.Errors);e.ULS.sendTraceTag(36459652,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${rd}`);Cd(new Wa.a(9,Lc.Errors))}else Lc.Result?(rd=Lc.Result,e.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded."),this.Pbj(jc,rd.FloatingObjectId,Lc.StateId),hd(je.Fod(rd.FloatingObjectId))):(e.ULS.sendTraceTag(537167873,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),Cd(new Wa.a(9,Lc.Errors)))},
Lc=>{Kb.serverRequestTimeInMs=Kb.commandParameters.stopwatch.Fc-ac;Lc=X.a.Ue(Lc.data);e.ULS.sendTraceTag(537167872,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${cb.a.qc(Lc)}`);Cd(new Wa.a(9,Lc))},Tb,Ac,Jc)})}Pbj(Qa,Zb,nb){const Tb=this.$.da.Ba(277);if(Tb){const qb=se.a.ez(Qa,je.Fod(Zb));Tb.k0b(()=>!!dd.a(this.$).vr(qb),nb,"PasteArt")}}T0d(Qa,Zb){Zb&&this.uqb.T0d(Qa,se.a.ez(Qa.type,Zb))}DOf(Qa){return this.aki(Qa.ribbonCommandInfo,Qa.destination,Qa.uNe,Qa.uRb,Qa.H0,Qa.pasteContext,Qa.item.type,
Qa.VEe,Qa.item.isFromCurrentSession(this.$)).then(Zb=>Zb,Zb=>{this.T0d(Qa.item,Qa.VEe);return Promise.reject(Zb)})}zRd(Qa,Zb,nb){Qa||(Qa=P.v(Y.h(this.$).ha.ra.activeCell,this.$));Y.h(this.$).wkc(P.E(Qa),1)?dd.a(this.$).Yna(nb,Zb,!0):Y.h(this.$).ha.Sa.hIa(Qa,Zb,nb).continueWith(Tb=>{Tb.result?e.ULS.sendTraceTag(537167843,5,50,`ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [${Zb}]`):e.ULS.sendTraceTag(537167842,5,10,`ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [${Zb}]`)})}WRd(Qa,
Zb,nb,Tb,qb,Kb,jc,Ac,Jc=!0){const hd=this.$.pa.va.$b(),Cd={};Cd.ShadowWorkbookBase64=Zb.shadowWorkbookBase64;Cd.FloatingObjectId=Tb;Cd.DestinationRanges=nb?P.s(nb):null;Cd.CopyPasteTargetType=2;Cd.ClientEstimationFloatingObjectId=Ac;nb=new Ma.a(503,0,(ac,Lc,rd)=>{Ac||this.$.vy();return Ga(this.$.pa.va,Cd,F.b(ac,qb),F.a(Lc,Kb),rd,null,hd,jc)},void 0,()=>{if(Jc){let ac;ac=Xc.a.Yh(Xc.a.Ec(Cd));ac.FloatingObjectId=Zb.floatingObjectId;Cd.DestinationRanges||(ac.DestinationRanges=P.p(this.$.ua.na.sheetName,
"",0,0,0,0));return new gd(ac,Jc,0,0)}return new gd(Cd,Jc,0,0)});nb.flags=65;this.$.userOperationManager.Oc(nb,Qa)}static Fod(Qa){return`${Qa.length+2}.{${Qa.toUpperCase()}}`}}Object(c.a)(je,"ArtCopyPasteUtils",null,[496]);var Ee=a(202);class ae{constructor(Qa){this.l6c=this.Uta=null;this.kbb=15;this.$=Qa}HId(Qa,Zb){this.Uta=Qa;this.l6c=Zb}r$c(){if(!this.Uta||!this.l6c)return e.ULS.sendTraceTag(537167841,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),
"";const Qa=tc.a.vsb(new se.a(this.Uta));Qa.Id=je.Fod(k.a.create().toString());Qa.Version=-1;Qa.Name="";Qa.IsClientEstimation=!0;var Zb=this.tli(Qa);if(!Zb)return null;const nb=new se.a(Qa);Zb.block.Ki.add(nb);nb.CLb();const Tb=dd.a(this.$);Tb.I6b(nb,Zb);Zb=Tb.vr(se.a.n_h(Qa));!Zb||Zb.floatingObject.mNa||Zb.floatingObject.KNa||Zb.DSa(this.l6c);Tb.Yna(Qa.Type,Qa.Id,!0);return Qa.Id}aag(Qa){return m.EwaSettings.xa(205)&&Qa.isFromCurrentSession(this.$)&&!Y.h(this.$).rtl&&!Y.h(this.$).jb.oj}T0d(Qa,Zb){this.aag(Qa)&&
(Qa=dd.a(this.$).vr(Zb))&&(e.ULS.sendTraceTag(537167840,5,50,`ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [${Zb}] of type [${Qa.floatingObject.type}]`),dd.a(this.$).deleteFloatingObject(Qa,15,!0),Qa.Wi&&Qa.Scb(Qa.Wi,!1))}tli(Qa){if(!Qa)return e.ULS.sendTraceTag(537167839,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(Y.h(this.$).ha.Sa.activeFloatingObjectControlId){var Zb=
Y.h(this.$).ha.Sa.IA.floatingObject;Qa.OriginDeltaX=Zb.offsetX+this.kbb;Qa.OriginDeltaY=Zb.offsetY+this.kbb;Qa.AbsoluteLeft+=this.kbb;Qa.AbsoluteTop+=this.kbb;Qa.AbsoluteRight+=this.kbb;Qa.AbsoluteBottom+=this.kbb;Qa.ZOrder=Zb.PB+1;return Y.h(this.$).ha.Sa.IA.Wi}if(!this.$.na||!this.$.na.activeCell)return e.ULS.sendTraceTag(537167838,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var nb=this.$.na.activeCell;
Zb=Y.h(this.$).pX(nb);if(!Zb)return e.ULS.sendTraceTag(537167837,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range ${nb.toString()} is null.`),null;const Tb=ta.HelperMethods.ryb(Zb.domElement,Zb.jj.domElement);nb=Zb.gridView.Eg(nb,2);if(!Tb||!nb)return e.ULS.sendTraceTag(537167836,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: ${!Tb}. cellPositionRelativeToGridOrigin is null: ${!nb} .`),null;Qa.OriginDeltaX=
nb.topLeft.x-Tb.x;Qa.OriginDeltaY=nb.topLeft.y-Tb.y;Qa.AbsoluteLeft=nb.topLeft.x;Qa.AbsoluteTop=nb.topLeft.y;Qa.AbsoluteRight=Qa.AbsoluteLeft+Math.abs(this.Uta.AbsoluteRight-this.Uta.AbsoluteLeft);Qa.AbsoluteBottom=Qa.AbsoluteTop+Math.abs(this.Uta.AbsoluteBottom-this.Uta.AbsoluteTop);Qa.ZOrder=this.Uta.ZOrder+100;return new Ee.a(Zb.gridView.Ca.pl(Zb.hashCode),Zb.hashCode)}}Object(c.a)(ae,"ArtPasteClientEstimation",null,[495]);class Yb{create(){const Qa=window.clipboardPlatform;return Qa?Qa.createClipboardItems():
null}}Object(c.a)(Yb,"ClipboardItemsFactory",null,[494]);class Sc{}Sc.undefined="Undefined";Object(c.a)(Sc,"CCPTelemetryConsts",null,[]);class qd{}qd.cells="Cells";qd.floatingObject="FloatingObject";qd.unknown="Unknown";Object(c.a)(qd,"ActiveSelection",null,[]);class Id{}Id.grh="DisplayNotInvoked";Id.j$c="Displayed";Id.Ybj="PrerequisitesNotReady";Object(c.a)(Id,"PasteIndicationDisplayStatus",null,[]);var ic=a(124);class Gc{constructor(Qa){this.GIc=this.NSc=null;this.$=Qa}get IKd(){if(!this.NSc){const Qa=
this.$.da.Ba(254,!0);Qa&&(this.NSc=new Fc(this.$,Qa,new Yb))}return this.NSc}get M_c(){if(!this.GIc&&this.$.da.Ba(254,!0)){const Qa=new ae(this.$);this.GIc=new Hd(this.$,new Yb,new je(this.$,Qa),Qa)}return this.GIc}getCopyFlowHandler(Qa){const Zb=this.fWh(Y.h(this.$).Oe);Qa.commandParameters.copyPasteHandlerName=Zb.name;return Zb}getPasteFlowHandler(Qa){var Zb=Qa.copyContextSnapshot;Zb=J(Qa)?this.M_c:N(Qa)?this.IKd:(null===Zb||void 0===Zb?0:Zb.sourceItem)&&Object.getType(Zb.sourceItem)===I?this.M_c:
this.IKd;Qa.commandParameters.copyPasteHandlerName=Zb.name;return Zb}initializePasteContext(Qa){if(Qa&&(Qa.isSameSession=!1,Qa.isShadowWorkbookParsedSuccessfully=!1,Qa.pasteResult=Sc.undefined,Qa.payloadOrigin=Sc.undefined,Qa.payloadType=Sc.undefined,Qa.encounteredDeploymentErrors=!1,Qa.shadowWorkbookSizeExceedsLimit=!1,Qa.originalSourceRangesCountExceedsLimit=!1,Qa.activeSelectionType=this.LRh(),Qa.indicationDisplayScheduled=!1,Qa.pasteDestinationHasMergedCells=!1,Qa.pasteIndicationDisplayStatus=
Id.grh,Qa.copyContextSnapshot)){var Zb=Qa.copyContextSnapshot;const jc=G(Zb.sourceItem);var nb=Zb.sourceItem;var Tb=!!nb&&Object.getType(nb)===I;nb=0;var qb=!1;jc?(qb=Zb.sourceItem,Qa.isSameSession=qb.isFromCurrentSession(this.$),nb=1,qb=this.pwi(qb,Qa)):Tb&&(Qa.isSameSession=Zb.sourceItem.isFromCurrentSession(this.$),nb=2);if(Qa.copyContextSnapshot.commandParameters){const Ac=-1985798686===Zb.commandParameters.ribbonCommandInfo.command;Tb=Qa.commandParameters;var Kb=this.$;Zb?Kb&&Kb.ya?Zb=Zb.sessionId===
Kb.ya.UserSessionId:(e.ULS.shipAssertTag(537166211,0,!1,"ewaControl shouldn't be null"),Zb=!1):(e.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),Zb=!1);Tb.clearSystemClipboard=Zb&&Ac&&jc&&!qb;Qa.commandParameters.copyPasteTargetType=nb}}}getSessionId(){return this.$.ya.UserSessionId}pwi(Qa,Zb){const nb=ic.b(Qa.ranges,Tb=>Tb.Fg)&&ic.b(Zb.commandParameters.originalDestinations,Tb=>1!==Tb.top);return ic.b(Qa.ranges,Tb=>Tb.isRow)&&ic.b(Zb.commandParameters.originalDestinations,Tb=>
1!==Tb.left)||nb}fWh(Qa){switch(Qa){case 1:return this.IKd;case 64:case 4:case 2:case 256:return this.M_c;default:throw Error.invalidOperation("Unsupported selection");}}LRh(){return Y.h(this.$).ha.Oe&470?qd.floatingObject:1===Y.h(this.$).ha.Oe?qd.cells:qd.unknown}getDialogResponse(){}}Object(c.a)(Gc,"ExcelCopyPasteApplicationHost",null,[484]);var jd=a(167);class ed extends y.a{constructor(Qa,Zb){super(Qa);this.qt=null;this.lni=(nb,Tb)=>{1===nb?(nb=ed.sqh[Tb[ed.rqh]],e.ULS.sendTraceTag(537167683,
0,50,`InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = ${0===nb?"Horizontal":"Vertical"}`),this.qt.setResult(nb)):(e.ULS.sendTraceTag(537167682,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),this.qt.As())};this.tg(Zb)}get pc(){return"InsertCopiedCutCellsDialog"}tg(Qa){this.qt=new jd.a;const Zb=v.a.instance.ga(16);Qa=this.NM(Qa);this.initializeAndShow(Zb,this.lni,Qa)}NM(Qa){return{[ed.pt]:this.pc,
[ed.$xi]:Qa}}}ed.rqh="direction";ed.$xi="isRtl";ed.sqh={["Vertical"]:1,["Horizontal"]:0};Object(c.a)(ed,"InsertCopiedCutCellsDialog",y.a,[]);class Qd{K6b(Qa,Zb){return(new ed(Qa,Zb)).qt.task}}Object(c.a)(Qd,"InsertCopiedCutCellsDialogFactory",null,[402]);var te=a(91),xe=a(49),He=a(45);class We{constructor(Qa){this.K7b="";this.o2=this.dt=null;this.Ctc=!1;this.fef=(Zb=null,nb=null)=>{this.hide(Zb,nb)};this.gridView=Y.h(Qa);this.gridView.ha.jC(this.fef)}GPe(){this.Ctc||(e.ULS.sendTraceTag(537167680,
0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.jz(Qa=>{Qa.eba(0).then(()=>{this.Ctc=!0})}))}Txj(Qa){var Zb=Qa.commandParameters.id;e.ULS.sendTraceTag(537167651,0,50,`PasteIndicationManager.ScheduleDisplay: pasteCommandId = ${Zb}, cancelCtx is null = ${!this.dt}, PrerequisitesDownloaded = ${this.Ctc}`);this.GPe();this.K7b=Zb;Zb=!this.Kzf();if(!this.dt||Zb)this.cCe(),this.dt=xe.a.instance.create(()=>{this.frh(Qa)},void 0===Qa.timeoutToShowSpinnerInMs||
null===Qa.timeoutToShowSpinnerInMs?100:Qa.timeoutToShowSpinnerInMs,He.a.d9i);this.o2=Qa.commandParameters.originalDestinations}frh(Qa){this.Ctc?(this.display(Qa.commandParameters.originalDestinations),Qa.pasteIndicationDisplayStatus=Id.j$c):(e.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),Qa.pasteIndicationDisplayStatus=Id.Ybj)}display(Qa){e.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");
this.gridView.Eb.CB(ua.a.qUa(la.d(this.gridView.$.na),Qa),We.Isc,!0);this.gridView.Eb.$q(We.Isc)}und(Qa){e.ULS.sendTraceTag(537167648,0,50,`PasteIndicationManager.HideForPasteId: pasteCommandId = ${Qa}, currentPasteCommandId = ${this.K7b}`);Qa&&Ya.a.equals(Qa,this.K7b,!1)&&this.hide()}hide(Qa=null){this.o2&&Qa&&this.Kzf()&&e.ULS.sendTraceTag(537167647,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");
this.K7b="";this.cCe();this.o2=null;this.gridView.Eb.Tj(We.Isc);this.gridView.Eb.Bk(null,We.Isc)}Kzf(){return P.R(this.gridView.ha.ra.selectedRanges,this.o2)}cCe(){this.dt&&(te.a.Ja(this.dt),this.dt=null)}dispose(){this.hide();this.gridView.ha.xB(this.fef)}}We.Isc=[30];Object(c.a)(We,"PasteIndicationManager",null,[401,3]);var ye=a(1010),$e=a(52),jf=a(717);class gf extends f.a{constructor(Qa){super();this.$=Qa;this.Fm=v.a.instance;this.Gb()}create(){const Qa=$e.a.pR([74,75],4,this.Na,void 0,void 0,
void 0,gf.doa);let Zb;Zb=m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormatCellsActionNewService",!1)?Object(ja.c)(Ab.a.resolve(Jb.r,{Wb:this.Na})):va.GetServiceTaskFactory.create(this.$.da,18,this.$.ka,this.Na);Ea.TaskExtensions.za(Ea.TaskExtensions.Md([Zb,Qa],this.ka),()=>{const nb=new ye.a;let Tb=null;this.ebh(nb).then(qb=>{Tb=qb.ZEe;const Kb=copyPasteInfra.createCopyPasteInfra(Tb,new Gc(this.$),nb,{isChangeGateEnabled:m.EwaSettings.isChangeGateEnabled});e.ULS.shipAssertTag(537167762,
0,!!this.$.ya,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");e.ULS.shipAssertTag(537167761,0,!!this.$.ya&&!!this.$.ya.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");const jc=Tb.getMetadataManager();var Ac=Object(jf.a)(this.$.da,254,()=>new Nb(this.$,jc,Zb.result,Kb,new Pb(this.$,Y.h(this.$)),new Qd,this.$.ya.DocumentHostInfo.UserId,Tb.getInitializationError()));this.qb(Ac);
if(qb.j1a){Ac=Nb.Jcc();const Jc=JSON.stringify(qb.j1a.dataClipboardCapabilities),hd=qb.j1a.clipboardStrategiesToInitialize[0].clipboardStrategyType===qb.j1a.dataClipboardStrategyType,Cd=void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString();e.ULS.sendTraceTag(41731933,0,50,`CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName=${Ac}, StrategyType=${qb.j1a.dataClipboardStrategyType}, StrategyCapabilities=${Jc}, IsBestStrategyTypeInitialized=${hd}, InfraLoadTimeMS=${Cd}`)}else e.ULS.shipAssertTag(537167760,
0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},qb=>{const Kb=Nb.Jcc();qb=qb?copyPasteInfra.getStringifiedError(qb):"null";e.ULS.shipAssertTag(38847436,0,!1,`CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: ${Kb} error: ${qb}`)})},this.ka,3)}dispose(){super.dispose()}ebh(Qa){let Zb=null;var nb=window.clipboardPlatform;
nb&&(Zb=nb.getClipboardPlatformEnvironment());if(!Zb)return e.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),Promise.reject(null);nb=this.$.ya;const Tb=[nb.OfficeOnlineChromeExtensionId,nb.ChromeClipboardAccessExtensionId],qb=this.Fm.Ua(5);var Kb=this.$.ke.get(57);let jc=!Kb&&this.$.ke.get(5);const Ac=this.$.ea.ic;Ac&&(Ac.inWebPart||Ac.inViewerFromWebPart||Ac.isDivSyndicated)&&
(jc=!1);Kb=this.aVh(jc,!Kb);e.ULS.shipAssertTag(537167758,0,!!nb.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return Zb.init({isChangeGateEnabled:m.EwaSettings.isChangeGateEnabled},Qa,Tb,nb.SharedClipboardHostingApp,nb.SharedClipboardHostingApps,nb.SharedClipboardHostingEnvironments,nb.SharedClipboardOverrideOrigin,nb.SharedClipboardSchemaVersion,nb.SharedClipboardExpirationInMinutes,nb.ClipboardPromiseTimeoutInMinutes,
qb,nb.MachineCluster,new mb(this.$),Kb,nb.DocumentHostInfo.UserId,nb.ClipboardTtlInMS,m.EwaSettings.xa(273),nb.UserSessionId,nb.BulsEndpointUrl).then(Jc=>Object(b.a)(new Ja,{ZEe:Zb,j1a:Jc}),Jc=>Promise.reject(Jc))}aVh(Qa,Zb){const nb=[];Qa&&Zb&&nb.push(this.Lkh());Zb&&(nb.push(this.Y7c(7)),nb.push(this.Y7c(0)));Qa&&nb.push(this.aKe());nb.push({clipboardStrategyType:4});const Tb=nb?nb.map(qb=>JSON.stringify(qb)).join(","):"[]";e.ULS.sendTraceTag(39978242,0,50,`CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed=${Qa}, isSystemClipboardAllowed=${Zb}, result = ${Tb}`);
return nb}aKe(){const Qa=this.$.ya,Zb={clipboardStrategyType:5};Zb.sessionId=Qa.UserSessionId;Zb.useSharedClipboardIframe=!0;Zb.sharedClipboardHostingApp=Qa.SharedClipboardHostingApp;Zb.sharedClipboardHostingApps=Qa.SharedClipboardHostingApps;Zb.sharedClipboardHostingEnvironments=Qa.SharedClipboardHostingEnvironments;Zb.sharedClipboardOverrideOrigin=Qa.SharedClipboardOverrideOrigin;Zb.sharedClipboardSchemaVersion=Qa.SharedClipboardSchemaVersion;Zb.sharedClipboardExpirationInMinutes=Qa.SharedClipboardExpirationInMinutes;
Zb.wacCluster=Qa.MachineCluster;return Zb}Lkh(){const Qa={clipboardStrategyType:6};Qa.localStorageStrategyParameters=this.aKe();Qa.systemClipboardStrategyParameters=this.Y7c(0);return Qa}Y7c(Qa){const Zb={};Zb.clipboardStrategyType=Qa;Zb.skipFilesIfPlainTextExists=!0;return Zb}static la(Qa){Qa.da.Ha(373,new We(Qa));Qa.da.Ha(gf.doa,new gf(Qa))}}gf.doa=255;Object(c.a)(gf,"CopyPasteInfrastructureFactory",f.a,[]);var rf=a(9);a.d(B,"a",function(){return Mf});const Mf=()=>{rf.a.Fa(Qa=>{gf.la(Qa)})}},1190:function(r,
B,a){r=a(0);var c=a(15),b=a(702),e=a(559),f=a(88),d=a(87),h;(function(La){La[La.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler";La[La.cloudPolicySettings=1]="cloudPolicySettings";La[La.alternateAuthToken=2]="alternateAuthToken"})(h||(h={}));Object(r.b)("ApplicationFeatureHelperRequestType",h);class l{constructor(){this.message=null;this.z6a=0}}Object(r.a)(l,"HttpRequstToPromiseRejectData",null,[]);var k=a(102),w=a(82),n=a(244),x=a(31);class m{constructor(La,va){this.fb=La;this.rh=
va}n7c(La,va,Ba,Ea=null,pa=null,$a=null,cb=null,ib=null){const ta=h[Ba],Ya=ta+"RequestFailure";k.Health.instance.recordKpiUsage(Ya,0,"jpittsdirects",null);return new Promise((Da,ba)=>{c.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",ta);const ya=null!=cb?cb:this.fb.Ad("ApplicationFeatureHelperRequestQueueTimeout",15E3),V=null!=ib?ib:this.fb.Ad("ApplicationFeatureHelperRequestSentTimeout",3E4);this.rh.eha(La,1,null,this.z_h(Ba,
Ea),$a,!1,1,Z=>{c.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",ta);try{if(void 0===Z||null===Z||void 0===Z.data||null===Z.data||void 0===Z.data.me||null===Z.data.me){k.Health.instance.recordKpiFailure(Ya,"Invalid RequestSucceededEventArgs",!1,!0,null);let la=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",ta);ba(this.Hyb(la,Z))}else if(Z.data.httpStatus!==
n.a.ZO){k.Health.instance.recordKpiFailure(Ya,"HttpStatusCode_"+Z.data.httpStatus.toString(),!1,!0,null);let la=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",Z.data.httpStatus,ta);ba(this.Hyb(la,Z))}else{void 0!==pa&&null!==pa&&void 0!==Z.data.responseHeaders&&null!==Z.data.responseHeaders&&pa(Z.data.responseHeaders);var ja=va(Z.data.me);if(ja)c.ULS.sendTraceTag(50622690,3004,
50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",ta),Da(ja);else{k.Health.instance.recordKpiFailure(Ya,"Parse Failure",!1,!0,null);let la=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",ta);ba(this.Hyb(la,Z))}}}catch(la){k.Health.instance.recordKpiFailure(Ya,"Unexpected Failure",!1,!0,null),ja=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",
la,ta),ba(this.Hyb(ja,Z))}},Z=>{if(Z.data){k.Health.instance.recordKpiFailure(Ya,"HttpStatusCode_"+Z.data.httpStatus.toString(),!1,!0,null);var ja=x.a.hkd(Z.data.me||"No Data");ja=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",Z.data.httpStatus,ja,ta)}else k.Health.instance.recordKpiFailure(Ya,"Invalid RequestFailedEventArgs",!1,!0,null),ja=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",
ta);ba(this.Hyb(ja,Z))},null,void 0,void 0,ya,V)})}Hyb(La,va){const Ba=new l;Ba.message=La;Ba.z6a=va&&va.data?va.data.httpStatus:-1;return Ba}z_h(La,va){const Ba={};Ba["x-UserDataSignature"]=this.fb.Wa("UserDataSignature");Ba["x-LicensingIsEnabled"]=this.fb.qa("LicensingIsEnabled").toString();Ba["x-CacheIsEnabled"]=this.fb.qa("LicensingRedisIsEnabled").toString();Ba["x-OcpsIsEnabled"]=this.fb.qa("OcpsIsEnabled").toString();Ba["x-LicensingAADIdIsEnabled"]=this.fb.qa("LicensingAadIdIsEnabled").toString();
0===La&&(Ba["x-LicenseCheckOnTenantEnabled"]="true",Ba["x-SupportUserConsentDependentFeatures"]="true",Ba["x-AFHUserConsentGroupValue"]="0",Ba["x-UseShellServiceForUserConsentGroup"]="true",Ba["x-SMBUserLicensingEnabled"]="true",Ba["x-AFHPIPLComplianceEnabled"]=w.a.xw(window.location.href,"wd_afhpipl")||"false");if(va)for(let Ea of va.keys)Ba[Ea]=va.ma(Ea);return Ba}}Object(r.a)(m,"HttpRequestToPromiseUtility",null,[]);var u=a(4),t;(function(La){La[La.loki=0]="loki";La[La.augloopACLP=1]="augloopACLP"})(t||
(t={}));Object(r.b)("AlternateAuthSupportApp",t);var y=a(563),v=a(40);class A{constructor(){this.Token=null;this.ExpirationTime=0}}Object(r.a)(A,"WacAlternateAuthToken",null,[]);class z{constructor(La,va){this.OYj=3E5;if(void 0===La||null===La||void 0===va||null===va)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.fb=La;this.MSb=new b.a(e.a.li());this.Gkb=new m(La,va);void 0!==y.OAuthManagerSettings.Tyd&&null!==y.OAuthManagerSettings.Tyd&&void 0!==y.OAuthManagerSettings.nnc&&
null!==y.OAuthManagerSettings.nnc&&0<y.OAuthManagerSettings.nnc&&(La=new A,La.Token=y.OAuthManagerSettings.Tyd,La.ExpirationTime=y.OAuthManagerSettings.nnc,this.MSb.ia("loki",La))}ySh(){let La=null;this.MSb.kb(t[0])&&(La=this.MSb.ma(t[0]));return void 0===La||null===La||this.Xud(La)?this.jJh():Promise.resolve(La.Token)}Xud(La){return La.ExpirationTime-Date.now()<this.OYj}jJh(){const La=new b.a(e.a.li());La.ia("X-AlternateAuthApp",t[0]);return this.Gkb.n7c(this.Qva("/afhs/AlternateAuthHelperHandler.ashx"),
Object(f.a)(this,this.n8i,"parseAlternateAuthTokenResponse"),2,La).then(va=>{c.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",t[0]);this.MSb.ia(t[0],va);return va.Token},va=>{va=Object(d.a)(l,va);c.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",va.message,va.z6a);return null})}n8i(La){let va=null;({ot:va}=v.d(La));c.ULS.sendTraceTag(545821457,3004,
va?50:10,"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",La);return va}Qva(La){return String.format("{0}{1}?{2}",this.fb.Wa("WebServiceBase"),La,u.AFrameworkApplication.xi)}}Object(r.a)(z,"AlternateAuthHelper",null,[225]);var C=a(461);class H{constructor(La,va,Ba){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=La;this.isEnabled=va;this.tierName=Ba}}Object(r.a)(H,"FeatureStateChangeArgs",null,[]);var I=a(143),S=a(261),P=a(27),D=a(115),G=a(178),E;
(function(La){La[La.Enabled=0]="Enabled";La[La.Disabled=1]="Disabled"})(E||(E={}));Object(r.b)("FeatureState",E);var O=a(86),N=a(25),J=a(199);class W{constructor(La,va,Ba=null,Ea=null,pa=null){this.gva=this.mYb=this.Kje=this.nra=this.nZb=null;this.Gkb=new m(La,va);this.fb=La;this.eDg=La.Ad("LicensingMaxRetryAttempts",0);this.TVb=La.qa("IsO365ConsumerHost");this.NOc=La.qa("IsO365CommercialHost");this.zOc=La.qa("PremiumUpsellIsEnabled");this.jXa=!1;this.VPc=0;this.X7d=Ba;this.$ne=Ea;this.La=pa;this.mra=
La.qa("LicensingIsEnabled");this.vFa=La.qa("OcpsIsEnabled")&&this.NOc;this.jWc=La.qa("ShowPrivacyDialog")&&!!Ea;this.aOc=La.qa("IsAnonymousUser");this.Mac=new Promise($a=>{$a(!1)});this.DCa=new Promise($a=>{$a(!0)});this.fva=new b.a(e.a.li());this.b_b=!0;this.Yee=this.b1h();this.btd()&&!this.aOc?(void 0!==u.AFrameworkApplication.sa&&null!==u.AFrameworkApplication.sa&&(this.nZb=u.AFrameworkApplication.sa.SD,void 0!==this.nZb&&null!==this.nZb&&(this.nra=this.nZb.vg("WebServiceCall","ApplicationFeatureHelperService"))),
this.gva=this.A0d()):this.gva=new Promise($a=>{$a({})});this.gva.catch($a=>{$a=Object(d.a)(l,$a);c.ULS.sendTraceTag(42513088,3004,10,"ApplicationFeatureHelper initialization failed, HttpStatus={0}",$a?$a.z6a.toString():"Unknown")});this.b_b&&this.isFeatureEnabled("FreemiumUpsell",!0).then($a=>{this.jXa=$a;return null})}b1h(){const La=this.fb.Jp("AllLicensedFeatures")?this.fb.ww("AllLicensedFeatures"):[],va=new C.a;for(let Ba=0;Ba<La.length;Ba++)va.add(La[Ba]);return va}btd(){return this.NOc||this.TVb}A0d(La=
0,va=!1){c.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",va);const Ba=I.a.Wr();Ba&&(Ba.set("retryAttempt",La.toString()),Ba.set("forceRefresh",va.toString()),Ba.set("isO365ConsumerHost",this.TVb.toString()),Ba.set("isO365CommercialHost",this.NOc.toString()),Ba.set("isFreemiumUpsellSettingEnabled",this.zOc.toString()));k.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",Ba);k.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",
1,"waclicensing",Ba);void 0!==this.nra&&null!==this.nra&&this.nra.start();let Ea=null;va&&(Ea=new b.a(e.a.li()),Ea.ia("x-LicensingForceRefresh","true"));this.Kje=new Date;return(this.mra?this.Gkb.n7c(this.Qva("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(f.a)(this,this.q8i,"parseApplicationFeatureHelperResponse"),0,Ea,Object(f.a)(this,this.Qcj,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(pa=>{const $a=Object.assign(new J.a,{durationMs:this.zeg()});$a.extendedProperties=
Ba;$a.extendedProperties&&pa&&($a.extendedProperties.set("featureCount",D.a.count(pa).toString()),$a.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in pa).toString()),$a.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in pa).toString()),"FreemiumUpsell"in pa&&$a.extendedProperties.set("isFreemiumUpsellEnabled",pa.FreemiumUpsell.toString()),this.mYb&&$a.extendedProperties.set("fromCache",(this.mYb<this.Kje).toString()));k.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",
$a);return pa},pa=>{const $a=Object.assign(new J.a,{durationMs:this.zeg()}),cb=Object(d.a)(l,pa);if(!cb)return c.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),k.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,$a),new Promise((ib,ta)=>{ta(pa)});$a.extendedProperties=Ba;$a.extendedProperties&&$a.extendedProperties.set("status",cb.z6a.toString());k.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest",
"RequestFailed",!1,!0,$a);return 408===cb.z6a&&++La<=this.eDg?this.A0d(La):new Promise((ib,ta)=>{ta(cb)})})}q8i(La){(La=v.b(La))?(c.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),c.ULS.sendTraceTag(50938594,3004,50,"{0}",La)):c.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");return La.Features}Qva(La){var va=String.format("{0}{1}",this.fb.Wa("WebServiceBase"),
La);this.fb.Jp("ApplicationFeatureHelperHttpCachingEnabled")&&this.fb.qa("ApplicationFeatureHelperHttpCachingEnabled")&&(La=W.Pdc(this.fb))&&0<La.length&&(this.b_b&&(La+="ucbf"),va=new S.QueryStringBuilder(va),va.hj("afhskey",La),va=va.toString());return va}isFeatureEnabled(La,va){if(!this.vFa&&!this.jWc&&!this.mra)return this.DCa;c.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",La);if("ConnectedServices"===La){var Ba=
this.vFa?this.X7d.IM("ControllerConnectedServicesEnabled"):this.DCa;const $a=this.jWc?this.$ne.getSettings().then(cb=>2!==cb.ou,()=>va):this.DCa;return Ba.then(cb=>cb?$a:this.Mac)}if("FreemiumUpsell"===La&&(!this.zOc||!this.TVb||this.aOc))return this.Mac;Ba=null;Ba=this.vFa?this.X7d.isFeatureEnabled(La):this.DCa;let Ea=null;Ea=this.mra?this.Ysi(La,va):this.DCa;let pa=null;pa=this.jWc?this.$ne.isFeatureEnabled(La):this.DCa;return Ba.then($a=>$a?pa.then(cb=>cb?Ea:this.Mac):this.Mac).then($a=>{this.Ttf(La,
$a,!0);return $a},()=>{this.Ttf(La,va,!1);return va})}Ttf(La,va,Ba){c.ULS.sendTraceTag(526713106,3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",La,va,Ba)}getFeatureTier(La,va){if(!this.mra)return new Promise(Ba=>{Ba(2)});c.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",La);return this.gva.then(Ba=>this.Lec(La,Ba,va),()=>va)}isFreemiumUpsellEnabled(){if(this.zOc&&this.TVb&&!this.aOc){if(this.jXa&&2!==this.VPc||!this.jXa&&1!==this.VPc)c.ULS.sendTraceTag(509728161,
3004,20,"ApplicationFeatureHelper_IsFreemiumUpsellEnabled: isFreemiumUpsellFeatureEnabled={0}",this.jXa.toString()),this.VPc=this.jXa?2:1;return this.jXa}return!1}launchUpsellExperience(La,va=null){c.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",La));var Ba=I.a.Wr();Ba&&(Ba.set("experienceId",La),va&&Ba.set("campaignId",va));k.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",
Ba);if(Ba=O.a.instance.og("Common.IInProductMessagingUIManager")){const Ea=Object(f.a)(this,this.cci,"handleDimeTaskComplete");Ba.Zrf(La,Ea,va)}else c.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),k.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this.La.$d(N.a.dcc,2,{["experience"]:La})}FAa(La,va){if(!this.mra)return null;if(!La||!va)return c.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),
null;const Ba=G.a.create().toString();this.fva.kb(La)||this.fva.ia(La,new b.a(e.a.li()));this.fva.ma(La).add(Ba,va);c.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",Ba,La));return Ba}LMd(La,va){this.mra&&(La&&this.fva.kb(La)?va&&G.a.isValid(va)?this.fva.ma(La).kb(va)?(c.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",
va,La)),this.fva.ma(La).remove(va)):c.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",va,La)):c.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",va,La)):c.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",
La)))}Lec(La,va,Ba){return this.b_b?La in va?va[La].LicenseTier:Ba:La in va?this.O8i(va[La],Ba):Ba}O8i(La,va){switch(La.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return va}}cci(){c.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.gva.then(La=>{this.fWf(La)}).catch(()=>{this.fWf({})})}fWf(La){c.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");const va=
this.A0d(0,!0);va.then(Ba=>{this.gva=va;D.a.count(Ba)>D.a.count(La)?k.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):k.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(let Ea of this.fva.keys)if(Ea in Ba){const pa=this.Lec(Ea,Ba,0);Ea in La?this.Lec(Ea,La,0)!==pa&&this.JCd(Ea,!0,pa):this.JCd(Ea,!0,pa)}else Ea in La&&this.JCd(Ea,!1,this.Lec(Ea,La,0))}).catch(Ba=>{k.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",
!1,!0,null);c.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(Ba))})}JCd(La,va,Ba){c.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",La,va,Ba);va=new H(La,va,Ba);Ba=this.fva.ma(La);for(let Ea of Ba)try{Ea.value(va)}catch(pa){c.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",
La,Ea.key,pa.message))}}Td(La,va){if(this.mra){const Ba=this.Yee.contains(La);let Ea=!0,pa="",$a=!1;return this.gva.then(cb=>{La in cb?(cb=cb[La],pa=E[cb.FeatureState],Ea=1!==cb.FeatureState):Ea=!Ba;this.buf(La,Ba,pa,$a,va,Ea);return Ea},()=>{$a=!0;Ba&&(Ea=va);this.buf(La,Ba,pa,$a,va,Ea);return Ea})}return this.DCa}buf(La,va,Ba,Ea,pa,$a){c.ULS.sendTraceTag(557389507,3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",
La,va,Ea,Ba,pa,$a)}Ysi(La,va){if(this.b_b)return this.Td(La,va);if(this.mra){if(this.Yee.contains(La))return this.gva.then(Ba=>La in Ba,()=>va);c.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",La)}return this.DCa}Qcj(La){try{La&&"Date"in La&&(this.mYb=new Date(La.Date),c.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.mYb.toString()))}catch(va){c.ULS.sendTraceTag(578863818,
3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",va)}}zeg(){if(void 0!==this.nra&&null!==this.nra){const La=this.nra.Fc;this.nra.stop();return La}return null}static Pdc(La){try{if(P.a.VUj){const va=La.Wa("UserDataSignature").split(".");if(1<va.length){const Ba=window.self.atob(va[1]),Ea=JSON.parse(Ba).LocalStorageKey;if(void 0!==Ea&&null!==Ea&&0<Ea.length)return Ea}}}catch(va){c.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",va.toString())}return null}}
Object(r.a)(W,"ApplicationFeatureHelper",null,[226]);var ea=a(197);class R{constructor(La,va){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=La.PolicySettings;La=new Date;La.setMinutes(La.getMinutes()+va);this.ExpirationTime=La.getTime()}}Object(r.a)(R,"CloudPolicySettingsCacheData",null,[]);var Y=a(803),U=a(383),da=a(233);class T{static Gcg(){return u.AFrameworkApplication.fa.qa("SideCarIsEnabled")?T.$xc&&T.yrd?new Promise(La=>{La(!0)}):new Promise((La,va)=>{T.$xc=da.a.create(u.AFrameworkApplication.fa.Wa("SideCarUrl"));
U.a.Zia(T.$xc);T.$xc.P9((Ba,Ea)=>{(T.yrd=Ea.succeeded)?La(Ea.succeeded):va(Ea.succeeded)})}):new Promise(La=>{La(!1)})}}T.yrd=!1;T.$xc=null;Object(r.a)(T,"SideCarLoader",null,[]);class ka{constructor(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}}Object(r.a)(ka,"CloudPolicySettingsData",null,[]);class L{constructor(La,va){this.HJc=0;this.m5b=null;this.Gkb=new m(La,va);this.fb=La;va=La.Wa("HostAuthType");this.vFa=La.qa("OcpsIsEnabled")&&La.qa("IsO365CommercialHost")&&!(void 0===
va||null===va)&&"aad"===va.toLowerCase();this.ghe=v.b(La.Wa("OcpsDefaultSettings")||"{}");this.Blb=this.Pdc();va=this.fb.Jp("ServicesControlsMicrosoftControllerServicesList")?this.fb.ww("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.NTb=new C.a;for(let Ba=0;Ba<va.length;Ba++)this.NTb.add(va[Ba]);this.vFa&&!La.qa("IsAnonymousUser")&&La.qa("SideCarIsEnabled")?this.m5b=this.R0j():this.m5b=this.ppa(this.vFa,this.Qva("/afhs/CloudPolicySettings.ashx"),Object(f.a)(this,this.r8i,"parseCloudPolicySettingsResponse"));
this.m5b.then(()=>null).catch(Ba=>{Ba=Object(d.a)(l,Ba);c.ULS.sendTraceTag(50622685,3004,10,"CloudPolicySettingsHelper initialization failed, HttpStatus={0}",Ba?Ba.z6a.toString():"Unknown")})}IM(La,va=!0){if(!this.vFa){const $a=this;return new Promise(cb=>{cb($a.qyb(La))})}let Ba=this,Ea=this;const pa=this.m5b.then($a=>{try{let cb=null;$a.PolicySettings&&"unknown"in $a.PolicySettings&&(cb=$a.PolicySettings.unknown);if(cb){if(La in cb&&void 0!==cb[La]&&null!==cb[La])return new Promise(ta=>{ta("0"!==
cb[La])});const ib=La.toLowerCase();if(ib in cb&&void 0!==cb[ib]&&null!==cb[ib])return new Promise(ta=>{ta("0"!==cb[ib])});c.ULS.sendTraceTag(51512667,3004,50,"Policy"+La+" not found, using default");return new Promise(ta=>{ta(Ba.qyb(La))})}return new Promise(ib=>{ib(Ba.qyb(La))})}catch(cb){return c.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+La+" policy value. Error Message: {0}",cb.message),Ba.handleError(cb.toString(),va,Ba.qyb(La))}},$a=>Ea.handleError($a,va,Ea.qyb(La)));pa.then($a=>{c.ULS.sendTraceTag(50651667,
3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",La,$a);return null});return pa}isFeatureEnabled(La,va=!0){if(this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.$si(La,va);let Ba=new Promise(pa=>{pa(!0)}),Ea="";this.NTb.contains(La)&&(Ea="ControllerConnectedServicesEnabled",Ba=this.IM(Ea,va));Ba.then(pa=>{c.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",
La,pa,Ea);return null});return Ba}$si(La,va=!0){let Ba=new Promise(pa=>{pa(!0)}),Ea="";"mso_sendASmile"===La?Ea="Enabled":"Survey"===La||"FloodgateSurvey"===La?Ea="SurveyEnabled":this.NTb.contains(La)&&(Ea="ControllerConnectedServicesEnabled");""!==Ea&&(Ba=this.IM(Ea,va));Ba.then(pa=>{c.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",La,pa,Ea);return null});return Ba}handleError(La,va,Ba){return va?new Promise(Ea=>
{Ea(Ba)}):new Promise((Ea,pa)=>{pa(La)})}ppa(La,va,Ba){if(!La)return Promise.resolve(new ka);let Ea=!1,pa=null;k.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);let $a=this.K6c("GetCloudPolicySettings");return(new Promise((cb,ib)=>{if(void 0!==this.Blb&&null!==this.Blb&&0<this.Blb.length){const ta=this.A0j();if(void 0!==ta&&null!==ta){Ea=!0;cb(ta);return}}this.Gkb.n7c(va,Ba,1,null,Object(f.a)(this,this.Vcj,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],
this.fb.Ad("CloudPolicySettingsRequestQueueTimeout",15E3),this.fb.Ad("CloudPolicySettingsRequestSentTimeout",3E4)).then(ta=>{c.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");this.q1j(ta);cb(ta);return ta},ta=>{ib(ta);return null})})).then(cb=>{({stopwatch:$a,returnValue:pa}=this.bCc($a));var ib=I.a.Wr();ib&&ib.set("FromCache",Ea.toString());ib=Object.assign(new J.a,{durationMs:pa,extendedProperties:ib});k.Health.instance.recordKpiSuccess("GetCloudPolicySettings",
ib);return cb})}R0j(){return T.Gcg().then(()=>{c.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");return sidecar.cloudPolicy.GetCloudPolicySettingsData()})}Qva(La){return String.format("{0}{1}",this.fb.Wa("WebServiceBase"),La)}r8i(La){let va=null;({ot:va}=v.d(La));La=!!va;c.ULS.sendTraceTag(50622687,3004,La?50:10,"ParseCloudPolicySettingsResponse: Success={0}",La);return va}Vcj(La){try{if(void 0!==La&&null!==La&&"CheckIn-Interval"in
La){const va=parseInt(La["CheckIn-Interval"]);void 0!==va&&null!==va&&0<va&&(this.HJc=va)}}catch(va){c.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",va)}}qyb(La){return La in this.ghe?"0"!==this.ghe[La]:!0}A0j(){try{const La=Y.a.instance.getItem(this.Blb);if(void 0===La||null===La)return c.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;c.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",
La);const va=JSON.parse(La);if(void 0===va||null===va)return c.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===va.ExpirationTime||null===va.ExpirationTime)return c.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if((new Date(va.ExpirationTime)).getTime()<Date.now())return c.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),
null;const Ba=new ka;Ba.PolicySettings=va.PolicySettings;Ba.ControllerConnectedServicesFeatureNames=new ea.a;this.fb.Jp("ServicesControlsMicrosoftControllerServicesList")&&this.fb.ww("ServicesControlsMicrosoftControllerServicesList");for(let Ea of this.NTb)Ba.ControllerConnectedServicesFeatureNames.add(Ea);c.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return Ba}catch(La){return c.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",
La.toString()),null}}q1j(La){try{if(void 0===La||null===La||void 0===La.PolicySettings||null===La.PolicySettings)c.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.HJc)c.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{const va=new R(La,this.HJc),Ba=JSON.stringify(va);c.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",Ba);Y.a.instance.setItem(this.Blb,
Ba);c.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(va){c.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",va.toString())}}Pdc(){const La=W.Pdc(this.fb);return La&&0<La.length?"OCPS"+La:null}K6c(La){const va=O.a.instance.og("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return void 0!==va&&null!==va?va.Kc("WebServiceCall",La):null}bCc(La){if(void 0!==La&&null!==La){const va=La.Fc;La.stop();return{returnValue:va,
stopwatch:null}}return{returnValue:null,stopwatch:La}}}Object(r.a)(L,"CloudPolicySettingsHelper",null,[223]);class fa{constructor(){this.APe=this.pog=this.ou=0;this.BPe=this.qog=this.MIa="";this.VUc=this.afa=2}clone(){const La=new fa;La.ou=this.ou;La.pog=this.pog;La.APe=this.APe;La.MIa=this.MIa;La.qog=this.qog;La.BPe=this.BPe;La.afa=this.afa;La.VUc=this.src;return La}get src(){return this.VUc}serialize(La=null){const va={};if(!La||La.contains(fa.mPa))va[fa.mPa]=this.ou;if(!La||La.contains(fa.AGb))va[fa.AGb]=
this.MIa;if(!La||La.contains(fa.BGb))va[fa.BGb]=this.afa;return JSON.stringify(va)}static create(La,va=null){const Ba=new fa;Ba.VUc=La;void 0!==va&&null!==va&&(fa.mPa in va&&(Ba.ou=va[fa.mPa]),fa.AGb in va&&(Ba.MIa=va[fa.AGb]),fa.BGb in va&&(Ba.afa=va[fa.BGb]));return Ba}static deserialize(La,va){try{const Ba=JSON.parse(La);if(void 0!==Ba&&null!==Ba)return fa.create(va,Ba);c.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",La);throw Error.argument("settingsData");
}catch(Ba){throw c.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",Ba.toString()),Ba;}}}fa.mPa="CCS";fa.AGb="CCSTime";fa.BGb="OfficePrivacyRoamedNoticeShown";Object(r.a)(fa,"UserPrivacySettings",null,[]);var wa=a(138);class oa{constructor(La,va){if(void 0===La||null===La||void 0===va||null===va)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.fb=La;this.rh=va;this.oUc=this.ue=null}Qva(La){var va=String.format("{0}RoamingServiceHandler.ashx?action=",
this.fb.appSettings.RoamingServiceHandlerWebServiceBase||"");va=new Sys.StringBuilder(va);va.append(La);va.append("&");va.append(u.AFrameworkApplication.xi);return va.toString()}executeRequest(La,va,Ba,Ea=null){return this.rh.bpb(La,va,Ea,null,Ba,"33",!1,null,6E4)}saveSettings(La){return new Promise((va,Ba)=>{try{if(void 0===this.ue||null===this.ue||void 0===La||null===La)c.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),Ba("Can't determine setting changes to save");
else{var Ea=this.ue.ou!==La.ou;if(2===this.ue.src&&Ea)this.nxj(La),va(!0);else{var pa=this.fBj(La);if(void 0===pa||null===pa||!pa.length)c.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),Ba("No changes to save");else if(1===this.ue.src)va(this.Zjg(pa));else if(0===this.ue.src){c.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",pa);const $a=this.executeRequest(this.Qva("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",
pa);$a.continueWith(()=>{if($a.vh||$a.Lf)c.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),va(!1);else{var cb=$a.result;void 0!==cb.Kg&&null!==cb.Kg&&void 0!==cb.Kg.data&&null!==cb.Kg.data&&cb.Kg.data.httpStatus===n.a.ZO?(c.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),va(!0)):(c.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),va(!1))}})}}}}catch($a){c.ULS.sendTraceTag(50860930,
3004,10,"SaveUserPrivacySettings: Exception = {0}",$a.toString()),va(!1)}})}fBj(La){if(void 0===this.ue||null===this.ue||void 0===La||null===La)throw Error.invalidOperation("User Privacy settings have not been initialized");const va=new ea.a;0===La.src?(this.ue.ou!==La.ou&&(va.add(fa.mPa),va.add(fa.AGb)),this.ue.afa!==La.afa&&va.add(fa.BGb)):1===La.src&&this.ue.ou!==La.ou&&va.add(fa.mPa);return va.count?La.serialize(va):(c.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),
null)}getSettings(){if(!this.oUc){const La=this;this.oUc=new Promise(va=>{try{La.ue?va(La.ue.clone()):La.J0j().then(Ba=>{La.ue=Ba;va(La.ue.clone());return null},()=>{La.H0j().then(Ba=>{La.ue=Ba;va(La.ue.clone());return null},()=>{La.I0j().then(Ba=>{La.ue=Ba;va(La.ue.clone());return null},()=>{c.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");La.ue=new fa;va(La.ue.clone());return null});return null});return null})}catch(Ba){c.ULS.sendTraceTag(50860932,
3004,10,"UserPrivacySettings GetSettings: Exception = {0}",Ba.toString()),La.ue=new fa,va(La.ue.clone())}})}return this.oUc}J0j(){return new Promise((La,va)=>{try{const Ea=-1!==window.location.href.indexOf("&wd_pn=2");if(this.fb.qa("PrivacyDialogShouldCheckRoaming")||Ea){var Ba=this.executeRequest(this.Qva("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");Ba.continueWith(()=>{try{if(Ba.vh||Ba.Lf)c.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");
else{const pa=Ba.result;if(pa&&pa.Kg&&pa.Kg.data)if(pa.Kg.data.httpStatus!==n.a.ZO)c.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",pa.Kg.data.httpStatus);else{if(pa.Kg.data.me){La(oa.parse(pa.Kg.data.me,0));c.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",pa.Kg.data.me);return}c.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else c.ULS.sendTraceTag(50860935,
3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");va("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(pa){c.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",pa.toString()),va("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else c.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),va("Roaming should not be used")}catch(Ea){c.ULS.sendTraceTag(50860939,
3004,10,"TryGetSettingsFromRoaming Exception = {0}",Ea.toString()),va("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})}H0j(){return new Promise((La,va)=>{try{const Ba=wa.a.get("WacUPToggleState");let Ea=null;void 0!==Ba&&null!==Ba&&0<Ba.length&&(Ea=decodeURIComponent(Ba));if(void 0!==Ea&&null!==Ea&&0<Ea.length){const pa=oa.parse(Ea,1);c.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",pa.toString());La(pa)}else{const pa=fa.create(1),
$a=new ea.a;$a.add(fa.mPa);const cb=pa.serialize($a);this.Zjg(cb)?(c.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",cb),La(pa)):(c.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",cb),va("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(Ba){c.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",
Ba.toString()),va("UserPrivacySettings TryGetSettingsFromCookie Eception")}})}I0j(){return new Promise(La=>{try{var va=-1!==window.location.href.indexOf("&wdccsoff=1");let Ba=fa.create(2);va?(Ba.ou=2,u.AFrameworkApplication.gOe(),c.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",Ba.toString())):(Ba.ou=1,c.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",Ba.toString()));La(Ba)}catch(Ba){c.ULS.sendTraceTag(50967431,
3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",Ba.toString()),va=fa.create(2),va.ou=1,La(va)}})}nxj(La){c.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===La.ou?u.AFrameworkApplication.gOe():u.AFrameworkApplication.ovh();c.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",La)}Zjg(La){try{c.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",La);const va=
this.fb.Wa("PrivacyCookieDomain")||"";if(!va||!va.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");c.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",La);return wa.a.$Td("WacUPToggleState",La,wa.a.v_,"/",va)}catch(va){return c.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",va.toString()),!1}}isFeatureEnabled(La){return this.getSettings().then(va=>{const Ba=this.fb.Jp("ServicesControlsMicrosoftControllerServicesList")?
this.fb.ww("ServicesControlsMicrosoftControllerServicesList"):[],Ea=new C.a;for(let pa=0;pa<Ba.length;pa++)Ea.add(Ba[pa]);return Ea.contains(La)?2!==va.ou:!0},()=>{c.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",La);return!0})}static parse(La,va){try{return c.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",La,va),fa.deserialize(La,va)}catch(Ba){throw c.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",Ba.toString()),
Ba;}}}Object(r.a)(oa,"UserPrivacySettingsHelper",null,[224]);var xa=a(257);class bb{constructor(){this.$a=null}get name(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}Kh(La){this.$a=La;this.$a.register(223,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").tc().Bc(()=>new L(u.AFrameworkApplication.fa,u.AFrameworkApplication.Hd));this.$a.register(224,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").tc().Bc(()=>new oa(u.AFrameworkApplication.fa,
u.AFrameworkApplication.Hd));this.$a.register(225,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").tc().Bc(()=>new z(u.AFrameworkApplication.fa,u.AFrameworkApplication.Hd));this.$a.register(226,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").tc().Bc(()=>new W(u.AFrameworkApplication.fa,u.AFrameworkApplication.Hd,this.$a.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),this.$a.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),
u.AFrameworkApplication.rb))}init(){u.AFrameworkApplication.fa.zu(()=>{const La=this.$a.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");u.AFrameworkApplication.fa.qa("LicensingIsEnabled")&&(La.isFeatureEnabled("LicensingTestFeature",!1).then(va=>{c.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",va,u.AFrameworkApplication.fa.Wa("IsAnonymousUser"));return null}),La.getFeatureTier("LicensingTestFeature",
0).then(va=>{c.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",va,u.AFrameworkApplication.fa.Wa("IsAnonymousUser"));return null}));this.$a.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");this.tWj()})}dispose(){}tWj(){try{u.AFrameworkApplication.fa.qa("SideCarIsEnabled")&&T.Gcg().then(La=>{c.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",
La);return La})}catch(La){}}static main(){xa.a.instance.si(new bb)}}Object(r.a)(bb,"ApplicationFeatureHelperPackage",null,[4,5]);a.d(B,"a",function(){return Za});const Za=()=>{Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");bb.main()}},1194:function(r,B,a){var c=a(9);r=a(0);var b=a(228),e=a(155),f=a(15),d=a(1397),h=a(646),l=a(555),k=a(27),w=a(91),n=a(31),x=a(167),m=a(240),u=a(8),t=a(59),y=a(164),v=a(352),A=a(49),z=a(45),C=a(29),H=a(1),I=a(22),S=a(14),
P=a(109),D=a(87),G=a(88),E=a(156),O=a(4),N=a(13),J=a(100),W=a(47),ea=a(1107);class R extends E.a{constructor(Ja,ab=!0){super(!1,!1,R.Su);this.dYa=null;this.V$d=!1;this.jn=[];this.Lj=null;this.WZb=Ja;this.IGg=ab;this.nx=this.Kme=!1;this.Pga=null;this.QLc=!1;this.qg=this.Xph;this.we="InsertFileDialog";this.wc(1,this.t_b);R.Su?(this.dYa={["id"]:this.we,["bodyControls"]:{["uploadButtonProps"]:{["label"]:CommonUIStrings.l_DialogChooseFile,["onExecute"]:Object(G.a)(this,this.t5i,"onUploadButtonClick")}},
["uploadStatusLabel"]:CommonUIStrings.l_DialogNoFileChosen,["onFrameReady"]:Object(G.a)(this,this.iXi,"onFrameReady")},this.initializeAndShow(this.titleText,Object(G.a)(this,this.Chc,"insertDialogHandler"),this.dYa),this.oUb=!0):(this.showDialog(this.titleText,Object(G.a)(this,this.Chc,"insertDialogHandler")),ab&&this.l9f(),(Ja=this.ZJ(1))&&this.jn.push(Ja),(Ja=this.ZJ(0))&&this.jn.push(Ja),this.Mmg(),this.oUb=!1)}get b8j(){return this.WZb}validate(){this.Lj.cF||f.ULS.sendTraceTag(25798091,322,10,
"UploadFrame.FileInputElement is null");return this.Lj.cF.value?!0:(R.Xz(CommonUIStrings.l_FileUploadNoFileSpecified),!1)}iXi(Ja){this.IGg&&(this.Lj=this.k9f(Ja,this.WZb))}t5i(){this.Lj&&this.Lj.cF&&(this.V$d||(this.Lj.Ukj(Object(G.a)(this,this.vEd,"onFileChosen")),this.V$d=!0),this.Lj.$Ye())}vEd(Ja){this.dYa.uploadStatusLabel=Ja;this.LUa(this.titleText,Object(G.a)(this,this.Chc,"insertDialogHandler"),this.dYa)}Chc(Ja){1===Ja&&this.isEnabled()?R.Su&&this.Lj.cF&&!this.Lj.cF.value?(this.dYa.uploadStatusLabel=
CommonUIStrings.l_FileUploadNoFileSpecified,this.LUa(this.titleText,Object(G.a)(this,this.Chc,"insertDialogHandler"),this.dYa)):(this.Wzb(),this.WZb.finalizeUpload(this.Lj,Object(G.a)(this,this.dispose,"dispose"))):0===Ja&&this.hide()}l9f(){this.QLc=!1;this.Lj=this.k9f(document.getElementById("uploadFrameContainer"),this.WZb);O.AFrameworkApplication.fa.qa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.Pga=Object(G.a)(this,this.iGd,"onUploadFrameLoad"),W.a.addHandler(this.Lj.iFrame,"load",this.Pga));
this.Lj.cF||f.ULS.sendTraceTag(25798092,322,15,"UploadFrame.FileInputElement is null");this.VRf()}iGd(){this.VRf()}VRf(){if(this.Lj&&!this.QLc){var Ja=this.Lj.cF;Ja&&(W.a.addHandler(Ja,N.a.Vb,Object(G.a)(this,this.onKeyDown,"onKeyDown")),Ja=[Ja],this.jn=Ja.concat.apply(Ja,this.jn),this.Mmg(),this.QLc=!0)}}dispose(){if(this.Lj&&!R.Su){const Ja=this.Lj.cF;Ja&&W.a.removeHandler(Ja,N.a.Vb,Object(G.a)(this,this.onKeyDown,"onKeyDown"));this.Pga&&W.a.removeHandler(this.Lj.iFrame,"load",this.Pga)}this.Lj=
null;super.dispose()}Mmg(){if(0<this.jn.length){const Ja=new ea.a(this.jn),ab=J.FocusManager.instance().BQ();ab&&(this.jn[0].focus(),ab.lf=Ja,ab.r_=!0)}}onKeyDown(Ja){4!==J.FocusManager.instance().YRf(Ja)&&Ja.preventDefault()}static get Su(){return O.AFrameworkApplication.sa.Qa.Fv&&O.AFrameworkApplication.sa.Qa.Dnf}static Xz(Ja){const ab=document.getElementById("errorText");ab.innerText=Ja;ab.style.display="inline-block"}}Object(r.a)(R,"InsertFileDialog",E.a,[]);class Y{static get qg(){return E.a.Iq(Y.Ql,
CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}Y.Ql="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";Object(r.a)(Y,"InsertImageDialogHtml",null,[]);class U extends R{constructor(Ja,ab=!0){super(Ja,ab)}get t_b(){return CommonUIStrings.l_ImageUploadButtonText}get titleText(){return CommonUIStrings.l_ImageUploadingTitle}get Xph(){return Y.qg}validate(){this.Lj.cF||
f.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");const Ja=Object(D.a)(d.a,this.b8j),ab=Ja.Uog(this.Lj.cF.value);return 0!==ab?(R.Xz(Ja.F4e(ab)),!1):!0}}Object(r.a)(U,"InsertImageDialog",R,[]);var da=a(560);const T=(Ja,ab,wb)=>{if(Ja){var xb=0;do{try{Ja();break}catch(rb){if(f.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",xb,wb,rb.message,rb.stack),xb>=ab)break}xb++}while(1)}};var ka=a(112),L=a(92),fa=a(40),
wa=a(261),oa=a(179),xa=a(82),bb=a(466),Za=a(178);class La{constructor(Ja,ab,wb,xb,rb,za,Aa,pb,kb=!0,Cb=null,ob=!1){this.gZe="FileUpload.ashx";this.io=null;this._initialized=!1;this.Jg=this.akb=this.PLc=this.Pga=this.NUb=this.dr=this.Ms=null;this.Jm=!1;this.bE=this.OUb=this.fWc=null;this._parent=Ja;this.ABg=ab;this.ZFg=wb;this.Bae=rb;this.lUc=Aa;this.F5d=pb;this.B7d=Cb;this.eWc=!1;this.YBg=xb.qa("CanaryRenewalForFileUploadIsEnabled");this.eog=!1;(this.Cra=ob)||this.Aeh(za);kb&&this.chf()}get u1f(){return this.ZFg}get sessionId(){return this.lUc}get iFrame(){return this.io}get cF(){return this.dr}get x$a(){return O.AFrameworkApplication.fa?
O.AFrameworkApplication.fa.qa("NativeFileOpenDialogIsEnabled"):!1}get aZe(){return O.AFrameworkApplication.fa?O.AFrameworkApplication.fa.qa("FileInputDescriptionAccessibilityIsEnabled"):!1}get bvi(){return this.Cra?!1:oa.b(this.io.contentWindow.location.pathname,this.gZe,0)}get bUg(){return!k.a.Exa&&O.AFrameworkApplication.fa.qa("AllowMultipleImageInsertFromLocalDevice")}chf(){this.bE=Za.a.create().toString();this.Cra?this.Nad():this.gVg()}Aeh(Ja){this.io=document.createElement("iframe");this.io.className=
Ja;this.io.id=Ja;this.Bae&&(this.io.style.visibility="visible",this.io.style.height="30px",this.io.setAttribute("frameborder","0"));this.Pga=Object(G.a)(this,this.iGd,"onUploadFrameLoad");W.a.addHandler(this.io,"load",this.Pga)}r9b(Ja=null){O.AFrameworkApplication.sa.ztc();if(!this.dr)return f.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";W.a.addHandler(this.dr,"change",()=>{this.CJh(Ja)});T(Object(G.a)(this,this.$Ye,"fileInputClick"),1,"DoFileOpenDialog");return this.dr.value}CJh(Ja){Ja&&
Ja(this.dr.value)}DJh(){this.NUb&&(this.NUb.innerText=this.Z5e())}Ukj(Ja){W.a.addHandler(this.dr,"change",()=>{Ja(this.Z5e())})}Z5e(){let Ja=null;if(this.dr.value){const ab=this.dr.value,wb=ab.lastIndexOf("\\");0<wb&&(Ja=ab.substring(wb+1,ab.length))}return Ja?Ja:""}$Ye(){try{f.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.dr.click()}catch(Ja){throw f.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",Ja.message),Ja;
}}jUj(){this.yyi()?this.mfg():(this.q2d(),this.Ms.submit())}yyi(){return(this.YBg||this.Cra)&&!(void 0===window.self.FormData||null===window.self.FormData)}G5f(Ja){if(Ja){const ab=this.JIe();this.Jg=new XMLHttpRequest;this.Jg.open("POST",ab);this.Jg.setRequestHeader("X-CorrelationId",this.bE);this.SGi(Ja);this.Jg.onreadystatechange=Object(G.a)(this,this.Cpa,"uploadResponseReceived");this.Jg.send(Ja)}}SGi(Ja){if(!k.a.Exa&&Ja.get){var ab=Ja.get("ImageId");Ja=window.self.navigator;ab={["CorrelationId"]:this.bE,
["Canary"]:O.AFrameworkApplication.canary,["ImageNodeId"]:ab};Ja&&(Ja=Ja.connection?Ja.connection:Ja.mozConnection?Ja.mozConnection:Ja.webkitConnection?Ja.webkitConnection:null)&&(ab.effectiveType=Ja.effectiveType,ab.downlink=Ja.downlink,ab.type=Ja.type,ab.rtt=Ja.rtt);f.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",ab)}}mfg(){try{this.q2d();f.ULS.sendTraceTag(594888409,322,50,"SubmitFormWithRequest is preparing to send an upload request");const Ja=new (Type.parse("FormData"))(this.Ms);
this.G5f(Ja)}catch(Ja){f.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+Ja.message),this.Jab(null)}}lfg(Ja){try{if(this.q2d(),f.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.W9j(Ja)){this.OUb=Ja;this.Ms.contains(this.dr)&&this.Ms.removeChild(this.dr);var ab=new (Type.parse("FormData"))(this.Ms);ab.append("applicationfileInput",Ja.blob,Ja.filename);this.G5f(ab)}else this.Jab(null)}catch(wb){f.ULS.sendTraceTag(591267743,
322,10,"SubmitFormWithBlob failed to send the request with exception "+wb.message),this.Jab(null)}}W9j(Ja){return Ja&&void 0!==Ja.blob&&null!==Ja.blob&&void 0!==Ja.filename&&null!==Ja.filename&&""!==Ja.filename?void 0===window.self.FormData||null===window.self.FormData?(f.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(Ja=Ja?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===Ja.blob||null===Ja.blob,void 0===Ja.filename||null===Ja.filename||
""===Ja.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",f.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",Ja)),!1)}Cpa(){if(4===this.Jg.readyState)if(200===this.Jg.status){f.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.bE);const Ja=this.Jg.getResponseHeader("X-NewKey"),ab=this.Pqi(this.Jg);let wb=!1;if(void 0!==Ja&&null!==Ja&&ab&&(wb=this.K9j(Ja),!this.eWc&&
wb)){f.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.bE);this.eWc=!0;void 0!==this.OUb&&null!==this.OUb?this.lfg(this.OUb):this.mfg();return}f.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.eWc,ab,!(void 0===Ja||null===Ja),wb,this.bE);this.Jab(this.Jg.responseText)}else f.ULS.sendTraceTag(42874946,
322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Jg.status,this.Jg.responseText?!1:!0,this.bE),this.Jab(null)}Pqi(Ja){try{const ab=fa.a(Ja.responseText).Responses;if(void 0!==ab&&null!==ab&&1===ab.length){const wb=ab[0];if(void 0!==wb&&null!==wb&&2===wb.length&&28===wb[1].StatusCode)return!0}}catch(ab){}return!1}K9j(Ja){bb.a.Klg(Ja);return O.AFrameworkApplication.canary!==Ja?!1:!0}q2d(){this.fWc||(this.fWc=new Date)}dispose(){this.Jm||(this.Cra?this._parent.removeChild(this.Ms):
(this._parent.removeChild(this.io),W.a.removeHandler(this.io,"load",this.Pga),this.Pga=null),this.PLc&&(W.a.removeHandler(this.dr,"change",this.PLc),this.PLc=null),this.aZe&&(this.akb&&(W.a.removeHandler(this.dr,"change",this.akb),this.akb=null),this.NUb=null),this.dr=this.Ms=this._parent=this.io=null,this.Jm=!0,this.fWc=null,f.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))}delayedDispose(){this.dispose()}ghh(Ja){if(this.Ms){var ab;(ab=this.Ms.querySelector("input[name=__REQUESTDIGEST]"))?
ab.value=Ja:(ab=this.q7c(),ab.type="hidden",ab.id="__REQUESTDIGEST",ab.name="__REQUESTDIGEST",ab.value=Ja,this.Ms.appendChild(ab))}}q7c(){return this.Cra?document.createElement("input"):this.io.contentWindow.document.createElement("input")}iGd(){try{if(!this.io.contentWindow.document.body)return}catch(ab){this.Nei();return}if(!(this._initialized||this.x$a&&k.a.xF))this.Nad();else if(!this.x$a||!k.a.xF||this.bvi){let ab;ab=k.a.Dv?this.io.contentWindow.document.body.innerText:this.eog?this.io.contentWindow.document.body.firstChild.innerText:
this.io.contentWindow.document.body.firstChild.innerHTML;var Ja=this.io.contentWindow.document.body.innerText.toLowerCase();const wb=0<=Ja.indexOf("responses")||0<=Ja.indexOf("wopisrc");Ja=0<=Ja.indexOf("http error");!wb&&Ja&&f.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.io.contentWindow.document.body.innerText);this.Jab(ab)}}Nad(){if(!this._initialized){var Ja=this.ga("uploadForm");const ab=this.ga("fileInput"),wb=this.JIe();this.Ogh();this.Ms.id=
Ja;this.Ms.method="post";this.Ms.encoding="multipart/form-data";this.Ms.action=wb;this.dr.type="file";this.F5d&&(this.dr.accept=this.F5d,this.B7d&&(this.dr.capture=this.B7d));this.dr.id=ab;this.dr.name=ab;this.bUg&&(this.dr.multiple=!0);!this.aZe||k.a.Dv||k.a.MH||(this.akb=Object(G.a)(this,this.DJh,"fileInputChangedHandleAccessibility"),W.a.addHandler(this.dr,"change",this.akb),this.NUb=L.a.Kve(this.Ms,this.dr,"InputFileDescription"));this.Bae&&(this.Cra||(Ja=this.io.contentWindow.document.body,Ja.style.margin=
"0",Ja.style.overflow="hidden"),Ja=O.AFrameworkApplication.sa,this.dr.style.fontFamily=Ja.Z0,this.dr.style.fontSize=Ja.nEc,this.dr.style.margin="0");(Ja=document.getElementById("__REQUESTDIGEST"))&&this.ghh(Ja.value);this.Ms.appendChild(this.dr);this._initialized=!0;this.ABg(this)}}Ogh(){if(this.Cra)this.Ms=document.createElement("form"),this._parent.appendChild(this.Ms),this.dr=document.createElement("input");else{this.Ms=this.io.contentWindow.document.createElement("form");const Ja=this.io.contentWindow.document;
Ja.body.appendChild(this.Ms);this.dr=Ja.createElement("input")}}gVg(){this._parent.appendChild(this.io);this.x$a&&k.a.xF&&this.Nad()}JIe(){var Ja=new wa.QueryStringBuilder(this.gZe);O.AFrameworkApplication.yZa(Ja);this.TBj(Ja);Ja=Ja.toString();if(k.a.Ff||k.a.xF||k.a.MH)Ja=xa.a.Zfd(Ja);return Ja}qqe(){const Ja=new ka.a(2,1,0,Object(G.a)(this,this.delayedDispose,"delayedDispose"),4);O.AFrameworkApplication.ti.ig(Ja)}}Object(r.a)(La,"UploadFrame",null,[3]);var va=a(44),Ba=a(117),Ea=a(21);class pa extends La{constructor(Ja,
ab,wb,xb,rb,za,Aa=!1){super(Ja,ab,wb,xb,rb,"UploadFrame",za.ea.sessionId,"image/*",!1,null,Aa);this.$=za;this.eog=!0;this.chf()}ga(Ja){return Ja}TBj(Ja){f.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");Ba.a.h_c(Ja,this.$.ya);Ja.K9(u.a.sessionId,this.sessionId);var ab=Ea.h(this.$).ha;ab=va.o(ab.ra.f4,this.$);Ja.K9(u.a.gej,this.$.ua.na.name);Ja.K9(u.a.fej,ab.FirstRow.toString());Ja.K9(u.a.eej,ab.FirstColumn.toString())}Nei(){this.u1f("ServerUploadError")}Jab(Ja){this.u1f(Ja)}static Wsi(Ja){return!Ja||
I.a.equals(Ja,"ServerUploadError",!1)}}Object(r.a)(pa,"UploadFrameWrapper",La,[]);class $a extends U{constructor(Ja,ab,wb,xb){super(Ja,!1);this.mQ=null;this.$Ba=!1;this.htmlSanitizationHelper=null;this.fqc=()=>{this.C1d("");this.CEc();return!1};this.$=ab;this.PFc=Ja;this.UQ=da.a.instance;this.fa=wb;this.htmlSanitizationHelper=xb;this.l9f();this.rpd();this.$.pb.Gw=!0}k9f(Ja,ab){return new pa(Ja,Object(G.a)(ab,ab.WHb,"onUploadFrameInitialized"),Object(G.a)(ab,ab.Cpa,"uploadResponseReceived"),this.fa,
!0,this.$)}dispose(){this.CEc();this.UQ=this.PFc=null;super.dispose()}hide(){super.hide();this.$.pb.Gw=!1}validate(){var Ja=this.PFc.Z2d(this.Lj.cF.value,this.PFc.Ejg(this.Lj));return 0!==Ja?(Ja=this.PFc.Fhd(Ja).Description,this.C1d(Ja),this.DYd(),!1):!0}isEnabled(){return!0}C1d(Ja){H.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&H.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")&&this.htmlSanitizationHelper?this.htmlSanitizationHelper.l7f(this.mQ,
Ja):this.mQ.innerHTML=Ja}rpd(){this.mQ=document.getElementById("errorText");this.mQ.style.display="inline-block";this.$Ba=!1;this.C1d("");this.wJa.style.maxWidth=this.wJa.currentStyle.minWidth}DYd(){this.UQ.ta(N.a.click,this.Lj.cF,this.fqc);this.UQ.ta(N.a.Vb,this.Lj.cF,this.fqc);this.$Ba=!0}CEc(){this.$Ba&&(this.UQ.Aa(N.a.click,this.Lj.cF,this.fqc),this.UQ.Aa(N.a.Vb,this.Lj.cF,this.fqc),this.$Ba=!1)}}Object(r.a)($a,"InsertImageDialogWrapper",U,[]);var cb=a(53),ib=a(58),ta=a(50),Ya=a(38),Da=a(108),
ba=a(153),ya=a(54);class V extends d.a{constructor(Ja,ab,wb,xb,rb=!0){super(null,ab,wb);this.lja=this.Tt=null;this.Q8a=!1;this.QHd=null;this.Cpa=za=>{this.T3d.stop();this.u2b.cancel();if(pa.Wsi(za))this.ADc?this.xbf(4):(za=new h.a(0,2,null,null,!1,null,null,null),za.status=8,this.f0d(new l.a(za),null,"InsertPictureWebMethod")),f.ULS.sendTraceTag(526399121,0,50,`Http Error occurred, isTimeoutError: ${this.ADc}`);else{const Aa=V.b$j(za);0!==Aa?(f.ULS.sendTraceTag(526399122,0,50,`Server returned error, response: ${za}`),
this.xbf(Aa)):this.Aei(za)}this.Trc();this.dispose()};this.BWi=za=>{this.YCa(za,this.Lj)&&this.finalizeUpload(this.Lj,null)};this.WHb=za=>{f.ULS.sendTraceTag(526399120,0,50,"Upload frame initialized");this.Lj=za;if(!this.K2a){if(this.y2d){if(this.LBe()||this.x$a&&k.a.xF){za.r9b(this.BWi);return}const Aa=za.r9b(null);if(!this.YCa(Aa,za))return}this.finalizeUpload(za,null)}};this.O4i=()=>{this.ADc=!0};this.mb=Ja;this.T3d=Ja.Mb.vg("WebServiceCall","InsertPictureOperation");this.u2b=A.a.instance.create(this.O4i,
1E5,z.a.MYg,!1);this.ADc=!1;this.Snc=this.$.ya.InsertPictureMaxFileSizeBytes;xb&&(this.Q8a="TestOnly"in xb);rb&&this.showDialog()}get $(){return this.mb}get qLi(){return this.Snc/1024/1024}dispose(){w.a.Ja(this.u2b);this.Lj&&this.Lj.qqe();this.Lj=this.u2b=this.mb=null}Uhj(Ja){if(!this.$)return f.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),ib.Task.Ta(!0);if(!this.$.Uba)return ib.Task.Ta(!0);const ab=new x.a,wb=new FileReader;Ja=Ja.cF.files[0];const xb=()=>{ab.hx(!0)};
wb.onload=()=>{this.QHd=wb.result;ab.hx(!0)};wb.onerror=xb;wb.onabort=xb;wb.readAsDataURL(Ja);return ab.task}Ejg(Ja){let ab=-1;Ja=Ja.cF;(null===Ja||void 0===Ja?0:Ja.files)&&0<Ja.files.length&&(ab=Ja.files[0].size);return ab}Z2d(Ja,ab){let wb=V.udh(d.a.YCa(Ja));0===wb?-1!==ab&&(f.ULS.sendTraceTag(526399118,0,50,`Validating picture, pictureSize: ${ab}, maxAllowedSize: ${this.Snc}, remainingWorkbookSize: ${this.$.ea.Erf}`),ab>this.Snc?wb=3:ab>this.$.ea.Erf&&(wb=7)):6===wb&&this.bJi(Ja);f.ULS.sendTraceTag(526399117,
0,50,`Validated file on client, validation result: ${wb}`);return wb}YCa(Ja,ab){Ja=this.Z2d(Ja,this.Ejg(ab));return 0!==Ja?(this.K2a||1===Ja||this.mWd(Ja),!1):!0}Xig(Ja){Ja.jUj()}Fhd(Ja){let ab=0,wb=1,xb=-1100324317,rb="InsertPictureUnknownError",za=null;switch(Ja){case 1:ab=1758;wb=0;xb=940870981;rb="InsertPictureNoFileSelected";break;case 3:wb=0;xb=1250467391;rb="InsertPicturePictureTooBig";za=String.format(S.a.instance.nb(181),this.qLi.toLocaleString());break;case 6:ab=1762;wb=0;xb=1380041209;
rb="InsertPictureUnsupportedFormat";break;case 7:ab=1759;wb=0;xb=-903115058;rb="InsertPictureExceedWorkbookSize";break;case 4:ab=1760;wb=0;xb=1218352119;rb="InsertPictureUploadTimeout";break;case 5:ab=1761,wb=0,xb=1979899005,rb="InsertPictureServiceNonDeterministicError"}Ja=V.hd(ab,wb,xb,rb);za&&(Ja.Description=za);return Ja}showDialog(){if(this.LBe())this.K2a=!1,this.Lj=new pa(this.$.domElement,this.WHb,this.Cpa,this.fa,!1,this.$,!0);else if(f.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),
!this.Q8a&&(k.a.Cw||k.a.xF&&72>k.a.ZDe))this.K2a=!1,this.Lj=new pa(this.$.domElement,this.WHb,this.Cpa,this.fa,!1,this.$);else{this.K2a=!0;let Ja=m.a.Ta(null);H.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&H.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")&&(Ja=H.EwaSettings.isChangeGateEnabled("OfficeVSO:7621821_migrate-HtmlSanitizationHelper-to-new-service")?Object(Da.c)(ba.a.resolve(ya.w,{Wb:0})):ta.GetServiceTaskFactory.Pa(this.$.da,
498,499,0));Ya.TaskExtensions.za(Ja,()=>{this.Lj=(new $a(this,this.$,this.fa,Ja.result)).Lj},this.$.ka,3)}}Aei(Ja){let ab={};try{if(ab=t.a.Yh(Ja),cb.b().hC(this.T3d.id,ab.ServerCorrelationId,"actions","ServerActions"),!C.a.Zf(ab.Errors)&&ab.Result){this.$.ea.lX(ab.StateId,"BasePictureUploaderWrapper.UploadResponseReceived");const wb=ab.Result;P.a(this.$).Yna(1,wb);const xb=this.$.da.Ba(277);xb&&xb.WXc(this.$,1,ab.Result,ab,"InsertPicture");f.ULS.sendTraceTag(526399114,0,50,"Insert picture completed successfully :)")}}catch(wb){f.ULS.sendTraceTag(526399113,
0,50,`BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: ${Ja?Ja.length:-1}, errror: ${wb}`)}this.bEc(ab,null,"InsertPictureWebMethod")}xbf(Ja){Ja=this.Fhd(Ja);const ab={};ab.Errors=[Ja];this.bEc(ab,null,"InsertPictureWebMethod")}bEc(Ja,ab,wb){this.Tt(Ja,ab,wb)}f0d(Ja,ab,wb){this.lja(Ja,ab,wb)}mWd(Ja){Ja=this.Fhd(Ja);H.EwaSettings.jy()?new v.a(this.$,Ja):(new y.ErrorDialog(this.$,Ja)).fg()}bJi(Ja){const ab=this.$.ya.InsertPicturUnsupportedExtensionsForLogging;
Ja=n.a.cl(Ja);for(let wb=0;wb<ab.length;++wb)if(Ja.endsWith(ab[wb])){f.ULS.sendTraceTag(526399112,0,50,`Insert picture blocked invalid extension: ${ab[wb]}`);break}}static b$j(Ja){return!Ja||I.a.equals(Ja,u.a.insertPictureUnknownError,!0)?2:I.a.equals(Ja,u.a.insertPictureNoFileSelectedError,!0)?1:I.a.equals(Ja,u.a.uni,!0)?3:I.a.equals(Ja,u.a.vni,!0)?5:0}static hd(Ja,ab,wb,xb){return C.a.hd(1,0,0,Ja,ab,wb,xb)}static udh(Ja){switch(Ja){case 1:return 1;case 2:return 6}return 0}LBe(){return this.Q8a||
void 0===window.self.FormData||null===window.self.FormData?!1:!0}}Object(r.a)(V,"BasePictureUploaderWrapper",d.a,[3]);class Z extends V{constructor(Ja,ab,wb,xb,rb,za=!0){super(Ja,ab,wb,xb,!1);this.IJh=rb;this.bbc=Ja.Mb.vg("LoadResource","FileReaderUploaderLoadResource");za&&this.showDialog()}LNj(){this.Snc=28E5;this.mWd(3)}Kdd(Ja){f.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");const ab=new FileReader;Ja=Ja.cF.files;if(0==Ja.length)f.ULS.sendTraceTag(526399110,
0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var wb=Ja[0];ab.onload=()=>{this.bbc.stop();this.IJh.i4i(ab.result,this);f.ULS.sendTraceTag(526399109,0,50,`FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:${wb.type}, Size:${wb.size.toString()}`)};ab.onerror=()=>{this.bbc.stop();f.ULS.sendTraceTag(526399108,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:${wb.type}, Size:${wb.size.toString()}`)};ab.onabort=()=>{this.bbc.stop();
f.ULS.sendTraceTag(526399107,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:${wb.type}, Size:${wb.size.toString()}`)};this.bbc.start();ab.readAsDataURL(wb)}}finalizeUpload(Ja,ab){this.Kdd(Ja,ab)}}Object(r.a)(Z,"FileReaderUploaderWrapper",V,[434]);var ja=a(379),la=a(198);class ua{constructor(Ja,ab){this.dataUri=this.sheetName=null;this.sheetName=Ja;this.dataUri=ab}getSheetName(){return this.sheetName}}Object(r.a)(ua,"MacroRecorderPictureInsertedPayload",null,[123]);class eb extends V{constructor(Ja,
ab,wb,xb,rb,za=!0){super(Ja,wb,xb,rb,!1);this.Ud=ab;za&&this.showDialog()}Kdd(Ja,ab){super.finalizeUpload(Ja,ab);ja.a(this.$.userOperationManager,(wb,xb)=>{this.Tt=wb;this.lja=xb;this.T3d.start();this.u2b.$p();this.ADc=!1;this.Xig(Ja);return this.Uhj(Ja)},wb=>{const xb={};this.$.Sj(xb);const rb=xb.SheetName;wb=new la.a(510,0,wb,72,()=>new ua(rb,this.QHd?this.QHd:""));wb.zBa(()=>!0);wb.Ud=this.Ud;return wb},this.Ud)}finalizeUpload(Ja,ab){this.Kdd(Ja,ab)}}Object(r.a)(eb,"PictureUploaderWrapper",V,[]);
class Eb{constructor(Ja,ab){this.filename=Ja;this.blob=ab}}Object(r.a)(Eb,"UploadBlobParameters",null,[]);class Wb extends eb{constructor(Ja,ab,wb,xb,rb,za,Aa){super(Ja,ab,wb,xb,rb,!1);this.y2d=!1;this.MI=Aa;this.Ugc=Wb.EPh(za);Ja=this.Z2d(this.Ugc.name,this.Ugc.size);0!==Ja?(this.mWd(Ja),this.MI.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),this.dispose()):this.Lj=new pa(this.$.domElement,this.WHb,this.Cpa,xb,!1,this.$)}f0d(Ja,ab,wb){super.f0d(Ja,ab,wb);this.MI.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))}bEc(Ja,
ab,wb){super.bEc(Ja,ab,wb);C.a.Zf(Ja.Errors)?this.MI.setException(Error.create(`DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: ${C.a.qc(Ja.Errors)}`)):this.MI.setResult(!0)}Xig(Ja){const ab=new Eb(this.Ugc.name,this.Ugc);Ja.lfg(ab)}static EPh(Ja){var ab=Ja.split(",");Ja=ab[0].includes("base64")?window.self.atob(ab[1]):window.self.decodeURI(ab[1]);ab=ab[0].split(":")[1].split(";")[0];const wb=new Uint8Array(Ja.length);for(let xb=0;xb<Ja.length;xb++)wb[xb]=
Ja.charCodeAt(xb);Ja=new Blob([wb],{type:ab});Ja.name="Image.png";return Ja}}Object(r.a)(Wb,"DataUrlUploaderWrapper",eb,[]);let Ab=class{constructor(){}fmi(Ja,ab,wb,xb,rb){new eb(Ja,ab,wb,xb,rb,!0)}eli(Ja,ab,wb,xb,rb,za){new Wb(Ja,null,ab,wb,xb,rb,za)}qli(Ja,ab,wb,xb,rb){new Z(Ja,ab,wb,xb,rb,!0)}};Ab=Object(e.b)([Object(ba.d)(ya.T)],Ab);Object(r.a)(Ab,"UploaderCreator",null,[383]);class Jb extends b.a{constructor(Ja){super();this.$=Ja;this.Gb()}static la(Ja){Ja.da.Ha(485,new Jb(Ja))}create(){var Ja;
this.qb(null!==(Ja=this.$.da.Ba(484))&&void 0!==Ja?Ja:this.$.da.Ha(484,new Ab))}}Object(r.a)(Jb,"UploaderCreatorFactory",b.a,[]);var Gb=a(70);a.d(B,"a",function(){return Nb});const Nb=()=>{c.a.Fa(Ja=>{Object(Gb.b)("OfficeVSO:7625189_MoveUploaderCreatorToNewServiceInfra")||Jb.la(Ja)})}},1226:function(r,B,a){var c=a(9);r=a(0);var b=a(714),e=a(167),f=a(107),d=a(4),h=a(196),l=a(15),k=a(1397),w=a(31),n=a(102),x=a(86),m=a(565),u=a(178),t=a(44),y=a(379),v=a(198),A=a(291),z=a(29),C=a(255),H=a(11),I=a(14),
S=a(290),P=a(109),D=a(21),G=a(156),E=a(92),O=a(100),N=a(172),J=a(192),W=a(93),ea=a(164),R=a(352),Y=a(1),U=a(1274),da=a(82);class T extends U.a{constructor(Ya,Da){super(Ya,da.a.oba(Da))}Xuc(Ya,Da){this.isEnabled()&&this.nY(this.targetOrigin)&&(this.lo(Ya),this.Il(Ya,Da))}}Object(r.a)(T,"InsertMediaCrossDocumentMessenger",U.a,[461,125,3]);var ka=a(7);class L{}Object(r.a)(L,"OnlineMediaSearchResult",null,[]);var fa=a(322);class wa extends G.a{constructor(Ya,Da,ba,ya,V,Z){super();this.Cjc=!1;this.jxd=
this.BD=this.$wa=null;this.vTi=()=>{this.eva(this.n0a)};this.$vd=ja=>{ja.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==ja.target.id||ja.shiftKey?"KeepFocusStartDiv"===ja.target.id&&ja.shiftKey&&(ja.preventDefault(),document.getElementById("KeepFocusDiv").focus()):(ja.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};this.C_i=()=>{this.Vpb&&(this.Vpb.launchUpsellExperience("stockimages"),l.ULS.sendTraceTag(537155807,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};this.ll=
Z;this.$=Ya;this.rhf=Da;this.Vpb=ba;this.lBa=[];this.Lxf=ya;this.Yph=V;this.Kue=this.$.ya.InsertOnlinePictureMaxCountOfImagesToInsert;this.qg=this.thh()}kOj(Ya){this.Cjc=!1;this.showDialog(this.ll,null);this.$wa=document.getElementById(this.Oh("InsertMediaFrame"));if(!this.$wa)throw this.eva(this.n0a),Error.invalidOperation("Couldn't get InsertMediaIframe.");var Da=document.getElementById(this.Oh("WACDialogPanel"));Da&&Da.setAttribute(E.a.Jd,E.a.D_a);Da=document.createElement("div");Da.id="KeepFocusStartDiv";
Da.tabIndex=0;Da.className="keep-focus-start";this.$wa.parentNode.insertBefore(Da,this.$wa.parentNode.firstChild);Da=document.createElement("div");Da.id="KeepFocusDiv";Da.tabIndex=0;Da.className="keep-focus";this.$wa.parentNode.appendChild(Da);$addHandler(this.wJa,"keydown",this.$vd);this.$wa.src=this.rhf;this.$wa.frameBorder="0";Da=document.getElementById(this.Oh("WACDialogButtonPanel"));if(!Da)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");Da.className="display-none";Da=document.getElementById(this.Oh("WACDialogTitleText"));
if(!Da)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");Da.className="display-none";2===this.Lxf&&(document.getElementById(this.Oh("WACDialogTitlePanel")).className="display-none",document.getElementById(this.Oh("WACDialogBodyPanel")).className="padding-zero");O.FocusManager.instance().BQ().scope.nN=!0;this.BD=new T(this.$wa.contentWindow,this.rhf);this.BD.nY("https://osiziwuspersimmon002.blob.core.windows.net");this.BD.nY("https://osizewuspersimmon001.blob.core.windows.net");this.BD.nY("https://osizpscuspersimmon000.blob.core.windows.net");
this.BD.nY("https://cdn.hubblecontent.msit.osi.office.net");this.BD.nY("https://cdn.hubblecontent.osi.office.net");this.BD.Xuc(N.a.xMg,ba=>{this.jSi(ba,Ya.Cpa)});this.BD.Xuc(N.a.insert,()=>{this.PZi(Ya.Cpa)});this.BD.Xuc(N.a.v2c,this.vTi);2===this.Lxf&&0===this.Yph&&(this.BD.Xuc(N.a.sDi,this.C_i),this.jxd=this.Vpb.FAa("MsoPremiumStockImages",ba=>{l.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");ba.isEnabled?this.BD.uj(N.a.W7j,{["LicenseTier"]:ba.toString()}):
l.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))}dispose(){this.lBa=null;this.Vpb&&this.jxd&&this.Vpb.LMd("MsoPremiumStockImages",this.jxd);this.BD&&(this.BD.dispose(),this.BD=null);super.dispose()}hide(){super.hide();W.a.ozc(this.$)}get g4(){return J.a.L8b+"/InsertMediaDialog"}get DY(){return!1}jSi(Ya,Da){Ya=Ya&&Ya.Values?(Ya=Ya.Values)?Object(ka.a)(new L,{Action:Ya.action||"",Caption:Ya.caption||"",ContentType:Ya.contentType||"",FileExtension:Ya.extension||
"",PageUrl:Ya.pageUrl||"",SourceUrl:Ya.sourceUrl||"",ThumbnailUrl:Ya.thumbnailUrl||"",LicenseUrl:Ya.licenseUrl||"",LicenseDisplayName:Ya.licenseDisplayName||"",Height:Ya.height||0,Width:Ya.width||0}):null:null;Ya&&(this.lBa.push(Ya),this.Cjc&&(l.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),Da(this.lBa),this.Cjc=!1,this.eva(this.n0a)))}PZi(Ya){this.lBa&&0<this.lBa.length?this.lBa.length<=this.Kue?(Ya(this.lBa),this.eva(this.n0a)):(this.Xz(),l.ULS.sendTraceTag(537155808,
0,10,"OnInsert : Tried to insert more than allowed limit of items."),this.lBa.length=0):this.Cjc=!0}thh(){const Ya=document.createElement("div");Ya.id="InsertMediaDialog";Ya.className=Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";const Da=document.createElement("div");Da.id="InsertMediaPanel";Da.className=Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",
!0)?"insert-media-panel":"insert-media-panel-old";const ba=document.createElement("iframe");ba.id="InsertMediaFrame";ba.className="insert-media-frame";Ya.appendChild(Da);Da.appendChild(ba);return fa.b(Ya)}Xz(){const Ya=z.a.hd(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");Ya.Description=String.format(I.a.instance.nb(206),this.Kue.toLocaleString());Y.EwaSettings.jy()?new R.a(this.$,Ya):(new ea.ErrorDialog(this.$,Ya)).fg()}}Object(r.a)(wa,"InsertMediaDialog",G.a,[]);var oa=a(386),xa=a(298);
class bb extends k.a{constructor(Ya,Da,ba,ya,V,Z){super(null,ba,ya);this.jvf=0;this.Cpa=ja=>{if(ja){var la=Array(ja.length);for(var ua=0;ua<ja.length;ua++){const Wb=ja[ua];la[ua]={};la[ua].SourceUrl=Wb.SourceUrl;w.a.Gxa(Wb.LicenseUrl)&&w.a.Gxa(Wb.PageUrl)&&(la[ua].LicenseUrl=Wb.LicenseUrl,la[ua].LicenseDisplayName=Wb.LicenseDisplayName,la[ua].PageUrl=Wb.PageUrl);la[ua].AltText=-2053056795===this.Ud.command?Wb.Caption:""}var eb=-2009825598===this.Ud.command?"bing":"M365";ua=D.h(this.$);var Eb=t.o(ua.ha.ra.activeCell,
this.$);y.a(this.$.userOperationManager,(Wb,Ab,Jb)=>A.s(this.$.pa.va,Eb,la,eb,S.b(Wb,this.l1i),S.a(Ab,this.k1i),Jb,null),Wb=>new v.a(595,0,Wb),this.Ud);H.HelperMethods.b_?(ua=new Map,ua.set("MediaProvider",eb),ua.set("ImagesCount",ja.length.toString()),ua.set("TimeTakenToOpenDialog",this.jvf.toString()),n.Health.instance.recordKpiUsage(xa.a.rni,1,oa.a.Jgg,ua)):l.ULS.sendTraceTag(537155805,0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.Trc()}else l.ULS.sendTraceTag(537155806,
0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};this.l1i=ja=>{C.a(ja)?l.ULS.sendTraceTag(537155799,0,10,`OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: ${z.a.qc(ja.Errors)}`):(l.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),ja.Result?P.a(this.$).Yna(1,ja.Result):l.ULS.sendTraceTag(537155800,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};
this.k1i=()=>{l.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};this.$=Ya;this.Ud=Da;this.MI=Z;this.sve=x.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");this.showDialog()}dispose(){this.$=null}showDialog(){let Ya=null;Ya=this.$.Mb.Kc("UserAction","showOnlineImagesDialogTimeStopwatch");switch(this.Ud.command){case -2009825598:this.uNj();break;case -2053056795:this.sve.execute(Da=>{Da.isFeatureEnabled("MsoPremiumStockImages",
!1).catch(ba=>l.ULS.sendTraceTag(557200643,0,10,`OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: ${ba}`)).then(ba=>{this.vNj(ba);return null})})}Ya.stop();this.jvf=Ya.Fc}uNj(){let Ya=this.$.ya.BingPictureEndpoint;const Da=m.a.bK(d.AFrameworkApplication.lcid),ba=u.a.create();Ya?(Ya=0<Ya.search(RegExp("insertmedia.bing.office.net","gi"))?String.format(Ya,1,1):String.format(Ya,1,d.AFrameworkApplication.lcid,Da?Da.name:"en-us",d.AFrameworkApplication.buildVersion,
ba.toString(),1,this.$.ya.DocumentHostInfo.LoggableUserId),this.K6b(Ya,1,-1,I.a.instance.ga(1764))):(l.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),this.MI.setException(Error.create("Failed to access the Bing service endpoint")))}vNj(Ya){var Da=this.$.ya.M365PictureEndpoint,ba=u.a.create();if(Da){var ya=this.$.ya.DocumentHostInfo.UserId;ya=ya?w.a.mu(ya).toString():"0";var V=this.sve.instance.isFreemiumUpsellEnabled();
Ya=Ya?1:V?0:-1;ba=ba.toString();V=m.a.bK(d.AFrameworkApplication.lcid).name;Da=String.format(Da,d.AFrameworkApplication.lcid,V,d.AFrameworkApplication.buildVersion,ba,1,ya,Ya,1);this.K6b(Da,2,Ya,I.a.instance.ga(1763))}else l.ULS.sendTraceTag(537155803,0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.MI.setException(Error.create("Failed to access the M365 service endpoint"))}K6b(Ya,Da,ba,ya){try{(new wa(this.$,Ya,x.a.instance.og("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),
Da,ba,ya)).kOj(this),this.MI.setResult(!0)}catch(V){l.ULS.sendTraceTag(537155802,0,10,`OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : ${V}] [MediaProvider : ${Da}] [DialogLicenseTier : ${ba}]`),this.MI.setException(V)}}}Object(r.a)(bb,"OnlinePictureUploaderWrapper",k.a,[3]);var Za=a(58);class La{constructor(Ya,Da){this.$=Ya;this.uploaderCreator=Da}executeCommand(Ya,Da,ba){Ya=Da.command;switch(Ya){case 1403967063:if(ba&&"dataUrl"in ba)return Da=new e.a,this.uploaderCreator&&
this.uploaderCreator.eli(this.$,f.a.instance,d.AFrameworkApplication.fa,ba,ba.dataUrl,Da),Da.task;this.uploaderCreator&&this.uploaderCreator.fmi(this.$,Da,f.a.instance,d.AFrameworkApplication.fa,ba);return Za.Task.Ta(!0);case -2053056795:case -2009825598:return Ya=new e.a,new bb(this.$,Da,f.a.instance,d.AFrameworkApplication.fa,ba,Ya),Ya.task;default:return h.a(Ya)}}Ac(Ya,Da){if(Ya=this.$.isEditMode)switch(Da.command){case 1403967063:Ya=!0;break;case -2053056795:Ya=!0;break;case -2009825598:Ya=!0;
break;default:Ya=!1}return Ya}Rc(){return!1}Mc(){return!1}}Object(r.a)(La,"PictureCommandHandler",null,[222]);var va=a(38),Ba=a(50),Ea=a(108),pa=a(153),$a=a(54),cb=a(70);class ib extends b.a{constructor(Ya){super(Ya)}ld(){va.TaskExtensions.za(Object(cb.b)("OfficeVSO:7625189_MoveUploaderCreatorToNewServiceInfra")?Object(Ea.c)(pa.a.resolve($a.T,{Wb:this.Na})):Ba.GetServiceTaskFactory.Pa(this.$.da,484,485,1),Ya=>{this.fd([new La(this.$,Ya.result)])},this.$.ka,3)}static la(Ya){b.a.Rd(90,new ib(Ya))}}
Object(r.a)(ib,"PictureCommandHandlerFactory",b.a,[]);a.d(B,"a",function(){return ta});const ta=()=>{c.a.Fa(Ya=>{ib.la(Ya)})}},1252:function(r,B,a){var c=a(9);r=a(0);var b=a(228),e=a(15),f=a(517),d=a(39),h=a(4),l=a(63);class k{}k.$hd="GetFontPreviewData";Object(r.a)(k,"FontWebServiceMethods",null,[]);const w=(H,I,S,P,D=null)=>{const G=k.$hd;D=H.Oa(5,D);D.locale=h.AFrameworkApplication.uiCulture;return l.g(H,G,D,I,S,P,null,644)};var n=a(11),x=a(1),m=a(43),u=a(117),t=a(29);const y={xlyellow:"xlyellow"};
class v extends d.a{constructor(H,I){super();this.$=H;this.tv=I;this.Hja={};this.xO={};this.Wwe=!1;this.styles=null;this.cXi=(S,P,D)=>{e.ULS.sendTraceTag(520710152,1,50,`FontServiceManager.onFontPreviewRequestComplete: Attempt to request FontUrl method: ${D} has succeeded.`);this.Fbj(S);this.Wwe=!0;e.ULS.sendTraceTag(512340116,1,50,"FontServiceManager.onFontPreviewRequestComplete: timeFromAppInteractive to fonts download {0} ms",m.PageLoadTrackingInfo.instance.kwa(new Date));this.yfj()};this.dXi=
(S,P,D)=>{S=u.a.Ue(S.data);S=t.a.qc(S);e.ULS.sendTraceTag(520710151,1,10,`FontServiceManager.onFontPreviewRequestFailed: Encountered errors: ${S} for method: ${D}`)};this.Dsj=()=>{this.rl&&this.$hd(this.cXi,this.dXi)};this.rl=x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FontServiceIntegration",!1);this.Dsj()}Fbj(H){if(this.EAi(H)){var I=n.HelperMethods.wR(()=>{const S=H.Result;this.styles=`@font-face{font-family:"msofpNew";font-style:normal;font-weight:normal;src:url('${S.PreviewUrl}') format('truetype')}`;
const P=S.FontFacePropertiesList;let D,G,E;S.FontNameList.forEach((O,N)=>{if(x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.NewDefaultTemplate",!1)||"Aptos Display"!==O&&"Aptos Narrow"!==O){this.Hja[O]=P[N].Codepoint;var J=`https://fs.microsoft.com/fs/${S.CatalogVersion}/rawguids/${P[N].FontGuid}`;this.styles=this.Jve(this.styles,O,J,P[N].FontWeight);this.xO[O]=P[N].LocalizedFontName;"Segoe UI Semibold"===O&&(D=P[N].FontFamily,G=J,E=P[N].FontWeight)}});D&&(this.styles=this.Jve(this.styles,
D,G,E));f.a.ni(this.styles)});10<I&&e.ULS.sendTraceTag(520710159,1,50,`FontServiceManager.prepareFontCodepointMap: Duration for prepareFontCodepointMap the model, duration=${I}`)}}EAi(H){if(!H.Result)return e.ULS.sendTraceTag(520710158,1,15,"FontServiceManager.isValidFontPreviewData: Result in EwaResult is Null."),!1;H=H.Result;return H?H.PreviewUrl?H.FontFacePropertiesList?H.FontNameList?0===H.FontFacePropertiesList.length||H.FontFacePropertiesList.length!==H.FontNameList.length?(e.ULS.sendTraceTag(520710153,
1,15,"FontServiceManager.isValidFontPreviewData: Mismatch in length of FontFacePropertiesList and FontNameList in fontListPreviewData."),!1):!0:(e.ULS.sendTraceTag(520710154,1,15,"FontServiceManager.isValidFontPreviewData: FontNameList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710155,1,15,"FontServiceManager.isValidFontPreviewData: FontFacePropertiesList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710156,1,15,"FontServiceManager.isValidFontPreviewData: PreviewUrl in fontListPreviewData is Null."),
!1):(e.ULS.sendTraceTag(520710157,1,15,"FontServiceManager.isValidFontPreviewData: fontListPreviewData is Null."),!1)}Jve(H,I,S,P){return H+`@font-face{font-family:"${I}";src:url('${S}');font-weight:${P};}`}$hd(H,I){return w(this.tv,H,I,null,this.tv.$b())}yfj(){this.djc&&this.raiseEvent(v.l0e)}get ACc(){return this.xO}get gNh(){return this.Hja}get djc(){return this.Wwe}isFontSupported(H){return this.rl&&this.xO&&(!!this.xO[H]||!!y[H.replace(/\s/g,"").toLowerCase()])}ate(H){this.addHandler(v.l0e,H)}}
v.l0e="fsmFD";Object(r.a)(v,"FontServiceManager",d.a,[407]);var A=a(717);class z extends b.a{constructor(H){super();this.$=H;this.Gb()}static la(H){H.da.Ha(505,new z(H))}create(){this.qb(Object(A.a)(this.$.da,504,()=>new v(this.$,this.$.pa.tv)))}}Object(r.a)(z,"FontServiceManagerFactory",b.a,[]);a.d(B,"a",function(){return C});const C=()=>{c.a.Fa(H=>{z.la(H)})}},1287:function(r,B,a){r=a(0);var c=a(113),b=a(228),e=a(15),f=a(13),d=a(39),h=a(96),l=a(1),k=a(21),w=a(5);class n extends d.a{constructor(y,
v,A){super();this.statusBarManager=null;this.nOe=()=>{this.Y8b()};this.Aqh=()=>{this.Y8b()};this.mOe=z=>{10===z&&this.Y8b()};this.onKeyDown=z=>13===z.Ea.keyCode?(z=new h.a(237279923,1,2,6,null),this.$.Ia.Hb(z,{[w.a.skipClipboardAccess]:!0,[w.a.pSe]:!0}),!0):!1;this.$=y;this.Co=v;this.Gm=A;this.$ad=!1;(this.Dag=l.EwaSettings.isChangeGateEnabled("OfficeVSO:7568646_PressEnterToPaste"))&&this.$.da.hb(29,z=>{this.statusBarManager=z;z.rJ(this)})}dispose(){this.Xj();this.Gm=this.Co=this.$=null;this.statusBarManager&&
(this.statusBarManager.SF(this),this.statusBarManager=null)}yn(){return this.Dag}$r(y,v){if("QueryPasteShortcutEnabledLabel"!==y&&!n.tTj.includes(y))return!1;const A=this.Vn();"QueryPasteShortcutEnabledLabel"===y?(v.Visible=A,e.ULS.sendTraceTag(537167636,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${A} for commandId ${y}`)):(v.Visible=!A,e.ULS.sendTraceTag(537167635,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${!A} for commandId ${y}`));return!0}tvh(){this.Gj();
this.raiseEvent("pasteShortcutStatusChanged")}Y8b(){this.Xj();this.raiseEvent("pasteShortcutStatusChanged")}Vn(){return this.$ad}vq(y){this.addHandler("pasteShortcutStatusChanged",y)}Wq(y){this.removeHandler("pasteShortcutStatusChanged",y)}Gj(){if(!this.Vn()){this.$ad=!0;k.h(this.$).Mh.gl(this.nOe);this.Gm.la("blur",this.Aqh);const y=this.$.da.Ba(65);y&&y.PY&&y.PY.registerForCommentEvents(this.mOe);this.Co.xs(f.a.Vb,this.$.nv,this.onKeyDown,!0)}}Xj(){if(this.Vn()){this.$ad=!1;k.h(this.$).Mh.Zk(this.nOe);
this.Gm.detach("blur");const y=this.$.da.Ba(65);y&&y.PY&&y.PY.unregisterForCommentEvents(this.mOe);this.Co.Fs(f.a.Vb,this.$.nv,this.onKeyDown,!0)}}}n.tTj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(r.a)(n,"PasteShortcutManager",d.a,[397,368,213,3]);var x=a(136);class m extends b.a{constructor(y){super();this.$=y;this.Gb()}create(){const y=this.$;this.qb(y.da.Ba(478)||this.$.da.Ha(478,new n(y,c.KeyInputManager.instance,x.a.instance.eH())))}static la(y){y.da.Ha(479,new m(y))}}
Object(r.a)(m,"PasteShortcutManagerFactory",b.a,[]);var u=a(9);a.d(B,"a",function(){return t});const t=()=>{u.a.Fa(y=>{m.la(y)})}},1288:function(r,B,a){var c=a(9);r=a(0);var b=a(113),e=a(228),f=a(136),d=a(7),h=a(15),l=a(4),k=a(1434),w=a(13),n=a(5),x=a(928),m=a(49),u=a(28),t=a(21),y=a(1),v=a(44),A=a(71),z=a(350),C=a(38),H=a(50),I=a(33);class S{constructor(N,J,W,ea){this.recoveryUI=null;this.Yig=(R="Paste")=>{var Y=A.d(this.$.ua.na);Y=new z.a(this.pasteRange,Y);this.dEc(Y,R)};this.cng=()=>{this.recoveryUI&&
(this.F3d=u.a.Ya.ze.m,this.hide(),m.a.instance.create(()=>{this.F6j()},250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",void 0,!0))};this.AOe=R=>{10===R&&this.xua()};this.Rqh=()=>{if(this.recoveryUI){const R=document.getElementById("PasteRecoveryUI");R&&n.a.$j===R.getAttribute(n.a.PT)&&R.click();this.documentHidden=!0;this.xua()}};this.BOe=()=>{this.xua()};this.COe=()=>{this.xua()};this.onKeyUp=R=>{if(this.recoveryUI){if(this.n_)return!1;if(17===R.Ea.keyCode&&this.yac){R=document.getElementById("PasteRecoveryUI");
if(!R)return h.ULS.shipAssertTag(537154070,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),!1;const Y=R.getAttribute(n.a.PT)||"";if(n.a.xq===Y)return R.click(),!0}}return!1};this.onKeyDown=R=>{if(this.recoveryUI){this.yac=!1;this.n_=R.ctrlKey;R=R.Ea.keyCode;if(27===R)return this.xua(),y.EwaSettings.isChangeGateEnabled("OfficeVSO:6022397_ClearStateWhileHidingRecoveryUI")&&(R=this.$.da.Ba(254))&&R.pr("RecoveryUIController.onKeyDown",!0,!0).catch(()=>{}),!0;if(17===R)return this.yac=
!0}return!1};this.qD=(R,Y)=>{this.JDb=R=Y.Ud;if(y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)){switch(R.command){case -1027730316:case -1059615499:if(Y.properties&&Y.properties.launcherId===this.r6e())return;break;case -847286761:if(Y.properties&&(13===Y.properties.CalloutName||18===Y.properties.CalloutName))return}this.xua()}else-1027730316!==R.command&&-1059615499!==R.command?this.xua():(Y=Y.properties)&&Y.launcherId!==this.r6e()&&
this.xua()};this.$=N;this.tuc=J;this.Co=W;this.Gm=ea;this.twd=this.JDb=this.hwd=null;this.n_=this.yac=this.c9b=this.kgc=!1;this.F3d=0;this.documentHidden=!1;this.grid=t.h(this.$);this.pasteRange=null}dispose(){this.Ukg();this.$kg();this.twd=this.hwd=this.recoveryUI=this.Gm=this.Co=this.tuc=this.$=null;this.F3d=0}lZg(N){this.recoveryUI=N;this.hwd=N.SSg;this.twd=N.ejj}xua(){this.recoveryUI&&(this.pasteRange=v.L(this.recoveryUI.oYe),this.gRj(),this.hide(),this.Ukg(),this.recoveryUI=null)}gRj(){const N=
[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,-111689794,-1502853784,-1096627081,1441131127,-1027730316,-847286761];l.AFrameworkApplication.Qq("XLS-SmartView-OnPasteEnabled-Control;XLS-SmartView-OnPasteEnabled-Treatment");y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&this.pasteRange&&(h.ULS.sendTraceTag(523622037,0,50,"RecoveryUIController:smartViewOnPaste RecoveryUI is being dismissed."),
null!=this.JDb&&N.includes(this.JDb.command)?(h.ULS.sendTraceTag(526758984,306,50,`RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. Last command was ${x.a[this.JDb.command]}`),this.JDb=null):y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.PasteCoOccurrence",!1)?h.ULS.sendTraceTag(509723927,306,50,"RecoveryUIController:smartViewOnPaste Format as table prompt already triggered with the paste recovery UI."):this.documentHidden?(h.ULS.sendTraceTag(523833603,
306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. User clicked outside of document."),this.documentHidden=!1):this.pza(()=>{this.Yig("Paste")}))}b5(){return this.grid.Ca.hN(4,this.$.na)}pza(N){if(this.b5())N();else{h.ULS.sendTraceTag(520725721,306,50,"RecoveryUIController:smartViewOnPaste Grid is not in consistent state.");const J=()=>{this.b5()&&(N(),this.grid.QKb(J))};this.grid.mpb(J)}}sxi(){return!!this.recoveryUI&&this.tuc.iti}fPj(N){l.AFrameworkApplication.Qq("XLS-SmartView-PasteCoOccurrence-Treatment;XLS-SmartView-PasteCoOccurrence-Control");
I.a.$yi()&&(this.pasteRange=v.L(this.recoveryUI.oYe),this.pza(()=>{this.Yig("PasteCoOccurrence")}));this.recoveryUI?this.show(N):h.ULS.shipAssertTag(537154072,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")}r6e(){return this.recoveryUI?this.recoveryUI.JDi:null}show(N){const J=this.recoveryUI.yXh();J?(this.tuc.showFloatie(Object(d.a)(new k.a,{x:J.x,y:J.y}),this.recoveryUI.gLa(),N),this.Gj()):h.ULS.sendTraceTag(537154071,0,100,"RecoveryUIController.Show: point is null.")}hide(){this.sxi()&&
this.tuc.MC();this.$kg()}Gj(){if(!this.c9b){var N=t.h(this.$);N.view.Vs(this.cng);N.Mh.gl(this.BOe);this.Gm.la("blur",this.Rqh);this.$.Ia.Gsa(this.qD);this.$.ua.Yf(this.COe);(N=this.$.da.Ba(65))&&N.PY&&N.PY.registerForCommentEvents(this.AOe);this.c9b=!0}this.kgc||(this.Co.xs(w.a.Vb,this.$.domElement,this.onKeyDown,!0),this.Co.xs(w.a.Qd,this.$.domElement,this.onKeyUp,!0),this.kgc=!0)}Ukg(){if(this.c9b){var N=t.h(this.$);N.view.Xq(this.cng);N.Mh.Zk(this.BOe);this.Gm.detach("blur");this.$.Ia.Ena(this.qD);
this.$.ua.yg(this.COe);(N=this.$.da.Ba(65))&&N.PY&&N.PY.unregisterForCommentEvents(this.AOe);this.c9b=!1}}$kg(){this.kgc&&(this.Co.Fs(w.a.Vb,this.$.domElement,this.onKeyDown,!0),this.Co.Fs(w.a.Qd,this.$.domElement,this.onKeyUp,!0),this.kgc=this.n_=this.yac=!1)}F6j(){this.recoveryUI&&250<=u.a.Ya.ze.m-this.F3d&&this.show(-1)}dEc(N,J){C.TaskExtensions.za(H.GetServiceTaskFactory.Pa(this.$.da,426,427,1),W=>{void W.result.Qea(N,J);h.ULS.sendTraceTag(523622036,0,50,"RecoveryUIController.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},
this.$.ka,3)}}Object(r.a)(S,"RecoveryUIController",null,[258,3]);var P=a(70),D=a(153),G=a(54);class E extends e.a{constructor(N){super();this.$=N;this.Gb()}create(){const N=this.$;let J=this.$.da.Ba(406);J?this.qb(J):Object(P.b)("OfficeVSO:7624897_MigrateContextMenuController")?void D.a.resolve(G.G,{Wb:this.Na}).then(W=>{J=new S(N,W,b.KeyInputManager.instance,f.a.instance.eH());this.$.da.Ha(406,J);this.qb(J)}):N.jz(W=>{W.ghc().then(ea=>{J=new S(N,ea,b.KeyInputManager.instance,f.a.instance.eH());this.$.da.Ha(406,
J);this.qb(J)})})}static la(N){N.da.Ha(405,new E(N))}}Object(r.a)(E,"RecoveryUIControllerFactory",e.a,[]);a.d(B,"a",function(){return O});const O=()=>{c.a.Fa(N=>{E.la(N)})}},1328:function(r,B,a){r=a(0);var c=a(15),b=a(261);class e{constructor(h,l){this.testName=null;this.startTimeMs=0;this.isSuccess=!1;this.caller=this.errorStatusCode=this.errorMessage=null;this.reqTotalDurationMs=0;this.browserResourceTiming=null;this.testIteration=0;this.testName=h;this.caller=l;this.reset()}reset(){this.isSuccess=
!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null}}Object(r.a)(e,"NetworkTestResult",null,[]);var f=a(586);a.d(B,"a",function(){return d});class d{constructor(h,l,k,w,n){this.url="";this.O6a=!1;this.T7=-1;this.testIteration=0;this.baseUrl=k;this.zDf=w;this.Vnd=l;this.result=new e(l,n)}runTest(){try{if(this.O6a)return c.ULS.sendTraceTag(537155206,0,50,`NetworkTestReq.RunTest: a test for the host ${this.Vnd} is already mid way, not starting a new one.`),
!1;this.reset();this.O6a=!0;this.result.startTimeMs=Date.now();const h=new b.QueryStringBuilder(this.baseUrl);h.K9("tid",this.result.startTimeMs.toString());this.url=h.toString();this.Ozj();this.testIteration++;this.result.testIteration=this.testIteration;return!0}catch(h){return this.hwb("Exeption: "+h.message),!1}}reset(){this.url="";this.result.reset();this.O6a=!1;this.T7=-1}clearTimeout(){-1!==this.T7&&(window.clearTimeout(this.T7),this.T7=-1)}Ozj(){try{const h=new XMLHttpRequest;h.onreadystatechange=
()=>{4===h.readyState&&(200===h.status?this.yLh():this.hwb(`Error when downloading resource. status code: ${h.status}, status text: ${h.statusText}`,h.status.toString()))};h.onerror=()=>{this.hwb(`Client error when attempting to download resource. status code: ${h.status}, response: ${h.statusText}`)};this.T7=window.setTimeout(()=>{this.T7=-1;this.hwb("Request timeout")},1E4);h.open("GET",this.url,!0);h.send(null)}catch(h){this.hwb("Exeption: "+h.message)}}yLh(){this.O6a&&(this.result.reqTotalDurationMs=
Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=f.a(this.url),this.result.isSuccess=!0,this.H5b())}hwb(h,l=null){this.O6a&&(this.clearTimeout(),this.result.errorMessage=h,this.result.isSuccess=!1,this.result.errorStatusCode=l,this.H5b())}H5b(){this.O6a=!1;this.zDf&&this.zDf(this.result,this.Vnd)}}Object(r.a)(d,"NetworkTestReq",null,[])},1397:function(r,B,a){r=a(0);var c=a(15),b=a(88);a(112);var e=a(27);class f{constructor(x,m,u){this.Lj=this.hGd=null;this.SFa=
this.s9=0;this.PUb=null;this.LS=x;this.pe=m;this.fb=u;this.K2a=!1;this.y2d=!0;this.utj();this.x$a=this.fa.qa("NativeFileOpenDialogIsEnabled")}get context(){return this.LS}get fa(){return this.fb}get retryCount(){return this.s9}get bxc(){return this.SFa}WHb(x){this.Lj=x;if(!this.K2a){if(this.y2d){if(this.x$a&&e.a.xF){this.PUb=x.r9b(Object(b.a)(this,this.vEd,"onFileChosen"));return}this.PUb=x.r9b(null);if(!this.YCa(this.PUb,x))return}this.finalizeUpload(x,null)}}vEd(x){if(this.YCa(x,this.Lj)){if(e.a.xF||
e.a.Ff)this.PUb=x;this.finalizeUpload(this.Lj,null)}}Trc(){this.hGd&&this.hGd()}utj(){this.s9=0;this.SFa=this.fa.Ad("Box4UploadRetryDelayStart",200);this.Lj&&(this.Lj.dispose(),this.Lj=null)}}Object(r.a)(f,"FileUploader",null,[]);var d=a(4),h=a(326),l=a(799),k=a(141),w=a(31);a.d(B,"a",function(){return n});class n extends f{constructor(x,m,u){super(x,m,u);this.AXb=this.lsa=null}get wO(){return d.AFrameworkApplication.sa.SD}F4e(x){switch(x){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;
case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}}Uog(x){return n.YCa(x,this.v$h())}v$h(){return n.coe}YCa(x,m=null){x=this.Uog(x);return 0!==x?(m&&m.qqe(),2===x&&this.vj(0,this.F4e(x)),!1):!0}finalizeUpload(x,m){c.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.hGd=m;this.rOj();h.a.mark(5576);this.AXb=this.wO.Kc("LoadResource","PictureUploadTime")}vj(x,m){const u=new k.StandardDialog;u.Rb=0;u.Xz(x,CommonUIStrings.l_ImageUploadFailedTitle,m,null)}Trc(){c.ULS.sendTraceTag(36783361,
322,50,"PictureUploader.OnUploadComplete");super.Trc();this.AXb&&(this.AXb.stop(),this.AXb=null);this.w9g()}rOj(){this.lsa=(new l.a).create();this.lsa.message=CommonUIStrings.l_ImageUploadWait;this.lsa.Rb=5;this.lsa.yt=!1;this.lsa.PBa(null,null,null)}w9g(){this.lsa&&(this.lsa.close(),this.lsa=null)}static Vfi(x,m){x=w.a.cl(x);for(let u=0;u<m.length;++u)if(x.endsWith(m[u]))return!0;return!1}static YCa(x,m=null){m||(m=n.coe);return x?n.Vfi(x,m)?0:2:1}}n.coe=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");
Object(r.a)(n,"PictureUploader",f,[])},1469:function(r,B,a){a.r(B);var c=a(1190),b=a(0),e=a(15),f=a(4),d=a(126),h=a(404);class l extends h.a{constructor(ac){super(ac)}get z6b(){return!1}createElement(){const ac=document.createElement("link");ac.setAttribute("rel","stylesheet");ac.setAttribute("type","text/css");ac.setAttribute("href",this.Ot);return ac}l7c(){return null}jvc(){this.element.setAttribute("href","");this.element.setAttribute("href",this.Rz.Ot)}}Object(b.a)(l,"CssResource",h.a,[]);var k=
a(383),w=a(233),n=a(31),x=a(58);class m{constructor(){this.FXb=this.TUb=null}TEi(){this.TUb||(e.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.TUb=x.Task.WAA(m.YEi(),m.PEi()),this.TUb.continueWith(ac=>{e.ULS.sendTraceTag(21030599,324,10,"{0}",n.a.Ghd(ac.exception))},5));return this.TUb}VEi(){if(!this.FXb)try{e.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),this.FXb=x.Task.WAA(m.Fad(w.a.create(f.AFrameworkApplication.fa.Wa("DimeUrl"),
null,null))),this.FXb.continueWith(ac=>{e.ULS.sendTraceTag(39978391,324,10,"{0}",n.a.Ghd(ac.exception))},5)}catch(ac){e.ULS.sendTraceTag(594874951,324,10,"{0}",n.a.Ghd(ac))}return this.FXb}static YEi(){var ac=m.Nec("inproductmessaging.js");ac=w.a.create(ac,null,null);return m.Fad(ac)}static PEi(){var ac=m.Nec("inproductmessaging.css");ac=new l(ac);return m.Fad(ac)}static Nec(ac){return d.a.E5b(String.format("ipm/{0}",ac))}static Fad(ac){k.a.Zia(ac);return ac.K9a}}Object(b.a)(m,"DependencyDownloader",
null,[768]);class u{}u.w7i="inProductMessagingOverlayDiv";u.t$i="PlayButtonImage";u.rrj="ReplayButtonImage";Object(b.a)(u,"Constants",null,[]);class t{constructor(){this.Ple=this.kge=this.E6d=!0;this.srj=this.u$i=null;this.rOi=!1;this.locale=null;this.pkg={}}get uye(){return this.E6d}set uye(ac){this.E6d=ac}get wyf(){return this.kge}set wyf(ac){this.kge=ac}get Hbg(){return this.Ple}set Hbg(ac){(this.Ple=ac)&&this.BFj()}BFj(){this.Kre(u.t$i,this.u$i);this.Kre(u.rrj,this.srj)}Kre(ac,Lc){Lc&&(this.pkg[ac]=
Lc)}}Object(b.a)(t,"FirstRunExperienceUISettings",null,[767]);class y{constructor(){this.completed=this.Zlj=!1}}Object(b.a)(y,"FirstRunExperienceViewData",null,[766]);var v=a(88),A=a(186),z=a(111),C=a(25);class H{constructor(ac,Lc,rd){this.La=ac;this.ff=Lc;this.yVb=rd}Hg(){this.La.Je(C.a.XLh,z.a.frame,Object(v.a)(this,this.VLh,"firstRunExperienceHandler"),64);this.La.Qb(C.a.o_e,z.a.frame,Object(v.a)(this,this.Mii,"inProductMessagingTabHandler"));this.La.Qb(C.a.n_e,z.a.frame,Object(v.a)(this,this.Lii,
"inProductMessagingShiftTabHandler"));this.La.Qb(C.a.nqh,z.a.frame,Object(v.a)(this,this.oqh,"dimeLaunchHandler"));this.La.Qb(C.a.H_f,z.a.frame,A.ActionManager.jg);this.La.Qb(C.a.Rrj,z.a.frame,A.ActionManager.jg);this.La.Qb(C.a.Srj,z.a.frame,A.ActionManager.jg);this.ff&&this.ff.updateCommandUI()}VLh(ac,Lc,rd,Yd,ie){2===rd&&this.yVb.qDi(ie);return 32}oqh(ac,Lc,rd,Yd,ie){2===rd&&this.yVb.nDi(ie);return 32}Mii(ac,Lc,rd){return 2===rd?this.yVb.hBd():32}Lii(ac,Lc,rd){return 2===rd?this.yVb.eBd():32}}Object(b.a)(H,
"InProductMessagingActor",null,[]);var I=a(87);class S{constructor(){this.gXf=this.k1f=this.ugg=this.umc=this.instance=null}}Object(b.a)(S,"DimeExperienceUISettings",null,[]);var P=a(140),D=a(468);class G{constructor(ac,Lc,rd,Yd,ie){this.ccc=!1;this.Dub=null;this.La=ac;this.kGa=Lc;this.jYb=rd;this.n1=Yd;this.yIc=ie}Fli(ac){P.b("getHeaderApi")?ac.isFeatureEnabled("MsoPremiumBadge",!0).then(Lc=>{const rd=ac.isFreemiumUpsellEnabled();rd&&(appChrome.getHeaderApi().then(Yd=>{Yd.updatePremiumStatus(Lc,
rd);return null}),ac.FAa("MsoPremiumBadge",Yd=>{appChrome.getHeaderApi().then(ie=>{ie.updatePremiumStatus(Yd.isEnabled,rd);return null})}));return null}):e.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")}qDi(ac){this.jYb.TEi().continueWith(()=>{this.kGa.GPj(ac)})}nDi(ac){let Lc="gopremium",rd=null,Yd=()=>{};ac?(ac.experience&&""!==Object(I.a)(String,ac.experience)&&(Lc=Object(I.a)(String,ac.experience)),ac.onTaskComplete&&(Yd=ac.onTaskComplete),ac.campaignId&&""!==Object(I.a)(String,
ac.campaignId)&&(rd=Object(I.a)(String,ac.campaignId))):e.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience");this.Zrf(Lc,Yd,rd)}Zrf(ac,Lc,rd=null){if(this.ccc&&this.Dub){const Yd={};Yd.experience=ac||"gopremium";Yd.campaignId=rd||D.b(this.n1,this.yIc,Object(I.a)(String,Yd.experience),!0);this.La.processAction(C.a.H_f,2);e.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+Yd.experience);try{const ie=Object.assign(new S,{instance:this.Dub,umc:Yd,ugg:Lc||
(()=>{}),k1f:Je=>{e.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+Je.status)},gXf:()=>{e.ULS.sendTraceTag(51675406,324,10,"Dime launch error");this.ccc=!1;this.Dub=null}});this.kGa.WNj(ie)}catch(ie){e.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+ie.message),this.ccc=!1,this.Dub=null,this.La.$d(C.a.dcc,2,{["experience"]:Yd.experience})}}else e.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this.La.$d(C.a.dcc,2,{["experience"]:ac})}Rsf(){this.jYb.VEi().continueWith(()=>
{try{var ac=n.a.cl(f.AFrameworkApplication.uiCulture);const Yd=D.c(this.n1);if(Yd){var Lc={};Lc.partnerId=Yd;Lc.language=ac;Lc.sessionId=f.AFrameworkApplication.userSessionId;Lc.authHint=f.AFrameworkApplication.fa.Wa("UserPrincipalName");var rd=f.AFrameworkApplication.fa.Wa("Puid")||"";""!==rd&&(ac={},ac.puid=rd,Lc.userInfo=ac);this.Dub=new Dime(Lc);this.ccc=!0;e.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else e.ULS.sendTraceTag(51675409,324,15,"App not supported")}catch(Yd){e.ULS.sendTraceTag(51675410,
324,10,"FreemiumUpsellDialogDependencies failed: "+Yd.message)}},3)}hBd(){return this.kGa.hBd()}eBd(){return this.kGa.eBd()}}Object(b.a)(G,"InProductMessagingUIManager",null,[764]);class E{constructor(){this.sne=0;this.EXa=Array(5);this.EXa[0]=10;this.EXa[1]=15;this.EXa[2]=50;this.EXa[3]=100;this.EXa[4]=200}Init(ac){this.sne=ac}SendTrace(ac,Lc){e.ULS.sendTraceTag(34182235,this.sne,this.EXa[ac],"{0}",Lc)}}Object(b.a)(E,"DefaultNetworkingManager",null,[787]);var O=a(270),N=a(323),J=a(100);class W{constructor(ac){this.fc=
ac}GPj(ac){ac&&(InProductMessaging.Networking.NetworkingMgr=new E,InProductMessaging.Networking.NetworkingMgr.Init(387),InProductMessaging.Init(ac.Hbg,ac.wyf,ac.uye,ac.rOi,ac.locale,Object(v.a)(this,this.IVi,"onDismissFirstRunExperience"),ac.pkg),this.ISa(u.w7i,!0))}WNj(ac){if(ac&&ac.instance&&ac.umc){let Lc=document.getElementById("wacDimeContainer");Lc||(Lc=document.createElement("div"),Lc.id="wacDimeContainer",document.body.appendChild(Lc));f.AFrameworkApplication.fa.qa("DimeFocusManagerIsEnabled")&&
this.ISa("wacDimeContainer",!1);ac.umc.parentElementId="wacDimeContainer";ac.instance.launch(ac.umc,ac.ugg).then(rd=>{this.yKb();document.body.removeChild(Lc);ac.k1f(rd)}).catch(rd=>{this.yKb();document.body.removeChild(Lc);ac.gXf(rd)})}else throw Error.argument("DimeExperienceUISettings");}ISa(ac,Lc){if(this.fc&&ac&&(ac=document.getElementById(ac),this.xli(ac),ac=this.fc.OM("InProductMessagingFocusId"))){const rd=this.fc.di;rd&&"InProductMessagingFocusId"===rd.name||this.fc.GR("InProductMessagingFocusId",
!1);Lc&&this.lVf(ac.scope)}}xli(ac){var Lc=this.fc.zi("InProductMessagingFocusId");Lc.parent=O.AFrame.OT;const rd=new N.DOMFocusListing(()=>ac);rd.Rcb=!1;rd.mo(3);rd.mo(2);rd.mo(4);Lc=this.fc.mta(()=>ac,Lc,rd);Lc.rKb();Lc.r_=!0;Lc.EIa=!0}lVf(ac){ac.Dk(J.FocusManager.instance().f2);ac.Dk(J.FocusManager.instance().g2);ac.bindAction(J.FocusManager.instance().f2,C.a.o_e);ac.bindAction(J.FocusManager.instance().g2,C.a.n_e)}yKb(){this.fc&&(this.fc.sda("InProductMessagingFocusId"),this.fc.nRa("InProductMessagingFocusId"))}IVi(ac,
Lc){this.yKb();ac=Object.assign(new y,{completed:ac,Zlj:Lc});f.AFrameworkApplication.rb.$d(C.a.ULh,2,ac)}hBd(){const ac=document.activeElement,Lc=this.fc.BQ();return ac&&Lc&&Lc.lf&&ac===Lc.lf.Hw?(Lc.lf.Kl(ac),Lc.Yya()?32:8):4}eBd(){const ac=document.activeElement,Lc=this.fc.BQ();return ac&&Lc&&Lc.lf&&ac===Lc.lf.firstElement?(Lc.lf.Kl(ac),Lc.dPa()?32:8):4}}Object(b.a)(W,"InProductMessagingUIWrapper",null,[763]);var ea=a(142),R=a(257),Y=a(27);class U{constructor(){this.$a=null}get name(){return"Common.App.InProductMessaging"}Kh(ac){ac.register(m,
"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").tc().Bc(()=>new m);ac.register(W,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").tc().Bc(()=>new W(J.FocusManager.instance()));ac.register(G,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").tc().Bc(()=>new G(f.AFrameworkApplication.rb,ac.resolve("Common.IInProductMessagingUIWrapper"),
ac.resolve("Common.App.InProductMessaging.IDependencyDownloader"),f.AFrameworkApplication.sa.Qa.ri,f.AFrameworkApplication.sa.Qa.Nca));ac.register(H,"Common.App.InProductMessaging.InProductMessagingActor").tc().Bc(()=>new H(f.AFrameworkApplication.rb,f.AFrameworkApplication.sa,ac.resolve("Common.IInProductMessagingUIManager")));ac.register(t,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").tc().Bc(()=>new t);ac.register(y,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").tc().Bc(()=>
new y);this.$a=ac}init(){this.$a.resolve("Common.App.InProductMessaging.InProductMessagingActor").Hg();f.AFrameworkApplication.fa.zu(()=>{f.AFrameworkApplication.sa.Qa.Bu&&ea.a.get_instance().Rj(15,()=>{this.$a.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(ac=>{this.$a.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").Fli(ac)})});f.AFrameworkApplication.fa.qa("FreemiumUpsellShowDialogIsEnabled")&&D.a()&&!Y.a.Exa&&1!==f.AFrameworkApplication.sa.Qa.ri&&
this.$a.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(ac=>{ac.isFeatureEnabled("MsoPremiumBadge",!0).then(Lc=>{!Lc&&ac.isFreemiumUpsellEnabled()&&this.$a.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").Rsf();return null})})})}dispose(){}static main(){R.a.instance.si(new U)}}Object(b.a)(U,"InProductMessagingPackage",null,[4,5]);var da=a(197),T=a(40);class ka{constructor(ac,Lc,rd,Yd=null,ie=null){this.Zv=ac;this.KEa=Lc;this.skb=rd;this.Jie=Yd;this.Gmb=
ie}rac(ac){const Lc=new Sys.StringBuilder(this.Zv.XLb);Lc.append("RoamingServiceHandler.ashx?action=");Lc.append("getFirstRunExperienceSettings");Lc.append("&");Lc.append(this.Ojd(ac));Lc.append("&");Lc.append(f.AFrameworkApplication.xi);f.AFrameworkApplication.Hd.Mm(Lc.toString(),1,null,null,!0,2,Object(v.a)(this,this.p4,"getRequestSuccessCallback"),Object(v.a)(this,this.PM,"getRequestFailureCallback"),null)}T3a(ac){var Lc=new Sys.StringBuilder(this.Zv.XLb);Lc.append("RoamingServiceHandler.ashx?action=");
Lc.append("saveFirstRunExperienceSettings");Lc.append("&");Lc.append(f.AFrameworkApplication.xi);Lc=Lc.toString();ac=T.c(ac);f.AFrameworkApplication.Hd.Mm(Lc,2,ac,null,!0,4,Object(v.a)(this,this.Xaj,"postRequestSuccessCallback"),Object(v.a)(this,this.ON,"postRequestFailureCallback"),null)}p4(ac){let Lc=!1,rd=null;try{if(0<ac.data.me.length){const Yd=Object(I.a)(Object,T.a(ac.data.me)),ie=Yd?Yd[this.Zv.c_c]:null;ie&&(rd=Object(I.a)(Object,T.a(ie.toString())))}Lc=!0}catch(Yd){this.PM(null)}Lc&&this.KEa&&
this.KEa(ac.data,rd)}PM(ac){this.skb&&this.skb(ac?ac.data:null)}Xaj(ac){this.Jie&&this.Jie(ac?ac.data:null)}ON(ac){this.Gmb&&this.Gmb(ac?ac.data:null)}Ojd(ac){const Lc=new Sys.StringBuilder("requestedsettings=");for(let rd=0;rd<ac.count;rd++)Lc.append(ac.ma(rd)),rd<ac.count-1&&Lc.append(";");return Lc.toString()}}Object(b.a)(ka,"FirstRunExperienceRequestHandler",null,[]);var L=a(237),fa=a(86);class wa{constructor(){this.ikb=this.UUb=this.Zv=null}fWd(ac){ac?(this.Zv=ac,this.svi()&&(e.ULS.sendTraceTag(51675532,
306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),ac=new da.a,ac.add(this.Zv.c_c),this.UUb=new ka(this.Zv,Object(v.a)(this,this.p4,"getRequestSuccessCallback"),Object(v.a)(this,this.PM,"getRequestFailureCallback"),null,Object(v.a)(this,this.ON,"postRequestFailureCallback")),this.UUb.rac(ac)),(this.Zv.Q8a||f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",!1))&&this.gWd()):e.ULS.sendTraceTag(51675531,306,
10,"Invalid launcherSettings")}svi(){try{if(this.Zv.Q8a)return!0;if(!f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",!0)||f.AFrameworkApplication.fa.qa("IsAnonymousUser"))return!1;if(this.Zv.$ri||this.Zv.T8a||f.AFrameworkApplication.fa.qa("IsO365ConsumerHost"))return!0;const ac=f.AFrameworkApplication.fa.Wa("FlightId");return-1!==(ac?ac.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(ac){e.ULS.sendTraceTag(576582624,306,
10,"Error checking setting {0}",ac?ac.toString():null)}return!1}A3f(ac){const Lc={},rd={};rd.FREDisplayedDate=(new Date).toUTCString();rd.VersionDisplayed=ac;rd.RemindMeLater=!1;Lc[this.Zv.c_c]=T.c(rd);e.ULS.sendTraceTag(51675533,306,50,"Initiating call to save FRE data for current user from Roaming Settings Service");this.UUb&&this.UUb.T3a(Lc)}p4(ac,Lc){ac=ac?+ac.h3-+ac.sF:-1;ac>this.Zv.m2f?e.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",
ac,this.Zv.m2f):Lc?this.KMj(Lc)?(e.ULS.sendTraceTag(51675536,306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",this.Zv.oyf),this.gWd()):(this.e$c(!1),e.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required.")):(e.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.gWd())}PM(ac){this.e$c(!1);
e.ULS.sendTraceTag(51675541,306,10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",ac?ac.httpStatus:-1)}ON(ac){e.ULS.sendTraceTag(51675542,306,10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",ac?ac.httpStatus:-1)}gWd(){this.e$c(!0);var ac=fa.a.instance.og("Common.ISystemInitiatedFeedback");ac?this.vbg(ac):(e.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",
!0)&&((ac=fa.a.instance.Tb("Common.ISystemInitiatedFeedback"))?ac.execute(Lc=>{this.vbg(Lc)}):e.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))}vbg(ac){if(ac){var Lc=this.Zv.iMh;Lc&&(f.AFrameworkApplication.zya(Lc),f.AFrameworkApplication.Qq(Lc));e.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",Lc);ac.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.ikb=Object(v.a)(this,this.KWi,"onFirstRunExperienceCampaignEvent"),
window.addEventListener("FGWebSurfaceEvent",this.ikb,!0),window.addEventListener("FRELaunchedEvent",this.ikb,!0)):(e.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),this.A3f(this.Zv.currentVersion))}else e.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")}KWi(ac){if(ac){var Lc=ac.detail;ac=ac.type;var rd=this.Zv&&this.Zv.campaignId?this.Zv.campaignId.split("-")[0]:null;if("FRELaunchedEvent"===ac||rd&&Lc&&Lc.id&&-1!==Lc.id.indexOf(rd))Lc.success&&
(e.ULS.sendTraceTag(51675546,306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.A3f(this.Zv.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",this.ikb,!0),window.removeEventListener("FRELaunchedEvent",this.ikb,!0))}}KMj(ac){if("RemindMeLater"in ac&&"FREDisplayedDate"in ac){if("true"===ac.RemindMeLater.toString()&&(+new Date-+new Date(ac.FREDisplayedDate.toString()))/36E5>this.Zv.oyf)return!0}else if(f.AFrameworkApplication.fa.qa("WacShowVersionBasedFREToAllUsers")&&
"VersionDisplayed"in ac&&ac.VersionDisplayed<this.Zv.currentVersion)return e.ULS.sendTraceTag(528262853,306,50,"Current version is higher so FRE V2 UI should be displayed again."),!0;return!1}e$c(ac){f.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DispatchFREDecisionEvent")&&L.a.dispatch("FREDecisionEvent",{["show"]:ac})}}Object(b.a)(wa,"FirstRunExperienceLauncher",null,[741]);class oa{constructor(){this.$a=null}get name(){return"Common.App.FirstRunExperienceLauncher"}Kh(ac){this.$a=
ac;this.$a.register(741,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").tc().Bc(()=>new wa)}init(){}dispose(){}static main(){R.a.instance.si(new oa)}}Object(b.a)(oa,"FirstRunExperienceLauncherPackage",null,[4,5]);var xa=a(1145),bb=a(1146),Za=a(1174),La=a(1287),va=a(9),Ba=a(228),Ea=a(1);class pa{constructor(ac){this.$=ac}get c_c(){return"Excel"}get campaignId(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}get version(){return 1}get currentVersion(){return 0}get $ri(){return this.isEnabled()&&
Ea.EwaSettings.xa(295)}get T8a(){return this.isEnabled()&&Ea.EwaSettings.xa(297)}get Q8a(){return Ea.EwaSettings.xa(296)}get iMh(){return null}get oyf(){return 24}get m2f(){return 4E3}get XLb(){return this.$.ya.WebServiceBase||""}isEnabled(){if(f.AFrameworkApplication.fa?f.AFrameworkApplication.fa.qa("IsAnonymousUser"):1)return!1;const ac=f.AFrameworkApplication.Ub?Object(I.a)(String,f.AFrameworkApplication.Ub.AudienceGroup):"";return"Unknown"!==ac&&"Automation"!==ac}}Object(b.a)(pa,"FirstRunExperienceLauncherSettings",
null,[769]);class $a{constructor(ac,Lc){this.p_e=ac;this.WLh=Lc}fWd(){this.p_e&&this.p_e.fWd(this.WLh)}}Object(b.a)($a,"FirstRunExperienceManager",null,[756]);var cb=a(717);class ib extends Ba.a{constructor(ac){super();this.$=ac;this.Gb()}create(){const ac=Object(cb.a)(this.$.da,311,()=>this.Hgh());this.qb(ac)}Hgh(){var ac=new pa(this.$);ac=new $a(fa.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),ac);ac.fWd();return ac}static la(ac){ac.da.Ha(312,new ib(ac))}}
Object(b.a)(ib,"FirstRunExperienceManagerFactory",Ba.a,[]);var ta=a(60);class Ya extends Ba.a{constructor(ac){super();this.Ood=null;this.$=ac;this.Gb()}create(){const ac=Object(cb.a)(this.$.da,361,()=>this.rhh());this.qb(ac)}rhh(){this.Ood=fa.a.instance.og("Common.IInProductMessagingUIManager");ta.a.rg.Bu?ea.a.get_instance().Rj(16,()=>{this.fhf()}):this.fhf();return this.Ood}fhf(){fa.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(ac=>{ac.isFeatureEnabled("MsoPremiumBadge",
!0).then(Lc=>{!Lc&&ac.isFreemiumUpsellEnabled()&&this.Ood.Rsf();return null})})}static la(ac){ac.da.Ha(362,new Ya(ac))}}Object(b.a)(Ya,"InProductMessagingManagerFactory",Ba.a,[]);var Da=a(1226),ba=a(1148),ya=a(49),V=a(424),Z=a(84),ja=a(535),la=a(21),ua=a(582);class eb extends ja.a{constructor(ac){super(1);this.Vfa=!1;this.PCf=()=>{this.refresh()};this.QCf=()=>{this.refresh()};this.gridView=la.h(ac);this.gridView.Xb.gl(this.QCf);this.gridView.Xb.rm(this.PCf);this.refresh()}get eI(){return this.moc(this.Vfa)}eUd(ac){this.Vfa!==
ac&&(this.Vfa=ac,this.IJb())}get name(){return ua.a.cellEdit}dispose(){this.gridView.Xb.Zk(this.QCf);this.gridView.Xb.dm(this.PCf);this.gridView=null;super.dispose()}IJb(){this.DKd(this.Vfa)}refresh(){this.eUd(!this.gridView.eb)}}Object(b.a)(eb,"CellEditSafeStatePublisher",ja.a,[]);var Eb=a(39),Wb=a(124);class Ab{constructor(ac,Lc){this.handler=null;this.publisher=ac;this.eI=Lc}}Object(b.a)(Ab,"SafeStatePublisherState",null,[]);var Jb=a(619);const Gb=ac=>ac?`${ac.Current} / ${ac.Pending} @${ac.SuspensionStartTimestamp}`:
null,Nb=ac=>(null===ac||void 0===ac?void 0:ac.SuspensionStartTimestamp)&&ac.Pending>ac.Current;class Ja extends Eb.a{constructor(ac,Lc){super();this.Grf=null;this.u9a=!1;this.rHb=(rd,Yd)=>{3===Yd.$xf&&this.u9a&&e.ULS.sendTraceTag(520480204,0,15,"ClientStateMonitor.onMergeDidntOccur: Aborted merge occurred after another aborted merge.");this.u9a=!0;this.kcb()};this.ZRa=new da.a;this.Uya=ac;this.dna=Lc;this.xBb=Ea.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);
this.x8a=Ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7464389_RetryDoPendingMergeAfterBailout");this.xBb&&(this.dna.PZa(this.xza.bind(this)),this.x8a?this.Uya.Sse(this.rHb):this.Uya.OQg(this.MHf.bind(this)))}get h3j(){return Wb.f(Wb.c(this.ZRa.toArray(),ac=>0!=ac.eI),ac=>ac.publisher.name)}X0b(ac){this.addHandler(Ja.YRa,ac)}$vc(ac){this.removeHandler(Ja.YRa,ac)}IAa(ac,Lc){const rd=new Ab(ac,Lc);this.ZRa.add(rd);Lc=(Yd,ie)=>{rd.eI=ie.eI;this.kcb()};ac.X0b(Lc);rd.handler=Lc;this.kcb()}g1d(ac){let Lc=
null;for(let rd of this.ZRa)if(rd.publisher===ac){this.qlg(rd);Lc=rd;break}Lc&&(this.ZRa.remove(Lc),this.kcb())}dispose(){for(let ac of this.ZRa)this.qlg(ac);this.ZRa.clear();this.xBb&&(this.dna.gdb(this.xza.bind(this)),this.x8a?this.Uya.lZf(this.rHb):this.Uya.kpj(this.MHf.bind(this)));super.dispose()}Dcc(){let ac=Ub.Dcc(this.ZRa.toArray().map(Lc=>Lc.eI));return this.u9a&&1===ac?2:ac}qlg(ac){ac.publisher.$vc(ac.handler)}kcb(){const ac=this.Dcc();ac!==this.Grf&&(this.raiseEvent(Ja.YRa,new Jb.a(ac)),
this.Grf=ac)}MHf(){this.u9a&&e.ULS.sendTraceTag(523317957,0,15,"ClientStateMonitor.onMergeWasAborted: Aborted merge occurred after another aborted merge.");this.u9a=!0;this.kcb()}xza(ac,Lc){ac=Lc.Fca;(Lc=!Nb(ac))||(Lc=this.JCi,Lc=(null===ac||void 0===ac?void 0:ac.SuspensionStartTimestamp)!==(null===Lc||void 0===Lc?void 0:Lc.SuspensionStartTimestamp));Lc&&(this.u9a=!1);this.JCi=ac;this.kcb()}}Ja.YRa="SSC";Object(b.a)(Ja,"ClientStateMonitor",Eb.a,[]);var ab=a(6),wb=a(74);class xb extends ja.a{constructor(ac,
Lc=null){super(1);this.Vfa=!1;this.AN=()=>{this.refresh()};this.VDf=()=>{this.refresh()};this.$=ac;this.Bbe=Lc||wb.a(ac).yQ(ab.a.idle);wb.a(ac).BYc(this.VDf);this.F6a.vq(this.AN);this.refresh()}get eI(){return this.moc(this.Vfa)}eUd(ac){ac!==this.Vfa&&(this.Vfa=ac,this.IJb())}get name(){return ua.a.F6a}get F6a(){return this.Bbe}dispose(){wb.a(this.$).Ivc(this.VDf);this.F6a.Wq(this.AN);this.Bbe=null;super.dispose()}IJb(){this.DKd(this.Vfa)}refresh(){this.eUd(1===this.F6a.vu||wb.a(this.$).Vh===this.F6a)}}
Object(b.a)(xb,"IdleActivitySafeStatePublisher",ja.a,[]);var rb=a(324),za=a(3),Aa=a(22);class pb extends Z.a{constructor(){super()}Mc(){return!1}executeCommand(){return x.Task.Ta(!0)}Ac(ac,Lc){return 1905775613===Lc.command}Rc(){return!1}}Object(b.a)(pb,"ToggleMergeSuspensionSafeState",Z.a,[222]);class kb extends Eb.a{constructor(ac,Lc){super();this.statusBarManager=null;this.hCd=!1;this.xza=(rd,Yd)=>{rd=`${Yd.Fca.Current===Yd.Fca.Pending?"\u26ad":"\u26ae"}${Yd.Fca.Current}`;Aa.a.equals(this.Uoc,
rd,!1)||(this.Uoc=rd,this.Az())};this.PPa=(rd,Yd)=>{rd=0==Yd.eI;this.hCd!==rd&&(this.hCd=rd,this.Az())};this.mergeSuspensionManager=Lc;this.mergeSuspensionManager.dna.PZa(this.xza);this.Uoc="";rb.a.I9(1905775613,za.a.rc,0,1);this.Ia=ac.Ia;this.jQb=new pb;ac.da.hb(29,rd=>{this.mergeSuspensionManager&&(this.statusBarManager=rd,rd.rJ(this),this.mergeSuspensionManager.$ha.X0b(this.PPa))});this.Ia.t2(this.jQb)}vq(ac){this.addHandler(kb.JAd,ac)}Wq(ac){this.removeHandler(kb.JAd,ac)}Az(){this.raiseEvent(kb.JAd)}yn(ac){return ac===
kb.pej&&!!this.mergeSuspensionManager}$r(ac,Lc){if(!this.yn(ac))return!1;this.mergeSuspensionManager&&(Lc.LabelText=this.Uoc,Lc.On=this.hCd);return!0}dispose(){this.jQb&&(this.Ia.Ucb(this.jQb),this.jQb.dispose(),this.jQb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.dna.gdb(this.xza),this.mergeSuspensionManager.$ha.$vc(this.PPa),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.SF(this),this.statusBarManager=null);this.Uoc=null;super.dispose()}}kb.JAd=
"MSMSC";kb.pej="QueryMergeSuspensionStatus";Object(b.a)(kb,"MergeSuspensionIndicatorManager",Eb.a,[368,213,3]);var Cb=a(7),ob=a(903);class qa extends Sys.EventArgs{constructor(ac){super();this.Lxa=ac}}Object(b.a)(qa,"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);class ma{}Object(b.a)(ma,"SuspensionState",null,[]);class Ga extends ma{constructor(ac){super();this.Iue=!1;this.Iue=ac}}Object(b.a)(Ga,"ReadyForPendingMergeState",ma,[]);const vb=new ma,Ka=new ma,Pa=new Ga(!1),fb=new Ga(!0);
var Wa=a(904);class Ma extends Wa.a{constructor(ac,Lc,rd){super(ac);this.cUg=Lc;this.qQj=rd}}Object(b.a)(Ma,"ReadyForPendingMergesUpdatedEventArgs",Wa.a,[]);class lb extends Eb.a{constructor(ac,Lc,rd){super();this.xza=(Yd,ie)=>{Yd=this.getState();const Je=this.w_;this.w_=ie.Fca;ie=this.getState();this.SHi(Yd,ie,Je);this.raiseEvent(lb.EAd);this.$Ze(Yd,ie)};this.PPa=(Yd,ie)=>{Yd=this.getState();this.eI=ie.eI;ie=this.getState();this.$Ze(Yd,ie)};this.rHb=(Yd,ie)=>{this.x8a&&4===ie.$xf&&(e.ULS.sendTraceTag(520480203,
0,50,"MergeSuspensionStateHandler.onMergeDidntOccur: Retry DoPendingMerge after bailout. Current merge counter: {0}, Response merge counter: {1}",Gb(this.w_),Gb(ie.w_)),this.GTf(this.getState(),!0))};this.xBb=Ea.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.x8a=Ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7464389_RetryDoPendingMergeAfterBailout");this.$ha=ac;this.$ha.X0b(this.PPa);this.dna=Lc;this.dna.PZa(this.xza);this.x8a&&(this.Uya=rd,this.Uya.Sse(this.rHb));
this.w_=Object(Cb.a)(new ob.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});this.eI=this.Rji()}Rji(){return Object(V.a)(Ja,this.$ha)?Object(I.a)(Ja,this.$ha).Dcc():1}a1b(ac){this.addHandler(lb.w_d,ac)}dwc(ac){this.removeHandler(lb.w_d,ac)}ARg(ac){this.addHandler(lb.oLd,ac)}Mpj(ac){this.removeHandler(lb.oLd,ac)}NQg(ac){this.addHandler(lb.EAd,ac)}jpj(ac){this.removeHandler(lb.EAd,ac)}ogj(){this.AKd(this.getState()===Ka)}dispose(){this.$ha.$vc(this.PPa);this.$ha=null;this.dna.gdb(this.xza);this.dna=
null;this.x8a&&(this.Uya.lZf(this.rHb),this.Uya=null);super.dispose()}djd(){return Object(Cb.a)(new ob.a,{Current:this.w_.Current,Pending:this.w_.Pending,SuspensionStartTimestamp:this.w_.SuspensionStartTimestamp})}getState(){return Nb(this.w_)?0==this.eI?fb:this.xBb&&1==this.eI?Pa:Ka:vb}$Ze(ac,Lc){ac!==Lc&&(Lc===Ka?this.AKd(!0):ac===Ka&&this.AKd(!1));this.GTf(Lc)}GTf(ac,Lc=!1){ac instanceof Ga&&this.raiseEvent(lb.oLd,new Ma(this.w_,ac.Iue||!this.xBb,Lc))}SHi(ac,Lc,rd){ac===vb&&Lc!==vb?(ac=Lc===Ka,
Lc=Lc===Pa,e.ULS.sendTraceTag(252760283,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: ${Lc} publisher: ${Lc||ac?this.$ha.h3j.join(","):""} counter: ${Gb(this.w_)} isBlockingAllMerges: ${ac}`)):ac!==vb&&Lc===vb&&e.ULS.sendTraceTag(252760284,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: No pending changes. counter: ${Gb(rd)}`)}AKd(ac){this.raiseEvent(lb.w_d,new qa(ac))}}lb.w_d="TPMBBC";lb.oLd="RFPMU";lb.EAd="MCC";Object(b.a)(lb,
"MergeSuspensionStateHandler",Eb.a,[]);class Na extends Eb.a{constructor(ac){super();this.S1=null;this.cmc=0;this.xFb=(Lc,rd)=>{(null===rd||void 0===rd?0:rd.Fca)&&this.GPa(rd.Fca,Na.W3d)};this.Ryc=()=>{this.Z0f();this.wTf(this.S1,Na.mtj)};this.gab=(Lc,rd)=>{rd.E1a&&this.S1.SuspensionStartTimestamp&&e.ULS.sendTraceTag(17318084,0,50,`PendingMergeMonitor.OnEditCellEnded: committed with counter ${Gb(this.S1)}`)};this.Z0f();this.$=ac;this.$.ea.Oj(this.Ryc);this.$.ea.ZL(this.Ryc);la.h(this.$).Xb.rm(this.gab);
this.$.da.hb(292,Lc=>{Lc.PZa(this.xFb);e.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")})}PZa(ac){this.addHandler("MCU",ac)}gdb(ac){this.removeHandler("MCU",ac)}get w_(){return this.S1}GPa(ac,Lc=""){const rd=this.S1.Current<ac.Current||this.S1.Pending<ac.Pending;if(ac.SuspensionStartTimestamp&&this.cmc!==ac.SuspensionStartTimestamp){if(this.cmc>ac.SuspensionStartTimestamp){rd&&e.ULS.sendTraceTag(553736149,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via ${Lc}. S: ${Na.wFb(ac)}, C: ${Na.wFb(this.S1)}`);
return}rd||e.ULS.sendTraceTag(553736148,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: ${Na.wFb(ac)}, C: ${Na.wFb(this.S1)}`)}else if(!rd)return;this.S1=ac;this.wTf(ac,Lc)}dispose(){this.$.ea.pk(this.Ryc);this.$.ea.MR(this.Ryc);la.h(this.$).Xb.dm(this.gab);const ac=this.$.da.Ba(292);ac&&ac.gdb(this.xFb);super.dispose()}wTf(ac,Lc=""){Nb(ac)&&ac.SuspensionStartTimestamp>this.cmc&&(e.ULS.sendTraceTag(537155416,0,50,`PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: ${Gb(ac)}, Origin: ${Lc}`),
this.cmc=ac.SuspensionStartTimestamp);this.raiseEvent("MCU",new Wa.a(ac))}Z0f(){e.ULS.sendTraceTag(588276808,0,50,`PendingMergeMonitor.ResetMergeCounter : Last counter was ${Na.wFb(this.S1)}`);this.S1=Object(Cb.a)(new ob.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})}static wFb(ac){return ac?`(${ac.Current}/${ac.Pending} @${ac.SuspensionStartTimestamp})`:"null"}}Na.W3d="PMM.RTC";Na.Q9b="PMM.EwaResult";Na.mtj="PMM.resetMergeCounter";Object(b.a)(Na,"PendingMergeMonitor",Eb.a,[]);class X{}Object(b.a)(X,
"ClientRevisions",null,[]);var F=a(45),na=a(63);const hb=(ac,Lc,rd,Yd,ie,Je,ff,Ae=null)=>{Ae=ac.Oa(1,Ae);Ae.viewportState=Lc;Ae.allowViewAdjustment=rd;return na.g(ac,"DoPendingMerge",Ae,Yd,ie,Je,ff,0)},Ib=(ac,Lc,rd,Yd,ie,Je,ff=null)=>{ff=ac.Oa(1,ff);ff.suspensionStartTimestamp=Lc;return na.g(ac,"KeepBlockingPendingMerges",ff,rd,Yd,ie,Je,0)};class vc extends Eb.a{constructor(ac,Lc,rd,Yd){super();this.FJa=null;this.yDb=0;this.zDb=this.h9a=null;this.wJf=(ie,Je)=>{this.FJa.MXg(Je.Fca,Je.cUg,Je.qQj)};
this.THb=(ie,Je)=>{Je.Lxa?this.FSj():this.fCc()};this.LHf=()=>{this.yDb=0};this.x5f=()=>{const ie=this.b6.djd();Ib(this.va,null!=ie.SuspensionStartTimestamp?ie.SuspensionStartTimestamp:0,null,()=>{this.o_i(ie)},null,null,this.va.$b())};this.gDa=(ie,Je)=>{if(Je){Je.Npb.MergeCount=this.b6.djd();let ff;({min:ie,max:ff}=la.h(this.$).bNi());Ea.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?Je.Npb.ClientRevisions=Object(Cb.a)(new X,{Min:ie,Max:ff,MaxFromBlockCache:la.h(this.$).Ca.yxf}):
Je.Npb.ClientRevisions=Object(Cb.a)(new X,{Min:ie,Max:ff})}};this.$=ac;this.I_a=rd;this.b6=Lc;this.b6.ARg(this.wJf);this.b6.a1b(this.THb);this.b6.NQg(this.LHf);this.$.pa.jha(this.gDa);this.va=this.$.pa.va;this.cPd=this.$.ya.MergeSuspensionRequestThrottlingTimeInMs;this.cCi=this.$.ya.KeepBlockingPendingMergesRequestIntervalMs;this.FJa=Yd;e.ULS.sendTraceTag(588276807,0,50,"RequestController initialized")}dispose(){this.$.pa.Hna(this.gDa);this.fCc();this.b6.Mpj(this.wJf);this.b6.dwc(this.THb);this.b6.jpj(this.LHf);
this.b6=null;super.dispose()}FSj(){this.fCc();if(this.$Ne()){const ac=this.b6.djd();e.ULS.sendTraceTag(537155414,0,50,`RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter ${Gb(ac)} fail count: ${this.yDb}`)}else this.zDb=this.I_a.create(this.x5f,this.cPd,F.a.zDb),this.h9a=this.I_a.GC(this.x5f,this.cCi,F.a.h9a)}fCc(){this.h9a&&(this.zDb.cancel(),this.h9a.cancel(),this.h9a=this.zDb=null)}o_i(ac){let Lc;
Lc=" fail count: "+this.yDb;this.yDb++;this.$Ne()&&this.fCc();e.ULS.sendTraceTag(542229773,0,10,`RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed ${Gb(ac)}${Lc}`)}$Ne(){return this.yDb>vc.JLi}}vc.JLi=5;Object(b.a)(vc,"RequestController",Eb.a,[]);var nc=a(167),Pb=a(204),oc=a(28),Ic=a(290);class ec extends Sys.EventArgs{constructor(ac,Lc){super();this.$xf=ac;this.w_=Lc}}Object(b.a)(ec,"MergeDidntOccurEventArgs",Sys.EventArgs,[]);class mb extends Eb.a{get JMa(){return 0<this.pGd}constructor(ac,
Lc,rd=null,Yd=null,ie=null){super();this.bmc=null;this.pGd=0;this.documentVisibilityObserver=null;this.Vqf=!1;this.koc=null;this.va=ac;this.cPd=Lc.ya.MergeSuspensionRequestThrottlingTimeInMs;const Je=Lc.ya.GetRangeContentPrefetchDelayForMergeInMs;this.vy=()=>{Lc.h4f(Je)};this.Ch=rd||oc.a.Ya;this.yog=0;this.pL=Yd;this.mBa=ie;Lc.da.hb(291,ff=>{this.documentVisibilityObserver=ff})}OQg(ac){this.addHandler(mb.KAd,ac)}kpj(ac){this.removeHandler(mb.KAd,ac)}Sse(ac){this.addHandler(mb.FAd,ac)}lZf(ac){this.removeHandler(mb.FAd,
ac)}get isDocumentHidden(){return!!this.documentVisibilityObserver&&this.documentVisibilityObserver.oi}MXg(ac,Lc,rd=!1){this.oOb(ac,Lc,rd)?(new nc.a).setResult(!0):(Lc=this.v9i(ac,Lc),this.bmc=ac,this.pGd++,Lc.continueWith(()=>{this.MVi()},0,Pb.a.none,this.pL))}v9i(ac,Lc){this.yog=this.Ch.bfa;this.Vqf=Lc;e.ULS.sendTraceTag(554767493,0,50,`DoPendingMergeSender.performDoPendingMergeInternal: Sending DoPendingMerge ${ac.Current} / ${ac.Pending} @${ac.SuspensionStartTimestamp}. allowSelectionAdjustment: ${Lc}`);
this.isDocumentHidden||this.vy();return this.Xzj(Lc,ac)}oOb(ac,Lc,rd=!1){if(this.mBa&&!Lc&&!this.mBa.jzi())return e.ULS.sendTraceTag(523317956,0,50,"DoPendingMergeSender.shouldThrottle: We can't retrieve selection and selection adjustments are disallowed."),!0;if(!this.bmc||ac.SuspensionStartTimestamp>this.bmc.SuspensionStartTimestamp)return this.JMa&&e.ULS.sendTraceTag(523551556,0,50,`DoPendingMergeSender.shouldThrottle: Allowing request for new suspension while previous is ongoing, new counter: ${ac.Current} / ${ac.Pending} @${ac.SuspensionStartTimestamp}`),
!1;if(this.JMa)return!0;if(rd)return!1;rd=this.bmc;const Yd=this.Ch.bfa-this.yog<this.cPd;Lc=this.Vqf===Lc;return(ac||rd?ac&&rd?ac.Current===rd.Current&&ac.Pending===rd.Pending&&ac.SuspensionStartTimestamp===rd.SuspensionStartTimestamp:!1:!0)&&Yd&&Lc}Xzj(ac,Lc){const rd=this.va.$b(),Yd=()=>{e.ULS.sendTraceTag(588276806,0,10,`DoPendingMergeSender.sendDoPendingMergeRequest: request failed ${Lc.Current} / ${Lc.Pending} @${Lc.SuspensionStartTimestamp}`)};return this.mBa?this.mBa.Bwj(this.BXh(ac,Yd,rd)):
this.vBe(null,!0,void 0,Yd,rd)}BXh(ac,Lc,rd){return(Yd,ie,Je)=>{let ff=void 0;e.ULS.shipAssertTag(523317955,0,null!=Yd||ac,"!allowSelectionAdjustment requires a non-null initialViewportState.");ff=this.NVi.bind(this);ie&&(ff=Ic.b.call(null,Ae=>{const pf=Ae.Result;let he=null===pf||void 0===pf?void 0:pf.AdjustedViewportState;3===(null===pf||void 0===pf?void 0:pf.MergeResultState)&&(he=void 0);ie(he,Ae.StateId)},ff));Je&&(Lc=Ic.a.call(null,Je,Lc));return this.vBe(Yd,ac,ff,Lc,rd)}}vBe(ac,Lc,rd,Yd,ie){return hb(this.va,
ac,Lc,rd,Yd,null,null,ie)}NVi(ac){var Lc=ac.Result;void 0!=Lc&&(Lc=Lc.MergeResultState,Ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7464389_RetryDoPendingMergeAfterBailout")&&2!==Lc?this.koc=[Lc,ac.MergeCount]:3===Lc&&(e.ULS.sendTraceTag(523317954,0,50,"DoPendingMergeSender.onDoPendingMergeSucceeded: Aborted merge."),this.Nfj()))}Nfj(){this.raiseEvent(mb.KAd,new Sys.EventArgs)}Mfj(ac,Lc){this.raiseEvent(mb.FAd,new ec(ac,Lc))}MVi(){this.pGd--;if(this.koc){const ac=this.koc;this.koc=null;this.Mfj(...ac)}}}
mb.KAd="MWA";mb.FAd="MDO";Object(b.a)(mb,"DoPendingMergeSender",Eb.a,[794,795]);class Ob{constructor(ac=!1){this.divergenceOnResponse=this.adjustedDidntChangeWithDivergence=this.editBoxDivergence=this.differentSheetAdjust=this.parallel=this.errors=this.nonContinuous=this.divergenceOnViewportReady=this.adjusted=this.adjustedDidntChange=0;this.Jii=ac}get reportName(){return this.Jii?"SelectionAdjustInHiddenDocument":"SelectionAdjust"}}Object(b.a)(Ob,"SelectionAdjustSessionEndsReport",null,[642]);var Ta=
a(44);class sb{constructor(ac,Lc,rd,Yd,ie,Je){this.mb=ac;this.wG=Lc;this.u9=rd;this.QYb=Yd;this.P5d=ie;this.LL=Je}get activeCell(){return this.wG}get selectedRanges(){return this.u9}get Mq(){let ac=!1;if(null===this.LL||void 0===this.LL)ac=!0;else if(this.LL>=this.selectedRanges.length||!this.selectedRanges[this.LL].contains(this.activeCell))e.ULS.sendTraceTag(521200010,0,50,`SelectionState.indexOfActiveRange: the index of the adjusted active range has changed. indexOfActiveRange: ${this.LL}, selectedRangesLength: ${this.selectedRanges.length}`),
ac=!0;ac&&(this.LL=this.I3g());return this.LL}get activeRange(){return 0>this.Mq?this.activeCell:this.selectedRanges[this.Mq]}get sheetName(){return this.QYb}get activeItemName(){return this.P5d}get $sg(){return 1===this.selectedRanges.length}Ipg(ac){let Lc=this.selectedRanges.map(rd=>this.x0j(rd,this.P5d));for(let rd of Lc)if(rd)for(let Yd of rd)if(Yd.ek&&Yd.he.Revision<ac)return!1;return!0}mYj(){var ac;return{SheetName:this.sheetName,ActiveCell:null===(ac=this.activeCell)||void 0===ac?void 0:ac.toString(),
TopLeft:void 0,SelectedRanges:Ta.r(this.selectedRanges,this.mb)}}toString(){var ac,Lc;return`active cell: ${null!==(Lc=null===(ac=this.activeCell)||void 0===ac?void 0:ac.toString())&&void 0!==Lc?Lc:"null"} selection: ${Wb.f(this.selectedRanges,rd=>{var Yd;return null!==(Yd=null===rd||void 0===rd?void 0:rd.toString())&&void 0!==Yd?Yd:"null"}).join(",")}`}equals(ac){return ac?this.activeCell.equals(ac.activeCell)&&Ta.R(this.selectedRanges,ac.selectedRanges)&&this.sheetName===ac.sheetName:!1}I3g(){for(let [ac,
Lc]of this.selectedRanges.entries())if(null===Lc||void 0===Lc?0:Lc.contains(this.activeCell))return ac;return-1}x0j(ac,Lc){var rd;const Yd=la.h(this.mb).Ca.Q4a(ac,Lc);Yd||e.ULS.sendTraceTag(522803340,0,50,`SelectionState.tryGetBlockCacheItemsFromRange: no items found. range: ${null!==(rd=null===ac||void 0===ac?void 0:ac.toString())&&void 0!==rd?rd:"null"} ; activeItemNameIsDefined: ${!!Lc}`);return Yd}}Object(b.a)(sb,"SelectionState",null,[]);var zb=a(220),db=a(757);class jb{constructor(ac){this.$Bc=
0;this.UG=this.pF=null;this.d6d=new Ob;this.e6d=new Ob(!0);this.XH=0;this.yWj=!1;this.fNi=1E4;this.od=()=>{this.QKe()};this.Ej=()=>{this.e0c(!0,!1)};this.Z$a=()=>{this.e0c(!1,!1)};this.$=ac;this.gridView=la.h(this.$);this.gridView.Ca.dw(this.Ej);this.gridView.Ca.Us(this.Z$a);this.gridView.Ca.Yre(this.Z$a);this.gridView.Ca.N9(this.Z$a);this.$.hl(this.od);this.QKe()}Bwj(ac){let Lc=null,rd=null,Yd=()=>{this.lSi()};this.Cif()?(this.yP.parallel++,e.ULS.sendTraceTag(526390086,0,15,`SelectionAdjustManager.runRequestWithSelectionAdjust: Skipping parallel request. Current adjustedSelection is defined : ${!!this.UG}`)):
(Lc=(ie,Je)=>{this.mSi(ie,Je)},rd=this.HFj());return null===ac||void 0===ac?void 0:ac(rd,Lc,Yd)}jzi(){return!this.Cif()&&this.hba().$sg}HFj(){var ac;e.ULS.shipAssertTag(525135961,0,0===this.XH,"SelectionAdjustManager.setPreRequestState: unexpected state");this.UG&&(this.yP.errors++,e.ULS.sendTraceTag(526960090,0,10,`SelectionAdjustManager.setPreRequestState: About to ignore a defined Adjusted selection: ${this.UG.toString()}`));this.UG=null;this.pF=this.hba();let Lc=null;const rd=null===(ac=this.pF)||
void 0===ac?void 0:ac.mYj();rd&&(Lc={ActiveSheetName:this.pF.sheetName,SheetViewportStateChanges:[rd]});this.XH=1;return Lc}lSi(){e.ULS.shipAssertTag(525135960,0,1===this.XH,"SelectionAdjustManager.onAdjustedRequestFailed: unexpected state");this.yP.errors++;this.XH=2;this.pr()}mSi(ac,Lc){try{e.ULS.shipAssertTag(525135959,0,1===this.XH,"SelectionAdjustManager.onAdjustedSelectionReady: unexpected state"),this.$Bc=Lc,Lc=2,this.pF?ac?(this.UG=this.jJj(ac))?(Lc=7,this.pF.equals(this.UG)?this.pF.equals(this.hba())?
(this.yP.adjustedDidntChange++,Lc=4):(this.yP.adjustedDidntChangeWithDivergence++,Lc=5):this.pF.sheetName!=this.UG.sheetName?(this.yP.differentSheetAdjust++,Lc=10):this.pF.equals(this.hba())||(this.yP.divergenceOnResponse++,Lc=6,this.C_f())):this.yP.errors++:(this.yP.errors++,e.ULS.sendTraceTag(537155412,0,15,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted returned null, initialSelection: ${this.pF.toString()}`)):(this.yP.errors++,e.ULS.sendTraceTag(537155413,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted selection results returned when not waiting for them, adjusted:  ActiveCell: ${null===
ac||void 0===ac?void 0:ac.ActiveCell}`)),this.XH=Lc}catch(rd){this.XH=12,e.ULS.sendTraceTag(525135958,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: caught Exception ${rd}`)}finally{7!=this.XH?this.pr():this.e0c(!1,!0)}}dispose(){this.gridView.Ca.Xw(this.Ej);this.gridView.Ca.Dr(this.Z$a);this.gridView.Ca.zYf(this.Z$a);this.gridView.Ca.pRa(this.Z$a);this.$.em(this.od)}Cif(){return 1===this.XH||7===this.XH}jJj(ac){let Lc;if(!({range:Lc}=Ta.ab(ac.ActiveCell,this.$.ua)).returnValue)return e.ULS.sendTraceTag(537155411,
0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract active cell ${ac.ActiveCell}`),null;let rd=[];const Yd=this.$.na,ie=!!Yd&&2===Yd.cG;if(ac.SelectedRanges)rd=Ta.g(ac.SelectedRanges.Ranges);else if(!ie)return e.ULS.sendTraceTag(522826913,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: SelectedRanges is null, active sheet exists: ${!!Yd}`),null;return new sb(this.$,Lc,rd,ac.SheetName,this.pF.activeItemName,this.pF.Mq)}hba(){const ac=this.$.na;if((null===
ac||void 0===ac?0:ac.activeCell)&&ac.selectedRanges&&ac.sheetName)return new sb(this.$,ac.activeCell,ac.selectedRanges,ac.sheetName,this.$.activeItemName,ac.Mq);e.ULS.sendTraceTag(525135957,0,15,`SelectionAdjustManager.getCurrentSelection: invalid activeItem. activeItem null: ${!ac}, activeCell null: ${!(null===ac||void 0===ac?0:ac.activeCell)}, selectedRanges null: ${!(null===ac||void 0===ac?0:ac.selectedRanges)}, sheetName null: ${!(null===ac||void 0===ac?0:ac.sheetName)}`);return null}QKe(){this.$.da.hb(276,
()=>{const ac=zb.a(this.$);ac.rY(this.d6d);ac.rY(this.e6d)})}e0c(ac,Lc){var rd;if(this.nxi(ac))if(8===this.XH)e.ULS.sendTraceTag(523106438,0,15,"SelectionAdjustManager.attemptAdjustSelection: skipping as was already adjusted");else{Lc&&e.ULS.sendTraceTag(524039250,0,50,"SelectionAdjustManager.attemptAdjustSelection: viewport ready on response");try{e.ULS.shipAssertTag(525135956,0,7===this.XH,"SelectionAdjustManager.attemptAdjustSelection: unexpected state"),this.pF.equals(this.hba())?(null===(rd=
this.gridView)||void 0===rd?0:rd.eb)?(this.yP.editBoxDivergence++,this.XH=11):(ac=0,ac=this.UG.Mq,-1==ac?(this.yP.errors++,e.ULS.sendTraceTag(522826912,0,10,"SelectionAdjustManager.attemptAdjustSelection: invalid indexOfActiveRange")):(this.yP.adjusted++,this.XH=8,this.gridView.ha.JD(this.UG.selectedRanges,ac,this.UG.activeCell,0,void 0,"SelectionAdjust"))):(this.yP.divergenceOnViewportReady++,this.C_f(),this.XH=9)}catch(Yd){this.XH=12,e.ULS.sendTraceTag(525135955,0,10,`SelectionAdjustManager.attemptAdjustSelection: caught Exception ${Yd}`)}finally{this.pr()}}}nxi(ac){if(!this.UG)return!1;
if(!this.pF)return e.ULS.sendTraceTag(537155409,0,10,`SelectionAdjustManager.attemptAdjustSelection: initialSelection is null while adjustedSelection isn't null, adjustedSelection: ${this.UG.toString()}`),!1;if(la.h(this.$).Ca.yxf<this.$Bc)return!1;if(ac||this.yWj)e.ULS.sendTraceTag(528590295,0,15,"SelectionAdjustManager.attemptAdjustSelection: got to blockCacheConsistent while pending for selection adjust");else if(!this.pF.Ipg(this.$Bc)||!this.UG.Ipg(this.$Bc))return!1;return!0}pr(){this.pF=this.UG=
null;this.XH=0}C_f(){const ac=this.hba();e.ULS.sendTraceTag(537155408,0,50,`SelectionAdjustManager.ReportDivergence: initial: ${this.pF.toString()} current: ${ac?ac.toString():""} adjusted: ${this.UG.toString()} sheetSameBetweenInitialAndAdjusted: ${this.pF.sheetName===this.UG.sheetName} sheetSameBetweenInitialAndCurrent: ${this.pF.sheetName===(ac?ac.sheetName:null)}`)}get yP(){return db.a.JH(this.fNi)?this.e6d:this.d6d}}Object(b.a)(jb,"SelectionAdjustManager",null,[774,3]);class Ub extends Z.a{constructor(ac,
Lc,rd=null){super();this.TDa=this.chc=this.G6a=this.S0a=null;e.ULS.sendTraceTag(537155417,0,50,"MergeSuspensionManager.ctor started");this.$=ac;this.WXa=new Na(ac);this.mBa=new jb(this.$);this.FJa=new mb(this.$.pa.va,this.$,void 0,void 0,this.mBa);this.mki(ac,rd);this.dga=new lb(this.TDa,this.WXa,this.FJa);this.WOd=new vc(ac,this.dga,Lc,this.FJa);Ea.EwaSettings.xa(230)&&(this.chc=new kb(ac,this));e.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created")}a1b(ac){this.dga.a1b(ac)}dwc(ac){this.dga&&
this.dga.dwc(ac)}get $ha(){return this.TDa}get dna(){return this.WXa}get b6(){return this.dga}IAa(ac,Lc){this.TDa.IAa(ac,Lc)}g1d(ac){this.TDa.g1d(ac)}GPa(ac,Lc=""){this.WXa.GPa(ac,Lc)}dispose(){this.chc&&(this.chc.dispose(),this.chc=null);this.mBa&&this.mBa.dispose();this.FJa.dispose();this.WOd&&(this.WOd.dispose(),this.WOd=null);this.dga&&(this.dga.dispose(),this.dga=null);this.WXa.dispose();this.WXa=null;this.TDa.dispose();this.TDa=null;this.S0a&&(this.S0a.dispose(),this.S0a=null);this.G6a&&(this.G6a.dispose(),
this.G6a=null);this.$=null;super.dispose()}IJb(){this.dga.ogj()}static Dcc(ac){let Lc=0;for(let rd of ac){if(2==rd)return 2;1==rd&&(Lc=1)}return Lc}mki(ac,Lc){this.TDa=new Ja(this.FJa,this.WXa);Lc?Object(V.a)(xb,Lc)?this.IAa(Lc,Object(I.a)(xb,Lc).eI):Object(V.a)(eb,Lc)?this.IAa(Lc,Object(I.a)(eb,Lc).eI):this.IAa(Lc,0):(this.S0a=new eb(ac),this.G6a=new xb(ac),this.IAa(this.S0a,this.S0a.eI),this.IAa(this.G6a,this.G6a.eI))}}Object(b.a)(Ub,"MergeSuspensionManager",Z.a,[753,3]);class xd extends Ba.a{constructor(ac){super();
this.Uc=ac;this.Gb()}create(){e.ULS.sendTraceTag(537155419,0,50,"MergeSuspensionFactory.Create");this.qb(this.Uc.da.Ba(343)||this.Uc.da.Ha(343,new Ub(this.Uc,ya.a.instance)))}static la(ac){e.ULS.sendTraceTag(537155418,0,50,"MergeSuspensionFactory.Attach");ac.da.Ha(344,new xd(ac))}}Object(b.a)(xd,"MergeSuspensionFactory",Ba.a,[]);var ne=a(50),fe=a(38),Bd=a(91),Ue=a(102),mc=a(59),Fc=a(14);class bd{}bd.EEi=3;bd.connected=0;Object(b.a)(bd,"ConnectionStateConstants",null,[]);var de=a(116),Md=a(125),se=
a(46);class tc{constructor(ac,Lc,rd){var Yd;this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=!1;this.durationUntilUserInactive=-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.zCf=(ie,Je)=>{this.blockedOperationsCount++;ie=`${Je.componentName}_${Je.actionName}_${Je.details})`;
this.blockedActions[ie]=this.blockedActions[ie]?this.blockedActions[ie]+1:1;this.isToastShown&&this.blockedUserOperationsWhileToastShown++};this.lGd=ie=>{this.durationUntilUserInactive=de.getElapsedSeconds(this.startTime,oc.a.Ya.Zb);ie.bOd(this.lGd)};this.XV=()=>{this.hasTabbedOut=!0};this.dda=(ie,Je)=>{Je.xOf!==this.type||this.isToastShown||(this.durationUntilToastShownMs=Md.a(oc.a.Ya,this.startTime),this.toastRaiser=Je.toastRaiser,this.isToastShown=!0)};this.startTime=ac;this.durationUntilToastShownMs=
0;this.blockedActions={};this.isToastShown=rd;if(null===(Yd=Lc.ea)||void 0===Yd?0:Yd.He)this.wasUserActiveOnPIStart=Lc.ea.He.xr;this.Gj(Lc);this.isDialogShown=0<Lc.pb.DR;ac=Lc.da.Ba(183);this.isTaskPaneShown=!!ac&&ac.isVisible&&!ac.isCollapsed;this.isTaskPaneCollapsed=!!ac&&ac.isVisible&&ac.isCollapsed}k7f(){this.durationMs=Md.a(oc.a.Ya,this.startTime)}tFd(ac){var Lc;this.k7f();se.a(ac).WKb(this.zCf);se.a(ac).Wf.Zvc(this.dda);ac.da.hb(291,rd=>{rd.adb(this.XV)});if(null===(Lc=ac.ea)||void 0===Lc?0:
Lc.He)ac.ea.He.bOd(this.lGd),this.wasUserActiveOnPIEnd=ac.ea.He.xr}Gj(ac){se.a(ac).tpb(this.zCf);this.isToastShown?this.toastRaiser="Immediate":se.a(ac).Wf.UYc(this.dda);ac.da.hb(291,Lc=>{this.hasTabbedOut=Lc.oi;Lc.OGa(this.XV)});this.wasUserActiveOnPIStart&&ac.ea.He.Fte(this.lGd)}}Object(b.a)(tc,"PartialInteractivityData",null,[]);var dd=a(1151);class Hd extends tc{constructor(ac,Lc,rd,Yd,ie,Je){super(ac,Lc,Yd);this.swappedOffline=this.swappedByOffline=!1;this.lastFailedRequestToOnlineTimeGapSec=
this.longestDurationBetweenFailedRequestsSec=this.averageDurationBetweenFailedRequestsSec=0;this.errorDataDuringConnectivityIssuesMode=this.disconnectionSource=null;this.failedRequests=[];this.triggeringRequest=null;this.type=4;this.swappedOffline=rd;this.disconnectionSource=Enum.toString(dd.a,ie);this.triggeringRequest=Je}JUi(ac,Lc){this.swappedByOffline=Lc;this.tFd(ac)}pDj(ac){this.errorDataDuringConnectivityIssuesMode=ac}Fij(ac){10>this.failedRequests.length&&(ac=ac+"_"+de.getElapsedSeconds(this.startTime,
oc.a.Ya.Zb).toString(),this.failedRequests.push(ac))}}Object(b.a)(Hd,"ConnectivityIssuesData",tc,[]);var Xc=a(170),gd=a(134),je=a(118);class Ee{}Ee.tth="DuringWork";Ee.connectivityIssues="ConnectivityIssues";Ee.offline="Offline";Object(b.a)(Ee,"UnavailabilityTypes",null,[]);var ae=a(53);class Yb{constructor(ac){this.Xlc=this.data=null;this.idd=0;this.uHe=null;this.JDf=(Lc,rd)=>{rd.TL?(this.data=new Hd(oc.a.Ya.Zb,this.$,5===rd.Woa,0!==rd.Woa,this.$.Xe.disconnectionSource,this.uHe),this.Xlc=this.$.Xe.Orf,
this.idd=1,this.$.pa.Xe.ASg(this.zm),Xc.a(this.$).CYc(this.y3f)):(this.data.JUi(this.$,5===rd.Woa),this.$.pa.Xe.IZf(this.zm),this.data.lastFailedRequestToOnlineTimeGapSec=de.getElapsedSeconds(this.Xlc,oc.a.Ya.Zb),Ea.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?ae.b().UMb(557682689,0,50,Ee.connectivityIssues,this.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",mc.a.Ec(this.data)):
e.ULS.sendTraceTag(557682689,0,50,`ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: ${mc.a.Ec(this.data)}`),this.data&&this.data.isToastShown&&Ue.Health.instance.recordQosError(gd.a.R8g,[je.a.Emc],!0,!1,!1,!1,null),Xc.a(this.$).uNd(this.y3f),this.data=null)};this.y3f=(Lc,rd)=>{this.data.pDj(rd.JU)};this.zm=(Lc,rd)=>{this.data.Fij(rd.context.methodName);Lc=oc.a.Ya.Zb;rd=de.getElapsedSeconds(this.Xlc,Lc);this.Xlc=Lc;rd>this.data.longestDurationBetweenFailedRequestsSec&&
(this.data.longestDurationBetweenFailedRequestsSec=rd);this.idd++;this.data.averageDurationBetweenFailedRequestsSec=this.v3g(rd)};this.GDf=(Lc,rd)=>{this.uHe=rd.V_j};this.$=ac;se.a(this.$).Wf.hse(this.JDf);this.$.Xe.gse(this.GDf)}dispose(){this.$&&(se.a(this.$).Wf.JYf(this.JDf),this.$.Xe&&this.$.Xe.IYf(this.GDf));this.data&&this.$.pa.Xe.IZf(this.zm);this.$=null}v3g(ac){const Lc=this.idd-1;return(this.data.averageDurationBetweenFailedRequestsSec*(Lc-1)+ac)/Lc}}Object(b.a)(Yb,"ConnectivityIssuesTelemetryManager",
null,[3]);var Sc=a(875),qd=a(8),Id=a(1150),ic=a(1149);class Gc{constructor(ac){this.z2f=null;this.pwd=this.TAd=this.uGb=this.vGb=0;this.sVd=!1;this.t5c=this.BTa=this.yBc=this.C$a=null;this.H5c=0;this.Szj=()=>{if(12E4>this.$.ea.He.mgb)for(let Lc of this.yBc)Lc.runTest();else this.mYd("UserInactive")};this.osj=Lc=>{Lc=Sys.Serialization.JavaScriptSerializer.serialize(Lc);e.ULS.sendTraceTag(388821830,0,50,Lc)};this.Frj=Lc=>{if(Lc){var rd=this.t5c[Lc.testIteration.toString()];rd?rd.push(Lc):(rd=[Lc],this.t5c[Lc.testIteration.toString()]=
rd);if(rd.length===this.z2f.length){rd=Sys.Serialization.JavaScriptSerializer.serialize(rd);if(this.$&&this.$.Xe){if(Lc.EstimatedLatency=this.$.Xe.zye,this.$.Xe.zye>this.$.Uy.ExcelRountripThresholdMs){e.ULS.sendTraceTag(570712144,0,50,`Periodic ping tests results when network is slow: ${rd}, consequtive slow ping iteration #: ${this.H5c++}`);return}}else e.ULS.sendTraceTag(537155209,0,50,"EwaControl/ConnectivityObserver is null when conducting slow connection speed tests");e.ULS.sendTraceTag(570712142,
0,50,`Periodic ping tests results: ${rd}`);this.H5c=1}}};this.nh=(Lc,rd)=>{Lc=rd.context.methodName;if(Lc===qd.a.Cyb||Lc===qd.a.jwa)this.uGb++,Lc=Date.now(),this.SKj(Lc)&&(this.uGb=0,this.pwd=Lc,this.WSj())};this.cda=()=>{this.OXd("OnThrottledUserActivity")};this.XV=()=>{this.mYd("OnDocumentHidden")};this.jI=()=>{this.OXd("OnDocumentUnhidden")};this.$=ac;if(this.tVd=this.i7g())this.z2f=[ic.a.iHc],this.H5c=1,this.t5c={},this.$.ea.He.S9(this.cda),this.$.da.hb(291,Lc=>{Lc.OGa(this.XV);Lc.Hsa(this.jI)})}dispose(){this.$&&
(this.sVd&&this.$.pa&&0<this.C$a.count&&this.$.pa.zs(this.nh),this.tVd&&(this.mYd("Dispose"),this.$.ea.He.OAa(this.cda)))}Qji(){Ea.EwaSettings.xa(199)&&this.tbj();this.tVd&&this.ubj()}nki(){this.uGb=this.vGb;this.pwd=0;var ac={};if(!this.C$a){this.C$a=new da.a;const Lc=Id.a.Rfd(this.osj,"InitSampleMeasurement",this.$);for(const rd of Lc)ac[rd.Vnd]=rd.baseUrl,this.C$a.add(rd)}ac=Sys.Serialization.JavaScriptSerializer.serialize(ac);e.ULS.sendTraceTag(537155210,0,50,`Init Network measurement: numberOfRequestToWaitPerNetworkMeasurement: ${this.vGb}, numberOfRequestFromTheLastNetworkMeasurement: ${this.uGb}, testParams: ${ac} `);
0<this.C$a.count&&this.$.pa.kr(this.nh)}WSj(){for(let ac of this.C$a)ac.runTest()}OXd(ac){this.BTa&&this.BTa.Wn||(e.ULS.sendTraceTag(537155208,0,50,`NetworkMeasurement.StartConnectionSpeedTest: starting ping tests. caller: ${ac}`),this.BTa=ya.a.instance.GC(this.Szj,5E3,F.a.SQj),this.BTa.uV())}mYd(ac){this.BTa&&this.BTa.Wn&&(e.ULS.sendTraceTag(537155207,0,50,`NetworkMeasurement.StopConnectionSpeedTest: stopping ping tests. caller: ${ac}`),this.BTa.cancel())}SKj(ac){return this.uGb>=this.vGb&&ac-this.pwd>
this.TAd}i7g(){return Gc.o2f(this.$.ya.SlowNetworkMeasurementsSamplePercentage)}tbj(){this.vGb=this.$.ya.NumberOfRequestToWaitPerNetworkMeasurement;this.TAd=1E3*this.$.ya.MinTimeBetweenNetworkMeasurementInSec;const ac=this.$.ya.NetworkMeasurementsSamplePercentage;0<this.vGb&&0<this.TAd&&(this.sVd=Gc.o2f(ac))&&this.nki()}ubj(){if(!this.yBc){this.yBc=new da.a;const ac=Id.a.Rfd(this.Frj,"PrepareAndInitSlowNetworkTests.ConnectionSpeedTest",this.$,[ic.a.iHc]);for(const Lc of ac)this.yBc.add(Lc);this.$.ea.He.xr&&
this.OXd("PrepareAndInitSlowNetworkTests")}}static o2f(ac){return 100*Math.random()<ac}}Object(b.a)(Gc,"NetworkMeasurement",null,[3]);var jd=a(136),ed=a(804);class Qd{constructor(ac){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=null;this.allOfflinePartialInteractivitiesDataInSession=[];this.sessionID=ac}get count(){return this._count}get oU(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-1]}E4j(){this.oU&&
this.oU.k7f()}$Mg(ac){this.allOfflinePartialInteractivitiesDataInSession.push(ac);this._count++}}Object(b.a)(Qd,"OfflinePartialInteractivitiesDataForLog",null,[]);class te extends tc{constructor(ac,Lc,rd){super(ac,Lc,rd);this.timeFromLastOffline=0;this._errorDataDuringOfflineMode=null;this.timeFromLastOffline=-1;this.type=5}$Gj(ac){this.timeFromLastOffline=ac}qDj(ac){this._errorDataDuringOfflineMode=ac}}Object(b.a)(te,"OfflinePartialInteractivityData",tc,[]);class xe{constructor(ac,Lc){this.nPa=this.oU=
null;this.mJd=-1;this.zwb=null;this.Irf=x.Task.delay(0);this.yab=(rd,Yd)=>{Yd.TL?this.R0i(Yd.Woa):this.S0i()};this.dda=(rd,Yd)=>{5===Yd.xOf&&this.j4a()};this.z3f=(rd,Yd)=>{this.oU.qDj(Yd.JU)};this.j4a=()=>{this.nPa.E4j();this.sxj(xe.pHd,Sys.Serialization.JavaScriptSerializer.serialize(this.nPa))};this.esj=rd=>{if(rd=rd.result)this.$pg=!0,e.ULS.sendTraceTag(576811915,0,50,`OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: ${rd}`)};
this.xmj=()=>{this.$pg&&(this.$?fe.TaskExtensions.za(this.indexedDB.C9c(xe.pHd),()=>{e.ULS.sendTraceTag(537155204,0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},this.$.ka):e.ULS.sendTraceTag(537155203,0,10,"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};this.tPa=()=>{if(this.nPa&&0<this.nPa.count){const rd=Sys.Serialization.JavaScriptSerializer.serialize(this.nPa);
e.ULS.sendTraceTag(560791644,0,50,`OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: ${rd}`)}};this.$=ac;this.indexedDB=Lc;this.$pg=!1;this.indexedDB.Me()&&(this.indexedDB.initialize(xe.zAb,xe.AAb),this.Arj(),this.nPa=new Qd(this.$.ya.UserSessionId),se.a(this.$).Wf.OYc(this.yab));this.Gm=jd.a.instance.eH();this.Gm.la("beforeunload",this.tPa)}dispose(){this.$&&se.a(this.$)&&se.a(this.$).Wf.INd(this.yab);Bd.a.Ja(this.zwb);this.$=this.zwb=null}R0i(ac){this.oU=
new te(oc.a.Ya.Zb,this.$,0!==ac);this.oU.$Gj(-1!==this.mJd?window.performance.now()-this.mJd:-1);this.nPa.$Mg(this.oU);se.a(this.$).Wf.UYc(this.dda);this.j4a();this.zwb=ya.a.instance.GC(this.j4a,xe.DMh,F.a.j4a);Xc.a(this.$).CYc(this.z3f)}S0i(){this.oU.tFd(this.$);this.j4a();Bd.a.Ja(this.zwb);this.zwb=null;this.mJd=window.performance.now();se.a(this.$).Wf.Zvc(this.dda);Xc.a(this.$).uNd(this.z3f);this.Grj()}sxj(ac,Lc){this.$?this.Irf=fe.TaskExtensions.za(this.Irf,()=>{this.indexedDB.Wdb(new ed.a(ac,
Lc))},this.$.ka):e.ULS.sendTraceTag(537155205,0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")}Arj(){const ac=this.$.ka;fe.TaskExtensions.za(fe.TaskExtensions.za(this.indexedDB.oLa(xe.pHd),this.esj,ac),this.xmj,ac)}Grj(){if(this.oU){const ac=Sys.Serialization.JavaScriptSerializer.serialize(this.oU);Ea.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?ae.b().UMb(560791645,0,50,Ee.offline,this.oU.durationMs,
"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",ac):e.ULS.sendTraceTag(560791645,0,50,`OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: ${ac}`)}this.oU&&this.oU.isToastShown&&Ue.Health.instance.recordQosError(gd.a.D8j,[je.a.Emc],!0,!1,!1,!1,null)}}xe.zAb="NetworkAvailability";xe.AAb="NetworkAvailabilityData";xe.pHd="partialInteractivityData";xe.DMh=3E3;Object(b.a)(xe,
"OfflineModeTelemetryManager",null,[3]);var He=a(1328);const We=ac=>{ac.isSuccess||(ac=Sys.Serialization.JavaScriptSerializer.serialize(ac),e.ULS.sendTraceTag(509669840,0,10,ac))};class ye{constructor(ac,Lc){this.rma=this.UBd=this.sBf=null;this.$=ac;Ea.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&Y.a.Ff||(this.sBf=new xe(ac,Lc));Ea.EwaSettings.xa(199)&&(this.UBd=new Gc(this.$),this.UBd.Qji());Ea.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&
Y.a.Ff||(this.rma=new Sc.NetworkConnectionHealthChecker(this.$));this.Dbh=new Yb(this.$);Ea.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.1CdnDarkTestEnabled",!1)&&(ac=this.$,Lc=Ea.EwaSettings.getStringFeatureGate("Microsoft.Office.Excel.1CdnDarkTestTargetUrl",""),""!==Lc&&(new He.a(ac,"1CDN",Lc,We,"runOneCdnNetworkTest")).runTest())}dispose(){Bd.a.Ja(this.sBf);Bd.a.Ja(this.UBd);Bd.a.Ja(this.rma);Bd.a.Ja(this.Dbh);this.$=null}}Object(b.a)(ye,"NetworkConnectionTelemetryManager",null,[3]);
class $e extends tc{constructor(ac,Lc,rd,Yd){super(ac,Lc,rd);this.wasInteruptedByOfflineMode=!1;this.type=Yd;this.wasInteruptedByOfflineMode=!1}yab(){this.wasInteruptedByOfflineMode=!0}}Object(b.a)($e,"SilentReopenData",tc,[]);class jf{constructor(ac){this.H7=null;this.rLf=(Lc,rd)=>{this.oLf(rd,3)};this.FHf=(Lc,rd)=>{this.oLf(rd,2)};this.$=ac;this.Wf=se.a(this.$).Wf;this.Wf.Pse(this.FHf);this.Wf.eSg(this.rLf)}dispose(){this.Wf.iZf(this.FHf);this.Wf.mqj(this.rLf);this.H7=this.Wf=this.$=null}oLf(ac,
Lc){ac.TL?this.H7=new $e(oc.a.Ya.Zb,this.$,0!==ac.Woa,Lc):(5===ac.Woa&&(this.H7.wasInteruptedByOfflineMode=!0),3!==ac.Woa&&2!==ac.Woa||e.ULS.sendTraceTag(537155202,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),this.H7.tFd(this.$),2===Lc?Ea.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?ae.b().VMb(571289604,0,50,Ee.offline,this.H7.durationMs,this.H7):
e.ULS.sendTraceTag(571289604,0,50,mc.a.Ec(this.H7)):Ea.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?ae.b().VMb(542782150,0,50,Ee.tth,this.H7.durationMs,this.H7):e.ULS.sendTraceTag(542782150,0,50,mc.a.Ec(this.H7)),this.H7=null)}}Object(b.a)(jf,"SilentReopenPartialInteractivityTelemetryManager",null,[3]);class gf extends Eb.a{constructor(ac,Lc,rd=!0){super();this.K0=this.V5b=this.oPa=this.Goa=this.wTa=null;this.wzf=0;this.fvc=this.Ocb=this.Pcb=!1;this.yzf=
this.documentVisibilityObserver=null;this.ara=!1;this.Qod=this.R7=0;this.ECb=!1;this.Pcg=0;this.lVd=!1;this.V0=null;this.qIf=()=>{e.ULS.sendTraceTag(537155219,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");this.woc(1,!1)};this.jI=()=>{this.ola||this.TEb?window.setTimeout(()=>{this.v_d()},this.wzf):this.v_d();this.documentVisibilityObserver.MAa(this.jI);this.ECb=!1};this.dg=()=>{e.ULS.sendTraceTag(537155218,0,50,`NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:${this.TEb}, IsInDuringWorkSilentReopenMode:${this.onc&&
!this.ara}`);this.TEb&&this.ape();this.onc&&!this.ara&&this.Yoe();la.h(this.$).oc.dm(this.dg);this.Pcb=this.Ocb=!1};this.rIf=()=>{e.ULS.sendTraceTag(537155213,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");this.woc(1,!0);this.Ocb&&!this.Pcb&&la.h(this.$).oc.dm(this.dg);this.Ocb=!1};this.cda=(Yd,ie)=>{this.Qod=this.R7;this.R7=ie.vDc};this.qLf=()=>{this.$&&(this.fvc||(wb.a(this.$).yQ(ab.a.bQa).KPg(this.AIf),this.$.hl(this.od),this.fvc=!0),this.ara=this.mqi(),this.woc(2,
!1))};this.AIf=()=>{var Yd=wb.a(this.$).Vh;const ie=Yd.cWg();Yd=Wb.f(Yd.Ks.kd.errors,Je=>Je.MessageIdName);e.ULS.sendTraceTag(545842889,0,50,`NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:${ie}, IsB2W:${this.ara}, Errors: ${mc.a.Ec(Yd)}`);ie&&(this.wTa?(this.ara=!1,this.oMe(),this.zEc()):this.Goa&&(this.pMe(),this.zEc()))};this.od=()=>{this.$?(e.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),this.ara=
!1,this.K0&&this.K0.Wn&&(Bd.a.Ja(this.K0),this.K0=null),this.V0&&this.V0.Wn&&(Bd.a.Ja(this.V0),this.V0=null),this.woc(2,!0),this.zEc()):e.ULS.sendTraceTag(537155212,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};this.HDf=()=>{this.xyf(!0)};this.IDf=()=>{this.xyf(!1)};this.IYb=bd.EEi;this.D5c=bd.connected;this.$=ac;this.Xe=ac.pa.Xe;rd&&(this.yzf=new ye(ac,Lc));this.$.da.hb(291,Yd=>{this.documentVisibilityObserver=Yd});this.wzf=this.$.ya.ExcelNetworkCheckAfterTabActivationDelayMs;
this.Xe.Vse(this.qIf);this.Xe.opb(this.rIf);this.Xe.gse(this.HDf);this.Xe.rPg(this.IDf);new jf(this.$,this);this.avf=this.$.ya.LongInactivityTimePeriodSeconds;this.$.ea.jZc(this.qLf);this.$.ea.He.S9(this.cda);this.Pcg=this.$.ya.SilentReopenDuringWorkDelayMs}get ssi(){return this.ara}get TEb(){return!(this.IYb&1)}get onc(){return!(this.IYb&2)}get ola(){return!!(this.D5c&2)}dispose(){this.Xe&&(this.Xe.oZf(this.qIf),this.Xe.VKb(this.rIf),this.Xe.IYf(this.HDf),this.Xe.boj(this.IDf));this.ECb&&this.documentVisibilityObserver&&
(this.documentVisibilityObserver.MAa(this.jI),this.ECb=!1);this.$&&(this.fvc&&this.zEc(),this.$.ea&&(this.$.ea.AZf(this.qLf),this.$.ea.He&&this.$.ea.He.OAa(this.cda)));this.V0&&(this.V0.dispose(),this.V0=null);Bd.a.Ja(this.yzf);this.$=null;super.dispose()}bLi(){this.lVd=!0}Yoe(){this.Goa||(this.Goa=se.a(this.$).Wf.nZa(3,"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))}mqi(){if(this.lVd)return this.lVd=!1,!0;const ac=this.R7>this.avf||this.Qod>this.avf&&10>this.R7;
e.ULS.sendTraceTag(537155223,0,50,`NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:${this.R7}, Time gap between last two activities: ${this.Qod}. return value:${ac}`);return ac}rsj(){this.V0=ya.a.instance.create(()=>{Ue.Health.instance.recordQosError(gd.a.XQj,[je.a.Emc],!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0)}EKg(){this.Goa||this.K0?e.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):
this.K0=ya.a.instance.create(()=>{this.$?this.Goa?e.ULS.sendTraceTag(537155221,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):la.h(this.$).eb?(this.Ocb||(la.h(this.$).oc.rm(this.dg),e.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),
this.Pcb=!0,e.ULS.sendTraceTag(537155220,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):this.Yoe():e.ULS.sendTraceTag(537155222,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.Pcg,F.a.UPj,void 0,!0)}xyf(ac){this.D5c=this.bBe(2,ac,!0);this.due()}woc(ac,Lc){this.IYb=this.bBe(ac,Lc,
!1);this.due()}bBe(ac,Lc,rd){rd=rd?this.D5c:this.IYb;return Lc?rd|ac:rd&~ac}v_d(){const ac=!!this.oPa,Lc=!!this.wTa,rd=!!this.Goa,Yd=!!this.V5b;this.TEb&&!ac?this.DKg():!this.TEb&&ac&&this.Ymh();!this.onc||Lc||rd?this.onc||(Lc?this.oMe():(rd||this.K0&&this.K0.Wn)&&this.pMe()):this.ara?this.BKg():this.K0||this.EKg();this.ola&&!Yd?this.Whg(!0):!this.ola&&Yd&&this.Whg(!1)}DKg(){this.$?this.oPa?e.ULS.sendTraceTag(537155215,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):
la.h(this.$).eb?(this.Pcb||(la.h(this.$).oc.rm(this.dg),e.ULS.sendTraceTag(537155217,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),this.Ocb=!0,e.ULS.sendTraceTag(537155216,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.ape():e.ULS.sendTraceTag(537155214,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")}ape(){this.oPa||
(this.oPa=se.a(this.$).Wf.nZa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))}Ymh(){this.oPa&&(Bd.a.Ja(this.oPa),this.oPa=null)}oMe(){this.wTa&&(Bd.a.Ja(this.wTa),this.wTa=null);this.V0&&this.V0.Wn&&this.V0.cancel();this.V0=null}pMe(){this.Goa&&(Bd.a.Ja(this.Goa),this.Goa=null);this.K0&&(Bd.a.Ja(this.K0),this.K0=null);this.Pcb&&!this.Ocb&&la.h(this.$).oc.dm(this.dg);this.Pcb=!1}BKg(){this.wTa||(this.wTa=se.a(this.$).Wf.nZa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",
void 0,Fc.a.instance.ga(2190)));this.rsj()}Whg(ac){ac?(this.V5b=se.a(this.$).Wf.nZa(4,"NetworkConnectionStateManager.ConnectivityIssues"),this.qej()):(Bd.a.Ja(this.V5b),this.V5b=null)}qej(){if(this.$&&this.$.pa){const ac=this.$.pa.va.$b();na.I(this.$.pa.va,null,null,null,ac)}}zEc(){wb.a(this.$).yQ(ab.a.bQa).Wq(this.AIf);this.$.em(this.od);this.fvc=!1}due(){this.documentVisibilityObserver||e.ULS.sendTraceTag(537155211,0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");
this.documentVisibilityObserver&&this.documentVisibilityObserver.oi?this.ECb||(this.documentVisibilityObserver.Hsa(this.jI),this.ECb=!0,e.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.v_d()}}Object(b.a)(gf,"NetworkConnectionStateManager",Eb.a,[755,3]);var rf=a(54),Mf=a(153);class Qa extends Ba.a{constructor(ac){super();this.$=ac;this.Gb()}create(){Ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7476522_IDBNewService2")?
void Mf.a.resolve(rf.x,{Wb:this.Na}).then(ac=>{let Lc=Object(cb.a)(this.$.da,400,()=>new gf(this.$,ac));this.qb(Lc)}):fe.TaskExtensions.za(ne.GetServiceTaskFactory.Pa(this.$.da,395,396,this.Na),ac=>{let Lc=Object(cb.a)(this.$.da,400,()=>new gf(this.$,ac.result));this.qb(Lc)},this.$.ka,3)}static la(ac){ac.da.Ha(401,new Qa(ac))}}Object(b.a)(Qa,"NetworkConnectionStateManagerFactory",Ba.a,[]);var Zb=a(1288),nb=a(1194),Tb=a(1252),qb=a(127),Kb=a(112),jc=a(158),Ac=a(329);class Jc{constructor(ac){this.MOa=
this.Czd=this.POa=this.Anc=0;this.vzd=this.mwf=null;ac?(this.Inc=ac,this.lub=Date.now,this.Oih(),this.$kj()):e.ULS.sendTraceTag(520955213,209,10,"Can not initialize PenMinutesManager because TaskManager is null")}uFj(){this.mwf="Office.Excel.Online.Data.Activity.PenMinutes"}$kj(){window.document.body.addEventListener("pointerenter",Object(v.a)(this,this.orc,"onPointerEnter"));window.document.body.addEventListener("pointerleave",Object(v.a)(this,this.ada,"onPointerLeave"));fa.a.instance.Tb("Common.App.VisibilityManagement.IVisibilityManager").execute(ac=>
{ac.hte(Object(v.a)(this,this.jzb,"handleVisibilityChange"))})}orc(ac){"pen"!==ac.pointerType||this.POa||(this.POa=Math.floor(this.lub()/1E3),this.POa<=this.Anc&&(this.POa=this.Anc),this.Czd=0)}ada(){this.fcf()}fcf(){const ac=Math.ceil(this.lub()/1E3);this.POa&&ac>this.Anc&&(this.Czd=ac,this.MOa+=this.Czd-this.POa);this.Anc=ac;this.POa=0}jzb(ac,Lc){0!==Lc.newState&&this.fcf()}Oih(){this.vzd=new Kb.a(4,2,6E4,Object(v.a)(this,this.RHi,"logPenUsage"));this.Inc.ig(this.vzd)}RHi(){0<this.MOa&&this.D5f(this.MOa);
this.MOa=0}D5f(ac){const Lc=new Ac.a;Lc.name=this.mwf;const rd=[];(ac=qb.a.mh("PenInputSec",ac.toString(),3))&&Array.add(rd,ac);Lc.dataFields=rd;jc.a.sendActivityEvent(Lc)}dispose(){0<this.MOa&&this.D5f(this.MOa);this.Inc.$o(this.vzd)}}Object(b.a)(Jc,"PenMinutesManager",null,[560]);class hd{constructor(){this.eSc=this.$a=null}get name(){return"Common.App.PenMinutesManager"}Kh(ac){this.$a=ac;const Lc=f.AFrameworkApplication.ti;this.$a.register(560,"Common.App.PenMinutesManager.IPenMinutesManager").tc().Bc(()=>
new Jc(Lc))}init(){this.eSc=this.$a.resolve("Common.App.PenMinutesManager.IPenMinutesManager")}dispose(){this.eSc&&this.eSc.dispose()}static main(){R.a.instance.si(new hd)}}Object(b.a)(hd,"PenMinutesManagerPackage",null,[4,5]);class Cd extends Ba.a{constructor(ac){super();this.$=ac;this.Gb()}static la(ac){ac.da.Ha(514,new Cd(ac))}create(){this.qb(Object(cb.a)(this.$.da,513,()=>{Type.registerNamespace("Common.App.PenMinutesManager");hd.main();const ac=fa.a.instance.resolve("Common.App.PenMinutesManager.IPenMinutesManager");
ac.uFj();return ac}))}}Object(b.a)(Cd,"PenMinutesFactory",Ba.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");Type.registerNamespace("_Ewa");Object(c.a)();Object(xa.a)();Object(bb.a)();Object(Za.a)();Object(La.a)();Object(Da.a)();Object(ba.a)();Object(Tb.a)();Type.registerNamespace("Common.App.InProductMessaging");U.main();Type.registerNamespace("Common.App.FirstRunExperienceLauncher");oa.main();(()=>{va.a.Fa(()=>{va.a.Fa(ib.la)})})();(()=>{va.a.Fa(()=>{va.a.Fa(Ya.la)})})();
va.a.Fa(xd.la);va.a.Fa(Qa.la);(()=>{va.a.Fa(ac=>{Cd.la(ac)})})();Object(Zb.a)();Object(nb.a)()},875:function(r,B,a){a.r(B);r=a(0);var c=a(7),b=a(15),e=a(327),f=a(29),d=a(11),h=a(271);class l{constructor(){this.scenario=null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}}Object(r.a)(l,"ConnectionErrorLogInfo",null,[]);var k=a(1149),w=a(1150);class n{constructor(m){this.dod=[k.a.xrg,k.a.iHc];this.Nm=(u,t)=>{this.bO[t]=u;this.Jfi()&&this.jsj("OnNetworkDownImmediatePing"===u.caller)};this.rma=
m;this.$=m.$;this.bO={}}bDi(){const m=w.a.Rfd(this.Nm,"OnNetworkDownImmediatePing",this.$,this.dod);for(const u of m)u.runTest()}Jfi(){for(const m of this.dod)if(void 0===this.bO[m]||null===this.bO[m])return!1;return!0}jsj(m){const u=this.$.Xe.l5;m&&this.VTj(u);for(var t of this.dod)this.bO[t]=Sys.Serialization.JavaScriptSerializer.serialize(this.bO[t]);m=Date.now();t=this.rma.Vkd(a(875).NetworkConnectionHealthChecker.$Fb).returnValue;const y=this.rma.Vkd(a(875).NetworkConnectionHealthChecker.XMb).returnValue;
this.bO.isOfflineMode=u;this.bO.networkDownBBAge=-1===t?t:m-t;this.bO.transientServerCommunicationFailuresBBAge=-1===y?y:m-y;this.rma.businessBar?(this.bO.isNetworkDownBBShown=this.rma.businessBar.bH(56).toString(),this.bO.isServerErrorBBShown=this.rma.businessBar.bH(21).toString()):(this.bO.isNetworkDownBBShown="unknown",this.bO.isServerErrorBBShown="unknown");b.ULS.sendTraceTag(537155224,0,50,`ConnectionHealthTestsRunner.ReportPingResults: ${Sys.Serialization.JavaScriptSerializer.serialize(this.bO)}`)}VTj(m){const {NetworkConnectionHealthChecker:u}=
a(875),t={};for(const y of Object.keys(this.bO)){const v=this.bO[y];t[v.testName]=v.isSuccess}t.isOfflineMode=m;this.rma.tYd(u.C5c,Sys.Serialization.JavaScriptSerializer.serialize(t))}}Object(r.a)(n,"ConnectionHealthTestsRunner",null,[]);a.d(B,"NetworkConnectionHealthChecker",function(){return x});class x{constructor(m){this.businessBar=this.r9a=null;this.fTi=(u,t)=>{t.j$c?this.hTi(t):this.gTi(t)};this.nh=(u,t)=>{u=t.context.methodName;this.r9a&&u===this.r9a&&(b.ULS.sendTraceTag(537155230,0,50,`NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "${this.r9a}" has now succeeded. Querying local storage for BB showings.`),
this.P9a(x.XMb,!0),this.r9a=null);this.puf(!1);this.T5b=!1};this.zm=(u,t)=>{f.a.lh(t.errors,[-1387426400])&&!this.T5b&&(this.T5b=!0,this.Y$f()&&window.performance.mark(x.rBf),(new n(this)).bDi())};this.Uf=()=>{this.puf(!0);this.P9a(x.$Fb,!1);this.P9a(x.XMb,!1)};this.yza=()=>{this.P9a(x.$Fb,!0)};this.$=m;this.pa=this.$.pa;this.localStorage=new h.a;this.T5b=!1;this.$.ea.Zj(this.Uf);this.pa.Xe.opb(this.yza);this.pa.kr(this.nh);this.$.da.hb(5,u=>{this.businessBar=u;u.YOg(this.fTi)});this.pa.Ax(this.zm)}dispose(){this.$&&
(this.$.ea&&this.$.ea.Zm(this.Uf),this.pa&&(this.pa.Xe.VKb(this.yza),this.pa.uy(this.zm),this.pa.zs(this.nh)))}hTi(m){const u={};u.Timestamp=Date.now().toString();switch(m.v0a){case 21:this.r9a=m.data.FailedMethod;u.FailedMethod=this.r9a;this.tYd(x.XMb,JSON.stringify(u));break;case 56:this.tYd(x.$Fb,JSON.stringify(u))}}gTi(m){switch(m.v0a){case 21:this.P9a(x.XMb,!0);break;case 56:this.P9a(x.$Fb,!0)}}tYd(m,u){try{this.localStorage.Me()&&this.localStorage.setItem(m,u)}catch(t){b.ULS.sendTraceTag(537155231,
0,15,`NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: ${t.message||"Unknown"}`)}}Vkd(m){if(this.localStorage.Me()&&(m=this.localStorage.vLa(m))&&"null"!==m){var u=JSON.parse(m);m=parseInt(u.Timestamp,10);u=Sys.Serialization.JavaScriptSerializer.serialize(u);return{returnValue:m,rawData:u}}return{returnValue:-1,rawData:null}}puf(m){if(this.localStorage.Me()){const u=this.localStorage.vLa(x.C5c);if(u&&"null"!==u){let t=-1;this.T5b&&(t=this.OXh(x.rBf,
x.QRi));b.ULS.sendTraceTag(537155229,0,50,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: ${Sys.Serialization.JavaScriptSerializer.serialize(u)}, Period offline: ${t}, New session: ${m}`);this.localStorage.removeItem(x.C5c)}}}OXh(m,u){if(!this.Y$f())return-1;window.performance.measure(u,m);m=window.performance.getEntriesByName(u);return m.length&&m[m.length-1]?m[m.length-1].duration:(b.ULS.sendTraceTag(537155228,0,10,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name ${u} returned no measures.`),
-1)}P9a(m,u){try{let t;const y=({rawData:t}=this.Vkd(m)).returnValue;if(-1!==y){const v=Object(c.a)(new l,{timeElapsed:Date.now()-y,scenario:m,isNewSession:!u,rawData:t});b.ULS.sendTraceTag(537155227,0,50,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: ${JSON.stringify(v)}`)}this.localStorage.removeItem(m)}catch(t){b.ULS.sendTraceTag(537155226,0,15,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: ${t.message||"Unknown"}`)}}Y$f(){return d.HelperMethods.n1c&&
e.a.grb}}x.$Fb="NetworkDownBBShown";x.XMb="ServerCommunicationFailureBBShown";x.C5c="ConnectionHealthPingRsults";x.rBf="offMoStMa";x.QRi="offMoDuMea";Object(r.a)(x,"NetworkConnectionHealthChecker",null,[3])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.pi.js.map/8b30c0acf77efa4e4f616d0d5488d0b9/EwaDSEsNext.pi.js.map