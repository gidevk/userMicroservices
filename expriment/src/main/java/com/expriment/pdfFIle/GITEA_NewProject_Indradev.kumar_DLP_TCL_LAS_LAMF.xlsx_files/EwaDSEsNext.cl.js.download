'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1016:function(r,B,a){a.d(B,"a",function(){return c});r=a(0);class c extends Sys.EventArgs{constructor(b,e,f,d){super();this.type=b;this.d8=e;this.Goh=f;this.bpa=d}}Object(r.a)(c,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1017:function(r,B,a){a.d(B,"a",function(){return c});r=a(0);class c{}c.xQd="rr";c.ewj="rd";c.cwj="rbp";c.NRd="sa";Object(r.a)(c,"RtcReconnectParams",null,[])},1018:function(r,B,a){a.d(B,
"a",function(){return c});r=a(0);class c{constructor(b,e,f,d){this.QMi=b;this.oCa=e;this.TLi=f;this.Lai=d}}Object(r.a)(c,"ThrottlerManagerSettings",null,[])},1196:function(r,B,a){r=a(0);class c extends Sys.EventArgs{constructor(C,H){super();this.newState=C;this.oldState=H}}Object(r.a)(c,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class b extends Sys.EventArgs{constructor(C,H){super();this.U8g=C;this.bpa=H}}Object(r.a)(b,"ClientInfoEventArgs",Sys.EventArgs,[]);class e extends Sys.EventArgs{constructor(C){super();
this.presence=C}}Object(r.a)(e,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);class f extends Sys.EventArgs{constructor(C){super();this.l4c=C}}Object(r.a)(f,"PersistentStateClearedEventArgs",Sys.EventArgs,[]);class d extends Sys.EventArgs{constructor(C,H){super();this.type=C;this.vL=H}}Object(r.a)(d,"PersistentStateUpdateEventArgs",Sys.EventArgs,[]);var h=a(1358);class l extends Sys.EventArgs{constructor(C,H=null){super();this.PG=C;this.dJg=H}get type(){return this.PG}get d8(){return this.dJg}}Object(r.a)(l,
"UpdateNotificationEventArgs",Sys.EventArgs,[]);class k extends Sys.EventArgs{constructor(){super()}}Object(r.a)(k,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class w extends Sys.EventArgs{constructor(C,H,I,S,P,D){super();this.Fhb=C;this.E5c=H;this.zbh=I;this.cYe=P;this.N3c=S;this.stopwatch=D}}Object(r.a)(w,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class n extends Sys.EventArgs{constructor(C){super();this.hubConnection=C}}Object(r.a)(n,"RefreshProxyEventArgs",
Sys.EventArgs,[]);class x extends Sys.EventArgs{constructor(C,H){super();this.errorMessage=H}}Object(r.a)(x,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class m extends Sys.EventArgs{constructor(C,H,I){super();this.type=C;this.presence=H;this.bpa=I}}Object(r.a)(m,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var u=a(1016);class t extends Sys.EventArgs{constructor(){super()}}Object(r.a)(t,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class y extends Sys.EventArgs{constructor(C){super();
this.l4c=C}}Object(r.a)(y,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(C,H){super();this.type=C;this.V7j=H}}Object(r.a)(v,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var A=a(101);a.d(B,"a",function(){return z});class z{constructor(){this.Za=new A.a}lfj(C,H){this.Za.raiseEvent("CSC",new c(C,H))}dgj(C){this.Za.raiseEvent("RP",new n(C))}ouc(C){this.Za.raiseEvent("RC",C)}fgj(){this.Za.raiseEvent("RMID")}cgj(C,H,I,S,P,D){this.Za.raiseEvent("RPS",
new w(C,H,I,S,P,D))}VTf(C,H){this.Za.raiseEvent("UPSR",new v(C,H))}ETf(C,H){this.Za.raiseEvent("PU",new h.a(C,H))}Ofj(C){this.Za.raiseEvent("MPU",new e(C))}EKd(C,H,I,S){this.Za.raiseEvent("SUN",new u.a(C,H,I,S))}ugj(C,H){this.Za.raiseEvent("UNR",new l(C,H))}NTf(C,H,I){this.Za.raiseEvent("SP",new m(C,H,I))}Yfj(C,H){this.Za.raiseEvent("PSU",new d(C,H))}Xfj(C){this.Za.raiseEvent("PSC",new f(C))}Ifj(C){this.Za.raiseEvent("IPSC",new f(C))}vgj(C){this.Za.raiseEvent("UPSC",new y(C))}jgj(C,H){this.Za.raiseEvent("SPC",
new t(C,H))}KTf(C,H){this.Za.raiseEvent("RCF",new x(C,H))}Cfj(C){this.Za.raiseEvent("CPSWM",new k(C))}tgj(C,H){this.Za.raiseEvent("UCI",new b(C,H))}z2(C){this.Za.addHandler("CSC",C)}a7(C){this.Za.removeHandler("CSC",C)}FRg(C){this.Za.addHandler("RP",C)}ERg(C){this.Za.addHandler("RC",C)}JRg(C){this.Za.addHandler("RMID",C)}DRg(C){this.Za.addHandler("RPS",C)}sSg(C){this.Za.addHandler("UPSR",C)}SZa(C){this.Za.addHandler("PU",C)}sRa(C){this.Za.removeHandler("PU",C)}pQg(C){this.Za.addHandler("IPU",C)}qSg(C){this.Za.addHandler("UCI",
C)}WRg(C){this.Za.addHandler("SUN",C)}qQg(C){this.Za.addHandler("IUNR",C)}UZa(C){this.Za.addHandler("UNR",C)}dLb(C){this.Za.removeHandler("UNR",C)}WYc(C){this.Za.addHandler("PSU",C)}LNd(C){this.Za.removeHandler("PSU",C)}oQg(C){this.Za.addHandler("IPSU",C)}nQg(C){this.Za.addHandler("IPSC",C)}rSg(C){this.Za.addHandler("UPSC",C)}VRg(C){this.Za.addHandler("SP",C)}YRg(C){this.Za.addHandler("SPC",C)}static getInstance(){return z.Ma||(z.Ma=new z)}}z.Ma=null;Object(r.a)(z,"RtcEventHub",null,[643])},1223:function(r,
B,a){a.r(B);r=a(0);var c=a(15),b=a(88),e=a(197),f=a(902);class d{}d.o$a="throttling_messageDelay";d.wCb="enabled";d.oCa="throttling_timeToWaitForResponse";d.i$a="throttling_maxNumberOfOutstandingMessages";d.Daf="throttling_globalMaxNumberOfOutstandingMessages";d.errorMessage="errorMessage";d.Mcg="url";d.S6="queryString";d.AC="connectionString";Object(r.a)(d,"RtcFindSessionOutputFieldNameConstants",null,[]);var h=a(4),l=a(82),k=a(41),w=a(466),n=a(704),x=a(115),m=a(31),u=a(178);class t{constructor(){this.Eaf=
this.mxf=this.nxf=this.txf=0;this.Okc=!1;this.correlationId=this.AC=this.S6=this.F5c=this.errorMessage=null}get Cah(){return this.F5c+"?"+this.S6}}Object(r.a)(t,"FindSessionResponse",null,[]);class y{}y.clientId="ClientId";y.s8j="UserApp";y.userSessionId="usid";y.userType="UserType";y.L8j="UserVersion";y.duc="qs";y.Y8g="clientProtocol";y.GPi="NoAuth";Object(r.a)(y,"RtcFindSessionInputQueryParamConstants",null,[]);class v{constructor(E,O,N,J,W,ea){this.JFa=null;const {FindSessionStrategy:R}=a(1223);
this.uFg=E;E=String.format("{0}={1}",y.clientId,m.a.pf(J));E=String.format("{0}&{1}={2}",E,y.userSessionId,m.a.pf(W));E=String.format("{0}&{1}={2}",E,y.s8j,m.a.pf(N.toString()));E=String.format("{0}&{1}={2}",E,y.userType,m.a.pf("1"));E=String.format("{0}&{1}={2}",E,y.L8j,m.a.pf(O));E=String.format("{0}&{1}={2}",E,y.Y8g,m.a.pf(R.W8g));(O=v.USh(N,ea))&&(E=String.format("{0}&{1}",E,O));this.Sxg=E}mWf(){this.JFa=this.uFg()}Kfd(){this.JFa&&""!==this.JFa||(this.mWf(),c.ULS.sendTraceTag(575784194,500,this.JFa&&
""!==this.JFa?50:15,"Query signature delegate called for refresh returned: {0} ",this.JFa));const E=String.format("{0}={1}",y.duc,m.a.pf(this.JFa));return String.format("{0}&{1}",E,this.Sxg)}static USh(E,O){return 4===E?String.format("{0}={1}",y.GPi,"1"):O?O.s$h():null}}Object(r.a)(v,"FindSessionQueryStringGenerator",null,[]);var A=a(963),z=a(901),C=a(742),H=a(1018);class I{}I.qLh="FSType";Object(r.a)(I,"RtcFindSessionRequestHeaders",null,[]);class S{}S.Rhj="polling";Object(r.a)(S,"RtcFindSessionTypes",
null,[]);var P=a(1017);class D{}D.h$j="RTC-TokenProofkey";D.XAi="RTC-IsWacJsBootFsRequest";Object(r.a)(D,"RtcRequestHeaders",null,[]);a.d(B,"FindSessionStrategy",function(){return G});class G{constructor(E,O,N,J,W,ea,R,Y,U,da,T,ka,L=null){this.ree=(new Date(0)).getTime();this.Bfe=0;this.AWb=!1;this.fle=null;this.QLd=36E5;this.lWa=G.Ggf;this.Vjb=0;this.GRa=null;this.eea=0;this.Rdb=this.rHe=null;this.XFg=[d.wCb,d.errorMessage,d.Mcg,d.AC,d.S6,d.Daf,d.i$a,d.oCa,d.o$a];this.WFg=[d.wCb,d.errorMessage];
this.AC=this.SOa=null;this.cae=new v(T?T:()=>h.AFrameworkApplication.xi,W,ea,R,E,O);this.Eib=ka;this.Ah=J;this.rh=O;this.Tzg=N;this.im=Y;this.Ug=U;this.ekb=L;this.dae=!1;this.rbc=9E4;da&&da.execute(fa=>{fa.rpb(()=>{c.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.im);this.cae.mWf()})});2>=100*Math.random()&&(this.QLd=3E5);A.a.instance&&(A.a.instance.R0e=this.QLd)}iGj(E){this.Rdb=E}init(){this.Ug.JRg(Object(b.a)(this,this.jtj,"resetGetMachineIdDelay"));
this.Ug.z2(Object(b.a)(this,this.WV,"onConnectionStateChanged"))}WV(E,O){this.eea=O.newState;2===O.newState&&(this.Vjb=0)}S4e(){let E;E=this.GRa.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.GRa.S6,G.zIe,m.a.pf(E)),correlationId:E}}n6h(E,O,N,J,W){this.dAj(()=>{J(W,"GetMachineIdSuccess")&&(c.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.AC,this.im),E(this.fle),N(this.g9h()))},ea=>{J(W,"GetMachineIdFailure")&&(c.ULS.sendTraceTag(4060129,
500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.im),O(ea))},J,W)}Drh(){this.EEe();this.Uii()}dAj(E,O,N,J){c.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.AC);if(this.AC)E();else{var W=this.H3g();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(E,O,N,J)},W)}}sendFindSessionRequestToServerInternal(E,O,N,J){N(J,"RequestMachineId")&&(this.ree=(new Date).getTime(),N=k.a.Yd(),this.T4e(W=>
{const ea=k.a.Yd();this.qOf(W);this.tTd();E();W=k.a.Yd()-ea;c.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",W)},W=>{const ea=k.a.Yd();this.EEe();A.a.instance&&A.a.instance.fy(2,3);O(W);W=k.a.Yd()-ea;c.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",W)},!1),N=k.a.Yd()-N,c.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",N))}Uii(){this.lWa+=G.v1h;this.lWa=Math.min(this.lWa,G.FLi)}H3g(){var E=(new Date).getTime();E=this.ree+this.lWa-E;0>E&&(E=
0);return E}qOf(E){try{this.GRa=E,this.SOa=E.Cah,this.AC=E.AC,this.rHe=E.S6,this.fle=E.F5c}catch(O){c.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",O.toString())}}EEe(){this.AC=null;this.FEe()}tTd(){this.FEe();this.AWb=!0;this.Bfe=window.setTimeout(Object(b.a)(this,this.zjj,"refreshMachineId"),this.QLd)}FEe(){this.AWb&&(window.clearTimeout(this.Bfe),this.AWb=!1)}zjj(){this.AWb=!1;this.T4e(E=>{const O=this.rHe!==E.S6,N=this.AC!==E.AC,J=this.AC;
this.qOf(E);0!==this.eea&&(N?(c.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",J||"null",E.AC),this.Ug.ouc()):(this.Ug.jgj(O,N),this.tTd()))},()=>{A.a.instance&&A.a.instance.fy(2,3);this.tTd()},!0)}jtj(){this.lWa=G.Ggf}g9h(){return new H.a(this.GRa.txf,this.GRa.nxf,this.GRa.mxf,this.GRa.Eaf)}d_j(E){if(Object.getType(E)!==Object)return null;for(let O in E);return this.Egh(E)}Egh(E){if(!(d.wCb in E))return null;const O=E[d.wCb];var N=O?this.XFg:
this.WFg;for(const J of N)if(!(J in E))return null;N=Object.assign(new t,{Okc:E[d.wCb],errorMessage:E[d.errorMessage],correlationId:u.a.create().toString()});O&&(N.F5c=E[d.Mcg],N.S6=E[d.S6],N.AC=E[d.AC],N.Eaf=E[d.Daf],N.mxf=E[d.i$a],N.nxf=E[d.oCa],N.txf=E[d.o$a]);return N}XYh(E,O){c.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.ekb.oLh.continueWith(()=>{this.ekb.oLh.result?(c.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),
E(this.ekb.pLh)):(c.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),O(this.ekb.pLh))})}B0f(E,O,N,J,W=!1){return ea=>{z.a.instance.XJb(0,1);E&&E.stop();this.Eib=this.Rdb=null;this.yuf(ea.data,!0,O);var R=C.RtcUtils.deserialize(ea.data.me,"FindSession",null);if(R)if(R=this.d_j(R)){if(R.Okc&&R.S6&&R.AC){c.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.im);this.BGi(ea.data);N(R);return}O.FindSessionFailureReason="FindSessionInvalidResponse";
O.IsRtcEnabled=R.Okc;O.IsQueryStringEmpty=!R.S6;O.IsConnectionStringEmpty=!R.AC;c.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.im,R.Okc,!R.S6,!R.AC)}else O.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",c.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.im);else O.FindSessionFailureReason=
"FindSessionDeserializeServerResponseFailed",c.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.im);this.LTf(O,W);J(null)}}u0f(E,O,N,J=!1){return W=>{z.a.instance.XJb(0,1);E&&E.stop();this.Eib=this.Rdb=null;this.yuf(W.data,!1,O);let ea=null;var R="unknown";let Y="unknown";W.data&&((R=W.data.responseHeaders)&&G.eMb in R&&(ea=R[G.eMb].toString()),R=n.a[W.data.status],Y=W.data.httpStatus.toString());O.FindSessionFailureReason="FindSessionRequestFailed";O.HttpErrorCode=
Y;O.HttpErrorStatus=R;O[G.eMb]=ea;c.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",R,Y,this.im,ea,J);this.LTf(O,J);N(Y)}}T4e(E,O,N=!1){let J=null;c.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.im);const W={};var ea=this.cae.Kfd();W[w.a.RY]=u.a.create().toString();this.Rdb&&""!==this.Rdb?ea=String.format("{0}&{1}={2}",ea,P.a.xQd,this.Rdb):this.Eib&&""!==this.Eib&&(ea=
String.format("{0}&{1}={2}",ea,P.a.xQd,this.Eib),W[D.h$j]="True",W[D.XAi]="True");ea=this.Tzg+"?"+ea;N&&(W[I.qLh]=S.Rhj);const R={};R.IsNetworkOfflineBeforeSendRequest=this.rh.e8a;R.HasAvailableConnectionsBeforeSendRequest=this.rh.Hcf;R.MaxConnectionsAllowed=this.rh.Vnc;R.IsRefreshMachineId=N;this.ekb&&!this.dae?(this.XYh(this.B0f(null,R,E,O,N),this.u0f(null,R,O,N)),this.dae=!0):(this.Ah&&(J=this.Ah.Kc("WebServiceCall","GetMachineIdFromTheServer")),A.a.instance&&A.a.instance.fy(2,0),0>this.rh.eha(ea,
1,null,W,[G.x6b,G.eMb,G.yGb,G.wQd,G.Pyf,G.dBf,G.cBf],!1,1,this.B0f(J,R,E,O,N),this.u0f(J,R,O,N),null,null,!1,null,this.rbc,"3",null,!0)&&(5<this.Vjb&&200>this.Vjb&&c.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.Vjb),window.setTimeout(()=>{this.Vjb++;O("-1")},1E3)))}yuf(E,O,N){N||(N={});N.IsNetworkOfflineAfterRequestComplete=this.rh.e8a;N.IsRequestSucceeded=O;E&&(N.EnqueueTime=E.n$b,N.InvokedTime=E.sF,
N.CompletedTime=E.h3,E.responseHeaders&&(G.x6b in E.responseHeaders&&(N.CorrelationId=E.responseHeaders[G.x6b]),G.yGb in E.responseHeaders&&(N[G.yGb]=E.responseHeaders[G.yGb])));c.ULS.sendTraceTag(38633565,500,O?50:15,C.RtcUtils.R$a(N))}LTf(E,O){E||(E={});E.ConnectionState=f.a[this.eea];O||this.Ug.KTf(1,E)}BGi(E){try{var O=!1,N=!1,J=E.responseHeaders,W=l.a.eK(E.request.get_url());if(J&&G.wQd in J){const da=J[G.wQd].toString().toLocaleLowerCase();N="true"===da;O="false"===da}J=!1;const U=0<=W.toLocaleLowerCase().indexOf("collab");
N&&!U?J=!0:O&&U&&(J=!0);if(J){O={};O.HostName=W;O.Status=n.a[E.status];O.HttpStatus=E.httpStatus.toString();var ea=E.request.get_headers();for(let da in ea){var R=ea[da];(W=da)&&0<W.length&&(N=0,R&&(N=R.toString().length),O["r_"+W]=N)}if(E.responseHeaders){const da=new e.a;da.add(G.x6b);da.add(G.yGb);da.add(G.eMb);da.add(G.dBf);da.add(G.cBf);da.add(G.Pyf);G.yNg(O,E.responseHeaders,da)}G.lNg(E.request.get_url(),O);var Y=x.a.toJSON(O);c.ULS.sendTraceTag(559437006,500,15,Y)}}catch(U){c.ULS.sendTraceTag(559437007,
500,10,"DomainLandingIncorretDC exception[{0}]",U.toString())}}static createInstance(E,O,N,J,W,ea,R,Y,U,da,T,ka=null){return G.vhh(E,O,N,J,W,ea,R,Y,U,da,T,ka)}static vhh(E,O,N,J,W,ea,R,Y,U,da,T,ka=null){E=E||u.a.create().toString();E=new G(E,O,N,J,W,ea,R,Y,U,da,null,T,ka);E.init();return E}static yNg(E,O,N){for(let J of N)J in O&&(E[J]=O[J])}static lNg(E,O){if(E){var N=E.indexOf("?");if(-1!==N)for(E=E.substr(N+1).split("&"),N=0;N<E.length;++N){var J=E[N].split("=");if(2===J.length){const W=J[0];if(W&&
0<W.length){let ea=0;if(J=J[1])ea=J.length;O["q_"+W]=ea}}}}}}G.v1h=3E3;G.FLi=3E5;G.W8g="1.0";G.Ggf=1E3;G.x6b="X-CorrelationId";G.zIe="corrid";G.eMb="RtcErrorCode";G.yGb="X-OfficeCluster";G.wQd="X-NewEnv";G.Pyf="X-MSEdge-Ref";G.cBf="X-OFFICEFD";G.dBf="X-OfficeFE";Object(r.a)(G,"FindSessionStrategy",null,[999])},1357:function(r,B,a){a.r(B);a.d(B,"RealtimeChannelMetrics",function(){return d});r=a(0);var c=a(15),b=a(244),e=a(115),f=a(742);class d{constructor(){this.ahe=this.bhe=this.che=this.Zge=this.Yge=
this.$ge=this.fmb=this.vRc=0;this.N8=this.SPc=this.slb=this.NPc=this.Yfa=this.EPc=this.jra=this.nlb=this.xXa=this.DPc=this.RUb=this.JWa=null;this.EQc=this.Nlb=this.cle=this.R7d=0;this.bge=!1;this.AVf=this.xLd;this.DVf=this.ALd;this.CVf=this.zLd;this.HVf=this.CLd;this.GVf=this.BLd;this.HLd=this.ILd;this.YJb=this.FLd;this.YQa=this.DLd;this.ZQa=this.ELd;this.BVf=this.yLd;this.aGb=this.TBd;this.Soc=this.VBd}xLd(){this.vRc++;this.DPc=new Date;this.JWa||(this.JWa=new Date)}ALd(){this.fmb++;this.jra=new Date;
this.RUb||(this.RUb=this.jra);this.slb=this.jra;this.Oah()}zLd(){this.$ge++;this.EPc=new Date}CLd(){this.Yge++;this.xXa=new Date}BLd(){this.Zge++;this.nlb=new Date}FLd(){this.Yfa=new Date;this.che++}ELd(){this.N8||(this.N8=new Date);this.bhe++}DLd(){this.NPc=new Date;this.ahe++}ILd(){!this.bge&&this.vRc&&(c.ULS.sendTraceTag(39321871,500,15,e.a.toJSON(this.Y9g())),this.bge=!0)}yLd(h){let l,k;({mff:h,pff:l,exception:k}=f.RtcUtils.zIh(h));h&&h!==b.a.ZO&&(c.ULS.sendTraceTag(40157596,500,15,e.a.toJSON({["HttpErrorCode"]:h,
["HttpErrorStatus"]:l,["Exception"]:k})),b.a.tjf(h)&&this.R7d++,b.a.uof(h)&&this.cle++)}TBd(){this.SPc=new Date}VBd(){this.xXa=this.slb=new Date}Y9g(){return{["numberOfConnectionAttempts"]:this.vRc,["numberOfSuccessfulConnections"]:this.fmb,["numberOfFailedConnections"]:this.$ge,["numberOfDisconnectedConnections"]:this.Yge,["numberOfExplicitDisconnectedConnections"]:this.Zge,["numberOfSentMessages"]:this.che,["numberOfReceivedMessages"]:this.bhe,["numberOfLostMessages"]:this.ahe,["firstConnectionAttempt"]:this.JWa?
this.JWa:null,["firstMessageReceived"]:this.N8?this.N8:null,["firstConnectionSuccess"]:this.RUb?this.RUb:null,["lastConnectionAttempt"]:this.DPc?this.DPc:null,["lastConnectionSuccess"]:this.jra?this.jra:null,["lastConnectionFailure"]:this.EPc?this.EPc:null,["lastMessageSent"]:this.Yfa?this.Yfa:null,["lastMessageLost"]:this.NPc?this.NPc:null,["lastDisconnect"]:this.xXa?this.xXa:null,["lastExplicitDisconnect"]:this.nlb?this.nlb:null,["lastTimeOnline"]:this.slb?this.slb:null,["lastTimeOffline"]:this.SPc?
this.SPc:null,["maxDisconnectedTimeMs"]:this.Nlb,["maxExplicitDisconnectedTimeMs"]:this.EQc,["clientConnectionErrors"]:this.R7d,["serverConnectionErrors"]:this.cle}}Oah(){this.JWa&&1===this.fmb&&(this.Nlb=Math.max(this.Nlb,this.jra.getTime()-this.JWa.getTime()));this.xXa&&1<this.fmb&&(this.Nlb=Math.max(this.Nlb,this.jra.getTime()-this.xXa.getTime()));this.nlb&&1<this.fmb&&(this.EQc=Math.max(this.EQc,this.jra.getTime()-this.nlb.getTime()))}static createInstance(h){d.Ma||(d.Ma=new d,c.ULS.sendTraceTag(39321870,
500,50,"RealtimeChannelMetrics initialized for client {0}",h));return d.Ma}}d.Ma=null;Object(r.a)(d,"RealtimeChannelMetrics",null,[996,72])},1466:function(r,B,a){a.r(B);var c={};a.r(c);a.d(c,"NamedSheetViewConversionManager",function(){return ta});var b=a(0),e=a(88);class f{constructor(Ua,Rb){this.Ora=null;this.zmb=Ua;this.YEg=Rb}init(){this.zmb.continueWith(()=>{this.Ora=this.zmb.result;this.Ora.VZa(Object(e.a)(this,this.IN,"onUsersUpdated"))})}IN(){f.axe(this.Ora.Dva())&&(this.Ora.cOd(Object(e.a)(this,
this.IN,"onUsersUpdated")),this.YEg.IsRealCoauthSession=!0)}static axe(Ua){let Rb=null;for(const sc of Ua)if(sc)if(Ua=sc.isAnonymous||!sc.email?sc.clientId:sc.email.toUpperCase(),!Rb)Rb=Ua;else if(Rb!==Ua)return!0;return!1}}Object(b.a)(f,"CoauthTelemetry",null,[599]);var d=a(15),h=a(167),l=a(87),k=a(4),w;(function(Ua){Ua[Ua.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";Ua[Ua.notImplemented=1]="notImplemented";Ua[Ua.renderHandled=2]="renderHandled";Ua[Ua.renderHandledWithVeto=3]="renderHandledWithVeto"})(w||
(w={}));Object(b.b)("CoauthorGalleryTelemetryEndResult",w);var n=a(102),x=a(115),m=a(58);class u{constructor(Ua,Rb,sc,Mc,id,Ed,ee,oe,Xe){this.lie=this.a8d=this.qx=null;this.DVa=Ua;this.kZb=new h.a;this.fb=sc;this.ZJc=Rb;this.MVa=Mc;this.Tg=id;this.nSc=Ed;this.Jra=ee;this.cwg=oe;this.bbe=this.Zae=!1;this.JZb=0;this.Z7d=1;this.KDa=Xe;this.aoe=this.fb.qa("PeoplesWellExtraButtonInfoIsEnabled");this.LVa=Object(l.a)(String,k.AFrameworkApplication.Ub.Application)||""}get leg(){return this.kZb.task}init(){m.Task.WAA.call(null,
this.Jra,this.ZJc,this.nSc).continueWith(()=>{this.qx=this.Jra.result;this.a8d=this.ZJc.result;this.lie=this.nSc.result;m.Task.WAA.call(null,this.ZJc.result.D4c,this.nSc.result.wDc).continueWith(()=>{this.Z7d=this.a8d.D4c.result;this.JZb=this.lie.wDc.result;this.qx.VZa(Object(e.a)(this,this.Vrc,"onUsersUpdatedEventListener"));this.qx.Dva().length&&this.IN()})})}Vrc(){this.IN()}IN(){this.cwg(this.qx.Dva())?(this.qx.cOd(Object(e.a)(this,this.Vrc,"onUsersUpdatedEventListener")),this.LWi(this.Zae)):this.kZb.hx(1);
this.Zae=!0}LWi(Ua){this.bbe?this.leg.continueWith(()=>{d.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",w[this.leg.result])}):(this.bbe=!0,this.xdj(0===this.Z7d&&!Ua))}xdj(Ua){Ua?this.MVa.Rj(4,Object(e.a)(this,this.WEd,"onInteractiveReady")):this.kZb.hx(1)}WEd(){const Ua=this.Tg.VA("AppInitStatus_interactivityReady");d.ULS.shipAssertTag(42259235,325,!!this.JZb);const Rb=this.JZb-Ua,sc={};sc.InteractiveTime=Ua;sc.ReactRenderComplete=this.JZb;sc.HadTabSwitch=
this.KDa();sc.IsModernGallery=this.aoe;d.ULS.sendTraceTag(594883104,325,50,x.a.toJSON(sc));this.aoe?(d.ULS.sendTraceTag(42062997,325,15,Rb.toString()),this.kZb.hx(this.I$j(Rb)?3:2)):d.ULS.sendTraceTag(594883103,325,15,Rb.toString())}I$j(Ua){const Rb=Ua>this.fb.Ad("CoauthorGalleryTimeToRenderDurationMs",1E4),sc="Word"===this.LVa;if(this.KDa())return d.ULS.sendTraceTag(50455714,325,50,Rb.toString()),!1;sc&&n.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);Rb&&
(sc&&n.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),d.ULS.sendTraceTag(42062998,325,15,Ua.toString()));return Rb}}Object(b.a)(u,"CoauthorGalleryTelemetry",null,[600]);class t{constructor(Ua){this.qx=null;this.wTb={};this.yXb={};this.Jkb=null;this.Jra=Ua}nec(Ua){const Rb=new h.a;this.init().continueWith(()=>{Ua in this.wTb?Rb.hx(this.wTb[Ua]):this.yXb[Ua]=Rb});return Rb.task}init(){if(this.Jkb)return this.Jkb.task;this.Jkb=
new h.a;this.Jra.continueWith(()=>{this.qx=this.Jra.result;this.qx.VZa(Object(e.a)(this,this.IN,"onUsersUpdated"));this.bng();this.Jkb.setResult(null)});return this.Jkb.task}bng(){const Ua=this.qx.Dva();Ua.sort(Object(e.a)(this,this.tah,"comparePresenceUsers"));this.wTb={};for(let Rb=0;Rb<Ua.length&&Ua[Rb]&&Ua[Rb].Pla;Rb++)this.hNg(this.wTb,Ua[Rb].clientId,Rb)}hNg(Ua,Rb,sc){Ua[Rb]=sc;Rb in this.yXb&&(this.yXb[Rb].hx(sc),delete this.yXb[Rb])}IN(){this.bng()}tah(Ua,Rb){return Ua.Pla>Rb.Pla?1:Ua.Pla<
Rb.Pla?-1:0}}Object(b.a)(t,"CoauthorPositionFinder",null,[596]);var y=a(653),v=a(559),A=a(702),z=a(197),C=a(178);class H{constructor(){this.Tga=null;this.wib=Array(32)}xor(Ua){if(!Ua)throw Error.argumentNull("Guid argument cannot be null");const Rb=new H,sc=new Sys.StringBuilder;for(let Mc=0;Mc<Ua.wib.length;Mc++){const id=this.wib[Mc]^Ua.wib[Mc];Rb.wib[Mc]=id;sc.append(id.toString(16));7!==Mc&&11!==Mc&&15!==Mc&&19!==Mc||sc.append("-")}Rb.Tga=C.a.faa(sc.toString());return Rb}toString(){return this.Tga.toString()}equals(Ua){if(!Ua)throw Error.argumentNull("Guid argument cannot be null");
return this.Tga.equals(Ua.Tga)}static tfd(Ua){if(!Ua)throw Error.argumentNull("String input cannot be null");const Rb=new H;Rb.Tga=C.a.faa(Ua);const sc=Rb.Tga.toString();let Mc=0;for(let Ed=0;Ed<sc.length;Ed++){var id=Ua.charAt(Ed);if(H.bui(id))id=H.tgi(id,Ua.charCodeAt(Ed)),Rb.wib[Mc++]=id;else if(!H.wti(id))throw Error.argument("String contains characters not valid in Guids");}return Rb}static bui(Ua){return"0"<=Ua&&"9">=Ua||"A"<=Ua&&"F">=Ua||"a"<=Ua&&"f">=Ua}static wti(Ua){return"{"===Ua||"}"===
Ua||"-"===Ua}static tgi(Ua,Rb){if("0"<=Ua&&"9">=Ua)return Rb-48;if("A"<=Ua&&"F">=Ua)return Rb-65+10;if("a"<=Ua&&"f">=Ua)return Rb-97+10;throw Error.argument("Char is not valid hex digit");}}Object(b.a)(H,"Guid",null,[]);class I{constructor(Ua,Rb,sc,Mc){this.Ora=null;this.j9d=this.vge=!1;this.Pee=0;this.zmb=Ua;this.pVc=Rb;this.fb=sc;this.PXa=Mc;this.Nvg=k.AFrameworkApplication.userNameUnknown||k.AFrameworkApplication.limitedEdit;this.sfe=new y.a(v.a.li())}get x8c(){return this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",
!1)}init(){this.zmb.continueWith(()=>{this.Ora=this.zmb.result;this.Ora.VZa(Object(e.a)(this,this.IN,"onUsersUpdated"))})}IN(){this.W9g(this.Ora.Dva())}W9g(Ua){var Rb=0;const sc=new A.a(v.a.li());for(const Mc of Ua)if(Mc&&Mc.isAnonymous){k.AFrameworkApplication.yya("70eb6120;2gfeb930");if(sc.kb(Mc.userName))sc.ma(Mc.userName).add(Mc.clientId);else{let id;sc.add(Mc.userName,(id=new z.a,id.add(Mc.clientId),id))}Mc.clientId!==this.PXa?(Rb++,2<=Rb&&!this.vge&&this.DHi()):!this.j9d&&this.x8c&&"Guest"===
Mc.userName&&(d.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.j9d=!0)}if(this.x8c&&this.Pee!==Rb){d.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",Rb+(this.Nvg?1:0));this.Pee=Rb;for(let Mc of sc.keys)2<=sc.ma(Mc).count&&(Ua=this.NXh(sc.ma(Mc)),this.sfe.contains(Ua)||(Rb={},Rb.guestsWithSameName=sc.ma(Mc).count,Rb.identifier=Ua,d.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",Rb),this.sfe.add(Ua)))}}DHi(){d.ULS.sendTraceTag(525112603,
302,50,"Multiple guests simultaneously coauthoring");this.vge=!0;this.x8c&&this.pVc&&this.pVc.continueWith(()=>{window.setTimeout(()=>{this.pVc.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}NXh(Ua){if(!Ua||1>=Ua.count)return"";let Rb=H.tfd(Ua.ma(0));for(let sc=1;sc<Ua.count;sc++)Rb=Rb.xor(H.tfd(Ua.ma(sc)));return Rb.toString()}}Object(b.a)(I,"GuestCoauthTelemetry",null,[]);var S=a(558);class P{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=
!1}}Object(b.a)(P,"PL",null,[]);var D=a(40);class G{constructor(){this.ct=this.vt=this.d=0}static R5f(Ua,Rb,sc){const Mc=new G;Mc.d=Ua;Mc.vt=Rb;Mc.ct=sc;return D.c(Mc)}}Object(b.a)(G,"VD",null,[]);var E=a(199);class O{constructor(Ua,Rb,sc,Mc,id,Ed,ee,oe,Xe){this.kle=!1;this._id=Ua;this.Cp=Rb;this.HL=sc;this.fRc=Mc;this.EVc=id;this.tGa=Ed;this.fEa=ee;this.qxg=oe;this.KDa=Xe;this.LVa=Object(l.a)(String,k.AFrameworkApplication.Ub.Application)||""}veto(Ua){m.Task.WAA(this.fRc,this.EVc).continueWith(()=>
{if(this.fRc.result<=this.EVc.result)Ua.hx(!1);else{var Rb=this.HL-this.Cp,sc=new P;sc.id=this._id;sc.et=this.HL;sc.st=this.Cp;sc.d=this.HL-this.Cp;sc.mp=this.fRc.result;sc.tp=this.EVc.result;sc.ct=this.ZUh(this.qxg);sc.vc=this.KDa();var Mc=D.c(sc),id="Word"===this.LVa;d.ULS.sendTraceTag(42078597,302,15,Mc);if(id){const Ed=new Map;Ed.set("data",Mc);n.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",Ed)}Rb>this.tGa.value&&!this.kle&&!sc.vc&&(this.kle=!0,Ua.hx(!0),sc=Object.assign(new E.a,
{inStaging:!0,extendedProperties:new Map}),sc.extendedProperties.set("data",Mc),id&&n.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,sc),Rb<this.fEa.value&&d.ULS.sendTraceTag(42078598,302,15,G.R5f(Rb,this.tGa.value,this.fEa.value)));Ua.task.isCompleted||Ua.hx(!1)}})}ZUh(Ua){switch(Ua){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(b.a)(O,"PresenceLatencyActivityLogger",null,[]);class N{constructor(Ua,
Rb,sc){this.z7d=this.Y7d=this.mTb=this.vTb=this.HVa=0;this._id=Ua;this.tGa=Rb;this.fEa=sc;this.LVa=Object(l.a)(String,k.AFrameworkApplication.Ub.Application)||""}get oue(){return this.HVa}set oue(Ua){this.HVa=Ua;this.q3c()}get EFe(){return this.vTb}set EFe(Ua){this.vTb=Ua;this.q3c()}get BCe(){return this.mTb}set BCe(Ua){this.mTb=Ua;this.q3c()}get FFe(){return 0!==this.Y7d}get CCe(){return 0!==this.z7d}q3c(){!this.FFe&&this.HVa&&this.vTb&&(this.Y7d=this.veto(this.vTb,"CoauthGalleryLightupDurationTooLong"));
!this.CCe&&this.HVa&&this.mTb&&(this.z7d=this.veto(this.mTb,"CanvasPresenceLightupDurationTooLong"))}veto(Ua,Rb){const sc=Ua-this.HVa;var Mc=new P;Mc.id=this._id;Mc.et=Ua;Mc.st=this.HVa;Mc.d=sc;var id=D.c(Mc);Ua="Word"===this.LVa;Mc="CanvasPresenceLightupDurationTooLong"===Rb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===Rb?d.ULS.sendTraceTag(572289499,302,15,id):d.ULS.sendTraceTag(571524118,302,15,id);if(Ua){var Ed=new Map;Ed.set("data",id);
n.Health.instance.recordKpiUsage(Mc,0,"wordcollabrel",Ed)}return sc>this.tGa.value?(Ed=Object.assign(new E.a,{inStaging:!0,extendedProperties:new Map}),Ed.extendedProperties.set("data",id),id=sc<this.fEa.value,Ed.extendedProperties.set("cash",id?"true":"false"),Ua&&n.Health.instance.recordKpiFailure(Mc,Rb,!1,!0,Ed),d.ULS.sendTraceTag(572289500,302,15,G.R5f(sc,this.tGa.value,this.fEa.value)),id?2:1):3}}Object(b.a)(N,"PresenceLightupLatencyLogger",null,[]);var J=a(55),W=a(327);class ea{constructor(Ua,
Rb,sc,Mc,id,Ed,ee=null,oe=null,Xe=null){this.cje={};this.YJc={};this.Sde=new z.a;this.Kkb=this.qx=this.uYb=null;this.ime=this.hme=0;this.tGa=new S.a(()=>ee.LM("PresenceBootLatencyThreshold",1E4));this.fEa=new S.a(()=>ee.LM("PresenceBootLatencyCutoffThreshold",6E4));this.BJg=new S.a(()=>ee.LM("PresenceLightupLatencyThreshold",2E3));this.pyg=new S.a(()=>ee.LM("PresenceLightupLatencyCutoffThreshold",1E4));this.aFg=Mc;this.$7d=Ua;this.vke=Rb;this.Jra=sc;this.Tg=id;this.PXa=oe;this.KDa=Ed;this.ebe=Xe;
this.U6d=!1;this.init()}Ivh(Ua,Rb,sc=null){sc&&(d.ULS.shipAssertTag(42274970,302,!this.PXa||this.PXa===sc,"_myClientId is already set and you are trying to update it to something different"),this.PXa=sc);const Mc=new h.a;this.init().continueWith(()=>{this.s1i(Ua);this.Jvh(Mc,Ua,Rb)})}get $yf(){return this.PXa||"{"+k.AFrameworkApplication.userSessionId+"}"}init(){if(this.Kkb)return this.Kkb.task;this.Kkb=new h.a;this.KDa()&&d.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.$7d.continueWith(()=>
{const Ua=this.$7d.result,Rb=Ua.D4c,sc=Ua.KNi;sc.continueWith(()=>{Rb.continueWith(()=>{this.ebe&&this.ebe.addQosPillar("RealTimeCoauth");this.ZSj(Rb.result,sc.result);this.Kkb.setResult(null)})})});this.vke.continueWith(()=>{this.uYb=this.vke.result;this.uYb.z2(Object(e.a)(this,this.A2i,"onRtcConnection"));this.uYb.UZa(Object(e.a)(this,this.vUi,"onCoauthorBootReceived"))});this.Jra.continueWith(()=>{this.qx=this.Jra.result;this.qx.VZa(Object(e.a)(this,this.Vrc,"onUsersUpdatedEventListener"));0<this.qx.Dva().length&&
this.IN()});return this.Kkb.task}l3e(){return this.Tg.j3(J.a.XUa)?this.Tg.VA(J.a.XUa):W.a.KP?window.performance.timing.fetchStart:-1}A2i(Ua,Rb){this.U6d||2!==Rb.newState||(Ua=Date.now()-this.l3e(),Rb={},Rb.clientId=this.$yf,Rb.bootTime=Ua,this.U6d=!0,this.uYb.lea(15,Rb))}vUi(Ua,Rb){if(15===Rb.type){Ua=Date.now();Rb=Rb.d8;var sc=Rb.bootTime;this.Wid(Rb.clientId).oue=Ua-sc}}Vrc(){this.IN()}IN(){const Ua=Date.now();var Rb=this.qx.Dva();const sc=new z.a;for(const Mc of Rb)this.Sde.contains(Mc.clientId)||
(this.Sde.add(Mc.clientId),sc.add(Mc.clientId));if(0<sc.count)for(let Mc of sc)Rb=this.Wid(Mc),Rb.FFe||(Rb.EFe=Ua)}s1i(Ua){Ua=this.Wid(Ua);Ua.CCe||(Ua.BCe=Date.now())}Wid(Ua){return Ua in this.YJc?this.YJc[Ua]:this.YJc[Ua]=new N(Ua,this.BJg,this.pyg)}ZSj(Ua,Rb=0){this.hme=Ua;this.ime=Rb?Rb:(new Date).getTime()}Jvh(Ua,Rb,sc){sc=sc?sc.getTime():(new Date).getTime();Rb in this.cje?Ua.$z():(sc=new O(Rb,this.X7h(),sc,this.nec(this.$yf),this.nec(Rb),this.tGa,this.fEa,0,this.KDa),this.cje[Rb]=sc,sc.veto(Ua))}X7h(){return 1===
this.hme?this.ime:this.l3e()}nec(Ua){return this.aFg.nec(Ua)}}Object(b.a)(ea,"PresenceBootTelemetry",null,[545]);var R=a(142),Y=a(257),U=a(223),da=a(86),T=a(524);class ka{get name(){return"Common.App.CoauthTelemetry"}Kh(Ua){Ua.register(f,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").tc().Bc(()=>new f(T.a.gq(Ua.Tb("Common.IPeopleInfoProvider")),k.AFrameworkApplication.gf));Ua.register(u,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").tc().Bc(()=>
new u(k.AFrameworkApplication.rb,T.a.gq(Ua.Tb("Common.ICoauthoringTelemeryInfoProvider")),k.AFrameworkApplication.fa,R.a.get_instance(),U.a.instance,T.a.gq(Ua.Tb("Common.IPeoplesWell")),T.a.gq(Ua.Tb("Common.IPeopleInfoProvider")),f.axe,()=>this.Tze()));Ua.register(ea,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").tc().Bc(()=>new ea(T.a.gq(Ua.Tb("Common.ICoauthoringTelemeryInfoProvider")),T.a.gq(Ua.Tb("Common.IRealtimeChannelBasic")),T.a.gq(Ua.Tb("Common.IPeopleInfoProvider")),
Ua.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),U.a.instance,()=>this.Tze(),k.AFrameworkApplication.fa,null,n.Health.instance));Ua.register(t,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").tc().Bc(()=>new t(T.a.gq(Ua.Tb("Common.IPeopleInfoProvider"))));Ua.register(I,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").tc().Bc(()=>new I(T.a.gq(Ua.Tb("Common.IPeopleInfoProvider")),T.a.gq(Ua.Tb("Common.ISystemInitiatedFeedback")),
k.AFrameworkApplication.fa,"{"+k.AFrameworkApplication.userSessionId+"}"))}init(){k.AFrameworkApplication.fa.zu(()=>{da.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();da.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();k.AFrameworkApplication.fa.qa("CoauthorGalleryTelemetryIsEnabled")&&da.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();k.AFrameworkApplication.fa.qa("CashTelemetryIsEnabled")&&(da.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),
da.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}Tze(){return W.a.KP&&U.a.instance.j3(J.a.tRb)?0<U.a.instance.VA(J.a.tRb)[J.a.Rpg]:!1}static main(){Y.a.instance.si(new ka)}}Object(b.a)(ka,"CoauthTelemetryPackage",null,[4,5]);var L=a(155),fa=a(39);class wa{}Object(b.a)(wa,"NamedSheetViewConversionEntry",null,[]);var oa=a(8),xa=a(117),bb=a(29),Za=a(1),La=a(63);const va=(Ua,Rb,sc,Mc,id,Ed=null)=>{Ed=Ua.Oa(1,Ed);return La.g(Ua,"GetNamedSheetViewConversion",Ed,
Rb,sc,Mc,id,132)};var Ba=a(44),Ea=a(22);const pa=(Ua,Rb)=>!!Ua&&!!Rb&&Ua.SheetName===Rb.SheetName&&(!!Ua.NamedObjectName&&Ua.NamedObjectName===Rb.NamedObjectName||!Ua.NamedObjectName&&!Rb.NamedObjectName&&Ba.E(Ua).vd(Ba.E(Rb))),$a=(Ua,Rb,sc)=>{if(!Rb||!Rb.Bb)return null;for(let Mc=0;Mc<Rb.Bb.count;Mc++){const id=Rb.Bb.getItem(Mc);if(id&&id.type===sc&&id.usedRange&&id.usedRange.contains(Ba.E(Ua))&&Ea.a.equals(id.sheetName,Ua.SheetName,!0))return id}return null};var cb=a(54),ib=a(153);let ta=class extends fa.a{constructor(Ua){super();
this.P1a=this.Qta=null;this.RGc=this.uua=!1;this.xf=()=>{const Rb=this.$.ea.Tm;if(null===Rb||void 0===Rb?0:Rb.SheetChanges)for(const sc of Rb.SheetChanges)if(2===sc.Type){if(this.Qta)for(const Mc of this.Qta)Mc.Range.SheetName===sc.Name&&(Mc.Range.SheetName=sc.NewName);if(this.P1a)for(const Mc of this.P1a)Mc.Range.SheetName===sc.Name&&(Mc.Range.SheetName=sc.NewName)}};this.rGf=()=>{d.ULS.sendTraceTag(537154395,0,50,"NamedSheetViewConversionManager.OnGridLoaded");this.RGc=!1;this.aqc(this,Sys.EventArgs.Empty)};
this.yc=()=>{d.ULS.sendTraceTag(537154394,0,50,"NamedSheetViewConversionManager.OnWorkbookClosing");this.RGc=!0};this.aqc=()=>{d.ULS.sendTraceTag(50620166,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: triggered with version [${this.$.ea.cza}]`);if(!this.$.isEditMode||!this.$.ea.Yb||this.$.ea.l6a||this.RGc||this.$.ea.cza===oa.a.p8b)d.ULS.sendTraceTag(537154393,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: Request skipped [Edit Mode: ${this.$.isEditMode}] [IsSessionActive: ${this.$.ea.Yb}] [HasRaisedSessionEnded: ${this.$.ea.l6a}] [WorkbookClosed: ${this.RGc}]`);
else{this.P1a=this.Qta=null;var Rb=this.$.pa.va.$b();va(this.$.pa.va,this.sYi,this.rYi,null,Rb)}};this.sYi=Rb=>{if(bb.a.wq(Rb.Errors)){this.uua=!0;const sc=[-1100324317,-1857233882];bb.a.lh(Rb.Errors,sc)&&d.ULS.sendTraceTag(537154392,0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionSuccess Errors: [${bb.a.qc(Rb.Errors)}]`);Rb=bb.a.Oz(Rb.Errors,sc,"NamedSheetViewConversionManager:OnGetNamedSheetViewConversionSuccess");this.$.ea.$n(Rb)}else this.uua=!1,Rb=Rb.Result,this.$.ea.cza=Rb.ConversionVersion,
this.Xcj(Rb.NamedSheetViewConversionEntries),this.nfj()};this.rYi=Rb=>{this.uua=!0;Rb=xa.a.Ue(Rb.data);let sc=!1;Za.EwaSettings.isChangeGateEnabled("OfficeVSO:6401332_RefreshTokenException")&&Rb.forEach(Mc=>{-1537615947===Mc.MessageId&&(sc=!0)});sc?d.ULS.sendTraceTag(512274778,0,50,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${bb.a.qc(Rb)}].`):d.ULS.sendTraceTag(537154391,0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${bb.a.qc(Rb)}].`)};
this.$=Ua;d.ULS.shipAssertTag(537154397,0,!!this.$.ea,"NamedSheetViewConversionManager ctor: EwaControl.SessionStateManager should not be null");this.$.ij(this.yc);this.$.ea.wP(this.rGf);this.$.ea.TQg(this.aqc);this.$.ea.ju(this.xf);this.$.ea.Cv&&this.aqc(this,Sys.EventArgs.Empty)}Use(Ua){this.addHandler("SVCU",Ua)}nZf(Ua){this.removeHandler("SVCU",Ua)}dispose(){this.P1a=this.Qta=null;this.$&&this.$.$k(this.yc);this.$.ea&&(this.$.ea.ZN(this.rGf),this.$.ea.opj(this.aqc),this.$.ea.Lv(this.xf));this.$=
null;super.dispose()}cdh(Ua){return this.uua?null:this.hIe(Ua,this.P1a,"ConvertPresencePublicToPrivate")}bdh(Ua){return this.uua?null:this.hIe(Ua,this.Qta,"ConvertPresencePrivateToPublic")}Xcj(Ua){Ua?(this.fnh(Ua),this.Qta=Ua,this.P1a=this.xhh(this.Qta)):d.ULS.sendTraceTag(537154396,0,10,"NamedSheetViewConversionManager.ProcessConversionEntries: conversionEntries can be empty but not null")}nfj(){d.ULS.sendTraceTag(537154390,0,50,"NamedSheetViewConversionManager.RaiseConversionUpdatedEvent: new version is update on client from server");
this.raiseEvent("SVCU")}hIe(Ua,Rb,sc){if(!Rb||!Rb.length)return d.ULS.sendTraceTag(537154389,0,50,`NamedSheetViewConversionManager.${sc}: skipping convert due to ${Rb?"empty":"null"} ConversionEntries. `),Ua;for(const Mc of Ua){for(const id of Rb)!id.IsRow||!pa(id.Range,Mc)||Mc.FirstRow<=id.Range.FirstRow&&Mc.LastRow>=id.Range.LastRow||(sc={},sc.SheetName=Mc.SheetName,sc.FirstRow=sc.LastRow=Mc.FirstRow,sc.FirstColumn=sc.LastColumn=Mc.FirstColumn,pa(id.Range,sc)?(sc=Mc.FirstRow-id.Range.FirstRow,0>
sc||sc>=id.ConversionMap.length?d.ULS.sendTraceTag(537154388,0,10,`NamedSheetViewConversionManager.ConvertRanges: invalid mapIndex after adjust. Index: [${sc}], ConversionMap.Length: ${id.ConversionMap.length}`):(sc=id.ConversionMap[sc]-sc,Mc.FirstRow+=sc,Mc.LastRow=Mc.FirstRow,Mc.LastColumn=Math.min(Mc.LastColumn,id.Range.LastColumn))):Mc.FirstRow<id.Range.FirstRow&&Mc.LastRow>=id.Range.FirstRow?Mc.LastRow=id.Range.FirstRow-1:Mc.LastColumn>=id.Range.FirstColumn&&(Mc.LastColumn=id.Range.FirstColumn-
1));if(0>Mc.FirstRow||Mc.FirstRow>oa.a.iB)Mc.FirstRow=Math.max(Math.min(Mc.FirstRow,oa.a.iB),0);if(0>Mc.LastRow||Mc.LastRow>oa.a.iB)Mc.LastRow=Math.max(Math.min(Mc.LastRow,oa.a.iB),0);if(0>Mc.FirstColumn||Mc.FirstColumn>oa.a.ky)Mc.FirstColumn=Math.max(Math.min(Mc.FirstColumn,oa.a.ky),0);if(0>Mc.LastColumn||Mc.LastColumn>oa.a.ky)Mc.LastColumn=Math.max(Math.min(Mc.LastColumn,oa.a.ky),0)}return Ua}xhh(Ua){if(!Ua||!Ua.length)return d.ULS.sendTraceTag(537154387,0,50,`NamedSheetViewConversionManager.CreateInverseConversionEntries: skip creating inverse due to ${this.Qta?
"empty":"null"} ConversionEntries. `),Ua;const Rb=Array(Ua.length);for(let sc=0;sc<Ua.length;++sc){const Mc=new wa;Mc.Range=Ua[sc].Range;Mc.IsRow=Ua[sc].IsRow;Mc.ConversionMap=Array(Ua[sc].ConversionMap.length);Mc.IsRow||(this.uua=!0,d.ULS.sendTraceTag(537154386,0,10,"NamedSheetViewConversionManager.CreateInverseConversionEntries: adjusting presence against column sort map is NYI."));for(let id=0;id<Ua[sc].ConversionMap.length;++id)Mc.ConversionMap[Ua[sc].ConversionMap[id]]=id;Rb[Ua.length-sc-1]=
Mc}return Rb}fnh(Ua){if(Ua&&Ua.length)for(const Rb of Ua)this.enh(Rb),Ua=Rb.IsRow?Rb.Range.LastRow-Rb.Range.FirstRow+1:Rb.Range.LastColumn-Rb.Range.FirstColumn+1,Rb.ConversionMap.length!==Ua&&(d.ULS.shipAssertTag(537154385,0,!1,`NamedSheetViewConversionManager.DecompressEntries: decompressed conversion map doesn't match expected size - Expected: [${Ua}] | Actual: [${Rb.ConversionMap.length}]`),this.uua=!0)}enh(Ua){const Rb=Ua.ConversionMap;if(Rb&&Rb.length)if(0>Rb[0])d.ULS.shipAssertTag(537154384,
0,!1,"NamedSheetViewConversionManager.DecompressConversionMap: conversionMap starts with a negative number"),this.uua=!0;else{var sc=[];for(let Mc=0;Mc<Rb.length;++Mc)if(0>Rb[Mc]){const id=Rb[Mc-1],Ed=-1*Rb[Mc];for(let ee=1;ee<=Ed;++ee)sc.push(id+ee)}else sc.push(Rb[Mc]);Ua.ConversionMap=sc}}};ta=Object(L.b)([Object(ib.d)(cb.y),Object(L.c)(0,Object(cb.o)())],ta);Object(b.a)(ta,"NamedSheetViewConversionManager",fa.a,[612,3]);var Ya=a(828);class Da extends Sys.EventArgs{constructor(Ua){super();this.oh=
Ua}}Object(b.a)(Da,"ConnectionCompletedEventArgs",Sys.EventArgs,[]);var ba=a(50),ya=a(38),V=a(52),Z=a(53),ja=a(1196);class la extends fa.a{constructor(Ua){super();this.pA=this.T2f=this.R5b=null;this.wce=!1;this.WV=(Rb,sc)=>{if(2===sc.newState){if(this.oh){if(Za.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Mc=(new Date).getTime();ya.TaskExtensions.za(ba.GetServiceTaskFactory.Pa(this.$.da,435,436,1),id=>{id.result.tIi(Mc)},this.$.ka,3)}this.raiseEvent("connectionCompleted",
new Da(this.oh),sc)}else d.ULS.sendTraceTag(537167630,0,15,"RealTimeChannelController.OnConnectionStateChanged: new state is connected and this.RealTimeChannel is null");this.R5b=sc}else if(2===sc.oldState||0===sc.newState)this.R5b=null,this.raiseEvent("connectionLostEventKey")};this.YPa=()=>{if(this.oh){const Rb=Object(l.a)(247,this.oh);Rb&&(d.ULS.sendTraceTag(537167629,0,50,"RealTimeChannelController.OnWorkbookClosed: disconnecting from RTC"),Rb.disconnect(),Rb.a7(this.WV))}this.pA=null};this.$=
Ua;this.$.ij(this.YPa);this.$.ea.eZc(this.YPa);Ua.da.hb(38,Rb=>{Rb.gte(this.YPa)})}ipb(Ua){this.addHandler("connectionCompleted",Ua)}Fvc(Ua){this.removeHandler("connectionCompleted",Ua)}ZYc(Ua){this.addHandler("rtcInitialized",Ua)}ZKb(Ua){this.removeHandler("rtcInitialized",Ua)}fse(Ua){this.addHandler("connectionLostEventKey",Ua)}HYf(Ua){this.removeHandler("connectionLostEventKey",Ua)}get oh(){return this.pA}get Zqd(){return this.wce}dispose(){this.oh&&this.oh.a7(this.WV);this.$&&this.$.$k(this.YPa);
this.pA=this.$=null;super.dispose()}JKe(Ua){ya.TaskExtensions.za(this.U8e().task,Rb=>{Ua(Rb.result)},this.ka)}pHe(Ua,Rb){this.wce=Rb;this.P_i(Ua)}Z0a(){this.oh&&(this.raiseEvent("rtcInitialized"),2===this.oh.connectionState&&this.R5b&&this.raiseEvent("connectionCompleted",new Da(this.oh),this.R5b))}jFi(){d.ULS.sendTraceTag(537167633,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice");const Ua=(new Date).getTime();ya.TaskExtensions.za(ba.GetServiceTaskFactory.Pa(this.$.da,435,436,1),Mc=>{Mc.result.wIi(Ua)},
this.$.ka,3);var Rb=[];Rb.push(V.a.current.Un(66));Rb.push(V.a.current.Un(67));Rb=V.a.zxd(Rb,this.$.ka);const sc=V.a.loadScript(9,0,1);return m.Task.uG(Rb,sc)}P_i(Ua){const Rb=this.jFi();ya.TaskExtensions.za(Rb,()=>{d.ULS.sendTraceTag(537167632,0,50,`RealTimeChannelController.OnLoadRealTimeChannelSlice Before RealtimeChannel create. RealtimeChannel = null: ${void 0===Ya.RealtimeChannel||null===Ya.RealtimeChannel}`);if(Za.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Mc=
(new Date).getTime();ya.TaskExtensions.za(ba.GetServiceTaskFactory.Pa(this.$.da,435,436,1),id=>{id.result.xIi(Mc)},this.$.ka,3)}this.pA=Ya.RealtimeChannel.createInstance(Ua,this.$.ya.UserSessionId,k.AFrameworkApplication.U2f,k.AFrameworkApplication.Hd,null,2,Z.b().faf(),this.$.workbookContext.RtcEndpointUrl,void 0,new ja.a,void 0,void 0,this.$.workbookContext.RtcBootToken);d.ULS.sendTraceTag(571770432,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice RealtimeChannel created");Za.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",
!1)&&(da.a.instance.register(Ya.RealtimeChannel,"AppRealtimeChannel.RealtimeChannel").as("Common.IRealtimeChannelBasic").as("AppRealtimeChannel.IRealtimeChannel").tc().Bc(()=>this.oh),da.a.instance.resolve("Common.IRealtimeChannelBasic"));this.U8e().setResult(this.oh);if(Za.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Mc=(new Date).getTime();ya.TaskExtensions.za(ba.GetServiceTaskFactory.Pa(this.$.da,435,436,1),id=>{id.result.vIi(this.Zqd,Mc)},this.$.ka,
3)}this.raiseEvent("rtcInitialized");d.ULS.sendTraceTag(571770403,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice raise RealTimeChannelInitializedEventKey");const sc=Object(l.a)(247,this.oh);sc&&(d.ULS.sendTraceTag(571770402,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice attach changed handler"),sc.z2(this.WV),sc.connect())},this.ka,3)}U8e(){return this.T2f||(this.T2f=new h.a)}static la(Ua){Ua.da.Ha(26,new la(Ua))}}Object(b.a)(la,"RealTimeChannelController",fa.a,[7,8]);var ua=
a(9),eb=a(7),Eb=a(101),Wb=a(112),Ab=a(25);class Jb{constructor(Ua,Rb,sc,Mc,id,Ed,ee,oe,Xe=!1){this.Wpa=null;this.aMc=!0;this.ySc=this.aw=this.OIc=null;this.Za=new Eb.a;this.RDg=Ua;this.tYa=Rb;this.Oie=sc;this.Mie=Mc;this.H6d=Ed;Jb.pe=id;this.lFg=ee;this.Bra=oe;this.IFg=Xe;m.Task.WAA(Rb,sc).continueWith(Object(e.a)(this,this.Wji,"initOnTaskReady"))}WTf(){this.Za.raiseEvent("u",null,this)}Wji(){this.tYa.result&&this.Oie.result&&(this.aw=this.tYa.result,this.ySc=this.Oie.result,this.aw.SZa(Object(e.a)(this,
this.Tma,"onPresenceUpdated")),this.OIc=new Wb.a(2,2,this.H6d,Object(e.a)(this,this.S3j,"updateAwayClientsTask"),88),Jb.pe.ig(this.OIc))}Tma(Ua,Rb){(this.aMc||this.lij(Rb.vL))&&Jb.pe.Mna(this.OIc,0)}lij(Ua){for(let sc in Ua){var Rb=this.Mie.e8e({key:sc,value:Ua[sc]});if(Rb&&Rb.clientId&&(Rb=Rb.clientId.toLowerCase(),(Rb=this.Wpa[Rb]||this.Wpa[Rb.toUpperCase()])&&2===Rb.status))return!0}return!1}S3j(Ua){var Rb=this.aw.vSh();if(Rb){var sc=new Date,Mc=!1;if(this.aMc){this.Wpa=Rb;this.aMc=!1;var id=this.Wpa;
for(var Ed in id){Rb=Ed;var ee=id[Ed];ee.z9a<sc&&(sc=ee.z9a);2===ee.status&&(Mc=!0,this.ySc.nYf(Rb))}Mc&&this.WTf();Jb.pe.Mna(Ua,this.e7e(sc))}else{ee=new z.a;Ed=!1;var oe=this.Wpa;for(id in oe){oe=id;if(!(oe in this.Wpa)||this.RDg.clientId===oe)continue;var Xe=this.Wpa[oe];const mf=Rb[oe];if(Xe&&mf){Xe=Xe.status;const wf=mf.status;2===Xe&&1===wf?(ee.add(oe),d.ULS.sendTraceTag(38052609,392,50,oe+" returned from away")):1===Xe&&2===wf&&(Ed=Mc=!0,this.ySc.nYf(oe),d.ULS.sendTraceTag(38052610,392,50,
oe+" went away"));1===wf&&mf.z9a<sc&&(sc=mf.z9a)}}this.Wpa=Rb;Jb.pe.Mna(Ua,this.e7e(sc));(0<ee.count||Mc)&&this.WTf();0<ee.count&&!this.IFg?(Ua=this.gVh(ee),this.rYj(Ua)):Ua=new z.a;(Ed||0<Ua.count)&&this.lFg(Ab.a.C4c,2)}}}rYj(Ua){if(Ua.count)for(let Rb of Ua)Ua=this.Bra.eaa(String.format(CommonUIStrings.l_EditorsToastArriving,Rb),!1),Ua.image=5,Ua.I4="CoAuth_AuthorStatus_16x16x32",this.Bra.rE(Ua)}gVh(Ua){const Rb=this.aw.ogd(),sc=new z.a;for(let Mc in Rb){const id={key:Mc,value:Rb[Mc]};if(Ua.contains(id.key)){const Ed=
this.Mie.e8e(id);Ed&&(sc.add(Ed.userName),Ua.remove(id.key))}}sc.count||d.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return sc}e7e(Ua){const Rb=new Date;return Math.max(Ua.getTime()+this.H6d-Rb.getTime(),0)}}Jb.pe=null;Object(b.a)(Jb,"AwayManager",null,[]);var Gb=a(439),Nb=a(107),Ja=a(300),ab=a(228);class wb extends ab.a{constructor(Ua){super();this.manager=null;this.$=Ua;this.Gb()}create(){this.qb(this.manager||(this.manager=new ta(this.$)))}}Object(b.a)(wb,"NamedSheetViewConversionManagerFactory",
ab.a,[]);var xb=a(91),rb=a(540);class za{constructor(Ua){this.Ra=new Eb.a;this.vhb=this.disposed=!1;this.YHb=()=>{d.ULS.sendTraceTag(537154381,0,50,"PeopleInfoProvider.OnUserListUpdated fired");this.Ra.raiseEvent("UU",this)};this.$=Ua;this.$.ea.T9(this.YHb);this.vhb=Za.EwaSettings.isChangeGateEnabled("OfficeVSO:7554748_UseIsAnonymousForPresenceUserV2")}dispose(){this.disposed||(this.$&&this.$.ea&&this.$.ea.c7(this.YHb),xb.a.sc([this.Ra]),this.$=this.Ra=null,this.disposed=!0)}VZa(Ua){this.Ra.addHandler("UU",
Ua)}cOd(Ua){this.Ra.removeHandler("UU",Ua)}Dva(){const Ua=[];for(const Rb of this.$.ea.Do)Ua.push(this.m4h(Rb));d.ULS.sendTraceTag(537154383,0,50,`PeopleInfoProvider.GetAllUsers: Count: [${Ua.length}]`);return Ua}m4h(Ua){var Rb;this.vhb&&!this.presenceView&&(this.presenceView=this.$.da.Ba(25));return new Gb.a(Ua.User.UserID,Ua.User.UserName,Ua.UserColor,new rb.a(1),null,Ua.UserEmail,void 0,void 0,this.vhb?null===(Rb=this.presenceView)||void 0===Rb?void 0:Rb.isAnonymousUser(Ua.User.UserID):void 0,
void 0,void 0,Ua.JoinCoauthTime)}}Object(b.a)(za,"PeopleInfoProvider",null,[632,3]);var Aa=a(650);class pb{rE(){d.ULS.sendTraceTag(537154380,0,50,"PresenceBootstrapper.AddNotificationBarEntry: User state changed from inactive to active")}removeEntry(){}get isVisible(){return!1}eaa(Ua,Rb){return new Aa.a(Ua,Rb)}dispose(){}static get instance(){pb.Ma||(pb.Ma=new pb);return pb.Ma}}pb.Ma=null;Object(b.a)(pb,"NoOpNotificationBar",null,[633,3]);class kb{e8e(Ua){const Rb=Ua.key;Ua=Ua.value;if(!Ua)return null;
const sc=Ua.SupportsChat?4:0;return Object(eb.a)(new Gb.a,{clientId:Rb,p3c:Ua.ChatThreadId,o3c:Ua.ChatThreadDiscoveryUri,qAb:Ua.InChat,email:Ua.Cid,capabilities:new rb.a(sc),isAnonymous:Ua.IsAnonymous})}}Object(b.a)(kb,"PresenceConverter",null,[656]);class Cb extends ab.a{constructor(){super();this.pIe=null;this.Gb()}create(){this.qb(this.pIe||(this.pIe=new kb))}static la(Ua){Ua.da.Ha(159,new Cb)}}Object(b.a)(Cb,"PresenceConverterFactory",ab.a,[]);var ob=a(132),qa=a(133);class ma{constructor(Ua){this.JQf=
this.PId=this.LQf=this.HQf=this.POf=this.uQd=this.K2f=this.S2f=this.R2f=!1;this.QId=this.BHd=this.cMb=this.fMb=this.zxc=this.yQd=0;this.cof=!1;this.NBd=this.Arb=0;this.Xkc=!1;this.Wc=()=>{this.Xkc=!0;this.$.ea.pk(this.Wc)};this.$=Ua;W.a.KP&&(this.NBd=window.performance.timing.navigationStart);this.NBd||d.ULS.sendTraceTag(537154379,0,15,"Navigation start time is zero");this.$.ea.Oj(this.Wc)}wIi(Ua){this.R2f||(this.yQd=Ua,this.R2f=!0)}xIi(Ua){this.S2f||(this.zxc=Ua,this.S2f=!0)}vIi(Ua,Rb){this.K2f||
(this.fMb=Rb,this.cof=Ua,this.K2f=!0)}tIi(Ua){this.uQd||(this.cMb=Ua,this.uQd=!0)}YHi(Ua){!this.PId&&this.uQd&&(this.QId=Ua,this.PId=!0)}THi(Ua){this.POf||(this.BHd=Ua,this.POf=!0)}XHi(Ua){if(!this.HQf&&this.rha&&!this.Xkc){this.HQf=!0;const Rb=this.Tgd();Rb.RtcIntializeToPeopleWellServiceCreate=this.BHd-this.fMb;Rb.PeopleWellServiceCreateToPresenceGalleryRender=Ua-this.BHd;Rb.PresenceGalleryRenderTotalTime=Ua-this.rha;qa.b(this.$).qd(ob.a.IQf,Rb,void 0,!0)}}$Hi(Ua){if(!this.LQf&&this.rha&&!this.Xkc){this.LQf=
!0;const Rb=this.Tgd();Rb.RtcIntializeToRtcConnect=this.cMb-this.fMb;Rb.RtcConnectToPresenceSent=Ua-this.cMb;Rb.PresenceSentTotalTime=Ua-this.rha;qa.b(this.$).qd(ob.a.MQf,Rb,void 0,!0)}}ZHi(Ua){if(!this.JQf&&this.PId&&this.rha&&!this.Xkc){this.JQf=!0;const Rb=this.Tgd();Rb.RtcIntializeToRtcConnect=this.cMb-this.fMb;Rb.RtcConnectToPresenceRenderInitiate=this.QId-this.cMb;Rb.PresenceRenderInitiateToPresenceRenderFinish=Ua-this.QId;Rb.PresenceRenderTotalTime=Ua-this.rha;qa.b(this.$).qd(ob.a.KQf,Rb,void 0,
!0)}}dispose(){this.$=null}Tgd(){const Ua={};Ua.CoAuthorCountsOnBoot=this.$.ea.Do.length;Ua.RtcConnectedLaterInSession=this.cof;Ua.BrowserVisibilityChanged=this.I_g();Ua.AppInteractiveAbsTime=this.rha;Ua.NavigationStartTime=this.NBd;Ua.AppInteractiveToRtcSliceDownloadInitialize=this.yQd-this.rha;Ua.RtcSliceDownloadInitializeToRtcSliceLoad=this.zxc-this.yQd;Ua.AppInteractiveToRtcSliceLoad=this.zxc-this.rha;Ua.RtcSliceLoadToRtcInitialize=this.fMb-this.zxc;return Ua}get rha(){if(this.Arb)return this.Arb;
U.a.instance.j3("AppInitStatus_interactivityReady")&&(this.Arb=U.a.instance.VA("AppInitStatus_interactivityReady"));this.Arb||d.ULS.sendTraceTag(537154378,0,15,"App interactive time is zero");return this.Arb}I_g(){return W.a.KP&&U.a.instance.j3(J.a.tRb)?0<U.a.instance.VA(J.a.tRb)[J.a.Rpg]:!1}}Object(b.a)(ma,"PresenceTelemetry",null,[655,3]);class Ga extends ab.a{constructor(Ua){super();this.$=Ua;this.Gb()}create(){this.qb(this.$.da.Ba(435)||this.$.da.Ha(435,new ma(this.$)))}static la(Ua){Ua.da.Ha(436,
new Ga(Ua))}}Object(b.a)(Ga,"PresenceTelemetryFactory",ab.a,[]);var vb=a(1358),Ka=a(49),Pa=a(45),fb=a(28),Wa=a(125),Ma=a(14),lb=a(21),Na=a(84);class X extends fa.a{constructor(Ua){super();this.Xne=Ua;this.DSc=this.Lra=null}get xRb(){return this.Xne}get lc(){return this.Lra||{}}set lc(Ua){this.DSc=this.Lra;this.Lra=Ua;this.raiseEvent("userPresenceChanged")}get nJd(){return this.DSc}dispose(){this.raiseEvent("userPresenceChanged");this.raiseEvent("userLeft");this.DSc=this.Lra=this.Xne=null;super.dispose()}}
Object(b.a)(X,"UserPresence",fa.a,[]);class F extends Na.a{constructor(){super();this.Pie=this.Nie=this.aA=null}get qy(){return this.Nie}hUd(Ua){this.Nie=Ua}get Am(){return this.Pie}E9f(Ua){this.Pie=Ua}get lc(){return this.aA.lc}set lc(Ua){this.aA.lc=Ua}a1a(){}A5a(){return null}Xhd(){return null}Acg(){}Bcg(){}Ymg(){}VAc(){}lgc(){}static A6j(Ua,Rb){const sc=Ua.aA.lc;xb.a.sc(Ua.qy);xb.a.sc([Ua.aA]);Ua.aA=null;Ua.aA=new X(Rb);Ua.hUd([]);Ua.E9f(Rb);Ua.lc=sc}}Object(b.a)(F,"IUserGridPresence",Na.a,[]);
var na;(function(Ua){Ua[Ua.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Ua[Ua.peopleImageClassName=1]="peopleImageClassName";Ua[Ua.peopleImageClusterPath=4]="peopleImageClusterPath";Ua[Ua.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Ua[Ua.imageDimension=6]="imageDimension";Ua[Ua.rtl=8]="rtl";Ua[Ua.pointerInputManager=9]="pointerInputManager";Ua[Ua.clickInputManager=10]="clickInputManager";Ua[Ua.vertical=11]="vertical";Ua[Ua.zIndex=12]="zIndex";Ua[Ua.contextMenuInputManager=
13]="contextMenuInputManager";Ua[Ua.imageDomElement=14]="imageDomElement";Ua[Ua.useIdleTooltip=15]="useIdleTooltip";Ua[Ua.viewportBoundsCallback=16]="viewportBoundsCallback";Ua[Ua.flipHorizontalDirection=17]="flipHorizontalDirection";Ua[Ua.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";Ua[Ua.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";Ua[Ua.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(na||(na={}));Object(b.b)("PresenceTooltipSettingKeys",na);class hb{constructor(){this.iP=
{}}get(Ua,Rb=null){Ua=na[Ua];return"number"===typeof Rb?(Rb=this.iP[Ua])?Number.parseInvariant(Rb.toString()):0:this.iP[Ua]}add(Ua,Rb){this.iP[na[Ua]]=Rb}FZa(Ua,Rb){na[Ua]in this.iP||(this.iP[na[Ua]]=Rb)}remove(Ua){delete this.iP[na[Ua]]}}Object(b.a)(hb,"PresenceTooltipSettings",null,[]);class Ib extends Eb.a{constructor(Ua){super();this._element=null;this.element=Ua}get element(){return this._element}set element(Ua){this._element=Ua}get visible(){return"visible"===this.element.style.visibility}set visible(Ua){this.element.style.visibility=
Ua?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Ua){this.element.dir=Ua?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Ua){this.element.style.zIndex=String(Ua)}dispose(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Ua){return this.element.ownerDocument.createElement(Ua)}gCc(){return!0}static $jh(Ua){return"prControl"+(Ua?"Rtl":"")}}Object(b.a)(Ib,"BasePresenceControl",
Eb.a,[3,169]);class vc extends Sys.EventArgs{constructor(Ua,Rb){super();this.type=Ua;this.Dvb=Rb}}vc.bla="InteractivityChanged";Object(b.a)(vc,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class nc{static KWh(Ua){return nc.LWh(Ua)}static LWh(Ua){const Rb=document.createElementNS(nc.o4d,"svg");Rb.setAttribute("viewBox",String.format(nc.lmh,nc.Apg,nc.zpg));Rb.appendChild(nc.z8h(Ua));return Rb}static z8h(Ua){const Rb=nc.Apg/Ua,sc=2*Rb,Mc=nc.zpg/2;Ua=(Ua-12-8)*Rb/2;const id=document.createElementNS(nc.o4d,
"g");Sys.UI.DomElement.addCssClass(id,nc.kmh);for(let Ed=1;3>=Ed;Ed++)id.appendChild(nc.WUh(Ed,sc,Ua+(6*Ed-2)*Rb,Mc));return id}static WUh(Ua,Rb,sc,Mc){const id=document.createElementNS(nc.o4d,"circle");Sys.UI.DomElement.addCssClass(id,String.format("{0}-{1}",nc.N7g,Ua));id.setAttribute("cx",String.format("{0}",sc));id.setAttribute("cy",String.format("{0}",Mc));id.setAttribute("r",String.format("{0}",Rb));return id}}nc.o4d="http://www.w3.org/2000/svg";nc.kmh="prDancingDots";nc.N7g="prAnimateCircle";
nc.lmh="0 0 {0} {1}";nc.zpg=40;nc.Apg=120;Object(b.a)(nc,"ModernPresenceTooltipDancingDots",null,[]);var Pb=a(126),oc=a(163),Ic=a(13),ec=a(92),mb=a(130),Ob=a(57),Ta=a(31);class sb extends Ib{constructor(Ua,Rb){super(Ua);this.Rne=this.Oqa=this.LJc=this.FNc=this.uKc=this.oA=this.Fi=null;this.jJ=Rb.get(8,!1);this.xjb=Rb.get(6,0);this.iJg=Rb.get(15,!1);this.ue=Rb;this.M$d=0;this.element=Ua;this.element.className=sb.KMh;this.OG=document.createElement("span");this.element.appendChild(this.OG);this.czg=
nc.KWh(Rb.get(6,0));this.Nt(Rb);this._state=5}JYc(Ua){this.addHandler(vc.bla,Ua)}Pvc(Ua){this.removeHandler(vc.bla,Ua)}get user(){return this.Rne}get state(){return this._state}dispose(){this.element&&(this.Fi.Aa(Ic.a.click,this.element,Object(e.a)(this,this.jd,"onClick")),this.Fi.Aa(Ic.a.yk,this.element,Object(e.a)(this,this.gCc,"stopPropagationAndPreventDefaultBehavior")),this.oA.Aa(Ic.a.pointerDown,this.element,Object(e.a)(this,this.onPointerDown,"onPointerDown")),this.oA.Aa(Ic.a.pointerOut,this.element,
Object(e.a)(this,this.GN,"onPointerOut")),this.oA.Aa(Ic.a.pointerOver,this.element,Object(e.a)(this,this.Nw,"onPointerOver")),this.uKc.Aa(this.element,Object(e.a)(this,this.gCc,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}Nt(Ua){this.Fi=Ua.get(10);this.Fi.ta(Ic.a.click,this.element,Object(e.a)(this,this.jd,"onClick"));this.Fi.ta(Ic.a.yk,this.element,Object(e.a)(this,this.gCc,"stopPropagationAndPreventDefaultBehavior"));this.oA=Ua.get(9);this.oA.ta(Ic.a.pointerOver,this.element,Object(e.a)(this,
this.Nw,"onPointerOver"));this.oA.ta(Ic.a.pointerOut,this.element,Object(e.a)(this,this.GN,"onPointerOut"));this.oA.ta(Ic.a.pointerDown,this.element,Object(e.a)(this,this.onPointerDown,"onPointerDown"));this.uKc=Ua.get(13);this.uKc.ta(this.element,Object(e.a)(this,this.gCc,"stopPropagationAndPreventDefaultBehavior"))}hide(Ua=null,Rb=0,sc=0){this.iJg&&Ua?this.iOj(Ua,Rb,sc):(3===this.state&&this.KXf(),this.visible=!1,this._state=5)}iOj(Ua,Rb,sc=0){this.show(Ua,Rb,15,4,void 0,sc)}dbg(Ua,Rb,sc=!1,Mc=
!1,id=!1,Ed=0){this.show(Ua,Rb,20,sc?2:Mc?1:0,id,Ed)}FNj(Ua,Rb,sc,Mc=!1,id=0){this.show(Ua,Rb,sc+20,3,Mc,id)}show(Ua,Rb,sc,Mc=3,id=!1,Ed=0){!Ua||Mc===this.state&&this.Kfi(Rb,sc)||(this.BLg(Mc,id,Ed),this.HZa(Ua,Mc,Ed),this._state=Mc,4===Ed||0===Ed&&!this.jJ?this.element.style.left=Rb+"px":this.element.style.right=Rb+"px",this.element.style.top=sc+"px",this.visible=!0)}HZa(Ua,Rb,sc){this.Rne=Ua;Ob.a.lsb(this.OG);mb.a.H8g(this.OG);this.OG.id="fly_"+Ua.clientId;this.OG.style.backgroundColor=Ua.color;
4!==Rb?(this.OG.style.height=this.xjb+"px",this.OG.style.lineHeight=this.xjb+"px",mb.a.PSa(this.OG,"border-radius",this.xjb+"px")):4===sc||0===sc&&!this.jJ?this.OG.style.left="0px":this.OG.style.right="0px";2!==Rb&&(4===Rb?Ob.a.lzc(this.OG,""):1===Rb?this.OG.appendChild(this.czg):(this.OG.setAttribute("dir","auto"),sc=Ta.a.V_h(Ua.userName),(!Ua.isAnonymous||k.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&sc||0!==Rb?(Ua=Ua.userName,
0===Rb&&(Ua=sc,mb.a.PSa(this.OG,"text-align","center")),Ob.a.lzc(this.OG,Ua)):(this.FNc||(this.FNc=this.Meh()),this.OG.appendChild(this.FNc),mb.a.PSa(this.OG,"text-align","start"))))}jd(Ua){if(0===this.state)return this.raiseEvent(vc.bla,new vc(1,Ua)),!0;3===this.state&&d.ULS.sendTraceTag(50436114,302,50,"User clicked on presence pill.");return!1}GN(Ua){3===this.state&&this.raiseEvent(vc.bla,new vc(3,Ua));return!1}Nw(Ua){3!==Ua.wb&&this.raiseEvent(vc.bla,new vc(2,Ua));return!1}onPointerDown(Ua){if(3!==
Ua.wb)return!0;this.raiseEvent(vc.bla,new vc(4,Ua));return!1}Meh(){const Ua=document.createElement("img");Ua.src=Pb.a.Ita("doughperson_white_glyph.svg");Ua.setAttribute("Unselectable","on");ec.a.xh(Ua,ec.a.Jd,ec.a.yq);return oc.createClusteredImageFromClusterWithImageClass(this.xjb,this.xjb,null,null,sb.NMh,"",!1,"",this.element.ownerDocument,Ua)}BLg(Ua,Rb=!1,sc=0){if(!this.iBb(this.state)||!this.iBb(Ua))switch(Sys.UI.DomElement.removeCssClass(this.element,this.LJc),this.state){case 4:3===Ua?this.cha(sb.zed,
sb.S_e):this.iBb(Ua)&&this.cha(sb.xed,sb.S_e);break;case 3:4===Ua?this.cha(sb.Ced,sb.R_e):this.iBb(Ua)&&(Rb&&this.KXf(),this.cha(sb.xed,sb.R_e,Rb?sb.MMh:""));break;case 0:case 1:case 2:4===Ua?this.cha(sb.Ced,sb.Aed):3===Ua&&(Rb&&this.aMg(),this.cha(sb.zed,sb.Aed,Rb?sb.V_e:"",3===sc?sb.QMh:sb.OMh));break;default:4===Ua?this.cha(sb.Ced):3===Ua?this.cha(sb.zed):this.iBb(Ua)&&this.cha(sb.xed)}}cha(...Ua){this.LJc=Ua.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.LJc)}aMg(){this.M$d=window.setTimeout(()=>
{this.element&&(this.Oqa=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.Oqa),this.element.style.zIndex="2",this.Oqa.style.zIndex="1")},300)}KXf(){window.clearTimeout(this.M$d);this.Oqa&&(Sys.UI.DomElement.removeCssClass(this.Oqa,sb.Aed+" "+sb.V_e),Sys.UI.DomElement.addCssClass(this.Oqa,sb.LMh),m.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.Oqa.parentNode&&this.element.parentNode.removeChild(this.Oqa)}),mb.a.GKb(this.element,"z-index"))}iBb(Ua){return 0===
Ua||1===Ua||2===Ua}Kfi(Ua,Rb){const sc=mb.a.AD(this.element.style.top);return mb.a.AD(this.element.style.left)===Ua&&sc===Rb}hPd(Ua){3===Ua&&mb.a.Z2(this.element,"left")?(Ua=mb.a.AD(this.element.style.left),mb.a.GKb(this.element,"left"),this.element.style.right=-1*Ua+"px"):4===Ua&&mb.a.Z2(this.element,"right")&&(Ua=mb.a.AD(this.element.style.right),mb.a.GKb(this.element,"right"),this.element.style.left=-1*Ua+"px")}}sb.KMh="prModernFlyout UIFont";sb.Ced="flyoutIdle";sb.zed="flyoutExpanded";sb.xed=
"flyoutCollapsed";sb.S_e="flyoutFromIdle";sb.R_e="flyoutFromExpanded";sb.Aed="flyoutFromCollapsed";sb.V_e="flyoutStacked";sb.MMh="flyoutFromStacked";sb.LMh="flyoutFadeOut";sb.NMh="cui-img-cont-float cui-img-20by20";sb.OMh="flyoutLtrDir";sb.QMh="flyoutRtlDir";Object(b.a)(sb,"ModernPresenceTooltipFlyoutControl",Ib,[]);class zb{constructor(Ua,Rb,sc=2,Mc=4){this.offsetTop=Ua;this.offsetLeft=Rb;this.xpg=sc;this.Oef=Mc}}Object(b.a)(zb,"FlyoutsPositioningInfo",null,[]);var db=a(41);class jb{constructor(Ua=
!1,Rb=!1){this.fj=Ua;this.gMc=Rb}Q0h(Ua,Rb,sc,Mc,id){const Ed=id.y,ee=id.height;var oe=this.KTh(Mc);const Xe=oe+Rb,mf=Ua*sc+2*(Ua-1);sc=null;1===Ua||this.A4g(oe,mf,Ed,ee)?Ua=new zb(0,0,2):(Ua=this.led(Xe,mf,Ed,ee),Ua.offsetTop-=oe);this.gMc?sc=new zb(0,0,void 0,this.fj?4:3):(Mc=this.JTh(Mc,id),oe=Math.max(0,id.x),id=id.width,Rb=Mc+Rb,this.B4g(Mc,oe,id)?sc=new zb(0,0,void 0,this.fj?3:4):this.C4g(Rb,oe)&&(sc=new zb(0,0,void 0,this.fj?4:3)),sc||(sc=this.$Lh(Mc,Rb,oe,id)));return new zb(Ua.offsetTop,
sc.offsetLeft,Ua.xpg,sc.Oef)}KTh(Ua){return db.a.ITh(Ua)}JTh(Ua,Rb){return this.fj?Rb.width-db.a.HTh(Ua):db.a.GTh(Ua)}A4g(Ua,Rb,sc,Mc){return Ua+Rb<=sc+Mc}led(Ua,Rb,sc,Mc){let id=1,Ed=Math.max(sc,Ua-Rb);Rb>Ua-sc&&(id=2,Ed=Rb<Mc?Mc-Rb:sc);return new zb(Ed,0,id)}B4g(Ua,Rb,sc){return Ua+150<=Rb+sc}C4g(Ua,Rb){return 150<=Ua-Rb}$Lh(Ua,Rb,sc,Mc){Mc-Rb>=Ua-sc?Ua=4:(Rb=Ua,Ua=3);return new zb(0,Rb,void 0,Ua)}}Object(b.a)(jb,"ModernPresenceTooltipPositioner",null,[]);class Ub{constructor(Ua,Rb,sc,Mc,id,Ed,
ee){this.IL=Ua;this._parent=Rb;this.c8d=sc;this.zxg=Mc;this.oBg=id;this.RYa=Ed;this.jJ=ee;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Ua,Rb){if(3!==Ua)if(5!==Ua&&this.IL&&this.IL.length){if(4===Ua){var sc=this.oBg;var Mc=(this.RYa-sc)/2;this.element.style.height=this.RYa+"px";this.element.style.width=this.RYa+"px";Ua=mb.a.AD(this.IL[0].element.style.top);Rb=mb.a.AD(this.jJ?this.IL[0].element.style.right:this.IL[0].element.style.left)}else sc=
this.c8d,Mc=(this.RYa-sc)/2,this.element.style.height=this.RYa+"px",this.element.style.width=this.iVh()+2*Mc+"px",Ua=mb.a.AD(this.IL[this.IL.length-1].element.style.top),Rb=this.Y3g(this.IL[this.IL.length-1].element,sc,Rb);mb.a.PSa(this.element,"border-radius",this.RYa+"px");this.element.style.top=Ua-Mc-sc+"px";this.jJ?this.element.style.right=Rb-Mc+"px":this.element.style.left=Rb-Mc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&
this.element.parentNode.removeChild(this.element)}Y3g(Ua,Rb,sc){return this.jJ&&!sc?mb.a.AD(Ua.style.right):this.jJ||sc?this.jJ&&sc?-mb.a.AD(Ua.style.left)-Rb:-mb.a.AD(Ua.style.right)-Rb:mb.a.AD(Ua.style.left)}iVh(){return this.IL&&this.IL.length?this.c8d+Math.min(this.IL.length-1,2)*this.zxg:0}}Object(b.a)(Ub,"ModernPresenceTooltipTarget",null,[]);var xd=a(140),ne=a(274);class fe extends Ib{constructor(Ua,Rb,sc){super(Ua);this.iYa=this.W8=this.zVb=this.CEa=!1;this.tA=[];this.sVb={};this.ue=sc;this.fj=
sc.get(8,!1);this.obe=sc.get(15,!1);this.Eyg=sc.get(12,0);this.jta=sc.get(6,0);this.gZb=Rb;this.moe=sc.get(16);this.gMc=sc.get(17,!1);sc.get(19,!1);this.fFg=sc.get(20,!1);this.mWb=0;this.bFg=new jb(this.fj,this.gMc);this.$hb=this.f4e();this.iSc=!1;this.ifa=[];this.Ikb=[];this.element.id=fe.RPh();this.element.className=Ib.$jh(this.fj);this.tub&&(this.zIndex=this.tub);this.rtl=this.fj;this.CCj(Rb);this.Kfa=this.createElement("div");this.Kfa.className="prFlyoutContainer";this.element.appendChild(this.Kfa);
this.IL=[];this.Vqa=new Ub(this.YJ,this.element,this.jta,4,6,32,this.fj);this.oA=sc.get(9);this.oA.ta(Ic.a.pointerDown,this.Vqa.element,Object(e.a)(this,this.jab,"onHitTarget"));this.oA.ta(Ic.a.pointerOver,this.Vqa.element,Object(e.a)(this,this.jab,"onHitTarget"));this.oA.ta(Ic.a.pointerOut,this.Vqa.element,Object(e.a)(this,this.jab,"onHitTarget"))}get Ftc(){return ne.a.clone(this.tA)}get YJ(){return this.IL}get tub(){return this.Eyg}get Fja(){return this.YJ?this.YJ.length:0}get vCa(){return 0<this.Fja?
this.YJ[0].state:5}get Akf(){return 3===this.vCa&&!this.CEa}JYc(Ua){this.addHandler(vc.bla,Ua)}Pvc(Ua){this.removeHandler(vc.bla,Ua)}dispose(){if(this.Akf)this.iSc=!0;else{if(this.YJ)for(const Ua of this.YJ)Ua.Pvc(Object(e.a)(this,this.mab,"onInteractivityChanged")),xb.a.Ja(Ua);this.IL=null;this.oA.Aa(Ic.a.pointerDown,this.Vqa.element,Object(e.a)(this,this.jab,"onHitTarget"));this.oA.Aa(Ic.a.pointerOver,this.Vqa.element,Object(e.a)(this,this.jab,"onHitTarget"));this.oA.Aa(Ic.a.pointerOut,this.Vqa.element,
Object(e.a)(this,this.jab,"onHitTarget"));super.dispose()}}$W(){this.rIa();this.visible=!0}uea(){this.visible=!0;this.iYe();this.CEa=!0}hide(){this.$Xf();this.cef();this.Vqa.update(this.vCa,this.iYa)}HZa(Ua){const Rb=this.vCa,sc=this.CEa;Ua.clientId||(Ua.clientId=(fe.ace++).toString());if(Ua.clientId in this.sVb){var Mc=this.gwb(Ua.clientId);if(0<=Mc){Mc=this.tA[Mc];if(Mc.color===Ua.color&&Mc.userName===Ua.userName)return;this.Ycb(Ua.clientId)}}this.hide();Mc=new sb(this.createElement("div"),this.ue);
Mc.JYc(Object(e.a)(this,this.mab,"onInteractivityChanged"));this.Kfa.insertBefore(Mc.element,this.Kfa.firstChild);this.sVb[Ua.clientId]=Mc;Array.add(this.tA,Ua);Array.add(this.YJ,Mc);this.Kng(Rb,sc);this.visible=!0}Ycb(Ua){if(this.Akf)Array.add(this.Ikb,Ua);else{var Rb=this.vCa,sc=this.CEa;this.hide();this.mYf(Ua);this.Kng(Rb,sc)}}t$a(Ua){const Rb=this.gwb(Ua);if(!(0>=Rb)){var sc=this.tA[Rb];Ua=this.sVb[Ua];Array.removeAt(this.tA,Rb);Array.insert(this.tA,0,sc);Array.removeAt(this.YJ,Rb);Array.insert(this.YJ,
0,Ua);this.Kfa.removeChild(Ua.element);this.Kfa.appendChild(Ua.element);this.rIa()}}Kng(Ua,Rb){0>=this.tA.length?this.hide():3===Ua&&Rb?this.uea():this.$W()}GNb(Ua,Rb){Rb?this.YKg(Ua):this.qXf(Ua)}loa(Ua){Ua!==this.zVb&&(this.zVb=Ua,this.KTd(Ua))}position(Ua,Rb){this.element.style.top=Rb+"px";this.element.style.left=Ua+"px"}rIa(Ua=!1){if(!Ua||this.W8){this.zVb&&this.KTd(!0);var Rb=Math.min(3,this.Fja)-1;Ua=0;var sc=1,Mc=0;this.iYa&&(Ua=this.$hb,sc=-1,Mc=-this.jta);for(let id=this.Fja-1;id>Rb;id--)this.YJ[id].dbg(this.tA[id],
-4*Rb*sc+Mc,!0,!1,!0,Ua);for(;0<=Rb;Rb--)this.YJ[Rb].dbg(this.tA[Rb],-4*Rb*sc+Mc,0<Rb,Array.contains(this.ifa,this.tA[Rb].clientId),Rb!==this.mWb,Ua);this.mWb=0;this.Vqa.update(0,this.iYa);this.zIndex=this.tub;this.CEa=!1;this.$Xf(0);this.iSc&&this.dispose()}}iYe(){this.zVb&&this.KTd(!1);this.zIndex=this.tub+1;let Ua,Rb,sc;({offsetX:Rb,offsetY:Ua,Nef:sc}=this.JEj());for(let Mc=0;Mc<this.Fja;Mc++)this.YJ[Mc].FNj(this.tA[Mc],Rb,Ua+(this.jta+2)*Mc,Mc!==this.mWb,sc)}cef(){let Ua=0,Rb=0;this.iYa&&(Ua=
this.$hb,Rb=-6);for(let sc=0;sc<this.Fja;sc++)this.YJ[sc].hide(this.tA[sc],Rb,Ua);this.zIndex=this.tub;this.visible=this.CEa=!1;this.iSc&&this.dispose()}F4c(Ua=0){Ua?(this.W8=!0,m.Task.delay(Ua).continueWith(()=>{this.obe?this.ahi():this.rIa(!0);this.W8=!1})):this.obe?this.hide():this.rIa()}ahi(){this.W8&&this.hide()}wZg(){if(k.AFrameworkApplication.sa&&k.AFrameworkApplication.sa.Qa.Ew&&xd.c()){const Ua=appChrome.selectors.getShyState();return Ua.isActive&&0!==Ua.state}return!1}mab(Ua,Rb){Ua=this.vCa;
this.wZg()||2!==Rb.type&&(4!==Rb.type||3===Ua)?4===Rb.type&&3===Ua?(this.W8&&(this.W8=!1),this.F4c()):3!==Rb.type||3!==Ua||this.CEa||(1<this.Fja?(this.W8=!0,m.Task.delay(250).continueWith(()=>{this.rIa(!0);this.W8=!1})):this.F4c()):(this.W8&&(this.W8=!1),3!==Ua&&(this.iYe(),3===Rb.Dvb.wb&&this.F4c(2E3)));this.raiseEvent(vc.bla,Rb)}jab(Ua){3===Ua.wb?this.mab(this,new vc(4,Ua)):Ua.eventName===Ic.a.pointerOver?this.mab(this,new vc(2,Ua)):Ua.eventName===Ic.a.pointerOut&&this.mab(this,new vc(3,Ua));return!1}CCj(Ua){this.element.style.width=
Ua+"px";this.element.style.height=this.jta+"px"}mYf(Ua){this.qXf(Ua);Ua=this.gwb(Ua);if(!(0>Ua)){var Rb=this.tA[Ua];Array.removeAt(this.tA,Ua);delete this.sVb[Rb.clientId];Rb=this.YJ[Ua];this.Kfa.removeChild(Rb.element);this.ue.get(18,!1)&&Rb.Pvc(Object(e.a)(this,this.mab,"onInteractivityChanged"));Array.removeAt(this.YJ,Ua);Rb.dispose()}}$Xf(Ua=5){if(this.Ikb.length){this.visible&&this.cef();for(let Rb=0;Rb<this.Ikb.length;Rb++)this.mYf(this.Ikb[Rb]);Array.clear(this.Ikb);0>=this.tA.length||5===
Ua?this.hide():0===Ua&&this.$W()}}gwb(Ua){for(let Rb=0;Rb<this.tA.length;Rb++)if(this.tA[Rb].clientId===Ua)return Rb;return-1}YKg(Ua){if(-1===this.gwb(Ua))d.ULS.sendTraceTag(41706451,302,15,"Cannot set active editor because client id is invalid");else{if(Array.contains(this.ifa,Ua)){if(this.tA[0].clientId===Ua)return;Array.remove(this.ifa,Ua)}Array.add(this.ifa,Ua);this.t$a(Ua);1!==this.vCa&&this.rIa()}}qXf(Ua){-1===this.gwb(Ua)?d.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):
Array.contains(this.ifa,Ua)&&(Array.remove(this.ifa,Ua),this.tA[0].clientId===Ua&&0<this.ifa.length&&this.t$a(this.ifa[this.ifa.length-1]),this.tA[0].clientId===Ua&&1===this.vCa&&this.rIa())}KTd(Ua){Ua?Sys.UI.DomElement.addCssClass(this.Kfa,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.Kfa,"prBackgroundSelection")}JEj(){let Ua,Rb;Rb=Ua=0;var sc=this.$hb;if(this.moe){const Mc=this.moe(this);if(!Mc)return{offsetX:Ua,offsetY:Rb,Nef:sc};const id=4===this.vCa;sc=this.bFg.Q0h(this.Fja,
id?6:this.jta,this.jta,this.element,Mc);Rb=sc.offsetTop;this.mWb=this.S_h(sc.xpg,sc.offsetTop);sc=sc.Oef;sc!==this.$hb&&(this.hPd(sc),this.element.dir=3===sc?"rtl":"ltr",this.$hb=sc);sc!==this.f4e()?(Ua=this.fFg?-2:id?-6:-this.jta,this.iYa=!0):this.iYa=!1}return{offsetX:Ua,offsetY:Rb,Nef:sc}}S_h(Ua,Rb){if(1===Ua)return this.Fja-1;Ua=Math.abs(Rb);return 0<Ua?Ua/(this.jta+2):0}hPd(Ua){for(let Rb=0;Rb<this.Fja;Rb++)this.YJ[Rb].hPd(Ua)}f4e(){return this.fj?3:4}static RPh(){return String.format("{0}-{1}",
"presencetooltip",fe.ace++)}}fe.ace=0;Object(b.a)(fe,"ModernPresenceTooltipControl",Ib,[176,3]);var Bd=a(229),Ue=a(359),mc=a(243);class Fc{constructor(Ua){this.ue=Ua;this.ue.FZa(10,Bd.a.instance);this.ue.FZa(9,mc.a.instance);this.ue.FZa(6,20);this.ue.FZa(13,Ue.a.instance);this.ue.FZa(17,!1)}zfh(){var Ua=document.createElement("div");this.ue.FZa(15,!1);return new fe(Ua,20,this.ue)}}Object(b.a)(Fc,"ModernPresenceTooltipFactory",null,[177]);var bd=a(180),de=a(18),Md=a(64),se=a(168),tc=a(12),dd=a(36),
Hd=a(355),Xc;(function(Ua){Ua[Ua.none=0]="none";Ua[Ua.master=1]="master";Ua[Ua.fixed=2]="fixed";Ua[Ua.horizontal=3]="horizontal";Ua[Ua.vertical=4]="vertical";Ua[Ua.first=1]="first";Ua[Ua.last=4]="last"})(Xc||(Xc={}));Object(b.b)("PaneType",Xc);const gd=(Ua,Rb,sc)=>{if(!Rb)return null;Ua=Ua.Tq;return new Sys.UI.Point(Rb.x+Ua.x*(sc?1:-1),Rb.y+Ua.y*(sc?1:-1))};class je extends fa.a{constructor(Ua,Rb,sc){super();this.WPf=this.Zza=null;this.cRd=!1;this.Bz=()=>{this.Mnd()};this.KF=()=>{this.Mnd()};this.gridView=
Ua;this.rtl=Ua.rtl;this.Lsd=!1;this.hm=new dd.a(!0);for(let Mc=0;4>Mc;Mc++)if(this.gridView.jb.Itd(sc,je.OLa()[Mc])||1===je.OLa()[Mc]){const id=Rb.zfh(),Ed=Ua.Vf(je.OLa()[Mc]).domElement;Ed.insertBefore(id.element,Ed.firstChild);this.hm.add(Enum.toString(Xc,je.OLa()[Mc]),id)}}JYc(Ua){this.addHandler("interactivityChanged",Ua)}Pvc(Ua){this.removeHandler("interactivityChanged",Ua)}get element(){return null}get Ftc(){const Ua=dd.a.Ic(this.hm.Du,Enum.toString(Xc,je.OLa()[0]));return Ua?Ua.Ftc:null}get Jaj(){return this.WPf}dispose(){if(0<
this.hm.count){this.hide();const Ua=this.hm.Du;for(let Rb in Ua)Ua[Rb].dispose()}this.gridView=null;this.hm.clear();super.dispose()}GFj(Ua){this.WPf=Ua}$W(){const Ua=this.hm.Du;for(let Rb in Ua)Ua[Rb].$W()}uea(){this.Mnd();const Ua=this.hm.Du;for(let Rb in Ua)Ua[Rb].uea()}hide(){this.HUa();const Ua=this.hm.Du;for(let Rb in Ua)Ua[Rb].hide()}HZa(Ua){const Rb=this.hm.Du;for(let sc in Rb)Rb[sc].HZa(Ua)}t$a(Ua){const Rb=this.hm.Du;for(let sc in Rb)Rb[sc].t$a(Ua)}Ycb(Ua){const Rb=this.hm.Du;for(let sc in Rb)Rb[sc].Ycb(Ua)}GNb(Ua,
Rb){const sc=this.hm.Du;for(let Mc in sc)sc[Mc].GNb(Ua,Rb)}loa(Ua){this.Lsd!==Ua&&(this.Lsd=Ua,Ua=dd.a.Ic(this.hm.Du,Enum.toString(Xc,je.OLa()[0])),this.Zza&&Ua&&(Ua=tc.DOMElementExtensions.getWidth(Ua.element)/2,this.position(this.Lsd?this.Zza.x+14+Ua:this.Zza.x-14-Ua,this.Zza.y)))}position(Ua,Rb){const sc=this.hm.Du;for(let Ed in sc){var Mc=sc[Ed],id=Enum.parse(Xc,Ed);id=this.gridView.Vf(id);const ee=gd(id,new Sys.UI.Point(Ua,Rb),!1);this.Zza=new Sys.UI.Point(Ua,Rb);0>ee.x&&(ee.x+=id.domElement.scrollLeft);
tc.DOMElementExtensions.updatePosition(Mc.element,ee.x,ee.y,!1,this.rtl)}}Mnd(){this.Zza&&(this.position(this.Zza.x,this.Zza.y),this.cRd||(this.cRd=!0,this.gridView.Ca.TG(this.Bz),this.gridView.Ca.Us(this.Bz),this.gridView.view.Vs(this.KF)))}HUa(){this.cRd&&(this.gridView.Ca.rI(this.Bz),this.gridView.Ca.Dr(this.Bz),this.gridView.view.Xq(this.KF))}static OLa(){return je.c$||(je.c$=[1,3,2,4])}}je.c$=null;Object(b.a)(je,"PaneInvariantTooltip",fa.a,[176,3]);class Ee{}Ee.kOb=!1;Ee.Boa=!1;Object(b.a)(Ee,
"PresenceViewSettings",null,[]);class ae{constructor(Ua){this.Skc=!1;this.Kz=this.Bpa=this.NQf=null;this.jHb=Rb=>{const sc=this.qba(Rb.Dy);sc&&this.zvc(sc,Rb.cAa.clientId,Rb.Dy)};this.MHb=Rb=>{this.FI(!1,Rb)};this.LHb=Rb=>{this.FI(!0,Rb)};this.Bz=()=>{this.Lng()};this.KF=()=>{this.Lng()};this.Gza=()=>{this.xtb();this.clearCache()};this.E$h=Rb=>{Rb=tc.DOMElementExtensions.getBounds(Rb.element);Rb=new Md.a(Rb.x,Rb.y,Rb.width,Rb.height);for(const Mc of je.OLa()){var sc=this.gridView.Vf(Mc);sc=tc.DOMElementExtensions.getBoundingClientRect(sc.domElement);
if((new Md.a(sc.x,sc.y,sc.width,sc.height)).vd(Rb))return sc}return null};this.I7j=()=>{const Rb=this.zz;for(let sc in Rb){const Mc=Rb[sc];if(Mc){const id=Mc.qNa(),Ed=this.qba(Mc.Dy),ee=id?this.d8e(Mc.Etc,Mc.paneType,Mc.range):null;if(ee!==Ed){Ed&&this.zvc(Ed,Mc.cAa.clientId,Mc.Dy);if(!Ee.Boa)break;ee&&id&&(ee.HZa(Mc.cAa),this.aVa[Mc.Dy]=ee,Mc.oPb(ee),this.zcf(ee,Mc))}else this.zcf(Ed,Mc)}}};this.Zhi=de.a.mDh;this.tMa=20;this.gridView=lb.h(Ua);this.$=Ua;this.jJb={};this.aVa={};this.zz={};this.ZUa=
{};this.$.ua&&this.$.ua.Yf(this.Gza);this.xtb()}dispose(){this.HUa();this.clearCache();this.$&&this.$.ua&&this.$.ua.yg(this.Gza);this.gridView=null}HUa(){this.Skc&&(this.gridView.Ca.rI(this.Bz),this.gridView.Ca.Dr(this.Bz),this.gridView.view.Xq(this.KF),this.Skc=!1)}l2j(Ua){const Rb=this.zz[Ua],sc=this.qba(Ua);Rb&&this.JXf(Rb);sc&&this.zvc(sc,Rb.cAa.clientId,Rb.Dy);delete this.aVa[Ua];delete this.zz[Ua];delete this.ZUa[Ua]}r2d(Ua){const Rb=Ua.Dy;this.zz[Rb]||(this.v6a(Ua),this.zz[Rb]=Ua)}Z1d(Ua){this.Kz=
Ua;this.t1i(Ua)}M7j(Ua){const Rb=Ua.Dy,sc=this.d8e(Ua.Etc,Ua.paneType,Ua.range),Mc=this.qba(Rb);sc&&sc!==Mc&&(Ua.oPb(sc),this.aVa[Rb]=sc,this.zz[Rb]=Ua,this.ZUa[Rb]&&sc.loa(this.ZUa[Rb]));Mc!==sc&&Mc&&this.zvc(Mc,Ua.cAa.clientId,Ua.Dy);!this.Skc&&this.gridView&&(this.gridView.Ca.TG(this.Bz),this.gridView.Ca.Us(this.Bz),this.gridView.view.Vs(this.KF),this.Skc=!0)}zvc(Ua,Rb,sc){Ua.Ycb(Rb);Za.EwaSettings.isChangeGateEnabled("OfficeVSO:3663630_ModernPresenceUxPerf")&&this.qba(sc)===Ua&&delete this.aVa[sc];
Ua.Ftc&&Ua.Ftc.length||((Rb=Ua.Jaj)&&delete this.jJb[Rb],Za.EwaSettings.isChangeGateEnabled("OfficeVSO:3663630_ModernPresenceUxPerf")||this.qba(sc)===Ua&&delete this.aVa[sc],Ua.dispose())}JXf(Ua){Ua&&(Ua.zNd(this.jHb),Ua.YNd(this.MHb),Ua.XNd(this.LHb),Ua.oPb(null))}v6a(Ua){Ua.IYc(this.jHb);Ua.iZc(this.MHb);Ua.hZc(this.LHb)}FI(Ua,Rb){if(Ee.Boa){Rb.Eja||this.r2d(Rb);this.M7j(Rb);var sc=this.qba(Rb.Dy);sc&&(sc.HZa(Rb.cAa),this.Kz===Rb.Dy&&sc.t$a(Rb.Dy),Rb.qNa()?Ua?sc.uea():sc.$W():sc.hide())}}t1i(Ua){const Rb=
this.qba(Ua);bd.a(()=>{null===Rb||void 0===Rb?void 0:Rb.t$a(Ua)},this.$.ka)}qba(Ua){return this.aVa[Ua]}d8e(Ua,Rb,sc){if(!Ua)return null;Ua=this.Hid(Ua,Rb,sc);var Mc=this.gridView.Vf(Rb).Tq;Rb=ae.c4h(Ua,Rb,Mc).toString();Mc=dd.a.Ic(this.jJb,Rb);Mc||(Mc=new je(this.gridView,this.NQf,sc),Mc.position(Ua.x,Ua.y),Mc.GFj(Rb),this.jJb[Rb]=Mc);return Mc}Hid(Ua,Rb,sc){const Mc=this.gridView.Vf(Rb).Dn,id=this.gridView.Vf(Rb).Tq;Rb=Hd.a.MM(Rb,Mc.topLeft);let Ed=Math.max(id.x,Ua.x-this.tMa/2-2);Ed=Math.min(Math.max(Rb.x+
id.x,Ed),Rb.x+id.x+Mc.width-this.tMa);Ua=Math.max(id.y,Ua.y-this.tMa/2+1);if(Rb.y+id.y>Ua||this.WYj(sc))Ed=Math.min(Ed+this.tMa/4,Rb.x+id.x+Mc.width-this.tMa);Ua=Math.min(Math.max(Rb.y+id.y,Ua),Rb.y+id.y+Mc.height-this.tMa);return new Sys.UI.Point(Ed,Ua)}clearCache(){var Ua=this.zz;for(let Rb in Ua)this.JXf(Ua[Rb]);Ua=this.jJb;for(let Rb in Ua)Ua[Rb].dispose();this.aVa={};this.zz={};this.jJb={};this.ZUa={};xb.a.Ja(this.Bpa);this.Bpa=null}xtb(){const Ua=new hb;Ua.add(0,de.a.wVe);Ua.add(1,this.Zhi);
Ua.add(12,49);Ua.add(6,this.tMa);this.gridView&&(Ua.add(4,V.a.Le(3)),Ua.add(5,V.a.Le(3)),Ua.add(8,this.gridView.rtl));Ua.add(18,!0);this.NQf=new Fc(Ua);Ua.add(16,this.E$h)}Lng(){Ee.Boa&&(this.Bpa=se.AsyncMethodContext.Cq(this.I7j,100,Pa.a.Zbj,this.Bpa))}zcf(Ua,Rb){Ee.Boa&&(this.ZUa[Rb.Dy]&&Ua.loa(this.ZUa[Rb.Dy]),Rb.qNa()?Rb.Coa(!0,!0):Rb.Coa(!1,!0))}loa(Ua,Rb){this.ZUa[Ua]=Rb;(Ua=this.qba(Ua))&&Ua.loa(Rb)}GNb(Ua,Rb){const sc=this.qba(Ua);sc&&sc.GNb(Ua,Rb)}static c4h(Ua,Rb,sc){return Ua.x.toString()+
"-"+Ua.y.toString()+"-"+Rb.toString()+"-"+sc.x.toString()+"-"+sc.y.toString()}WYj(Ua){var Rb;Ua=lb.h(this.$).Ca.Tja(Ua.topRight);return null===(Rb=null===Ua||void 0===Ua?void 0:Ua[0])||void 0===Rb?void 0:Rb.Ika}}Object(b.a)(ae,"PresenceTooltipManager",null,[3]);var Yb=a(109),Sc=a(120);class qd extends fa.a{constructor(Ua,Rb,sc,Mc,id){super();this.hy=[];this.z0a=null;this.visible=!1;this.Aqb=this.XDb=null;this.Eja=!1;this.DPj=()=>{xb.a.Ja(this.Aqb);this.Aqb=null;this.visible&&(this.qNa()?this.raiseEvent("showPresenceTooltip"):
this.E4(!0))};this.YEd=Ed=>{this.Ycb(Ed)};this.Bz=()=>{this.Jlg()};this.KF=()=>{this.Jlg()};this.domElement=Ua;this.gridView=Rb;this.$Vc=Ua.id;this.Gra=Mc;this.$=id;this.Rkc=!1;this.Kef();this.zSc=sc;this.Yg=null;this.$B={};this.$B.FirstColumn=0;this.$B.FirstRow=0;this.$B.LastColumn=0;this.$B.LastRow=0}IYc(Ua){this.addHandler("hidePresenceTooltip",Ua)}zNd(Ua){this.removeHandler("hidePresenceTooltip",Ua)}iZc(Ua){this.addHandler("showPresenceTooltip",Ua)}YNd(Ua){this.removeHandler("showPresenceTooltip",
Ua)}hZc(Ua){this.addHandler("showFullPresenceTooltip",Ua)}XNd(Ua){this.removeHandler("showFullPresenceTooltip",Ua)}TGa(Ua){this.addHandler("presenceChanged",Ua)}NAa(Ua){this.removeHandler("presenceChanged",Ua)}get Dy(){return this.$Vc}get cAa(){return this.zSc}get paneType(){return this.Gra}get Etc(){if(!this.domElement)return null;var Ua=this.gridView.Vf(this.paneType).Dn,Rb=this.gridView.rtl,sc=this.domElement.offsetWidth;if(!this.Yg&&4>=sc){if(this.$B){sc=this.gridView.pi;var Mc=this.$B.FirstRow;
Rb=Rb?this.$B.FirstColumn:this.$B.LastColumn;if(sc&&!(Mc>=sc.top&&Mc<=sc.bottom&&Rb>=sc.left&&Rb<=sc.right))return Mc=Mc<=sc.top?Ua.y:Ua.y+(Mc>=sc.bottom?Ua.height:Ua.height/2),Rb=Rb<=sc.left?Ua.x:Ua.x+(Rb>=sc.right?Ua.width:Ua.width/2),this.XDb=new Sys.UI.Point(Rb,Mc)}return this.XDb}if(this.Yg){Ua=this.domElement.offsetTop-2;Mc=parseInt(this.domElement.style.left,10);let id=0;Rb&&(id=parseInt(this.domElement.parentNode.style.width,10)-sc-Mc,id-=this.gridView.aS.aOa&&this.gridView.aS.uvd?Sc.a.Ku:
0);return this.XDb=new Sys.UI.Point((Rb?id:Mc)+sc+4,Ua)}return this.XDb=new Sys.UI.Point(parseInt(Rb?this.domElement.style.right:this.domElement.style.left,10)+sc,this.domElement.offsetTop)}get range(){return Ba.E(this.$B)}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.NEe();this.HUa();xb.a.Ja(this.Aqb);this.domElement=this.gridView=null;super.dispose()}SWd(Ua,Rb){const sc=!!Ua&&!Ba.E(Ua).equals(Ba.E(this.$B)),Mc=!!Rb&&(!this.Yg||this.Yg.get_id()!==Rb.get_id());
if(sc||Mc)this.raiseEvent("presenceChanged"),this.NEe(),this.Eja=!1,this.$B=Ua,this.Yg=Rb,this.XDb=null}E4(Ua){this.visible=this.Eja=!1;Ua&&this.raiseEvent("hidePresenceTooltip")}fha(Ua){this.hy.push(Ua);this.Kef();Ua.TGa(this.YEd)}Coa(Ua,Rb){Ua?(this.visible=!0,Rb&&(this.Aqb=se.AsyncMethodContext.Cq(this.DPj,this.$.ya.ShowTooltipDelayInMs,Pa.a.cZj,this.Aqb))):this.E4(Rb)}oPb(){}ahb(){if(this.domElement&&this.visible){this.z0a=tc.DOMElementExtensions.getBoundingClientRect(this.domElement);const Ua=
Math.floor(this.z0a.x);this.z0a.x=Ua===this.z0a.x?Ua:Ua+1;this.z0a.y=Math.floor(this.z0a.y)}}qNa(){if(!this.$B)return!1;const Ua=this.k4h();return Ua?this.gridView.exi(Ua,this.paneType):!1}k4h(){if(this.range.isSingle){var Ua=this.gridView.Ca.Wva(this.range,this.$.activeItemName);return Ua?(Ua=Ua.es(this.range))?Ua.VC:null:null}return this.range}NEe(){for(let Ua=0,Rb=this.hy.length;Ua<Rb;Ua++)this.hy[Ua].NAa(this.YEd);this.hy.length=0;this.HUa()}Kef(){!this.Rkc&&1<=this.hy.length&&(this.Rkc=!0,this.gridView.Ca.TG(this.Bz),
this.gridView.Ca.Us(this.Bz),this.gridView.view.Vs(this.KF))}HUa(){this.Rkc&&!this.hy.length&&(this.Rkc=!1,this.gridView&&(this.gridView.Ca.rI(this.Bz),this.gridView.Ca.Dr(this.Bz),this.gridView.view.Xq(this.KF)))}Ycb(Ua){Ua.NAa(this.YEd);Array.remove(this.hy,Ua);this.HUa()}Jlg(){this.ahb();for(let Ua=0,Rb=this.hy.length;Ua<Rb;Ua++)this.hy[Ua].ahb()}}Object(b.a)(qd,"TooltipNotificationUnit",fa.a,[691,3]);class Id extends fa.a{constructor(Ua,Rb,sc,Mc,id,Ed,ee,oe){super();this.Ib=null;this.zz={};this.kpe=
0;this.Yg=this.wsa=null;this.Gra=0;this.jHb=Xe=>{this.wsa&&this.wsa!==Xe||(this.wsa=null,this.E4(!1));this.raiseEvent("hidePresenceTooltip")};this.MHb=Xe=>{this.wsa&&this.wsa!==Xe||(this.wsa=null,this.Coa(!0,!1));this.raiseEvent("showPresenceTooltip")};this.LHb=Xe=>{this.wsa||this.raiseEvent("showFullPresenceTooltip");this.wsa=Xe};this.EHb=()=>{this.E4(!1);this.raiseEvent("presenceChanged")};oe=sc===Ma.a.instance.nb(87)||oe;this.zSc=new Gb.a(Rb,sc,Mc,new rb.a,null,null,null,null,oe);this.gridView=
Ua;this.$Vc=Rb;this.highlight=id;this.ry=Ed;this.$=ee}IYc(Ua){this.addHandler("hidePresenceTooltip",Ua)}zNd(Ua){this.removeHandler("hidePresenceTooltip",Ua)}iZc(Ua){this.addHandler("showPresenceTooltip",Ua)}YNd(Ua){this.removeHandler("showPresenceTooltip",Ua)}hZc(Ua){this.addHandler("showFullPresenceTooltip",Ua)}XNd(Ua){this.removeHandler("showFullPresenceTooltip",Ua)}TGa(Ua){this.addHandler("presenceChanged",Ua)}NAa(Ua){this.removeHandler("presenceChanged",Ua)}get Dy(){return this.$Vc}get cAa(){return this.zSc}get paneType(){return this.Gra}get range(){return this.Ib}get Etc(){return this.Ib||
this.Yg?gd(this.gridView.Vf(this.paneType),this.fwa(this.paneType).Etc,!0):null}get Eja(){return this.fwa(this.paneType).Eja}set Eja(Ua){const Rb=this.zz;for(let sc in Rb)Rb[sc].Eja=Ua}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.ry&&this.ry.l2j(this.Dy);const Ua=this.zz;for(let Rb in Ua){const sc=Ua[Rb];sc.zNd(this.jHb);sc.YNd(this.MHb);sc.XNd(this.LHb);sc.NAa(this.EHb);sc.dispose()}this.ry=this.Ib=this.highlight=this.gridView=this.zz=null;super.dispose()}Lcg(Ua,
Rb,sc=null){Ua?(this.Ib=Ba.E(Ua),this.Gra=this.gridView.jb.Li(this.Ib.topRight)):sc?(this.Yg=sc,this.Gra=sc.Bg.paneType):this.Gra=1;this.kpe=Rb;this.fwa(this.paneType);this.SWd(Ua,sc)}SWd(Ua,Rb){const sc=this.zz;for(let Mc in sc)sc[Mc].SWd(Ua,Rb)}E4(Ua){this.fwa(this.paneType).E4(Ua);Ua=this.zz;for(let Rb in Ua)Ua[Rb].E4(!1)}bre(Ua){const Rb=this.zz;for(let sc in Rb){const Mc=Rb[sc];Mc.fha(Ua.fwa(Mc.paneType))}}fha(Ua){this.fwa(Ua.paneType).fha(Ua)}qNa(){let Ua=this.fwa(this.paneType).qNa();const Rb=
this.zz;for(let sc in Rb)Ua=Rb[sc].qNa()||Ua;return Ua}Coa(Ua,Rb){this.ry.r2d(this);this.fwa(this.paneType).Coa(Ua,Rb);Rb=this.zz;for(let sc in Rb)Rb[sc].Coa(Ua,!1)}oPb(Ua){const Rb=this.zz;for(let sc in Rb)Rb[sc].oPb(Ua)}ahb(){const Ua=this.zz;for(let Rb in Ua)Ua[Rb].ahb();this.ry.r2d(this)}fwa(Ua){return this.h3h(Ua,this.kpe)}Z1d(Ua){this.ry.Z1d(Ua)}h3h(Ua,Rb){const sc=this.highlight?this.highlight.WC(Rb,Ua).kg:this.Yg?this.Yg.get_element():null;Rb=Id.T9h(Rb,Ua);let Mc=dd.a.Ic(this.zz,Rb);Mc||(Mc=
new qd(sc,this.gridView,this.cAa,Ua,this.$),this.zz[Rb]=Mc,Mc.IYc(this.jHb),Mc.iZc(this.MHb),Mc.hZc(this.LHb),Mc.TGa(this.EHb));return Mc}static T9h(Ua,Rb){return Ua.toString()+Rb.toString()}}Object(b.a)(Id,"PaneInvariantTooltipNotificationUnit",fa.a,[691,3]);class ic{constructor(Ua,Rb,sc){this.Yg=this.objectId=this.VUb=null;this.Am=Ua;this.$=Rb;this.ry=sc;this.Hu=new Id(lb.h(this.$),this.Am.User.UserID,this.Am.User.UserName,this.Am.UserColor,null,sc,this.$,this.Am.IsAnonymous)}get Yg(){return this.VUb}set Yg(Ua){this.VUb=
Ua}dispose(){this.Vzb();xb.a.Ja(this.Hu);this.objectId=this.$=this.Am=this.Yg=null}fha(Ua){this.Hu.bre(Ua.Hu)}Vzb(){this.Yg&&this.Am&&this.Am.User&&(this.Yg.XEc(!1,this.Am.User.UserID,null),this.Hu.E4(!0))}DOb(){Ee.kOb&&this.Yg&&this.Am&&this.Am.User&&(this.Yg.XEc(!0,this.Am.User.UserID,this.Am.UserColor),this.Hu.ahb())}FI(Ua){Ee.Boa&&(this.Hu.Eja=Ua,this.Hu.Coa(Ua,!0))}MOb(Ua,Rb){this.Hu.Lcg(null,0===Rb?49:50,Ua)}}Object(b.a)(ic,"FloatingObjectPresenceHighlight",null,[666,3]);var Gc=a(633),jd=a(76),
ed=a(11),Qd=a(260),te=a(157);class xe extends Gc.a{constructor(Ua,Rb,sc){super(Rb,lb.h(Rb),!0,!1,Ua.User.UserID);this.lz=[];this.Qjc=this.HOb=!1;this.L_=()=>{this.Am.User.UserID===this.yyb()&&(d.ULS.sendTraceTag(521143967,0,50,`PresenceHighlight:onPresenterDetailsSaved called for User:
        ${this.Am.User.UserID}, Logging presenter information: ${this.yyb()}, meetingId: ${this.$.ya.MeetingId}`),this.lz.forEach(Mc=>{this.YOe(Mc)}),this.lz=[])};xe.J1a||(xe.J1a={});this.Am=Ua;this.Hu=new Id(this.gridView,this.Am.User.UserID,this.Am.User.UserName,this.Am.UserColor,this,sc,this.$,this.Am.IsAnonymous);this.osd=te.i(this.$);this.Fwi=Za.EwaSettings.isChangeGateEnabled("OfficeVSO:6191577_PresenterPresenceOnTop");this.srd=te.a(this.$);this.ykf=this.osd||this.srd;this.L_=this.L_.bind(this);
this.ykf&&this.CEi()}dispose(){var Ua;xb.a.Ja(this.Hu);super.dispose();const Rb=xe.J1a;for(let Mc in Rb){var sc=Mc;const id=Rb[Mc];id&&!id.children.length&&(tc.DOMElementExtensions.yf(id),xe.J1a[sc]=null)}null===(Ua=xe.excelLiveManager)||void 0===Ua?void 0:Ua.jdb(this.L_);this.lz=null}fha(Ua){this.Hu.bre(Ua.Hu)}FI(Ua){Ee.Boa&&(this.Qjc||(this.Hu.Eja=Ua,this.Hu.Coa(Ua,!0)),this.HOb=Ua&&this.Qjc)}MOb(Ua,Rb){this.Hu.Lcg(Ua,0===Rb?49:50);this.HOb=!1}DOb(Ua){Ee.kOb&&(this.Hu.Coa(!0,!0),this.$q([Ua]))}Vzb(Ua){this.E4();
this.Tj(Ua)}bLe(Ua,Rb,sc){sc.className=jd.a.PEh;sc.style.borderColor=this.Am.UserColor;this.srd&&sc.classList.add(jd.a.WWe);const Mc=document.createElement("div");49!==Ua&&50!==Ua&&(Mc.style.backgroundColor=this.Am.UserColor);sc.appendChild(Mc);Mc.className=[jd.a.REh,jd.a.QEh][Ua-49];Ua=dd.a.Ic(xe.J1a,Rb.toString());if(!Ua){const id=this.gridView.Vf(Rb).domElement;Ua=document.createElement("div");id.insertBefore(Ua,id.firstChild);xe.J1a[Rb.toString()]=Ua}Ua.appendChild(sc);this.ykf&&this.Krh(Mc)}Tzb(){}M7f(Ua,
Rb,sc,Mc){const id=this.YSg(Mc,Ua,Rb);Qd.c(sc,this.gridView.rtl,ed.HelperMethods.zc(id.x));sc.width=ed.HelperMethods.zc(id.width);sc.top=ed.HelperMethods.zc(id.y);sc.height=ed.HelperMethods.zc(id.height);Rb=Rb.kg;sc=Rb.parentNode;50===Ua?xe.qLd(sc,Rb,!1):49===Ua&&(Ua=this.WC(50),Mc.equals(Ua.Slc)?xe.qLd(sc,Rb,!1):xe.qLd(sc,Rb,!0));this.Taj()}lag(){return!1}YSg(Ua,Rb,sc){let Mc=Ua.y+this.Vxb(sc,!1);sc=Ua.x+this.Vxb(sc,!0)+Sc.a.Yfd(sc.kg.parentNode.parentNode,this.gridView.rtl);let id=Ua.width;Ua=Ua.height+
1;1>sc&&-1<=sc&&49===Rb&&(id-=1-sc,sc=1);1>Mc&&-1<=Mc&&49===Rb&&(Ua-=1-Mc,Mc=1);id=Math.max(0,id-1);Ua=Math.max(0,Ua-2);return new Md.a(sc,Mc,id,Ua)}Taj(){this.Hu.ahb();this.Qjc=!1;this.HOb&&this.FI(!0);this.HOb=!1}E4(){this.Qjc||(this.Hu.E4(!0),this.HOb=!1)}static qLd(Ua,Rb,sc){sc?Rb!==Ua.firstChild&&(Ua.removeChild(Rb),Ua.insertBefore(Rb,Ua.firstChild)):Rb!==Ua.lastChild&&(Ua.removeChild(Rb),Ua.appendChild(Rb))}Krh(Ua){var Rb;(null===(Rb=xe.excelLiveManager)||void 0===Rb?0:Rb.ibb.Kz)?this.Am.User.UserID===
this.yyb()&&(d.ULS.sendTraceTag(521143968,0,50,`PresenceHighlight:Distinct presenter presence called for User:${this.Am.User.UserID}, Logging presenter information: ${this.yyb()}, meetingId: ${this.$.ya.MeetingId}`),this.YOe(Ua)):(d.ULS.sendTraceTag(509749071,0,50,`PresenceHighlight:PresenterCid is not yet saved for User:${this.Am.User.UserID}`),this.lz.push(Ua))}YOe(Ua){this.srd&&this.ymj(Ua);this.osd&&(d.ULS.sendTraceTag(509749070,0,50,`PresenceHighlight:distinctPresenterPresenceInternal called for User:${this.Am.User.UserID}`),
this.hhi(Ua));this.osd&&this.Fwi&&this.J6j(Ua)}CEi(){xe.excelLiveManager?xe.excelLiveManager.vpb(this.L_):this.$.da.hb(473,Ua=>{xe.excelLiveManager=Ua;xe.excelLiveManager.vpb(this.L_)})}hhi(Ua){bd.a(()=>{Ua.style.backgroundColor=this.Am.UserColor;Ua.classList.add(jd.a.WEh);d.ULS.sendTraceTag(520648066,0,50,`PresenceHighlight:Highlighting presence for User: ${this.Am.User.UserID}, Logging presenter information: ${this.yyb()}, meetingId: ${this.$.ya.MeetingId}`)},this.$.ka)}ymj(Ua){bd.a(()=>{Ua.parentElement.classList.remove(jd.a.WWe)},
this.$.ka)}J6j(Ua){this.Hu.Z1d(xe.excelLiveManager.ibb.Kz);bd.a(()=>{Ua.parentElement.classList.add(jd.a.VEh)},this.$.ka)}yyb(){return xe.excelLiveManager.ibb.Kz}}xe.J1a=null;Object(b.a)(xe,"PresenceHighlight",Gc.a,[]);class He extends F{constructor(Ua,Rb,sc){super();this.nH=new dd.a(!0);this.countFloatingObjects=this.z6c=this.y6c=0;this.PJd=!1;this.Sq=()=>{this.eTd()};this.Gza=()=>{this.eTd()};this.aA=new X(Ua);this.E9f(Ua);this.ry=sc;this.hUd([]);this.$=Rb;this.$.ua.Yf(this.Gza);lb.h(this.$).BT(this.Sq);
this.PJd=Za.EwaSettings.isChangeGateEnabled("OfficeVSO:6331623_ProcessShapeFOPresence")}get lc(){return this.aA.lc}set lc(Ua){this.aA.lc=Ua;this.eTd()}VAc(){var Ua=1===this.lc.PresenceType?50:49;for(let Rb=0;Rb<this.qy.length;Rb++)this.qy[Rb].DOb(Ua);for(Ua=0;Ua<this.nH.count;Ua++)this.nH.$f(Ua).DOb()}lgc(){var Ua=1===this.lc.PresenceType?50:49;for(let Rb=0;Rb<this.qy.length;Rb++)this.qy[Rb].Vzb([Ua]);for(Ua=0;Ua<this.nH.count;Ua++)this.nH.$f(Ua).Vzb()}dispose(){this.$&&(this.$.ua&&this.$.ua.yg(this.Gza),
lb.h(this.$).YN(this.Sq));this.ROe();xb.a.sc(this.qy);xb.a.sc([this.aA]);this.aA=this.$=null;this.hUd(null);this.nH=null;super.dispose()}ROe(){if(this.nH){for(let Ua=0;Ua<this.nH.count;Ua++)this.nH.$f(Ua).dispose();this.nH.clear()}}a1a(Ua){1===this.lc.Version?this.j7g(Ua):this.k7g(Ua)}j7g(Ua){if(Ua.lc.SelectedRange&&this.lc.SelectedRange){const Rb=this.lc.SelectedRange.length,sc=Ua.lc.SelectedRange.length;for(let Mc=0;Mc<Rb;Mc++)for(let id=0;id<sc;id++)if(pa(this.lc.SelectedRange[Mc],Ua.lc.SelectedRange[id])){this.qy[Mc].fha(Ua.A5a(id));
return}}}k7g(Ua){var Rb;let sc=0,Mc=0;if(this.lc&&this.lc.Object&&(null===(Rb=Ua.lc)||void 0===Rb?0:Rb.Object)){Rb=this.lc.Object.length;var id=Ua.lc.Object.length;for(var Ed=0;Ed<Rb;Ed++)if(this.lc.Object[Ed]&&this.qkd(this.lc.Object[Ed])){sc++;for(var ee=0;ee<id;ee++)if(Ua.lc.Object[ee]&&this.qkd(Ua.lc.Object[ee])&&(Mc++,this.x_c(this.lc.Object[Ed],Ua.lc.Object[ee]))){var oe=this.A5a(sc),Xe=Ua.A5a(Mc);if(oe&&Xe){oe.fha(Xe);return}}}else if(this.lc.Object[Ed]&&Ua.lc.Object[Ed]&&(0===this.lc.Object[Ed].ObjectType||
2===this.lc.Object[Ed].ObjectType))for(ee=0;ee<id;ee++)if(Ua.lc.Object[ee]&&(0===Ua.lc.Object[Ed].ObjectType||2===Ua.lc.Object[Ed].ObjectType)&&this.lc.Object[Ed].ObjectId===Ua.lc.Object[ee].ObjectId&&(oe=this.Xhd(this.lc.Object[Ed].ObjectId),Xe=Ua.Xhd(this.lc.Object[Ed].ObjectId),oe&&Xe)){oe.fha(Xe);return}}if(Ua.lc.SelectedRange&&this.lc.SelectedRange)for(Rb=this.lc.SelectedRange.length,id=Ua.lc.SelectedRange.length,Ed=0;Ed<Rb;Ed++)for(ee=0;ee<id;ee++)if(pa(this.lc.SelectedRange[Ed],Ua.lc.SelectedRange[ee])&&
(oe=this.A5a(sc+Ed),Xe=Ua.A5a(Mc+ee),oe&&Xe)){oe.fha(Xe);return}}x_c(Ua,Rb){return!!Ua&&!!Rb&&Rb.ObjectType===Ua.ObjectType&&(1===Ua.ObjectType||3===Ua.ObjectType)&&!Ua.ObjectId.localeCompare(Rb.ObjectId)}A5a(Ua){return 0<=Ua&&this.qy.length>Ua?this.qy[Ua]:null}Acg(Ua){for(let Rb=0,sc=this.qy.length;Rb<sc;Rb++)this.qy[Rb].FI(Ua)}Xhd(Ua){return Ua&&this.nH.kb(Ua)?this.nH.getItem(Ua):null}Bcg(Ua,Rb=null){if(Ua)(Ua=this.nH.getItem(Rb))&&Ua.FI(!0);else for(Ua=0;Ua<this.nH.count;Ua++)(Rb=this.nH.$f(Ua))&&
Rb.FI(!1)}Ymg(Ua){F.A6j(this,Ua)}D7c(Ua,Rb){if(Ua<Rb)return this.qy[Ua];if(!this.Am||!this.$||!this.ry)return null;Ua=new xe(this.Am,this.$,this.ry);this.qy.push(Ua);return Ua}bEj(){const Ua=this.qy.length;var Rb=this.lc.SelectedRange?this.lc.SelectedRange.length:0,sc=this.$.ua.na;for(let Mc=0;Mc<Rb;Mc++){let id=this.D7c(Mc,Ua);id&&this.lc.SelectedRange[Mc]&&(this.lc.SelectedRange[Mc].NamedObjectName?id.Tj([50,49]):(id.MOb(this.lc.SelectedRange[Mc],this.lc.PresenceType),He.Y1d(this.lc.PresenceType,
id,this.lc.SelectedRange[Mc],sc,this.Am,this.ry)))}sc=!!this.aA&&!!this.aA.nJd&&this.aA.nJd.PresenceType!==this.aA.lc.PresenceType;for(Rb=sc?0:Rb;Rb<Ua;Rb++)this.qy[Rb].Tj([1===this.aA.nJd.PresenceType?50:49])}qkd(Ua){return(null===Ua||void 0===Ua?0:Ua.ObjectId)&&(1===this.V6e(Ua.ObjectType)||2===this.V6e(Ua.ObjectType))&&(Ua=this.$.Bb.hjd(Ua.ObjectId))?Ba.w(Ua):null}cEj(){const Ua=this.qy.length,Rb=this.$.ua.na,sc=this.lc.SelectedRange?this.lc.SelectedRange.length:0;var Mc=this.lc.Object?this.lc.Object.length:
0;for(var id=0;id<Ua;id++)this.qy[id].Tj([50,49]);this.p8g();this.z6c=this.y6c=id=0;for(var Ed=0;Ed<Mc;Ed++){var ee=this.lc.Object[Ed],oe=this.qkd(ee);if(oe){let Xe=this.D7c(id,Ua);1===ee.ObjectType?this.y6c++:3===ee.ObjectType&&this.z6c++;id++;Xe.MOb(oe,ee.ObjectPresenceType);He.Y1d(ee.ObjectPresenceType,Xe,oe,Rb,this.Am,this.ry)}}for(Mc=0;Mc<sc;Mc++)this.lc&&this.lc.SelectedRange&&(Ed=this.lc.SelectedRange[Mc],Ed.NamedObjectName||(ee=!!Rb&&Ed.SheetName===Rb.name,oe=!!$a(Ed,this.$,1),ee&&oe||(ee=
this.D7c(id+Mc,Ua),ee.MOb(Ed,this.lc.PresenceType),He.Y1d(this.lc.PresenceType,ee,Ed,Rb,this.Am,this.ry))));0<(this.countFloatingObjects=this.l6f())&&d.ULS.sendTraceTag(537154370,0,50,'{{"SetAllFloatingObjectPresenceHighlights":"Success"}')}p8g(){this.l6f();this.ROe()}l6f(){let Ua=0;if(this.lc&&this.lc.Object)for(let Rb=0;Rb<this.lc.Object.length;Rb++)this.a5j(this.lc.Object[Rb])&&Ua++;return Ua}Cih(Ua,Rb){if(this.nH.kb(Rb))return Rb=this.nH.getItem(Rb),Rb.Yg=Ua,Rb;if(!this.Am||!this.$||!this.ry)return null;
const sc=new ic(this.Am,this.$,this.ry);sc.Yg=Ua;this.nH.add(Rb,sc);return sc}a5j(Ua){let Rb=!1;if((null===Ua||void 0===Ua?0:Ua.ObjectId)&&(0===Ua.ObjectType||2===Ua.ObjectType||this.PJd&&5===Ua.ObjectType))try{const sc=this.iZh(Ua);if(sc){const Mc=this.Cih(sc,Ua.ObjectId);Mc.MOb(sc,Ua.ObjectPresenceType);5!==Ua.ObjectType&&Mc.DOb();Rb=!0}}catch(sc){throw d.ULS.sendTraceTag(537154369,0,10,`{"UpdatedFloatingObjectPresence":"Fail","Exception":"${sc.stack}"}`),sc;}return Rb}iZh(Ua){if(!Ua)return null;
let Rb=null;this.PJd?-1!=Ua.ObjectType&&(Rb=Yb.a(this.$).nLa(Ua.ObjectId)):2===Ua.ObjectType?Rb=Yb.a(this.$).nLa(Ua.ObjectId):0===Ua.ObjectType&&(Ua=this.$.Bb.hjd(Ua.ObjectId),null===Ua||void 0===Ua?0:Ua.imageId)&&(Rb=Yb.a(this.$).X_h(Ua.imageId));return Rb}eTd(){try{1===this.lc.Version?(this.bEj(),d.ULS.sendTraceTag(537154368,0,50,'{{"SetGridHighlightPass":"V1"}')):(this.cEj(),d.ULS.sendTraceTag(537154339,0,50,`{"FloatingObjects":"${this.countFloatingObjects}","PivotTables":"${this.y6c}","QueryTables":"${this.z6c}"}`))}catch(Ua){throw d.ULS.sendTraceTag(537154338,
0,10,`{"SetGridHighlight Exception":"${Ua.stack}"}`),Ua;}}V6e(Ua){switch(Ua){case 0:return 0;case 1:return 1;case 3:return 2;case 2:return 9;default:return-1}}static Y1d(Ua,Rb,sc,Mc,id,Ed){const ee=1===Ua?50:49;Mc&&sc&&Mc.name===sc.SheetName?(Rb.Bk(Ba.E(sc),[ee]),Rb.DOb(ee),d.ULS.shipAssertTag(537154337,0,Rb.Hu.Dy===id.User.UserID,"UserID and UnitID should match"),Ed.GNb(Rb.Hu.Dy,1===Ua)):Rb.Vzb([ee])}}Object(b.a)(He,"UserGridPresence",F,[]);var We=a(43),ye=a(809);class $e extends fa.a{constructor(Ua,
Rb,sc,Mc,id=null){super();this.$u={};this.A6b=this.B6b=0;this.Iwd=this.Ztb=null;this.Vtf=3E4;this.Amd=!1;this.YUd=!0;this.KId=null;this.DEf=()=>{var Ed=this.ena;for(let ee in Ed)Ed=ee,this.Zqe(Ed)?(this.anc(Ed,!0),delete this.qbb[Ed],delete this.ena[Ed]):d.ULS.sendTraceTag(537154377,0,50,`PresenceView.OnEcsUserListChanged: pending userId=[${Ed}] still not updated`)};this.UFd=(Ed,ee)=>{Ed={};Ed.UpdatedCount=ee.vL?Object.keys(ee.vL).length:0;Ed.DisconnectedCount=ee.waa?ee.waa.length:0;Ed.Location="canvas";
qa.b(this.$).qd(ob.a.SId,Ed);Ed=null;this.$.Mb&&(Ed=this.$.Mb.vg("ModelUpdate","PresenceRendering"),Ed.start());var oe={};if(ee.vL){if(Za.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const af=(new Date).getTime();ya.TaskExtensions.za(ba.GetServiceTaskFactory.Pa(this.$.da,435,436,1),Wf=>{Wf.result.YHi(af)},this.$.ka,3)}this.pwb||(this.tyd(!0),this.pwb=!0);const Kf=ee.vL;for(var Xe in Kf){var mf=Kf[Xe];let af=Xe;this.Sod[af]=fb.a.Ya.Zb;if(!te.h(this.$)||null==mf.NavigationState)if(this.YFe(af,
new Date),this.gTg(mf),af!==this.Ztb){var wf=this.$u[af];wf||(this.Zqe(af)?this.anc(af,!0):(af in this.ena?d.ULS.sendTraceTag(537154376,0,50,`PresenceView.OnSelectionPresenceChanged: userId=[${af}] already pending update`):(this.qbb[af]=fb.a.Ya.Zb,oe[af]=1),this.ena[af]=!0,wf=this.E3h(af),this.$u[af]=this.nLe(wf)),wf=this.$u[af]);wf&&(wf.lc=mf,mf.SelectedRange&&1<mf.SelectedRange.length?this.B6b++:this.A6b++,this.lYf(af),this.a1a(wf))}}if(Za.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&
this.$.ea&&this.$.ea.dMa){const af=(new Date).getTime();ya.TaskExtensions.za(ba.GetServiceTaskFactory.Pa(this.$.da,435,436,1),Wf=>{Wf.result.ZHi(af)},this.$.ka,3)}}if(ee.waa)for(let Kf=0,af=ee.waa.length;Kf<af;Kf++)Xe=ee.waa[Kf],this.Y9c[Xe]=fb.a.Ya.Zb,this.bYf(Xe,!0);if(ee.waa&&0<ee.waa.length||0<ye.a(oe).length||0<ye.a(this.ena).length)Xe=[],Xe.push(...ye.a(oe)),Xe.push(...ye.a(this.ena)),(oe=this.$.da.Ba(292))&&oe.ohb(Xe,ee.waa);Ed&&Ed.stop();this.Amd=!1;Ed=this.$u;for(let Kf in Ed)if(0===Object(l.a)(F,
Ed[Kf]).lc.CollabMode){this.Amd=!0;break}this.raiseEvent("pcek",ee)};this.gDa=(Ed,ee)=>{ee&&this.$.Dt&&(ee.Npb.HasAnyNonOcsCoauthor=this.Amd)};this.xHb=()=>{const Ed=new vb.a({},null),ee=this.Dpa;for(let oe in ee){const Xe=oe,mf=ee[oe].lc;mf.SelectedRange=mf.SelectedRangeRaw;Ed.vL[Xe]=mf}this.UFd(this,Ed)};this.Zc=()=>{this.ocf()};this.dJi=()=>{this.Iwd&&Wa.a(fb.a.Ya,this.Iwd)<this.Vtf||(this.Iwd=fb.a.Ya.Zb,this.Rxd(),this.QFi(),this.AGi(),this.pwb||this.tyd(!1))};this.Gza=()=>{this.ocf();const Ed=
this.$u;for(let ee in Ed)this.a1a(Ed[ee])};this.yc=()=>{this.Rxd();this.pwb||this.tyd(!1);this.pwb=!1};this.dJf=()=>{const Ed=this.$u;for(let ee in Ed)Ed[ee].dispose();this.$u={};this.kEe();this.qbb={};this.lSc={};this.hy.length=0;this.YAc()};this.Sca=(Ed,ee)=>{this.NXd(ee.oh)};this.Y9c={};this.Sod={};this.qbb={};this.lSc={};this.$=Ua;this.gPa=Mc;this.Fn=Rb;this.Zke=sc;Ee.kOb=!0;Ee.Boa=!0;this.v6a();this.ry=new ae(Ua);this.$.ua&&this.$.ua.Yf(this.Gza);this.Fn.ipb(this.Sca);Ua.pa&&this.$.pa.jha(this.gDa);
this.hy=[];this.Fn.Z0a();Ua.da.Ha(25,this);this.pwb=!1;this.$.ij(this.yc);this.R_c=Ka.a.instance.GC(this.dJi,this.Vtf/2,Pa.a.$bj,!0,!1);this.LId=id}TGa(Ua){this.addHandler("pcek",Ua)}NAa(Ua){this.removeHandler("pcek",Ua)}get eL(){return this.Zke}get Dpa(){return this.$u}get ena(){return this.lSc}isAnonymousUser(Ua){var Rb,sc;return null===(sc=null===(Rb=this.Dpa[Ua])||void 0===Rb?void 0:Rb.lc)||void 0===sc?void 0:sc.IsAnonymous}nYf(Ua){this.Dpa[Ua]&&this.bYf(Ua,!1)}NXd(Ua){this.Ztb&&this.Ztb!==Ua.clientId&&
(this.YUd=!1);!Za.EwaSettings.isChangeGateEnabled("OfficeVSO:5657706_CorrectPresenceBootTelemetry")||this.$.ea.dMa&&We.PageLoadTrackingInfo.instance.BBj||(this.YUd=!1);this.eL.xbh(Ua);this.Ztb=Ua.clientId}h0h(Ua,Rb){let sc,Mc;sc=[];Mc=[];const id=this.Dpa;for(let Ed in id){const ee=id[Ed];if(Rb){const oe=Ba.k(Ua,this.$);this.T$e(oe,sc,Mc,ee)}else this.S$e(Ua,sc,Mc,ee)}return{Oni:sc,Qth:Mc}}KNe(Ua,Rb,sc,Mc,id){(id=this.Dpa[id])&&(Rb?this.T$e(Ua,sc,Mc,id):this.S$e(Ua,sc,Mc,id))}M$h(){const Ua=[],Rb=
this.Dpa;for(let id in Rb){var sc=Rb[id],Mc=sc.lc.SelectedRange;if(Mc)for(const Ed of Mc){Mc=Ba.E(Ed);const ee=lb.h(this.$).ha.ra.f4;if(this.$.ua.na.sheetName===Ed.SheetName&&Mc.right===ee.right&&Mc.top===ee.top){sc=sc.Am;sc=new Gb.a(sc.User.UserID,sc.User.UserName,sc.UserColor,new rb.a(1),null,sc.UserEmail,void 0,void 0,void 0,void 0,void 0,sc.JoinCoauthTime);Ua.push(sc);break}}}return Ua}VAc(){Ee.kOb=!0;Ee.Boa=!0;const Ua=this.$u;for(let Rb in Ua)Ua[Rb].VAc()}lgc(){Ee.kOb=!1;Ee.Boa=!1;const Ua=
this.$u;for(let Rb in Ua)Ua[Rb].lgc()}dispose(){this.LQb();this.$&&(this.$.ua&&this.$.ua.yg(this.Gza),this.$.pa&&this.$.pa.Hna(this.gDa),this.$.$k(this.yc));this.Fn&&this.Fn.Fvc(this.Sca);this.R_c&&(this.R_c.dispose(),this.R_c=null);if(this.$u){const Ua=this.$u;for(let Rb in Ua)Ua[Rb].dispose()}xb.a.sc([this.eL,this.ry]);this.kEe();this.$u=this.$=this.Zke=null;this.hy.length=0;super.dispose()}LQb(){this.eL&&(this.eL.NAa(this.UFd),this.eL.moj(this.DEf),this.eL.Kpj(this.dJf),this.eL.Sda(this.Zc));this.gPa.nZf(this.xHb)}nLe(Ua){return new He(Ua,
this.$,this.ry)}Zqe(Ua){const Rb=this.$.ea.fld(Ua);if(Rb)if(Ua in this.$u)this.$u[Ua].Ymg(Rb);else{const sc=this.nLe(Rb);this.$u[Ua]=sc;this.a1a(sc)}return!!Rb}T$e(Ua,Rb,sc,Mc){if(Ua)for(const id of Ua){if(id){if((Ua=$a(id,this.$,1))&&$e.hld(Ua.ej,Rb,sc,Mc))break;if((Ua=$a(id,this.$,2))&&$e.hld(Ua.ej,Rb,sc,Mc))break}if(Mc.lc.SelectedRange)for(const Ed of Mc.lc.SelectedRange)if(Ed&&id&&pa(id,Ed)){(1===Mc.lc.PresenceType?sc:Rb).push(Mc.aA.xRb.User);return}}}S$e(Ua,Rb,sc,Mc){Ua&&$e.hld(this.oZh(Ua),
Rb,sc,Mc)}gTg(Ua){Ua.SelectedRange&&(Ua.SelectedRangeRaw=this.lnh(Ua.SelectedRange),Ua.SelectedRange=this.gPa.cdh(Ua.SelectedRange))}lnh(Ua){const Rb=Array(Ua.length);for(let id=0;id<Ua.length;id++){var sc=id,Mc=Ua[id];const Ed={};Ed.SheetName=Mc.SheetName;Ed.FirstColumn=Mc.FirstColumn;Ed.FirstRow=Mc.FirstRow;Ed.LastRow=Mc.LastRow;Ed.LastColumn=Mc.LastColumn;Ed.NamedObjectName=Mc.NamedObjectName;Rb[sc]=Ed}return Rb}oZh(Ua){if(Ua)switch(Ua.type){case 0:return(Ua=this.$.Bb.U6e(Ua.id))?Ua.ej:null;case 2:return Ua.ej}return null}v6a(){this.eL.TGa(this.UFd);
this.eL.yRg(this.dJf);this.eL.CPg(this.DEf);this.eL.B2(this.Zc);this.gPa.Use(this.xHb)}quf(Ua,Rb,sc,Mc){const id={};id.a=this.$.ya.UserSessionId;id.b=Ua;id.c=sc?"PendingUserRemoved":"Non-PendingUserRemoved";id.d=Mc?"Disconnected":"Inactivity";id.e=Rb;Z.b().Ze(22,id,!0)}bYf(Ua,Rb){Ua in this.$u&&(this.lYf(Ua),this.$u[Ua].dispose(),delete this.$u[Ua],d.ULS.sendTraceTag(537154375,0,50,`PresenceView.RemovePresenceForUser: userId=[${Ua}] removed due to inactivity`),this.quf(Ua,fb.a.Ya.Zb,!1,Rb));Ua in
this.ena&&(this.anc(Ua,!1),delete this.qbb[Ua],delete this.ena[Ua],d.ULS.sendTraceTag(537154374,0,50,`PresenceView.RemovePresenceForUser: Pending userId=[${Ua}] removed due to inactivity`),this.quf(Ua,fb.a.Ya.Zb,!0,Rb))}lYf(Ua){for(let Rb=this.hy.length-1;0<=Rb;Rb--)if(this.hy[Rb].User.UserID===Ua){this.hy.splice(Rb,1);for(const sc of this.$u[Ua].qy)this.ry.loa(sc.Hu.Dy,!1);this.YAc()}}AGi(){if(this.A6b||this.B6b)this.$.Yc(-70383382,-1,0,null),d.ULS.sendTraceTag(537154373,0,50,`PresenceView.LogDiscontinuousCountPresenceData: Discontinuous Presence Received with count= [${this.B6b}], Continuous Presence Received with count= [${this.A6b}]`);
this.B6b=this.A6b=0}kEe(){this.Rxd();this.lSc=this.qbb=null}Rxd(){const Ua=this.ena;for(let Rb in Ua)this.anc(Rb,!1)}QFi(){var Ua=this.Y9c;for(let Rb in Ua)this.$tf(Rb,!0,Ua[Rb]);Ua=this.Sod;for(let Rb in Ua)this.$tf(Rb,!1,Ua[Rb]);this.Y9c={};this.Sod={}}anc(Ua,Rb){if(this.$.Dt&&this.$.ea.Yb){const sc={};sc.a=this.$.ya.UserSessionId;sc.b=Ua;sc.c=Rb;sc.e=!1;sc.d=-1;sc.f=fb.a.Ya.Zb;this.$.ea&&(sc.e=this.$.ea.AM);if(Ua=this.qbb[Ua])sc.d=Wa.a(fb.a.Ya,Ua);Z.b().Ze(20,sc,!0)}}tyd(Ua){if(this.$.Dt){const Rb=
{e:-1,f:-1,c:!1,d:!1};Rb.b=Ua;Rb.a=this.$.ya.UserSessionId;this.$.ea&&(Rb.c=this.$.ea.dMa,Rb.d=this.$.ea.AM,Rb.e=this.$.ea.Do.length,this.$.ea.lDa&&(Rb.f=Wa.a(fb.a.Ya,this.$.ea.obk)));Z.b().Ze(21,Rb,!0)}}$tf(Ua,Rb,sc){if(this.$.Dt){const Mc={};Mc.a=this.$.ya.UserSessionId;Mc.b=Ua;Mc.c=Rb;Mc.d=sc;Z.b().Ze(19,Mc,!0)}}ocf(){const Ua=[],Rb=this.$u;for(let sc in Rb){const Mc=Rb[sc];if(this.eL.g5f(Mc.lc)){this.Nre(Ua,Mc);Array.remove(this.hy,Mc.aA.xRb);if(1===this.eL.lc.PresenceType){const id={};id.a=1===
Mc.lc.PresenceType?"Editing":"Non-Editing";id.b=this.$.ya.UserSessionId;id.c=fb.a.Ya.Zb;Z.b().Ze(18,id)}for(const id of Mc.qy)this.ry.loa(id.Hu.Dy,!0)}else for(const id of Mc.qy)this.ry.loa(id.Hu.Dy,!1)}this.hy.length=0;this.hy=Ua;this.YAc()}Nre(Ua,Rb){const sc=Rb.aA.xRb;if(0===Rb.lc.PresenceType){Rb=Ua.length;let Mc;for(Mc=0;Mc<Rb&&0===this.$u[Ua[Mc].User.UserID].lc.PresenceType;Mc++);Ua.splice(Mc,0,sc)}else Ua.push(sc)}a1a(Ua){this.eL.g5f(Ua.lc)&&(this.Nre(this.hy,Ua),this.YAc());const Rb=Ua.aA.xRb.User.UserID,
sc=this.$u;for(let id in sc){var Mc=sc[id];id!==Rb&&Ua.a1a(Mc)}}YAc(){0<this.hy.length&&this.EPj()}EPj(){for(let Ua=0,Rb=this.hy.length;Ua<Rb;Ua++){const sc=this.$u[this.hy[Ua].User.UserID];if(sc)if(this.eL.cUf(sc.lc)){sc.Acg(!0);for(const Mc of sc.qy)this.ry.loa(Mc.Hu.Dy,!0)}else{const Mc=this.eL.a6e(sc.lc);Mc&&sc.Bcg(!0,Mc)}}}E3h(Ua){const Rb={User:{}};Rb.User.UserID=Ua;Rb.User.UserName=Ma.a.instance.nb(87);Rb.UserColor="#AAAAAA";return Rb}YFe(Ua,Rb){this.YUd&&this.LId&&(Ua&&Rb?this.KId?this.KId.Ivh(Ua,
Rb,this.Ztb):this.LId.continueWith(()=>{this.KId=this.LId.result;this.YFe(Ua,Rb)}):d.ULS.sendTraceTag(537154372,0,15,`userId: [${Ua}], endTime: [${Rb}]`))}static hld(Ua,Rb,sc,Mc){if(!Mc||!Mc.lc||!Mc.lc.Object)return!1;for(const id of Mc.lc.Object)if(Ua&&id&&id.ObjectId&&!id.ObjectId.localeCompare(Ua))return(1===id.ObjectPresenceType?sc:Rb).push(Mc.aA.xRb.User),!0;return!1}}Object(b.a)($e,"PresenceView",fa.a,[630,631]);var jf=a(231),gf=a(275),rf=a(33);class Mf extends fa.a{constructor(Ua){super();
this.statusBarManager=null;this.$=Ua;this.$.da.hb(29,Rb=>{this.statusBarManager=Rb;Rb.rJ(this)})}vq(Ua){this.addHandler("OSC",Ua)}Wq(Ua){this.removeHandler("OSC",Ua)}Az(){this.raiseEvent("OSC")}$r(Ua,Rb){if("QueryOcsConnectionStatus"===Ua)Ua=this.$.ea.V8a?Ma.a.instance.ga(924):Ma.a.instance.ga(925),rf.a.xn()?(Rb.LabelText=Ua,Rb.Visible=!0):Rb.Value=Ua;else return!1;return!0}yn(){return!0}dispose(){this.statusBarManager&&(this.statusBarManager.SF(this),this.statusBarManager=null);this.$=null;super.dispose()}}
Object(b.a)(Mf,"OcsStatusBarManager",fa.a,[3,368,213]);class Qa extends fa.a{constructor(Ua,Rb){super();this.ihg=this.$Pb=this.oh=null;this.vhb=this.K5f=!1;this.Bn=()=>{this.$&&this.SRd(0,!1)};this.Di=()=>{this.PZd?this.$Pb(!1):(this.lc.PresenceType=1,this.raiseEvent(Qa.z0),this.sendPresenceToService(!1))};this.dg=()=>{this.PZd?this.ihg(!1):(this.deb(!1),this.ORd())};this.dFf=()=>{this.ha.Sa.jc?this.SRd(1,!1):this.YRd(0,!1)};this.Tma=(sc,Mc)=>{this.raiseEvent(Qa.MId,Mc)};this.Zc=()=>{this.YRd(lb.h(this.$).eb?
1:0,!1)};this.Wc=(sc,Mc)=>{jf.a(Mc)&&(this.Lra={})};this.xHb=()=>{this.r5f()};this.EMf=(sc,Mc)=>{if(Mc&&Mc.methodName in Qa.Xsc){sc=!1;switch(Qa.Xsc[Mc.methodName]){case 0:Mc=Mc.parameters.cell;break;case 1:Mc=Mc.parameters.parameters.Location;break;case 2:Mc=Ba.v(this.ha.ra.activeRange,this.$);sc=!0;break;default:return}Mc.LastColumn=Mc.FirstColumn;Mc.LastRow=Mc.FirstRow;Mc.NamedObjectName=null;this.lc.SelectedRange=[Mc];this.lc.PresenceType=0;if(sc){Mc=[];for(var id of this.$.Bb.i2h())sc={},sc.ObjectType=
this.pba(id.type),sc.ObjectPresenceType=1,sc.ObjectId=id.ej,Mc.push(sc);this.lc.Object=Mc}else id=$a(Mc,this.$,1),Mc=null,id&&(Mc={},Mc.ObjectType=this.pba(id.type),Mc.ObjectPresenceType=0,Mc.ObjectId=id.ej),this.lc.Object=[Mc];this.raiseEvent(Qa.z0);this.sendPresenceToService(!1)}};this.zm=(sc,Mc)=>{Mc.context.methodName in Qa.Xsc&&(this.lc.Object=[null],this.deb(!1))};this.nh=(sc,Mc)=>{Mc.context.methodName in Qa.Xsc&&(this.lc.Object=[null],this.deb(!1))};this.od=(sc,Mc)=>{Mc.jN||(this.Lra={},this.$.Dt?
this.v6a():this.LQb())};this.yc=()=>{this.ORd()};this.Jpf=()=>{this.r5f();this.UAf.Az()};this.$=Ua;this.ha=lb.h(this.$).ha;this.gPa=Rb;this.$.hl(this.od);this.$.ij(this.yc);this.Lra={};this.YXa=new Gb.a(null,null,null,null);this.pBa={};this.pBa.b=0;this.pBa.c=0;this.UAf=new Mf(this.$);if(this.PZd=Za.EwaSettings.vb())this.$Pb=gf.b(sc=>{this.lc.PresenceType=1;this.raiseEvent(Qa.z0);this.sendPresenceToService(sc)},40,this.$.ka,"SelectionPresenceManager.SendPresenceToService",!0),this.ihg=gf.b(sc=>{this.deb(sc);
this.ORd()},40,this.$.ka,"SelectionPresenceManager.SendCurrentPresence",!0);this.K5f=Za.EwaSettings.isChangeGateEnabled("OfficeVSO:6331623_ProcessShapeFOPresence");this.vhb=Za.EwaSettings.isChangeGateEnabled("OfficeVSO:7554748_UseIsAnonymousForPresenceUserV2")}TGa(Ua){this.addHandler(Qa.MId,Ua)}NAa(Ua){this.removeHandler(Qa.MId,Ua)}CPg(Ua){this.$.ea.T9(Ua)}moj(Ua){this.$.ea.c7(Ua)}B2(Ua){this.addHandler(Qa.z0,Ua)}Sda(Ua){this.removeHandler(Qa.z0,Ua)}yRg(Ua){this.addHandler(Qa.NId,Ua)}Kpj(Ua){this.removeHandler(Qa.NId,
Ua)}get lc(){return this.Lra}get amIAlone(){return!this.$.ea||this.$.ea.amIAlone}dispose(){this.$&&(this.LQb(),this.$.em(this.od),this.$.$k(this.yc));this.oh&&this.oh.sRa(this.Tma);xb.a.Ja(this.UAf);this.$=this.oh=null;super.dispose()}xbh(Ua){this.oh?this.oh.sRa(this.Tma):this.v6a();(this.oh=Ua)?(this.oh.SZa(this.Tma),this.deb(!0)):this.LQb()}v6a(){this.ha.jC(this.Zc);lb.h(this.$).uE(this.Bn);var Ua=lb.h(this.$).Xb;Ua.rm(this.dg);Ua.gl(this.Di);this.$.ea.Oj(this.Wc);this.$.ea.Gse(this.Jpf);this.gPa.Use(this.xHb);
Ua=this.$.pa.va;Ua.UGa(this.EMf);Ua.kr(this.nh);Ua.Ax(this.zm);this.$.da.hb(16,Rb=>{Rb.QPg(this.dFf);Rb.PPg(this.dg)})}LQb(){this.ha.xB(this.Zc);lb.h(this.$).VF(this.Bn);const Ua=lb.h(this.$).Xb;Ua.dm(this.dg);Ua.Zk(this.Di);this.$.ea.pk(this.Wc);this.$.ea.bZf(this.Jpf);this.gPa.nZf(this.xHb);this.$.pa.va.tRa(this.EMf);this.$.pa.va.zs(this.nh);this.$.pa.va.uy(this.zm);this.$.da.hb(16,Rb=>{Rb.voj(this.dFf);Rb.uoj(this.dg)});this.raiseEvent(Qa.NId)}g5f(Ua){return this.cUf(Ua)||!!this.a6e(Ua)}cUf(Ua){if(2===
this.lc.Version&&this.lc.Object&&2===Ua.Version&&Ua.Object&&0<this.lc.Object.length&&0<Ua.Object.length){var Rb=this.lc.Object.length,sc=Ua.Object.length;for(var Mc=0;Mc<Rb;Mc++)for(var id=0;id<sc;id++)if(this.x_c(this.lc.Object[Mc],Ua.Object[id]))return!0}if(this.lc.SelectedRange&&Ua.SelectedRange)for(Rb=this.lc.SelectedRange.length,sc=Ua.SelectedRange.length,Mc=0;Mc<Rb;Mc++)for(id=0;id<sc;id++)if(Qa.qWg(this.lc.SelectedRange[Mc],Ua.SelectedRange[id]))return!0;return!1}a6e(Ua){if(2===this.lc.Version&&
this.lc.Object&&2===Ua.Version&&Ua.Object&&0<this.lc.Object.length&&0<Ua.Object.length){const Rb=this.lc.Object.length,sc=Ua.Object.length;for(let Mc=0;Mc<Rb;Mc++)for(let id=0;id<sc;id++)if(Qa.vRi(this.lc.Object[Mc],Ua.Object[id]))return this.lc.Object[Mc].ObjectId}return null}x_c(Ua,Rb){return!!Ua&&!!Rb&&Ua.ObjectType===Rb.ObjectType&&(1===Ua.ObjectType||3===Ua.ObjectType)&&!!Ua.ObjectId&&!!Rb.ObjectId&&!Ua.ObjectId.localeCompare(Rb.ObjectId)}r5f(){this.deb(!1)}deb(Ua){this.ha.Sa.jc?this.SRd(0,Ua):
this.YRd(lb.h(this.$).Xb.eb?1:0,Ua)}SRd(Ua,Rb){var sc={};this.$.Sj(sc);var Mc=this.ha.Sa.jc;if(Mc){const id=Mc.floatingObject;sc.FirstColumn=-1;sc.FirstRow=-1;sc.LastColumn=-1;sc.LastRow=-1;sc.NamedObjectName=id?id.Mg():null;this.lc.SelectedRange=[sc];this.lc.PresenceType=0;sc=null;if(this.K5f){if(null===id||void 0===id?0:id.id)sc={ObjectType:this.l4h(id.type),ObjectPresenceType:Ua,DialogType:0,ObjectId:Mc.ej}}else if(id)switch(id.type){case 0:if(Mc=this.$.Bb.U6e(id.id))sc={},sc.ObjectType=this.pba(0),
sc.ObjectPresenceType=Ua,sc.ObjectId=Mc.ej;break;case 2:id.id&&(sc={},sc.ObjectType=this.pba(9),sc.ObjectPresenceType=Ua,sc.ObjectId=id.ej)}this.lc.Object=[sc]}this.raiseEvent(Qa.z0);this.sendPresenceToService(Rb)}YRd(Ua,Rb){if(!lb.h(this.$).eb&&!lb.h(this.$).ei){const Mc=this.$.Mb.vg("ModelUpdate","SendRangePresence");Mc.start();var sc=Ba.k(this.ha.ra.selectedRanges,this.$);this.lc.SelectedRange=this.gPa.bdh(sc);this.lc.Object=[];for(const id of sc)if(sc=$a(id,this.$,1)){const Ed={};Ed.ObjectType=
this.pba(sc.type);Ed.ObjectPresenceType=0;Ed.ObjectId=sc.ej;this.lc.Object.push(Ed)}this.lc.PresenceType=Ua;this.raiseEvent(Qa.z0);this.lc.SelectedRange||this.lc.Object?this.sendPresenceToService(Rb):d.ULS.sendTraceTag(537154371,0,50,`SelectionPresenceManager.SendRangePresence: skip sending range presence since selected range/object are both null.  UserId: [${this.oh.clientId}]`);Mc.stop()}}sendPresenceToService(Ua){if(this.$.ea.X9b||!this.$.ea.Q5b||Ua)if(this.amIAlone||++this.pBa.b,this.oh){this.lc.Version=
2;this.lc.ClientType=1;this.lc.ChatThreadId=this.YXa.p3c;this.lc.ChatThreadDiscoveryUri=this.YXa.o3c;this.lc.InChat=this.YXa.qAb;this.lc.Cid=this.YXa.email;this.lc.SupportsChat=!!this.YXa.capabilities&&this.YXa.capabilities.$La(4);this.lc.CollabMode=this.$.ea.V8a?2:0;this.lc.OcsCapable=this.$.ea.ocsCapable;this.vhb&&(this.lc.IsAnonymous=k.AFrameworkApplication.userNameUnknown||k.AFrameworkApplication.limitedEdit);this.oh.H5f(this.lc);if(Za.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&
this.$.ea&&this.$.ea.dMa){const Rb=(new Date).getTime();ya.TaskExtensions.za(ba.GetServiceTaskFactory.Pa(this.$.da,435,436,1),sc=>{sc.result.$Hi(Rb)},this.$.ka,3)}this.amIAlone||++this.pBa.c}}ORd(){this.$.Dt&&(this.pBa.a=this.$.ya.UserSessionId,Z.b().Ze(26,this.pBa,!0));this.pBa.b=0;this.pBa.c=0}l4h(Ua){switch(Ua){case 0:return 0;case 2:return 2;case 5:return 5;default:return-1}}pba(Ua){switch(Ua){case 0:return 0;case 1:return 1;case 2:return 3;case 9:return 2;default:return-1}}static get Xsc(){return Qa.yie||
(Qa.yie={["ApplyFilter"]:1,["ApplyPivot"]:0,["ApplyPivotSort"]:0,["ApplyPivotSortByValue"]:1,["ApplyWellKnownPivotFilter"]:0,["RemovePivotFilter"]:0,["SetCustomFilter"]:1,["SetTop10Filter"]:1,["TogglePivotDrill"]:0,["RefreshAll"]:2})}static vRi(Ua,Rb){return!!Ua&&!!Ua.ObjectId&&!!Rb&&!!Rb.ObjectId&&(0===Ua.ObjectType||2===Ua.ObjectType)&&Ua.ObjectType===Rb.ObjectType&&!Ua.ObjectId.localeCompare(Rb.ObjectId)}static qWg(Ua,Rb){return!Ua.NamedObjectName&&pa(Ua,Rb)}}Qa.MId="presenceChanged";Qa.NId="presenceDisabled";
Qa.z0="selectionChanged";Qa.yie=null;Object(b.a)(Qa,"SelectionPresenceManager",fa.a,[653,3,654]);var Zb=a(108),nb=a(70);class Tb extends ab.a{constructor(Ua){super();this.manager=null;this.$=Ua;this.Gb()}create(){this.manager?this.qb(this.manager):ya.TaskExtensions.za(Object(nb.b)("OfficeVSO:7624673_NamedSheetViewConversionManagerService")?Object(Zb.c)(ib.a.resolve(cb.y,{Wb:this.Na})):ba.GetServiceTaskFactory.create(this.$.da,28,this.ka,this.Na),Ua=>{this.qb(this.manager||(this.manager=new Qa(this.$,
Ua.result)))},this.ka,3)}}Object(b.a)(Tb,"SelectionPresenceManagerFactory",ab.a,[]);var qb=a(1293),Kb=a(5),jc=a(200);class Ac extends Na.a{constructor(Ua,Rb,sc){super();this.CQa=this.OId=null;this.EHb=(Mc,id)=>{if(id.vL){Mc=[];const ee=[];var Ed=lb.h(this.$).ha;const oe=!(2===Ed.Oe||128===Ed.Oe);Ed=oe?Ba.k(Ed.ra.selectedRanges,this.$):Ed.Sa.jc.floatingObject;id=id.vL;for(let mf in id)this.presenceView.KNe(Ed,oe,Mc,ee,mf);for(const mf of this.eJa)Mc.includes(mf)||ee.includes(mf)||this.presenceView.KNe(Ed,
oe,Mc,ee,mf.UserID);this.eJa=[];this.eJa.push(...Mc);this.eJa.push(...ee);this.OId&&(xb.a.Ja(this.CQa),this.OId=this.CQa=null);const Xe=Ac.nAe(Mc,ee);this.CQa=new jc.a;this.OId=ya.TaskExtensions.za(m.Task.delay(1),()=>{this.ariaLiveNotifier.vcb(Xe,Kb.a.uHa)},this.CQa.token,3)}};this.$=Rb;this.ariaLiveNotifier=Ua;this.presenceView=sc;this.eJa=[];sc.TGa(this.EHb);this.$.da.Ha(231,this)}b6e(Ua,Rb){this.eJa=[];({Oni:Ua,Qth:Rb}=this.presenceView.h0h(Ua,Rb));this.eJa.push(...Ua);this.eJa.push(...Rb);return Ac.nAe(Ua,
Rb)}dispose(){this.presenceView.NAa(this.EHb);this.CQa&&(xb.a.Ja(this.CQa),this.CQa=null);super.dispose()}static nAe(Ua,Rb){if(!Ua.length&&!Rb.length)return"";if(Rb.length){if(1===Rb.length)return Ua=Ma.a.instance.nb(83),String.format(Ua,Rb[0].UserName);Ua=Ma.a.instance.nb(84);return String.format(Ua,Rb.length)}if(1===Ua.length)return Rb=Ma.a.instance.nb(85),String.format(Rb,Ua[0].UserName);Rb=Ma.a.instance.nb(86);return String.format(Rb,Ua.length)}}Object(b.a)(Ac,"PresenceReadoutHandlerService",
Na.a,[629]);const Jc=(Ua,Rb,sc,Mc,id,Ed,ee,oe=null)=>{oe=Ua.Oa(1,oe);oe.Id=Rb;oe.OnBehalfOfOcs=sc;return La.g(Ua,"CheckPersistedContentUpdate",oe,Mc,id,Ed,ee,516)},hd=(Ua,Rb,sc,Mc,id,Ed,ee=null)=>{ee=Ua.Oa(1,ee);ee.updateInfo=Rb;return La.g(Ua,"BatchCheckCollabServiceContent",ee,sc,Mc,id,Ed,516)},Cd=(Ua,Rb,sc,Mc,id,Ed,ee,oe=null)=>{oe=Ua.Oa(1,oe);oe.clientIdsToAdd=Rb;oe.clientIdsToRemove=sc;return La.g(Ua,"UpdatePresenceUsers",oe,Mc,id,Ed,ee,0)},ac=(Ua,Rb,sc,Mc,id,Ed=null)=>{Ed=Ua.Oa(1,Ed);return La.g(Ua,
"CheckWorkbookFileNameUpdate",Ed,Rb,sc,Mc,id,0)},Lc=(Ua,Rb,sc,Mc,id,Ed,ee,oe=null)=>{oe=Ua.Oa(1,oe);oe.GenerateNotifications=Rb;oe.DownloadNotifications=sc;return La.g(Ua,"UploadLatencyTelemetry",oe,Mc,id,Ed,ee,128)};class rd{constructor(Ua){this.$=Ua}cgd(Ua){return Ua}IHd(Ua){const Rb=Array(Ua.nIa.count);let sc=0;for(let Mc of Ua.nIa.values)Rb[sc]=Mc,sc++;return hd(this.$.pa.va,Rb,Ua.Tt,Ua.Taa,null,null)}KZc(Ua,Rb){if(!Rb)return Ua;if(!Ua)return d.ULS.shipAssertTag(537154136,0,!!Ua,"CheckCollabServiceActionAggregationPerformer.AggregateActionParameters: Received null newActionParameters"),
Rb;d.ULS.shipAssertTag(537154135,0,1===Ua.nIa.count,"CheckCollabServiceActionAggregationPerformer.AggregateActionParameters: newActionParameters has unexpected number of entries");for(let sc of Ua.nIa){let Mc;({value:Mc}=Rb.nIa.Ic(sc.key)).returnValue?Mc.OcsSessionId!==sc.value.OcsSessionId?(d.ULS.sendTraceTag(537154134,0,15,`CheckCollabServiceActionAggregationPerformer.AggregateActionParameters: Found nonidentical OcsSessionIds. new SeqNum: ${sc.value.SeqNum}, aggregated SeqNum: ${Mc.SeqNum}`),Rb.nIa.ia(sc.key,
sc.value.SeqNum<Mc.SeqNum?sc.value:Mc),Rb.Tt=sc.value.SeqNum<Mc.SeqNum?Ua.Tt:Rb.Tt):(sc.value.SeqNum>Mc.SeqNum&&Rb.nIa.ia(sc.key,sc.value),Rb.Tt=Ua.Tt):(Rb.nIa.add(sc.key,sc.value),Rb.Tt=Ua.Tt)}return Rb}}Object(b.a)(rd,"CheckCollabServiceActionAggregationPerformer",null,[634,635]);class Yd{constructor(Ua){this.$=Ua}cgd(Ua){return Ua}IHd(Ua){return Jc(this.$.pa.va,Ua.qmh,Ua.Mpc,Ua.Tt,null,null,null)}KZc(Ua,Rb){if(!Rb)return Ua;if(!Ua)return d.ULS.shipAssertTag(537154133,0,!1,"CheckPersistedActionAggregationPerformer.AggregateActionParameters: Received null newActionParameters"),
Rb;Ua.Mpc=Rb.Mpc&&Ua.Mpc;return Ua}}Object(b.a)(Yd,"CheckPersistedActionAggregationPerformer",null,[634,635]);class ie{}Object(b.a)(ie,"RevisionGeneratedNotification",null,[]);class Je{}Object(b.a)(Je,"StateDownloadedNotification",null,[]);var ff=a(187);class Ae extends Na.a{constructor(Ua){super();this.mergeSuspensionManager=this.We=null;this.Lxa=!1;this.zHd=null;this.uCc=this.tCc=this.vCc=this.Ld=!1;this.THb=(Rb,sc)=>{this.Lxa!==sc.Lxa&&(this.zHd=(this.Lxa=sc.Lxa)?null:fb.a.Ya.Zb)};this.od=()=>
{this.$.Dt&&this.uUj()};this.Wc=(Rb,sc)=>{sc.Yb||this.pr(Rb,sc)};this.pr=()=>{if(0<this.aBa.length||0<this.Bea.count)d.ULS.sendTraceTag(537154128,13,15,`Dropping ${this.aBa.length} revisionGeneratedNotifications and ${this.Bea.count} stateDownloadedNotifications.`),this.aBa=[],this.Bea=new ff.a;this.Cqb.cancel();this.nlg();this.j1d();this.o3j()};this.EJf=(Rb,sc)=>{this.sUj();this.tUj();Rb=new ie;Rb.Xluid=sc.ej;Rb.NotificationReceivedOn=fb.a.Ya.Zb.toISOString();Rb.CurrentPresenceUserCount=this.$.ea.Do.length;
Rb.OurCollabModeIsUsingOcs=this.$.ea.V8a;Rb.SenderCollabMode=sc.TAj;Rb.SenderClientType=sc.SAj;Rb.SessionSiteIdentifier=sc.s7;Rb.CommandTimeInMs=sc.x$g;d.ULS.sendTraceTag(537154127,13,50,`ContentLatencyTracker.OnRemoteRevisionGenerated: RevisionGeneratedNotification: ${JSON.stringify(Rb)}`);this.aBa.push(Rb)};this.Ej=()=>{this.RIe(this.$.ea.se,"OnBlockCacheConsistent")};this.IJf=(Rb,sc)=>{(Rb=Object(l.a)(637,sc.je))&&this.RIe(Rb.zE,"OnRenderedContent")};this.a8j=()=>{if(!this.$.ea.Yb)d.ULS.sendTraceTag(537154122,
13,15,"ContentLatencyTracker.UploadLatencyTelemetryPeriodically: session isn't active");else if(this.aBa.length||this.Bea.count){var Rb=null;0<this.aBa.length&&(Rb=this.aBa,this.aBa=[]);var sc=null;if(0<this.Bea.count){sc=Array(this.Bea.count);let Mc=0;for(let id of this.Bea.values)sc[Mc++]=id;this.Bea=new ff.a}d.ULS.sendTraceTag(537154120,13,100,`ContentLatencyTracker.UploadLatencyTelemetryPeriodically: Uploading ${Rb?Rb.length:0} revisionGeneratedNotifications and ${sc?sc.length:0} stateDownloadedNotifications.`);
Lc(this.$.pa.va,Rb,sc,this.x5i,null,null,null)}};this.x5i=Rb=>{Rb.Result&&0<Rb.Result&&this.aAd()};this.$=Ua;this.Ca=lb.h(this.$).Ca;this.viewport=lb.h(this.$).view;this.contentRefreshManager=this.$.da.Ba(292);this.Xe=this.$.Xe;this.aBa=[];this.Bea=new ff.a;this.Cqb=Ka.a.instance.GC(this.a8j,3E4,Pa.a.bch,!1,!1);this.$.hl(this.od);this.$.ea.Oj(this.Wc);this.$.ea.eZc(this.pr);this.$.da.hb(291,Rb=>{this.We=Rb});this.$.da.hb(343,Rb=>{this.Ld||(this.mergeSuspensionManager=Rb,this.mergeSuspensionManager.a1b(this.THb),
this.mergeSuspensionManager.IJb())});d.ULS.sendTraceTag(537154131,13,50,"ContentLatencyTracker initialized");this.od(this.$,null)}dispose(){this.Ld=!0;this.Cqb&&(this.Cqb.dispose(),this.Cqb=null);this.contentRefreshManager&&(this.nlg(),this.contentRefreshManager=null);this.Ca&&(this.j1d(),this.Ca=null);this.viewport&&(this.j1d(),this.viewport=null);this.Xe&&(this.Xe=null);this.$&&(this.$.em(this.od),this.$.ea.pk(this.Wc),this.$.ea.yZf(this.pr),this.$=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.dwc(this.THb),
this.mergeSuspensionManager=null);super.dispose()}uUj(){this.vCc||(this.contentRefreshManager.HRg(this.EJf),this.vCc=!0,this.Cqb.$p())}nlg(){this.vCc&&(this.contentRefreshManager.Qpj(this.EJf),this.vCc=!1)}sUj(){this.tCc||(this.Ca.dw(this.Ej),this.tCc=!0)}j1d(){this.tCc&&(this.Ca.Xw(this.Ej),this.tCc=!1)}tUj(){this.uCc||(this.viewport.IRg(this.IJf),this.uCc=!0)}o3j(){this.uCc&&(this.viewport.Tpj(this.IJf),this.uCc=!1)}RIe(Ua,Rb){if(Ua!==oa.a.re&&!this.Bea.kb(Ua)){var sc=fb.a.Ya.Zb.toISOString();sc=
Object(eb.a)(new Je,{StateId:Ua,DownloadedOn:sc,IsHidden:this.We?this.We.oi:"visible"!==window.document.visibilityState,DocumentLastUnhidden:this.We&&this.We.Wlc?this.We.Wlc.toISOString():null,LastLostRtcConnection:this.contentRefreshManager&&this.contentRefreshManager.srf?this.contentRefreshManager.srf.toISOString():null,LastOffline:this.Xe&&this.Xe.jya?this.Xe.jya.toISOString():null});this.mergeSuspensionManager&&(sc.IsPendingMergeBlockedByClient=this.Lxa,this.zHd&&(sc.PendingMergeBlockedByClientLastEnded=
this.zHd.toISOString()));d.ULS.sendTraceTag(537154124,13,50,`ContentLatencyTracker.CreateAndAddstateDownloadedNotifications: ${Rb} - StateDownloadedNotification: ${JSON.stringify(sc)}`);this.Bea.add(Ua,sc)}}aAd(){k.AFrameworkApplication.gf&&k.AFrameworkApplication.gf.aAd()}}Object(b.a)(Ae,"ContentLatencyTracker",Na.a,[]);var pf=a(903);class he{}Object(b.a)(he,"UpdateInfo",null,[]);var Va=a(904);class bc extends Sys.EventArgs{constructor(Ua,Rb,sc,Mc,id){super();this.ej=Ua;this.TAj=Rb;this.SAj=sc;this.s7=
Mc;this.x$g=id}}Object(b.a)(bc,"RevisionGeneratedEventArgs",Sys.EventArgs,[]);class yc{constructor(Ua,Rb,sc,Mc){this.XFc=this.Dtc=this.Msc=this.Ggc=0;this.Yce=this.Fif=!1;this.clientId=Ua;this.bmh=Rb;this.$=Mc;this.VIi=db.a.Yd()+sc}get jmf(){return this.Yce}m6j(){this.Dtc||(this.Dtc=db.a.Yd(),this.MEb())}j6j(){this.Ggc||(this.Ggc=db.a.Yd(),this.MEb())}l6j(){this.Msc||(this.Msc=db.a.Yd(),this.MEb())}n6j(Ua){this.XFc||(this.XFc=db.a.Yd(),this.Fif=Ua,this.MEb())}MEb(Ua=0){this.jmf||(Ua&&Ua>this.VIi?
this.xK(!0):this.Dtc&&this.Msc&&this.Ggc&&this.XFc&&this.xK(!1))}dispose(){this.$=null}xK(Ua){const Rb={};Rb.CoAuthorsCount=this.$.ea.Do.length;Rb.HostNotificationTime=this.Ggc;Rb.PeerNotificationTime=this.Msc;Rb.PresenceNotificationTime=this.Dtc;Rb.UserFetchTime=this.XFc;Rb.IsAlreadyFetchedFromServer=this.Fif;Rb.IsTimeout=Ua;Rb.ClientId=this.clientId;Rb.CurrentUserClientId=this.bmh;Za.EwaSettings.isChangeGateEnabled("OfficeVSO:6875242_useStringLiteralToPrintJsonObjectInLogs")?d.ULS.sendTraceTag(541388879,
0,50,`Host Notification Latency Entry: ${JSON.stringify(Rb)}`):d.ULS.sendTraceTag(541388879,0,50,"Host Notification Latency Entry: {0}",Rb);this.Yce=!0}}Object(b.a)(yc,"HostNotificationLatencyEntry",null,[3]);class Hc{constructor(Ua,Rb,sc){this.qmh=Ua;this.Mpc=Rb;this.Tt=sc}}Object(b.a)(Hc,"PersistedContentUpdateActionParameters",null,[]);class Zc{constructor(Ua,Rb,sc){this.RJc={};this.SJc={};this.Tt=sc;this.S1b(Ua,this.RJc);this.S1b(Rb,this.SJc)}get h4c(){return ye.a(this.RJc)}get i4c(){return ye.a(this.SJc)}get Zkf(){return!this.h4c.length&&
!this.i4c.length}p2j(Ua){this.S1b(Ua.h4c,this.RJc);this.S1b(Ua.i4c,this.SJc)}S1b(Ua,Rb){if(Ua)for(const sc of Ua)Rb[sc]=!0}}Object(b.a)(Zc,"UpdatePresenceUsersActionParameters",null,[]);class Sd extends fa.a{constructor(Ua,Rb,sc,Mc,id){super();this.oh=null;this.BCd=!1;this.yee=this.currentUserId=this.Xnd=null;this.AFd=(Ed,ee)=>{if(ee.vL){Ed=ee.vL;for(let oe in Ed)(Ed=oe)&&Ed!==this.currentUserId&&!this.d1a.has(Ed)&&this.eec(Ed).m6j()}};this.oB=()=>{this.JVf()};this.eda=(Ed,ee)=>{this.BCd=!0;Ed=Object(l.a)(Object,
ee.d8);if(1===ee.type){var oe=Za.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",!1);if(null===Ed||void 0===Ed?0:Ed[oa.a.Bhi]){if(!oe||!Object(l.a)(String,Ed[oa.a.Wef]))return;var Xe=this.YHe(Object(l.a)(String,Ed[oa.a.Wef]));Object(l.a)(String,Ed[oa.a.Xef])===oa.a.zhi?(Xe=[Xe],Xe[0]===this.currentUserId||this.d1a.has(Xe[0])||this.eec(Xe[0]).j6j(),this.nag(Xe)&&this.ohb(Xe,null)):Object(l.a)(String,Ed[oa.a.Xef])===oa.a.Ahi&&Xe!==this.currentUserId&&this.ohb(null,
null)}else{ee=Array.isArray(ee.d8)?ee.d8:null;!ee&&Ed&&(ee=Array.isArray(Ed[oa.a.vQe])?Ed[oa.a.vQe]:null);if(ee&&oe)for(Xe of ee)Xe===this.currentUserId||this.d1a.has(Xe)||this.eec(Xe).l6j();ee&&!this.nag(ee)||this.ohb(ee,null);return}}if(Ed)if(0===ee.type)({qVf:Xe}=this.jqb(Ed)).returnValue?(this.GPa(Ed),oa.a.se in Ed&&(this.$.ea.lX(Ed[oa.a.se],"ContentRefreshManager.OnUpdateNotificationReceived"),this.Glg())):d.ULS.sendTraceTag(22905367,0,50,`RTC ContentUpdate session identifier mismatch. Received: ${Xe}. Expected: ${this.$.ea.s7}. Ignoring this update.`);
else{if(3===ee.type){if(!(oa.a.I2f in Ed)){d.ULS.sendTraceTag(537154117,13,10,"RTC WetContentUpdate does not specify a type. Ignoring this update.");return}ee=Ed[oa.a.I2f];ee===oa.a.lwj?this.bei(Ed):ee!==oa.a.jwj&&ee!==oa.a.nwj&&ee!==oa.a.owj&&ee!==oa.a.mwj&&ee!==oa.a.kwj&&d.ULS.sendTraceTag(537154081,13,50,`RTC WetContentUpdate of unknown type ${ee}. Ignoring this update.`);return}if(4===ee.type){Xe=!1;oa.a.aPf in Ed&&(Xe=Ed[oa.a.aPf]);if(this.jqb(Ed).returnValue)return;this.$.ea.nri()&&this.a7g();
if(this.$.ea.V8a&&Xe)return;oe=Ed[oa.a.H9i];this.$.ea.Yb&&oe&&this.G9i.XOf(new Hc(oe,Xe,this.VCf))}else if(8===ee.type){if(this.vnj)return;let mf=0;const wf=Ed[oa.a.hwj],Kf=Ed[oa.a.fwj],af=Ed[oa.a.gwj];oa.a.J2f in Ed&&(mf=Ed[oa.a.J2f]);this.$.ea.Yb&&wf&&(Xe=Object(eb.a)(new he,{OcsSessionId:wf,ClientId:Kf&&Za.EwaSettings.isChangeGateEnabled("OfficeVSO:5544917_HookUpRevisionTrackerOnXLO")?Kf:"",SeqNum:af,XrevidSaved:mf}),oe=Array(1),oe[0]=Xe,hd(this.$.pa.va,oe,this.VCf,()=>{d.ULS.sendTraceTag(537154080,
0,10,`BatchCheckCollabServiceContent failed. OcsSessionId: ${wf}, ClientId: ${Kf}, SeqNum: ${af}, XrevidSaved: ${mf}`)},null,null))}}2===ee.type?Ed&&this.jqb(Ed).returnValue||(d.ULS.sendTraceTag(537154079,0,50,"RTC : FileNameUpdate received. Now invoking CheckWorkbookFileNameUpdate web method"),ac(this.$.pa.va,null,null,null,null)):12!==ee.type||Ed&&this.jqb(Ed).returnValue||this.raiseEvent("LabelUpdateEventKey")};this.VCf=Ed=>{var ee=Ed.Errors;bb.a.wq(ee)?(ee=bb.a.Oz(ee,[1552731907],"ContentRefreshManager"),
bb.a.sha(ee)||this.$.ea.$n(ee)):(ee=Ed.StateId+1,Ed.Result&&this.$.ea.se<ee&&this.$.ea.lX(oa.a.re,"ContentRefreshManager.OnCheckForUpdateSuccess"))};this.nh=()=>{this.bwj&&this.BCd&&this.$.ea.X9b&&this.Glg()};this.FDf=()=>{this.BCd=!1;this.$.ea.mea=500;this.yee=fb.a.Ya.Zb};this.Sca=(Ed,ee)=>{this.NXd(ee.oh)};this.$=Ua;this.Fn=Rb;this.$.pa.kr(this.nh);this.Fn.ipb(this.Sca);this.Fn.fse(this.FDf);this.G9i=Mc;this.H6j=id;this.oMa={};this.d1a=new Set;this.Fn.Z0a();Za.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",
!1)&&(this.currentUserId=this.$.workbookContext.ClientId,this.JVf(),this.$.ea.T9(this.oB));this.vnj=Za.EwaSettings.isChangeGateEnabled("OfficeVSO:6195367_RemoveWebRequestsForCollabServiceContentUpdates")}HRg(Ua){this.addHandler("ekcrmrrg",Ua)}Qpj(Ua){this.removeHandler("ekcrmrrg",Ua)}PZa(Ua){this.addHandler("ekcrmmcu",Ua)}gdb(Ua){this.removeHandler("ekcrmmcu",Ua)}AQg(Ua){this.addHandler("LabelUpdateEventKey",Ua)}Zoj(Ua){this.removeHandler("LabelUpdateEventKey",Ua)}get srf(){return this.yee}get bwj(){return!!this.oh&&
2===this.oh.connectionState}ohb(Ua,Rb){this.$.ea.Yb&&(d.ULS.sendTraceTag(39150978,0,50,`ContentRefreshManager.UpdatePresenceUsers: clientIdsToAdd=[${Ua?Ua.join(","):"null"}] clientIdsToRemove=[${Rb?Rb.join(","):"null"}]`),this.H6j.XOf(new Zc(Ua,Rb,null)))}dispose(){this.oh&&(this.oh.dLb(this.eda),this.oh.sRa(this.AFd));this.$&&(this.$.pa.zs(this.nh),this.$.ea.c7(this.oB));this.Fn&&(this.Fn.Fvc(this.Sca),this.Fn.HYf(this.FDf));this.$=this.oh=this.d1a=this.oMa=null;super.dispose()}NXd(Ua){this.oh&&
(this.oh.dLb(this.eda),this.oh.sRa(this.AFd));this.oh=Object(l.a)(247,Ua);this.oh.UZa(this.eda);Za.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",!1)&&this.oh.SZa(this.AFd);this.currentUserId=this.oh.clientId}JVf(){const Ua=!this.oh;var Rb=this.$.ea.Do;for(const sc of Rb)(Rb=sc.User.UserID)&&Rb!==this.currentUserId&&!this.d1a.has(Rb)&&this.eec(Rb).n6j(Ua)}bei(Ua){if(oa.a.H2f in Ua&&oa.a.G2f in Ua&&oa.a.F2f in Ua){var Rb=Ua[oa.a.F2f];1!==Rb||oa.a.s7 in Ua&&oa.a.yxc in
Ua||d.ULS.sendTraceTag(537154076,13,10,`RTC WetContentUpdate was sent from ECS and is missing some expected fields. Has SessionSiteIdentifier: ${oa.a.s7 in Ua}, Has UserOperationTimeInMs: ${oa.a.yxc in Ua}.`);var sc;({qVf:sc}=this.jqb(Ua)).returnValue||(Ua=new bc(Ua[oa.a.H2f],Ua[oa.a.G2f],Rb,sc,oa.a.yxc in Ua?Ua[oa.a.yxc]:0),this.raiseEvent("ekcrmrrg",Ua,this))}else d.ULS.sendTraceTag(537154077,13,10,"RTC WetContentUpdate is missing some critical fields. Ignoring this update.")}jqb(Ua){Ua=oa.a.s7 in
Ua?Ua[oa.a.s7]:null;return{returnValue:this.$.ea.s7===Ua,qVf:Ua}}Glg(){this.$.ea.mea=Math.max(Sd.FYg,this.$.ea.mea)}nag(Ua){for(const Rb of Ua)if(!this.$.ea.fld(Rb))return!0;return!1}a7g(){this.$.Yc(1562177611,-1,0,null)}GPa(Ua){oa.a.Yxf in Ua&&oa.a.Zxf in Ua&&oa.a.byf in Ua&&(Ua=Object(eb.a)(new pf.a,{Pending:Ua[oa.a.Zxf],Current:Ua[oa.a.Yxf],SuspensionStartTimestamp:Ua[oa.a.byf]}),this.raiseEvent("ekcrmmcu",new Va.a(Ua),this))}eec(Ua){Ua=this.YHe(Ua);if(!this.oMa[Ua]){const Rb=new yc(Ua,this.currentUserId,
4E4,this.$);this.oMa[Ua]=Rb}this.i4f();return Object(l.a)(yc,this.oMa[Ua])}YHe(Ua){if(!Ua)return Ua;let Rb=Ua.toLocaleLowerCase();Rb.startsWith("{")||(Rb="{"+Ua+"}");return Rb}i4f(){this.Xnd||x.a.isEmpty(this.oMa)||!Za.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",!1)||(this.Xnd=m.Task.delay(2E4).continueWith(()=>{this.yhi()}))}yhi(){const Ua=[],Rb=db.a.Yd(),sc=this.oMa;for(let id in sc){var Mc=id;const Ed=Object(l.a)(yc,sc[id]);Ed.MEb(Rb);Ed.jmf&&(Ed.dispose(),
Ua.push(Mc))}for(const id of Ua)delete this.oMa[id],this.d1a.add(id);this.Xnd=null;this.i4f()}}Sd.FYg=3E4;Object(b.a)(Sd,"ContentRefreshManager",fa.a,[636]);var ue=a(204),Fe=a(75);class Be{constructor(Ua){this.$=Ua}cgd(Ua){return Ua+5E3}IHd(Ua){return this.$.ea.Yb?ya.TaskExtensions.ts(ya.TaskExtensions.ts(m.Task.delay(0),()=>Cd(this.$.pa.va,Ua.h4c,Ua.i4c,Ua.Tt,null,null,null),ue.a.none,0,Fe.a.current),()=>m.Task.delay(5E3),ue.a.none,0,Fe.a.current):m.Task.Ta(!0)}KZc(Ua,Rb){if(!Rb)return Ua;if(!Ua)return d.ULS.shipAssertTag(537154073,
0,!1,"UpdatePresenceUsersActionAggregationPerformer.AggregateActionParameters: Received null newActionParameter"),Rb;if(Rb.Zkf)return Rb;if(Ua.Zkf)return Ua;Rb.p2j(Ua);return Rb}}Object(b.a)(Be,"UpdatePresenceUsersActionAggregationPerformer",null,[634,635]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.CoauthTelemetry");ka.main();Type.registerNamespace("Common.App.CollabControls");Type.registerNamespace("Common.App.Presence");Type.registerNamespace("RealtimePresenceUI");ua.a.Fa(la.la);
(()=>{ua.a.Fa(Ua=>{Za.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&Ga.la(Ua);const Rb=Ua.da,sc=Object(nb.b)("OfficeVSO:7624673_NamedSheetViewConversionManagerService");sc||Rb.Ha(28,new wb(Ua));Rb.Ha(158,new Tb(Ua));ua.a.Fa(Cb.la);const Mc=ba.GetServiceTaskFactory.create(Ua.da,158,Rb.ka,1),id=sc?Object(Zb.c)(ib.a.resolve(cb.y,{Wb:1})):ba.GetServiceTaskFactory.create(Ua.da,28,Rb.ka,1);ya.TaskExtensions.za(ya.TaskExtensions.Md([Mc,id],Rb.ka),()=>{const Ed=new h.a,
ee=Rb.Ba(26);ee.JKe(Object(e.a)(Ed,Ed.setResult,"setResult"));const oe=new $e(Ua,ee,Mc.result,id.result,T.a.gq(da.a.instance.Tb("Common.App.CoauthTelemetry.IPresenceBootTelemetry")));Ja.a.getInstance(Ua.da).add(oe);Rb.Ha(159,new Cb);ya.TaskExtensions.za(ba.GetServiceTaskFactory.create(Rb,159,Rb.ka,1),Xe=>{const mf=new h.a;mf.setResult(oe);new Jb(Object(eb.a)(new Gb.a,{clientId:Ua.workbookContext.ClientId}),Ed.task,mf.task,Xe.result,Nb.a.instance,k.AFrameworkApplication.fa.qa("AwayStatusOneMinuteTimeoutIsEnabled")?
6E4:k.AFrameworkApplication.fa.Ad("AwayCoauthorThresholdMs",9E5),Object(e.a)(k.AFrameworkApplication.rb,k.AFrameworkApplication.rb.processAction,"processAction"),pb.instance)},Rb.ka)},Rb.ka,3);da.a.instance.register(183,"Microsoft.Office.Excel.WebUI.Client.ISessionStateManager").as("Common.ICoauthoringTelemeryInfoProvider").tc().Bc(()=>Ua.ea);da.a.instance.resolve("Common.ICoauthoringTelemeryInfoProvider");da.a.instance.register(za,"Microsoft.Office.Excel.WebUI.Client.Presence.PeopleInfoProvider").as("Common.IPeopleInfoProvider").tc().Bc(()=>
new za(Ua));da.a.instance.resolve("Common.IPeopleInfoProvider")})})();ua.a.Fa(qb.a.la);ua.a.Fa(Ua=>{const Rb=Ua.da,sc=ba.GetServiceTaskFactory.Pa(Ua.da,211,212,1);Rb.hb(25,Mc=>{ya.TaskExtensions.za(sc,id=>{Rb.Ba(231)||new Ac(id.result,Ua,Mc)},Rb.ka,3)})});(()=>{ua.a.Fa(Ua=>{const Rb=Object(nb.b)("OfficeVSO:7629428_MigrateSharedUIControlsFactoryService")?Object(Zb.c)(ib.a.resolve(cb.L,{Wb:0})):ba.GetServiceTaskFactory.Pa(Ua.da,12,477,0);ya.TaskExtensions.za(Rb,sc=>{var Mc=new rd(Ua),id=Ua.da.Ba(291);
Mc=sc.result.F6c(Mc,Mc,id,"collabService");var Ed=new Yd(Ua);id=sc.result.F6c(Ed,Ed,id,"persisted");Ed=new Be(Ua);sc=sc.result.F6c(Ed,Ed,null,"updatePresence");Ua.da.Ha(292,new Sd(Ua,Ua.da.Ba(26),Mc,id,sc));Ja.a.getInstance(Ua.da).add(new Ae(Ua));Ja.a.getInstance(Ua.da).add(Mc);Ja.a.getInstance(Ua.da).add(id)},Ua.ka)})})();String(c);window.___1678693106739_closurehack=c},742:function(r,B,a){a.r(B);a.d(B,"RtcUtils",function(){return f});r=a(0);var c=a(15),b=a(828),e=a(40);class f{static s3c(d,h=b.RealtimeChannel.hAd){let l;
try{l=e.c(d)}catch(k){throw d=String.format("Failed to JSON-serialize payload : {0}",k),c.ULS.sendTraceTag(18637072,500,10,d),Error.argument("payload",d);}if(l.length>h)throw d=String.format("Payload exceeds maximum length: {0} > {1}.",l.length,h),c.ULS.sendTraceTag(18637074,500,10,d),Error.argument("payload",d);return l}static deserialize(d,h,l){if(!d)return null;if(Object.getType(d)!==String){var k=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",
h,Object.getType(d).getName(),l);c.ULS.sendTraceTag(18637075,500,10,k);return null}k=null;try{k=e.a(d)}catch(w){d=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",h,w,l),c.ULS.sendTraceTag(18637077,500,10,d)}return k}static R$a(d){if(!d)return"";if("string"===typeof d)return d.toString();try{return e.c(d)}catch(h){return d.toString()}}static zIh(d){let h,l,k;h=0;k=l=null;if(!d)return{mff:h,pff:l,exception:k};try{const w=d.source;w&&Object.getType(w)===
String&&(k=w);const n=d.context;n&&(d=n,h=d.status?d.status:0,l=d.statusText?d.statusText:null)}catch(w){}return{mff:h,pff:l,exception:k}}}Object(r.a)(f,"RtcUtils",null,[])},828:function(r,B,a){a.r(B);r=a(0);var c=a(15),b=a(88),e=a(167),f=a(902),d=a(103),h=a(4);class l{constructor(ta,Ya){this.status=ta;this.z9a=Ya}}Object(r.a)(l,"UserStatusInfo",null,[]);var k=a(82),w=a(578),n=a(197);class x{constructor(ta){this.messageId=ta;this.IAj=(new Date).getTime();this.Jwd=new n.a}}Object(r.a)(x,"MessageLatencyDetails",
null,[]);class m{constructor(ta,Ya,Da){this.c9=null;this.vQc=this.gUc=0;this.ue=Ya;this.age=Da;this.qnb=!1;this.Ug=ta;this.Ug.UZa(Object(b.a)(this,this.iij,"receiveMessage"))}start(){if(this.age&&!this.qnb){const ta=this.ue.Q2f;this.vQc=this.ue.N2f;ta<=this.vQc?(c.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.ue.Q2f,this.ue.N2f),
this.age=!1):(this.qnb=!0,this.gUc=window.setInterval(Object(b.a)(this,this.uj,"sendMessage"),ta))}}uj(){if(this.qnb){const ta=w.a.create().toString();this.c9=new x(ta);this.Ug.EKd(16,ta,!1,new e.a);window.setTimeout(()=>{this.AHi(ta)},this.vQc)}}AHi(ta){this.c9&&this.c9.messageId===ta&&(0<this.c9.Jwd.count?(ta=this.c9.Jwd.toArray().join(","),c.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",ta)):c.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.c9=
null)}stop(){this.gUc&&(window.clearInterval(this.gUc),this.qnb=!1)}iij(ta,Ya){16===Ya.type?this.Ug.EKd(17,Ya.d8,!1,new e.a):17===Ya.type&&this.qnb&&Ya.d8&&this.gdj(Ya.d8)}gdj(ta){ta&&this.c9&&ta.toString()===this.c9.messageId&&(ta=(new Date).getTime()-this.c9.IAj,this.c9.Jwd.add(ta))}static get instance(){return m.Ma}static ujd(ta,Ya,Da){return m.instance||(m.Ma=new m(ta,Ya,Da))}}m.Ma=null;Object(r.a)(m,"ClientToClientMessageTelemetry",null,[]);var u=a(963),t=a(901);class y{constructor(ta,Ya){this.data=
ta;this.timeStamp=Ya}}Object(r.a)(y,"PresenceData",null,[]);class v{constructor(ta){this.v9=!1;this.VYa=0;this.nKc=!1;this.setTimeout=v.v9c;this.clearTimeout=v.k9c;this.eJi=Object(b.a)(this,this.uIi,"logRtcConnectingUsageStatement");this.im=ta}GUi(){this.v9||(this.VYa=this.setTimeout(()=>{this.v9=!1;this.zuf()},8E3),this.v9=!0,this.nKc=!1)}GVi(){this.nM()}h4i(){this.zuf()}zuf(){this.nM();this.nKc||(this.nKc=!0,this.eJi())}uIi(){c.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",
this.im)}nM(){this.v9&&this.clearTimeout(this.VYa);this.VYa=0;this.v9=!1}static v9c(ta,Ya){return window.setTimeout(ta,Ya)}static k9c(ta){window.clearTimeout(ta)}}Object(r.a)(v,"ConnectedUsageKpiLogger",null,[997]);class A{constructor(){this.AVf=this.xLd;this.DVf=this.ALd;this.CVf=this.zLd;this.HVf=this.CLd;this.GVf=this.BLd;this.HLd=this.ILd;this.YJb=this.FLd;this.YQa=this.DLd;this.ZQa=this.ELd;this.BVf=this.yLd;this.aGb=this.TBd;this.Soc=this.VBd}xLd(){}ALd(){}zLd(){}CLd(){}BLd(){}FLd(){}ELd(){}DLd(){}ILd(){}yLd(){}TBd(){}VBd(){}}
Object(r.a)(A,"NoopRealtimeChannelMetrics",null,[996,72]);class z{}z.ZQb="presenceUpdated";z.updateNotification="updateNotification";z.dPf="persistentStateCleared";z.updatePersistentState="persistentStateUpdated";Object(r.a)(z,"RtcClientMethodNames",null,[]);class C{}C.Ohi="realtimeChannelHub";C.ZQb="UpdatePresence";C.lea="SendUpdateNotification";C.Ugd="GetCompletePersistentStateWithMetadata";C.updatePersistentState="UpdatePersistentState";C.chb="UpdateClientInfo";Object(r.a)(C,"RtcHubMethodNames",
null,[]);class H{constructor(ta){this.Qr=ta}elj(ta){this.Qr.on(z.ZQb,ta)}Flj(ta){this.Qr.on(z.updateNotification,ta)}clj(ta){this.Qr.on(z.updatePersistentState,ta)}blj(ta){this.Qr.on(z.dPf,ta)}T2j(ta){this.Qr.off(z.ZQb,ta)}c3j(ta){this.Qr.off(z.updateNotification,ta)}S2j(ta){this.Qr.off(z.updatePersistentState,ta)}R2j(ta){this.Qr.off(z.dPf,ta)}ZQb(ta){return this.Qr.invoke(C.ZQb,ta)}chb(ta){return this.Qr.invoke(C.chb,ta)}lea(ta,Ya){return this.Qr.invoke(C.lea,ta,Ya)}Ugd(ta){return this.Qr.invoke(C.Ugd,
ta)}updatePersistentState(ta,Ya){return this.Qr.invoke(C.updatePersistentState,ta,Ya)}}Object(r.a)(H,"RealtimeChannelProxy",null,[993,994,995]);class I{constructor(){this.PIc=this.G6d=!1;this.NIc=0;this.TJc=this.BUc=this.AUc=this.jIc=!1;this.ULc=0;this.uke=!1;this.tke=this.ske=0;this.GTc=!1;this.LTc=this.JTc=this.MTc=this.HTc=0;this.KTc=!1}get CYg(){return this.PIc}get BYg(){return this.NIc}get WTg(){return this.jIc}get NKj(){return this.AUc}get OKj(){return this.BUc}get V8g(){return this.TJc}get rbc(){return this.ULc}get rtcJsClientFrequentlyLogsMetrics(){return this.uke}get L2f(){return this.ske}get iwj(){return this.tke}get rtcClientMessageTelemetryEnabled(){return this.GTc}get dwj(){return this.HTc}get Q2f(){return this.MTc}get N2f(){return this.JTc}get P2f(){return this.LTc}get O2f(){return this.KTc}static createInstance(ta){const {RealtimeChannel:Ya}=
a(828);return ta?Object.assign(new I,{G6d:ta.qa("AwayStatusManagerIsEnabled"),PIc:ta.qa("AwayStatusOneMinuteTimeoutIsEnabled"),NIc:ta.Ad("AwayCoauthorThresholdMs",9E5),jIc:ta.qa("RtcAllowCrossDomainAccessEnabled"),AUc:ta.qa("ShouldLogOnContentNotification"),BUc:ta.qa("ShouldLogOnHostSubscriptionNotification"),TJc:ta.qa("RtcClientMetricsEnabled"),ULc:ta.Ad("RtcFindSessionRequestTimeoutInMS",6E4),uke:ta.qa("RtcJsClientFrequentlyLogsMetrics"),ske:ta.Ad("RtcJsClientFrequentMetricsLatencyThresholdInMS",
1E3),tke:ta.Ad("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),GTc:ta.qa("RtcClientMessageTelemetryEnabled"),HTc:ta.Ad("RtcClientMessageTelemetrySampleSize",5),MTc:ta.Ad("RtcSendTelemetryMessageIntervalInMS",3E5),JTc:ta.Ad("RtcLogClientMessageMetricsTimeOutInMs",2E4),LTc:ta.Ad("RtcMaxPayloadSizeInCharactersOverride",Ya.hAd),KTc:ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new I,{G6d:!1,PIc:!1,NIc:9E5,jIc:!1,AUc:!1,BUc:!0,TJc:!1,ULc:9E4,
GTc:!1,HTc:5,MTc:3E5,JTc:2E4,LTc:Ya.hAd,KTc:!1})}}Object(r.a)(I,"RealtimeChannelSettings",null,[998]);var S=a(1196),P=a(87),D=a(385);class G{constructor(ta){this.Wnb=null;this.eea=0;this.pKa=!1;this.Ug=ta;this.Ug.z2(Object(b.a)(this,this.WV,"onConnectionStateChanged"))}WV(ta,Ya){this.eea=Ya.newState}Z4i(){c.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Ug.ouc()}yki(ta){this.Wnb.init(ta)}}Object(r.a)(G,"ARtcMessageHandler",null,[]);var E=a(1241);
class O{constructor(){this.Presence=null;this.TimeStamp=0}}Object(r.a)(O,"PresenceDataEntryForClients",null,[]);var N=a(115);class J{constructor(ta,Ya=""){this.BGg=ta;this.dJ=Ya}send(){return this.BGg()}get messageId(){return this.dJ}}Object(r.a)(J,"MessageHandler",null,[1012]);class W{constructor(){this.p7d=this.lKc=!1;this.callback=null}aab(ta){this.callback=ta;this.Tig()}Uwf(ta){this.lKc||(this.lKc=!0,this.Oxg=ta,this.Tig())}Tig(){this.lKc&&this.callback&&!this.p7d&&(this.p7d=!0,this.callback(this.Oxg))}}
Object(r.a)(W,"CompletionTask",null,[]);class ea{constructor(){this.$fe=new W;this.Yfe=new W}Vqc(ta){this.$fe.aab(ta)}Uqc(ta){this.Yfe.aab(ta)}nFb(ta){this.$fe.Uwf(ta)}Pya(ta){this.Yfe.Uwf(ta)}bAd(){this.nFb(2);this.Pya(2)}}Object(r.a)(ea,"MessageStatus",null,[1013]);class R extends Sys.EventArgs{constructor(ta,Ya,Da,ba){super();this.xOd=ta;this.reconnectDelay=Ya;this.reason=Da;this.NRd=ba}}Object(r.a)(R,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var Y=a(1016);class U{constructor(){this.aVc=
this.Cp=null}get Fc(){return this.Cp?this.aVc?this.aVc.getTime()-this.Cp.getTime():(new Date).getTime()-this.Cp.getTime():0}start(){this.Cp=new Date}stop(){this.aVc=new Date}}Object(r.a)(U,"SimpleStopwatch",null,[]);var da=a(1017),T;(function(ta){ta[ta.contentUpdate=0]="contentUpdate";ta[ta.editorsTableUpdate=1]="editorsTableUpdate";ta[ta.fileNameUpdate=2]="fileNameUpdate";ta[ta.wetContentUpdate=3]="wetContentUpdate";ta[ta.persistedContentUpdate=4]="persistedContentUpdate";ta[ta.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";ta[ta.replicationTelemetry=6]="replicationTelemetry";ta[ta.lockUpdate=7]="lockUpdate";ta[ta.collabServiceContentUpdate=8]="collabServiceContentUpdate";ta[ta.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";ta[ta.saveTargetUpdate=10]="saveTargetUpdate";ta[ta.uploadToOcsUpdate=11]="uploadToOcsUpdate";ta[ta.labelUpdate=12]="labelUpdate";ta[ta.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";ta[ta.subscribeOrExtend=14]="subscribeOrExtend";
ta[ta.elapsedBootTelemetry=15]="elapsedBootTelemetry";ta[ta.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";ta[ta.clientToClientResponseMessage=17]="clientToClientResponseMessage";ta[ta.verifyNotificationPipeline=18]="verifyNotificationPipeline";ta[ta.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";ta[ta.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";ta[ta.last=21]="last"})(T||(T={}));Object(r.b)("UpdateNotificationType",T);var ka=a(994),L=a(992),fa=a(993);class wa extends G{constructor(ta,
Ya,Da,ba,ya,V,Z,ja,la,ua){super(Z);this.Qr=null;this.qfe=!1;this.dJ=0;this.jSc=new D.a;this.VCg=wa.SVh();this.WRc=h.AFrameworkApplication.fa.Wa("OwningFeatureCrewForRtcNotificationKpis");this.ue=ta;this.Uge=this.Tge=0;this.Wnb=Ya;this.Wnb.b1b(Object(b.a)(this,this.Z4i,"onTooManyUndeliveredMessages"));this._clientId=Da;this.oFg=ya;this.Ug.FRg(Object(b.a)(this,this.W1i,"onRefreshProxyRequired"));this.Ug.DRg(Object(b.a)(this,this.V1i,"onRefreshAllPersistentStateRequest"));this.Ug.WRg(Object(b.a)(this,
this.lea,"sendUpdateNotification"));this.Ug.pQg(Object(b.a)(this,this.b_i,"onInternalPresenceUpdated"));this.Ug.qQg(Object(b.a)(this,this.c_i,"onInternalUpdateNotificationReceived"));this.Ug.oQg(Object(b.a)(this,this.a_i,"onInternalPersistentStateUpdated"));this.Ug.nQg(Object(b.a)(this,this.$Zi,"onInternalPersistentStateCleared"));this.Ug.VRg(Object(b.a)(this,this.Byc,"sendPersistentState"));this.Ug.qSg(Object(b.a)(this,this.chb,"updateClientInfo"));this.Ah=V;this.im=ba;this.Ml=ja;this.WB=la;this.Olb=
ua;this.LVa=Object(P.a)(String,h.AFrameworkApplication.Ub.Application)||""}W1i(ta,Ya){this.Qr=this.oFg(Ya.hubConnection);this.Wnb.reset();this.Qr.elj(Object(b.a)(this,this.Tma,"onPresenceUpdated"));this.Qr.clj(Object(b.a)(this,this.HPa,"onPersistentStateUpdated"));this.Qr.blj(Object(b.a)(this,this.vFd,"onPersistentStateCleared"));this.Qr.Flj(Object(b.a)(this,this.eda,"onUpdateNotificationReceived"))}WV(ta,Ya){this.eea=Ya.newState;2===Ya.newState&&this.vAj()}vAj(){for(let ta of this.jSc)this.lea(null,
new Y.a(ta.key,ta.value,!1,new e.a));this.jSc=new D.a}V1i(ta,Ya){Ya.N3c();for(ta=0;3>ta;++ta)this.fAj(ta,Ya)}fAj(ta,Ya){try{this.Qr.Ugd(ta).done(Da=>{Ya.Fhb(Ya.E5c,"GetCompletePresenceSuccess")&&(Ya.zbh.h4i(),c.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.im),this.Ug.fgj(),this.j1i(ta,Da),this.Ug.Cfj(Da),Ya.cYe.kb(ta)&&this.Ug.NTf(ta,Ya.cYe.ma(ta),new e.a))}).fail(Da=>{const {RtcUtils:ba}=a(742);Ya.Fhb(Ya.E5c,"GetCompletePresenceFail")&&(c.ULS.sendTraceTag(3249541,
500,15,"Failed to retrieve complete session state : {0} for [{1}]",ba.R$a(Da),this.im),this.Ug.ouc())}).always(()=>{Ya.stopwatch&&Ya.stopwatch.stop()})}catch(Da){c.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",Ya.E5c,Da.message)}}Byc(ta,Ya){var {RtcUtils:Da}=a(742);ta=Ya.presence;let ba;const ya=Ya.bpa;this.WB.fy(1,0);try{ba=Da.s3c(ta,this.Olb)}catch(Z){this.WB.fy(1,
3);c.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",Z.message);ya.setException(Z);return}Da=new d.a;Da.ia(this._clientId,Object.assign(new O,{Presence:ta,TimeStamp:(new Date).getTime()}));this.Ug.VTf(Ya.type,Da);if(2!==this.eea)this.Ml.YQa(),this.WB.fy(1,2),ya.setResult(null);else{var V=this.dJ.toString();++this.dJ;ta=new J(()=>this.xAj(Ya.type,ba,V),V);ta=this.ohg(0,Ya.type).add(ta);ta.Vqc(Z=>{2===Z&&this.WB.fy(1,6);ya.setResult(null)});
ta.Uqc(()=>{})}}xAj(ta,Ya,Da){let ba=null;const ya=new U,V=new ea;c.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.im);if(2!==this.eea)return this.Ml.YQa(),this.WB.fy(1,2),c.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.im),V.bAd(),V;this.Ah&&20>this.Tge&&(ba=this.Ah.Kc("WebServiceCall","Send Presence Message"),this.Tge++);ya.start();V.nFb(1);try{this.Qr.updatePersistentState(ta,Ya).done(()=>{this.Ml.YJb();this.WB.fy(1,1);
c.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Da,this.im);V.Pya(1);ya&&(ya.stop(),ya.Fc>this.ue.L2f?this.WB.fy(1,4):this.WB.fy(1,5))}).fail(Z=>{const {RtcUtils:ja}=a(742);this.pKa||(this.Ml.YQa(),this.WB.fy(1,3),c.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Da,ja.R$a(Z),this.im));V.Pya(2)}).always(()=>{ba&&ba.stop()})}catch(Z){c.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",
Z.message),this.WB.fy(1,3),V.Pya(2)}return V}chb(ta,Ya){({RtcUtils:ta}=a(742));const Da=Ya.U8g,ba=Ya.bpa;let ya;try{ya=ta.s3c(Da,this.Olb)}catch(V){c.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",V.message);ba.setException(V);return}try{this.Qr.chb(ya).done(()=>{c.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(V=>{const {RtcUtils:Z}=a(742);this.pKa||c.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",
Z.R$a(V));ba.setResult(null)})}catch(V){c.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",V.message),ba.setResult(null)}}lea(ta,Ya){({RtcUtils:ta}=a(742));const Da=Ya.type,ba=Ya.d8,ya=Ya.Goh,V=Ya.bpa;let Z;this.WB.fy(0,0);try{Z=ta.s3c(ba,this.Olb)}catch(la){this.WB.fy(0,3);c.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",la.message);V.setException(la);return}if(2!==this.eea)ya?this.jSc.ia(Da,
ba):(this.Ml.YQa(),this.WB.fy(0,2)),V.setResult(null);else{var ja=this.dJ.toString();++this.dJ;Ya=new J(()=>this.RAj(Da,Z,ja),ja);Ya=this.ohg(1,Da).add(Ya);Ya.Vqc(la=>{2===la&&this.WB.fy(0,6);V.setResult(null)});Ya.Uqc(()=>{})}}RAj(ta,Ya,Da){let ba=null;const ya=new U,V=new ea;c.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.im);if(2!==this.eea)return this.Ml.YQa(),this.WB.fy(0,2),c.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",
this.im),V.bAd(),V;this.Ah&&3===ta&&20>this.Uge&&(ba=this.Ah.Kc("WebServiceCall","Send WetContent Update"),this.Uge++);ya.start();V.nFb(1);this.Qr.lea(ta,Ya).done(()=>{this.Ml.YJb();this.WB.fy(0,1);c.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",Da,this.im);V.Pya(1);ya&&(ya.stop(),ya.Fc>this.ue.L2f?this.WB.fy(0,4):this.WB.fy(0,5))}).fail(Z=>{const {RtcUtils:ja}=a(742);this.pKa||(this.Ml.YQa(),this.WB.fy(0,3),c.ULS.sendTraceTag(3249507,500,15,
"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Da,ja.R$a(Z),this.im));V.Pya(2)}).always(()=>{ba&&ba.stop()});return V}Rv(){this.Qr.T2j(Object(b.a)(this,this.Tma,"onPresenceUpdated"));this.Qr.S2j(Object(b.a)(this,this.HPa,"onPersistentStateUpdated"));this.Qr.R2j(Object(b.a)(this,this.vFd,"onPersistentStateCleared"));this.Qr.c3j(Object(b.a)(this,this.eda,"onUpdateNotificationReceived"))}b_i(ta,Ya){this.Tma(Ya.vL,Ya.waa)}Tma(ta){this.Ml.ZQa();this.HPa(0,ta)}a_i(ta,
Ya){this.HPa(Ya.type,Ya.vL)}j1i(ta,Ya){const Da={};for(let ba in Ya)Da[ba]=Ya[ba].Presence;this.PIf(ta,Da,Ya)}HPa(ta,Ya){this.Ml.ZQa();this.PIf(ta,Ya)}PIf(ta,Ya,Da=null){var {RtcUtils:ba}=a(742);if(c.ULS.sea(500,100))for(var ya in Ya);delete Ya[this._clientId];if(!N.a.isEmpty(Ya)){for(var V in Ya)ya=V,Ya[ya]=ba.deserialize(Ya[V],"Presence",ya,!1,this.Olb);ba=new d.a;V=(new Date).getTime();for(let Z in Ya){ya=Ya[Z];let ja=Z,la;Da?(la=Da[ja],la.Presence=ya):la=Object.assign(new O,{Presence:ya,TimeStamp:V});
ba.ia(ja,la)}this.Ug.VTf(ta,ba);switch(ta){case 0:this.qfe||(c.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.im),this.qfe=!0,h.AFrameworkApplication.gf&&h.AFrameworkApplication.gf.UKi());this.Ug.ETf(Ya,[]);break;default:this.Ug.Yfj(ta,Ya)}}}$Zi(ta,Ya){this.vFd(Ya.l4c)}vFd(ta){this.Ml.ZQa();if(c.ULS.sea(500,100))for(let Ya=0;Ya<ta.length;++Ya);ta.length&&(this.Ug.vgj(ta),this.Ug.Xfj(ta),this.Ug.ETf({},ta))}c_i(ta,Ya){this.eda(Ya.type,Ya.d8)}eda(ta,Ya=null){this.ue.NKj&&
0===ta&&c.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===ta&&this.WRc&&0<this.WRc.length){var Da=Object.assign(new ka.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.WRc,vetoPillar:"RealTimeCoauth"});(Da=E.a.getInstance(Da))&&Da.logKpiUsage(this.VCg)}this.ue.OKj&&13===ta&&c.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",Ya||"<none>"));
this.Ml.ZQa();5===ta?(Ya=(ta=this.G8i(Ya))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",ta.reason,ta.reconnectDelay):"Received client reconnection request from the server without params.",c.ULS.sendTraceTag(18637071,500,50,Ya),this.Ug.ouc(ta)):(Ya=a(742).RtcUtils.deserialize(Ya,String.format("UpdateNotification-{0}",T[ta]),null,!1,this.Olb),this.Ug.ugj(ta,Ya))}G8i(ta){try{if(!ta||""===ta)return null;const Ya=JSON.parse(ta);return new R(Ya[da.a.xQd],
Ya[da.a.cwj],Ya[da.a.ewj],Ya[da.a.NRd])}catch(Ya){return c.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",Ya.message),null}}ohg(ta,Ya){return this.Wnb.e9h(this.f9h(ta,Ya))}f9h(ta,Ya){return ta+","+Ya}static SVh(){var ta=new Map;ta.set("SkipAria","True");ta=Object.assign(new L.a,{extendedProperties:ta});return Object.assign(new fa.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:ta,blockFutureEmissionDurationInMs:3E5})}}Object(r.a)(wa,"RtcMessageHandler",
G,[]);var oa=a(101);class xa{constructor(ta,Ya=""){this.Ijb=this.Vnb=0;this.KOc=!1;this.UYa=this.GZb=null;this.qXa=!1;this.ale=ta;this.phg=Ya;this.setTimeout=xa.v9c;this.jGa=this.Vnb=this.Ijb=0}GLd(){0<this.jGa&&0<this.Ijb&&c.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.phg,this.Ijb,this.jGa);0<this.jGa&&0<this.Vnb&&c.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.phg,this.Vnb,this.jGa)}get a8a(){return this.KOc}Kzc(ta,
Ya){this.Vnb++;this.rsb(!0);this.KOc=!0;this.GZb=ta;this.UYa=Ya}rsb(ta){this.KOc=!1;this.UYa&&ta&&(this.Ijb++,this.UYa.bAd());this.UYa=this.GZb=null}static v9c(ta,Ya){return window.setTimeout(ta,Ya)}}Object(r.a)(xa,"ThrottlerBase",null,[]);class bb extends xa{constructor(ta,Ya=""){super(ta,Ya);this.i$a=this.oCa=0;this.Za=new oa.a;this.pXa=!1;this.ZWb=this.OTb=this.CTb=this.FVc=0;this.LZb=[];this.clearTimeout=bb.k9c}add(ta){this.qXa||this.init(bb.QMe,bb.IMe);this.jGa++;const Ya=new ea;this.a8a?this.Kzc(ta,
Ya):this.ZWb<this.i$a?this.OMb(ta,Ya):(this.Kzc(ta,Ya),this.pXa=!1);return Ya}OMb(ta,Ya){ta=this.ale(ta);const Da=this.setTimeout(Object(b.a)(this,this.h0i,"onMessageWaitTimeExpired"),this.oCa);++this.ZWb;Array.add(this.LZb,Da);const ba=this.CTb;ta.Vqc(ya=>{Ya.nFb(ya)});ta.Uqc(ya=>{this.CTb===ba&&(this.g0i(ba,Da),Ya.Pya(ya))})}g0i(ta,Ya){this.CTb===ta&&(--this.ZWb,this.clearTimeout(Ya),Array.remove(this.LZb,Ya),this.a8a&&this.GAj())}GAj(){this.a8a&&!this.pXa&&(this.FVc=this.setTimeout(Object(b.a)(this,
this.HAj,"sendThrottledMessageFromTimer"),0),this.pXa=!0)}HAj(){this.pXa=!1;if(this.a8a){const ta=this.GZb,Ya=this.UYa;this.rsb(!1);this.OMb(ta,Ya)}}h0i(){++this.OTb;this.OTb>Math.floor(this.i$a/2)&&(this.OTb=-1E9,this.Za.raiseEvent("TMUDM"))}b1b(ta){this.Za.addHandler("TMUDM",ta)}reset(){this.jGa=this.Vnb=this.Ijb=this.OTb=0;++this.CTb;for(const ta of this.LZb)this.clearTimeout(ta);this.ZWb=0;this.LZb=[];this.rsb(!0);this.pXa&&(this.clearTimeout(this.FVc),this.FVc=0,this.pXa=!1)}init(ta,Ya){this.qXa||
(this.oCa=ta,this.i$a=Ya,this.qXa=!0)}static createInstance(ta,Ya=""){return new bb(ta,Ya)}static k9c(ta){window.clearTimeout(ta)}}bb.QMe=15E3;bb.IMe=5;Object(r.a)(bb,"MaxOutstandingThrottler",xa,[1011,1010]);class Za extends xa{constructor(ta,Ya=""){super(ta,Ya);this.o$a=0;this.qlb=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(ta){this.qXa||(this.o$a=ta,this.qXa=!0)}add(ta){this.qXa||this.init(Za.zMe);this.jGa++;const Ya=this.currentTime(),Da=new ea;this.qlb>Ya&&(this.qlb=
Ya);this.a8a?(this.rsb(!0),this.Kzc(ta,Da)):this.qlb+this.o$a<=Ya?this.OMb(ta,Da):(this.Kzc(ta,Da),this.setTimeout(Object(b.a)(this,this.FAj,"sendThrottledMessage"),this.qlb+this.o$a-Ya));return Da}FAj(){if(this.a8a){const ta=this.GZb,Ya=this.UYa;this.rsb(!1);this.OMb(ta,Ya)}}OMb(ta,Ya){this.qlb=this.currentTime();ta=this.ale(ta);ta.Vqc(Da=>{Ya.nFb(Da)});ta.Uqc(Da=>{Ya.Pya(Da)})}static createInstance(ta,Ya=""){return new Za(ta,Ya)}}Za.zMe=200;Object(r.a)(Za,"MaxRateThrottler",xa,[1009,1010]);class La{eKe(ta,
Ya=""){return bb.createInstance(ta,Ya)}Rhh(ta,Ya=""){return Za.createInstance(ta,Ya)}}Object(r.a)(La,"ThrottlerFactory",null,[1001]);var va=a(1018);class Ba{constructor(ta){this.ue=null;this.px=!1;this.Za=new oa.a;this.JQc=new d.a;this.IQc=new d.a;this.GVc=ta;this.VWa=this.GVc.eKe(Ya=>Ya.send(),"GlobalMaxOustandingThrottler");this.VWa.b1b(()=>{this.Za.raiseEvent("TMUDM")})}init(ta){this.px||(this.ue=ta,this.VWa.init(this.ue.oCa,this.ue.Lai),this.px=!0)}e9h(ta){this.px||this.init(new va.a(Za.zMe,bb.QMe,
bb.IMe,Ba.ULi));if(!({value:Ya}=this.JQc.Ic(ta)).returnValue){if(!({value:Ya}=this.IQc.Ic(ta)).returnValue){var Ya="MaxOutstandingThrottler-"+ta;Ya=this.GVc.eKe(Object(b.a)(this.VWa,this.VWa.add,"add"),Ya);Ya.init(this.ue.oCa,this.ue.TLi);Ya.b1b(()=>{this.Za.raiseEvent("TMUDM")});this.IQc.add(ta,Ya)}const Da="MaxRateThrottler-"+ta;Ya=this.GVc.Rhh(Object(b.a)(Ya,Ya.add,"add"),Da);Ya.init(this.ue.QMi);this.JQc.add(ta,Ya)}return Ya}reset(){for(let ta of this.JQc)ta.value.GLd();for(let ta of this.IQc)ta.value.GLd(),
ta.value.reset();this.VWa.GLd();this.VWa.reset()}b1b(ta){this.Za.addHandler("TMUDM",ta)}}Ba.ULi=1E3;Object(r.a)(Ba,"ThrottlerManager",null,[1E3]);var Ea;(function(ta){ta[ta.unspecified=0]="unspecified";ta[ta.word=1]="word";ta[ta.excel=2]="excel";ta[ta.powerPoint=3]="powerPoint";ta[ta.test=4]="test";ta[ta.wacFrontEnd=5]="wacFrontEnd";ta[ta.oneNote=6]="oneNote";ta[ta.visio=7]="visio";ta[ta.officeMobile=8]="officeMobile";ta[ta.cosmosDBChangefeed=9]="cosmosDBChangefeed";ta[ta.last=10]="last"})(Ea||(Ea=
{}));Object(r.b)("RtcClientAppName",Ea);const pa=(ta,Ya,Da,ba,ya,V,Z,ja,la=null,ua=null,eb=null,Eb=null)=>{const Wb=I.createInstance(h.AFrameworkApplication.fa),Ab=h.AFrameworkApplication.buildVersion?h.AFrameworkApplication.buildVersion:"1.0",Jb=$a(ta,Ya,Z,Ab),Gb=Wb.V8g?a(1357).RealtimeChannelMetrics.createInstance(Jb):new A;var Nb=u.a.create(ya);Wb.rtcJsClientFrequentlyLogsMetrics&&Nb.HSj(Wb.iwj);var Ja="";Ja=la&&""!==la?la:"/rtc2/";Nb.QZe=k.a.eK(Ja);const ab=Ja+"signalr";la=Ja+"findsession";const wb=
C.Ohi;Ja=new La;eb=eb||S.a.getInstance();c.ULS.shipAssertTag(556867617,500,Wb.P2f<=a(828).RealtimeChannel.pxf,"Client attempting to override max payload size beyond absolute limit");const xb=Math.min(Wb.P2f,a(828).RealtimeChannel.pxf);Nb.oxf=xb;Nb=new wa(Wb,new Ba(Ja),ta,Jb,rb=>new H(rb.createHubProxy(wb)),ja,eb,Gb,Nb,xb);ua||(ua=a(1223).FindSessionStrategy.createInstance(Ya,ya,la,ja,Ab,Z,ta,Jb,eb,V,ba,Eb));ua.rbc=Wb.rbc;Ya=new v(Jb);Da=Da?Da.split(","):null;ta=new (a(828).RealtimeChannel)(ta,Da,
Jb,ja,()=>$.hubConnection(ab),ua,Nb,Ya,eb,Gb,Wb,ya);ta.init();return ta},$a=(ta,Ya,Da)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",ta,cb(Ea[Da]),cb("browser"),Ya),cb=ta=>ta?ta.charAt(0).toLocaleUpperCase()+ta.substring(1,ta.length):ta;a.d(B,"RealtimeChannel",function(){return ib});class ib{constructor(ta,Ya,Da,ba,ya,V,Z,ja,la,ua,eb,Eb){this.$Uc=!1;this.t1=null;this.LG=new d.a;this.Zib=1;this.gP=null;this.du=!1;this.FPc=(new Date(0)).getTime();this.Ule=0;this._clientId=ta;
this.RZb=Ya;this.BL=0;this.Ah=ba;this.mKc=ja;this.tGg=Z;this.nvg=la;this.Qxg=ya;this.eqa=V;this.im=Da;this.Ml=ua;this.ue=eb;this.rh=Eb;this.nHg=1>100*Math.random()}get SOa(){return this.eqa.SOa}set SOa(ta){this.eqa.SOa=ta}get dBa(){return this.tGg}get Ug(){return this.nvg}init(){this.Ug.ERg(Object(b.a)(this,this.$8b,"disconnectAndCreateNewConnection"));this.Ug.sSg(Object(b.a)(this,this.n5i,"onUpdatePersistentStateRequestReceivedInternal"));this.Ug.rSg(Object(b.a)(this,this.m5i,"onUpdatePersistentStateClearedRequestReceived"));
this.rh.$Xc(this.Ml);h.AFrameworkApplication.Sfb(()=>{this.Ml.HLd();u.a.instance&&u.a.instance.lyd()});this.mKe();this.Eqh();this.Ug.YRg(Object(b.a)(this,this.w4j,"updateConnectionQueryString"))}Eqh(){try{const Da=$.signalR;if(!Da)throw Error.invalidOperation("Failed to retrieve Signalr object");const ba=Da.version;if(!ba)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===ba){var ta=Da.transports;if(!ta)throw Error.invalidOperation("Failed to retrieve transports object");
var Ya=ta.longPolling;if(!Ya)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!Ya.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");Ya.supportsKeepAlive=this.tkh()}}catch(Da){c.ULS.sendTraceTag(6432339,500,15,"Failed to disable longPolling KeepAlives: {0}",Da.message)}}tkh(){return()=>!1}mKe(){const ta=++this.Zib;this.FPc=(new Date(0)).getTime();this.gP=this.Qxg();this.Ug.dgj(this.gP);this.gP.stateChanged(Ya=>
{this.IUi(Ya,ta)});this.gP.connectionSlow(Object(b.a)(this,this.X3i,"onSlowConnection"));this.gP.error(Object(b.a)(this,this.L3i,"onSignalRError"));this.gP.log=Object(b.a)(this,this.M3i,"onSignalRLog")}Fhb(ta,Ya){return ta!==this.Zib?(c.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",Ya),!1):!0}connect(){2!==this.BL&&1!==this.BL&&(c.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.im),this.mKc.GUi(),t.a.instance.ISj(),this.WV(1,this.BL),
this.Kdg())}Kdg(){const ta=this.Zib;this.$Uc=!1;this.Ml.AVf();this.eqa.n6h(Object(b.a)(this,this.ubh,"connectSignalrConnection"),Object(b.a)(this,this.bFf,"onFailureToConnect"),Object(b.a)(this.dBa,this.dBa.yki,"initThrottlerManager"),Object(b.a)(this,this.Fhb,"verifyConnectionToken"),ta)}bFf(ta=null){this.Ml.CVf();let Ya=null;!ta||"documentsessiondeleted"!==(Ya=ta.toLowerCase())&&"documentsessionexpired"!==Ya?this.$8b():(c.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",
this.im,ta),this.disconnect())}$8b(ta,Ya=null){c.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.t1);ta=(ta=2===this.BL||1===this.BL)&&!this.dBa.pKa;let Da=!0,ba=0;Ya&&Object.getType(Ya)!==Object.getType(Sys.EventArgs.Empty)&&Ya.xOd&&""!==Ya.xOd&&(ta=!0,this.eqa.iGj(Ya.xOd),Da=Ya.NRd,ba=Ya.reconnectDelay);ta&&this.WV(1,this.BL);++this.Zib;this.dBa.Rv();this.GTj(Da);this.eqa.Drh();this.mKe();ta&&window.setTimeout(Object(b.a)(this,this.Kdg,"startConnecting"),Math.min(ba,3E4))}w4j(){let ta=
null;const Ya=({correlationId:ta}=this.eqa.S4e()).returnValue;this.gP.qs=Ya;c.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.im,ta)}ubh(ta){this.FPc=(new Date).getTime();let Ya=null;this.gP.qs=({correlationId:Ya}=this.eqa.S4e()).returnValue;this.ue.WTg&&(this.gP.url=ta,u.a.instance&&(u.a.instance.qHe=k.a.eK(ta)));let Da=null;this.Ah&&(Da=this.Ah.Kc("WebServiceCall","ConnectToServer"));c.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",
this.im);ta={};this.RZb&&(ta.transport=1===this.RZb.length?this.RZb[0]:this.RZb);ta.pingInterval=null;t.a.instance.XJb(1,0);ta.waitForPageLoad=!1;this.gP.start(ta,null).done(ba=>{this.Ml.DVf();t.a.instance.XJb(1,1,!0);c.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",ba.id,Ya)}).fail(ba=>{c.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.eqa.AC,Ya,this.im);
this.bFf();this.Ml.BVf(ba);t.a.instance.XJb(1,1,!1);this.Ug.KTf(0,{["CorrelationId"]:Ya,["ErrorDetails"]:ba,["ConnectionState"]:f.a[this.BL]})}).always(()=>{Da&&Da.stop();u.a.instance&&(u.a.instance.ELc=!1)})}disconnect(){0===this.BL?c.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.im):(this.Ml.GVf(),u.a.instance&&(u.a.instance.ELc=!0),c.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.im),this.dBa.pKa=
!0,this.mKc.GVi(),this.WV(0,this.BL),this.$8b(),this.dBa.pKa=!1)}GTj(ta){const Ya=this.$3g(),Da=this.gP,ba=this.t1,ya=()=>{if(this.$Uc)c.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.$Uc=!0,Da.stop(!0,ta)}catch(V){c.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",V.message)}};0<Ya?(c.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",ba,Ya),window.setTimeout(ya,Ya)):(c.ULS.sendTraceTag(36804372,
500,50,"Stopping connection [{0}].",ba),ya())}$3g(){let ta=0;0===this.gP.state&&(ta=this.FPc+ib.qak-(new Date).getTime(),0>ta&&(ta=0));return ta}get connectionState(){return this.BL}z2(ta){this.Ug.z2(ta)}a7(ta){this.Ug.a7(ta)}H5f(ta){this.Byc(0,ta)}Byc(ta,Ya){const Da=new e.a;this.Ug.NTf(ta,Ya,Da);return Da.task}SZa(ta){this.Ug.SZa(ta)}sRa(ta){this.Ug.sRa(ta)}WYc(ta){this.Ug.WYc(ta)}LNd(ta){this.Ug.LNd(ta)}Syb(ta){return this.k$h(ta)}ogd(){return this.ngd(0)}ngd(ta){const Ya={};for(let Da of this.LG)Da.value.kb(ta)&&
(Ya[Da.key]=Da.value.ma(ta).data);return Ya}k$h(ta){return this.LG.kb(ta)&&this.LG.ma(ta).kb(0)?this.LG.ma(ta).ma(0).data:null}n5i(ta,Ya){for(let Da of Ya.V7j)this.LG.kb(Da.key)||this.LG.ia(Da.key,new D.a),ta=Da.value,this.LG.ma(Da.key).ia(Ya.type,new y(ta.Presence,new Date(ta.TimeStamp))),Da.key===this._clientId&&0===Ya.type&&this.Ug.Ofj(ta.Presence)}m5i(ta,Ya){for(const Da of Ya.l4c)this.LG.remove(Da)}pSh(){const ta=new D.a;if(!this.LG.kb(this._clientId))return ta;for(let Ya of this.LG.ma(this._clientId))ta.ia(Ya.key,
Ya.value.data);return ta}lea(ta,Ya=null,Da=!1){const ba=new e.a;this.Ug.EKd(ta,Ya,Da,ba);return ba.task}UZa(ta){this.Ug.UZa(ta)}dLb(ta){this.Ug.dLb(ta)}swa(ta){let Ya,Da;return({value:Ya}=this.LG.Ic(ta)).returnValue&&({value:Da}=Ya.Ic(0)).returnValue?new l(this.o$h(Da),Da.timeStamp):null}vSh(){const ta={};for(let Ya of this.LG)Ya.value.Ic(0).returnValue&&(ta[Ya.key]=this.swa(Ya.key));return ta}chb(ta){const Ya=new e.a;this.Ug.tgj(ta,Ya);return Ya.task}get clientId(){return this._clientId}get SPj(){return this.nHg}dispose(){this.du||
(this.dBa.Rv(),this.rh.$mj(this.Ml),this.Ml.HLd(),u.a.instance&&u.a.instance.lyd(),this.du=!0)}IUi(ta,Ya){this.Fhb(Ya,"StateChangedSignalR")&&this.WV(this.jIe(ta.newState),this.jIe(ta.oldState))}WV(ta,Ya){if((1!==this.BL||0!==Ya||1!==ta)&&this.BL!==Ya){var Da=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.BL,Ya,ta]));c.ULS.sendTraceTag(3290053,500,10,Da)}if(this.BL!==ta){switch(ta){case 2:u.a.instance&&
u.a.instance.XKi();this.t1=this.gP.id;c.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.t1,this.im);this.XIi(this.gP);c.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Da=null;this.Ah&&(Da=this.Ah.Kc("WebServiceCall","Receive First Presence"));const ba=this.Zib;this.Ug.cgj(Object(b.a)(this,this.Fhb,"verifyConnectionToken"),ba,this.mKc,Object(b.a)(this,this.N3c,"clearExistingPersistentState"),this.pSh(),Da);this.ue.rtcClientMessageTelemetryEnabled&&
m.ujd(this.Ug,this.ue,100*Math.random()<=this.ue.dwj).start();break;case 1:2===Ya&&c.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.t1);break;case 0:if(m.instance&&m.instance.stop(),this.dBa.pKa)c.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.t1);else{1===Ya&&(c.ULS.sendTraceTag(7672737,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",
this.t1),this.Ml.HVf());2===Ya&&c.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.t1);this.$8b();return}}this.BL=ta;this.Ug.lfj(ta,Ya)}}XIi(ta){if(ta&&ta.transport&&ta.transport.name){ta=ta.transport.name;var Ya=ta.toLowerCase();"websockets"===Ya?c.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",ta,this.im):"serversentevents"===Ya?c.ULS.sendTraceTag(4290752,
500,50,"Transport name - {0} for [{1}]",ta,this.im):"foreverframe"===Ya?c.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",ta,this.im):"longpolling"===Ya?c.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",ta,this.im):"mocktransport"!==Ya&&c.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",ta)}else c.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}X3i(){if(this.ue.O2f){const ta=k.a.xw(this.SOa,"mid");c.ULS.sendTraceTag(3249544,
500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.t1,ta)}else c.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.t1)}L3i(){c.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.t1)}M3i(ta){ta=a(742).RtcUtils.R$a(ta);if(this.ue.O2f&&ta.startsWith("Keep alive timed out.")){const Ya=k.a.xw(this.SOa,"mid");c.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",ta,Ya)}else this.SPj&&2E3>this.Ule&&
!ta.startsWith("Invok")&&!ta.startsWith("Trigger")&&(c.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",ta),this.Ule++)}N3c(){let ta;const Ya=[];({value:ta}=this.LG.Ic(this._clientId)).returnValue&&this.LG.remove(this._clientId);for(let Da of this.LG.keys)Array.add(Ya,Da);for(const Da of Ya)this.LG.remove(Da);ta&&this.LG.ia(this._clientId,ta);this.Ug.Ifj(Ya)}jIe(ta){switch(ta){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",ta,"Unknown SignalR state");
}}o$h(ta){return ta&&ta.timeStamp?(new Date).getTime()-ta.timeStamp.getTime()>(this.ue.CYg?6E4:this.ue.BYg)?2:1:1}static createInstance(ta,Ya,Da,ba,ya,V,Z,ja=null,la=null,ua=null,eb=null,Eb=null,Wb=null){return pa(ta,Ya,Da,Wb,ba,ya,V,Z,ja,la,ua,Eb,eb)}}ib.pxf=31E3;ib.hAd=8E3;ib.qak=15E3;Object(r.a)(ib,"RealtimeChannel",null,[247,980])},901:function(r,B,a){a.d(B,"a",function(){return c});r=a(0);class c{constructor(){this.Ame=!1;this.ESc=null;this.K8d=0;this.TLc=this.qLe();this.BTb=this.qLe();this.YDa=
this.RWa=0;this.vw=()=>new Date}get CUj(){return this.Ame}qLe(){const b=Array(6);for(let e=0;e<b.length;e++)b[e]=0;return b}WYh(){return this.TLc.toString()}KVh(){return this.BTb.toString()}ISj(){this.ESc=this.vw()}XJb(b,e,f=!1){this.CUj||(f&&(this.Ame=!0),f=this.vw(),0===b&&5<this.RWa||1===b&&5<this.YDa||(this.K8d<b?(1===this.RWa%2&&(this.TLc[this.RWa]=-1,this.RWa++),this.K8d=b,1===e&&(this.BTb[this.YDa]=-1,this.YDa++),this.BTb[this.YDa]=this.uYd(f),this.YDa++):0===b?(this.TLc[this.RWa]=this.uYd(f),
this.RWa++):(this.BTb[this.YDa]=this.uYd(f),this.YDa++)))}uYd(b){const e=b.getTime()-this.ESc.getTime();this.ESc=b;return e}static get instance(){c.Ma||(c.Ma=new c);return c.Ma}static set instance(b){c.Ma=b}}c.Ma=null;Object(r.a)(c,"LatencyMetrics",null,[])},963:function(r,B,a){r=a(0);var c=a(15),b=a(88),e=a(115),f;(function(k){k[k.SendNotification=0]="SendNotification";k[k.SendPersistentState=1]="SendPersistentState";k[k.FindSession=2]="FindSession";k[k.Last=3]="Last"})(f||(f={}));Object(r.b)("ApiType",
f);var d;(function(k){k[k.AttemptCount=0]="AttemptCount";k[k.SuccessCount=1]="SuccessCount";k[k.DropCount=2]="DropCount";k[k.FailedCount=3]="FailedCount";k[k.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";k[k.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";k[k.ThrottledCount=6]="ThrottledCount";k[k.Last=7]="Last"})(d||(d={}));Object(r.b)("EventCountType",d);var h=a(901);a.d(B,"a",function(){return l});class l{constructor(k){this.qHe=this.QZe=null;this.oxf=this.R0e=0;this.Ml=null;
this.vfe=this.uQc=0;this.rh=k;this.Yli();this.ELc=this.gae=this.SQc=!1;this.oQc=0}get jIh(){return this.ELc}HSj(k){this.vfe=k;window.setInterval(Object(b.a)(this,this.lyd,"logMetricsBatchAndReset"),k);this.uQc=(new Date).getTime()}fy(k,w){this.FJj(k)&&!this.gae||this.jIh||!window.navigator.onLine||this.rh.e8a||(this.Ml[k][w]++,this.SQc=!0)}Yli(){this.Ml=Array(3);for(let k=0;3>k;k++){this.Ml[k]=Array(7);for(let w=0;7>w;w++)this.Ml[k][w]=0}}X0g(){const k={};for(let w=0;3>w;w++)for(let n=0;7>n;n++)this.GAi(w,
n)&&(k[f[w]+d[n]]=this.Ml[w][n]);k.FSDomain=this.QZe;k.ConnectionDomain=this.qHe;k.FSRetryInterval=this.R0e;k.MaxPayloadSize=this.oxf;k.LogNumber=this.oQc;1===this.oQc&&(k.FSLatencies=h.a.instance.WYh(),k.ConLatencies=h.a.instance.KVh());return k}GAi(k,w){return 2===k&&3!==w&&0!==w?!1:!0}FJj(k){return 2===k?!1:!0}lyd(){if(this.SQc){this.oQc++;if((new Date).getTime()-this.uQc<5E3+this.vfe){var k=e.a.toJSON(this.X0g());c.ULS.sendTraceTag(50644352,500,15,k)}this.uQc=(new Date).getTime();for(k=0;3>k;k++)for(let w=
0;7>w;w++)this.Ml[k][w]=0;this.SQc=!1}}XKi(){this.gae=!0}static get instance(){return l.Ma}static create(k){l.instance||(l.Ma=new l(k));return l.instance}}l.Ma=null;Object(r.a)(l,"FrequentLoggingMetrics",null,[992])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.cl.js.map/785befe5aa32ad03c2d836c6fafae066/EwaDSEsNext.cl.js.map