'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[25],{1152:function(r,B,a){a.d(B,"a",function(){return b});var c=a(517);const b=()=>{c.a.ni(".ewa-excelLive-meetingPill-container{height:24px;transition:height 400ms cubic-bezier(.8,0,.2,1) 0s;position:absolute;width:100%;bottom:0;pointer-events:none;z-index:992}.ewa-excelLive-meetingPill-container-hidden{height:0 !important;overflow:hidden;transition:height 400ms cubic-bezier(.8,0,.2,1) 0s}.ewa-excelLive-meetingBoundary-container{position:fixed;z-index:992}")}},
1176:function(r,B,a){var c=a(9);r=a(0);var b=a(714),e=a(38),f=a(157),d=a(196);class h{constructor(F,na){this.$=F;this.excelLiveManager=na}Mc(){return!1}Ac(F,na){switch(na.command){case 1491932557:return f.h(this.$)&&2===this.excelLiveManager.ibb.Nk;default:return!1}}executeCommand(F,na){F=e.TaskExtensions.Yj();const hb=na.command;switch(na.command){case 1491932557:this.excelLiveManager.ICc();break;default:F=d.a(hb)}return F}Rc(){return!1}}Object(r.a)(h,"ExcelLiveCommandHandler",null,[222]);class l extends b.a{constructor(F){super(F)}ld(){this.$.da.hb(473,
F=>{this.fd([new h(this.$,F)])})}static la(F){b.a.Rd(469,new l(F))}}Object(r.a)(l,"ExcelLiveCommandHandlerFactory",b.a,[]);var k=a(15),w=a(228),n=a(87),x=a(8),m=a(51),u=a(24),t=a(44),y=a(21),v=a(225),A=a(35),z=a(5);const C=(F,na)=>{F=document.getElementById(F.Cb+z.a.v2a);return{QRb:F.clientWidth/na,MRb:F.clientHeight/na}};var H=a(49),I=a(277),S=a(612),P=a(11),D;(function(F){F[F.complete=0]="complete";F[F.nonComplete=1]="nonComplete";F[F.unknown=2]="unknown"})(D||(D={}));Object(r.b)("FollowerViewState",
D);var G;(function(F){F[F.none=0]="none";F[F.selection=1]="selection";F[F.scroll=2]="scroll";F[F.zoom=4]="zoom";F[F.default=0]="default"})(G||(G={}));Object(r.b)("UpdateType",G);var E=a(59),O;(function(F){F[F.presenter=0]="presenter";F[F.follower=1]="follower";F[F.explorer=2]="explorer";F[F.unknown=3]="unknown"})(O||(O={}));Object(r.b)("ParticipantRole",O);class N{constructor(){this.average=0;this.max=Number.MIN_SAFE_INTEGER;this.min=Number.MAX_SAFE_INTEGER;this.recordsCount=this.last=0}pI(F){F=parseFloat(F.toFixed(4));
this.min=F<this.min?F:this.min;this.max=F>this.max?F:this.max;++this.recordsCount;this.average=parseFloat(((F+this.average*(this.recordsCount-1))/this.recordsCount).toFixed(4));this.last=F}toString(){return`{average: ${this.average}, min: ${this.min}, max: ${this.max}, last: ${this.last}, recordsCount: ${this.recordsCount}}`}}Object(r.a)(N,"Aggregates",null,[]);class J{constructor(F){this.hM=[25,50,100,250,500,1E3,2E3,5E3];this.hrb={};this.vue=new N;this.hM=null!==F&&void 0!==F?F:this.hM;for(F=0;F<=
this.hM.length;F++){let na=Number.NEGATIVE_INFINITY,hb=Number.POSITIVE_INFINITY;0<F&&(na=this.hM[F-1]+1);F<this.hM.length&&(hb=this.hM[F]);this.hrb[F]={bucketId:`[${na}-${hb}]`,count:0}}}pI(F,na){const hb=this.MKh(na);-1===hb?k.ULS.sendTraceTag(509442069,0,15,`BucketAggregates.record: could not find bucket for value: ${na}, caller: ${F}.`):(++this.hrb[hb].count,this.vue.pI(na))}toString(){const F={};F.Aggregates=this.vue;let na={};for(let hb=0;hb<=this.hM.length;hb++)1>this.hrb[hb].count||(na[this.hrb[hb].bucketId]=
this.hrb[hb].count);0<Object.keys(na).length&&(F.Buckets=na);return E.a.Ec(F)}MKh(F){let na=0,hb=this.hM.length-1;var Ib=this.hM[na];const vc=this.hM[hb];if(F<=Ib||F>vc)return F<=Ib?0:this.hM.length;for(;na<=hb;){Ib=Math.floor((na+hb)/2);if(F===this.hM[Ib]||0!==Ib&&F<this.hM[Ib]&&F>this.hM[Ib-1])return Ib;F<this.hM[Ib]?hb=Ib-1:na=Ib+1}return-1}}Object(r.a)(J,"BucketAggregates",null,[]);const W=(F,na)=>{k.ULS.sendTraceTag(523015437,0,50,`${na} = ${F}`)};var ea=a(1);class R{constructor(F,na,hb){this.tYe=
this.zAf=this.yAf=this.Led=this.j0e=this.Jpg=this.wGc=this.Ycd=this.sYe=this.AIb=0;this.pmc=void 0;this.r4d=this.jZd=0;this.Zpf=!1;this.Ttc=this.dmc=this.Crf=this.ybc=this.hed=this.Hbb=this.poc=0;this.S4c=3E3;this.$=F;this.AIb=na;this.S4c=ea.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLive.CommandExecIntervalForValidExplorerTransitionMs",3E3);this.nxc=new Map;this.nxc[O[hb]]=1;this.hJa=hb;this.Ttc=na;this.pQd=new Map;this.oxc=new Map;this.fyf=new N;this.eyf=new N;this.Dhg=new N;this.JEb(300)}dispose(){this.$=
null}S9a(){var F=P.HelperMethods.Lb();const na={};na.FollowerViewState=0<this.Led?"Hybrid":D[this.pmc];na.FollowerViewStateTransitions=this.Led;na.FollowerZoomInOppositeDirectionCount=this.j0e;na.ExplorerConsumptionTrends=0<this.tYe?"WorkbookEdited":"WorkbookViewed";na.ExplorerNSVModeTrends=this.yAf;na.ExplorerNSVSwitchTrends=this.zAf;na.ViewportChangesInNonCompleteViewCount=this.Jpg;na.ParticipantSessionInitTimestamp=this.AIb;na.FirstMessageIdReceived=this.hed;na.LastMessageIdReceived=this.Crf;na.FirstMessageReceivedTimestamp=
this.ybc;na.LastMessageReceivedTimestamp=this.dmc;na.TimeSinceLastMessageReceivedInMs=F-this.dmc;na.TotalMessagesReceived=this.poc;na.MessagesReceptionLatencyAggregates=this.fyf;na.MessagesProcessSynchronousLatencyAggregates=this.eyf;na.timeToSyncViewportAggregates=this.Dhg;na.PresenterIdentifiedTimestamp=this.Hbb;na.PresenterID=this.fAa;na.TimeToIdentifyPresenterFromCreationInMs=this.Hbb-this.AIb;na.PresenterIdentifyingFunction=this.TQf;na.CurrentRole=this.hJa;na.TimeInCurrentRole=F-this.Ttc;na.PreviousRole=
this.pJd;na.RoleSwitchCounts=this.nxc;na.RoleSwitchDurationsInMs=this.pQd;na.RoleSwitchDurationsTrackerAggregates=this.oxc;F=E.a.Ec(na);this.$.sendBeaconTraceTag(523015447,50,!1,`ExcelLiveFollowerOrExplorer.logSessionTelemetry: ${F}`)}iuf(){2E3>P.HelperMethods.Lb()-this.wGc&&(++this.Jpg,W(P.HelperMethods.Lb()-this.wGc,"ExcelLiveFollowerOrExplorer.logNonCompleteViewStateTelemetry: TimeElapsedSinceLastViewportChange"),this.wGc=0)}zZj(F,na){this.pmc&&F!==this.pmc&&++this.Led;this.pmc=F;W(P.HelperMethods.Lb()-
na,"ExcelLiveFollowerOrExplorer.trackAndLogFollowerViewStateTransitions: TimeTakenToSyncFollowerViewport")}EZj(F,na){na=P.HelperMethods.Lb()-na;this.eyf.pI(na);this.Dhg.pI(Date.now()-F)}yZj(F,na,hb){this.Ycd=P.HelperMethods.Lb();++this.sYe;1===this.sYe&&W(P.HelperMethods.Lb()-this.AIb,"ExcelLiveFollowerOrExplorer.trackAndLogExplorerTransitions: TimeToFirstExplorerTransition");k.ULS.sendTraceTag(523015444,0,50,`ExcelLiveFollowerOrExplorer.trackAndLogExplorerTransitions: Last Update Type from Presenter Was = ${G[F]}. Current View State = ${y.h(this.$).Yja().ZC(!0)}. Explorer role transition caused by = ${na}`);
hb&&-1!==na.indexOf("OnGoToEnded")&&(F=P.HelperMethods.Lb()-hb.timestamp,(F>this.S4c||F<=this.S4c&&hb.isSystemInitiated)&&k.ULS.sendTraceTag(509166596,0,15,`ExcelLiveFollowerOrExplorer.ExplorerTransitionWarning: CommandName = ${hb.commandName},
        IsSystemInitiated = ${hb.isSystemInitiated},
        TimeSinceLastCommand = ${F},
        Caller = ${na}`))}AZj(F){this.Ypf(F,A.a(this.$).zoom)!==this.Zpf&&(F=P.HelperMethods.Lb()-this.r4d,1E4>F&&(W(F,"ExcelLiveFollowerOrExplorer.trackAndLogFollowerZoomTrends: TimeToZoomChangeInOppositeDirection"),this.r4d=0),this.GZj())}GZj(){P.HelperMethods.Lb()<this.AIb+12E4&&++this.j0e}OIi(){const F=P.HelperMethods.Lb()-this.Ycd;5E3>F&&W(F,"ExcelLiveFollowerOrExplorer.logSyncBackToPresenterTelemetry: TimeElapsedToSyncBackSinceBecomingExplorer");this.Ycd=0}NIi(F=!1,na,hb){W(P.HelperMethods.Lb()-
this.jZd,`ExcelLiveFollowerOrExplorer.logSyncBackToPresenterTelemetry: Synced via Presence Notification = ${F}, IsSyncBack = ${na}, Retries = ${hb} TimeElapsedInSyncingExplorerBackToPresenter`);this.jZd=0}HZj(F){typeof F===typeof S.a?++this.yAf:++this.zAf}Ypf(F,na){return na>F?!0:na==F?void 0:!1}LZj(){this.jZd=P.HelperMethods.Lb()}MZj(){this.wGc=P.HelperMethods.Lb()}NZj(F,na){this.r4d=P.HelperMethods.Lb();this.Zpf=this.Ypf(F,na)}FZj(){++this.tYe}CZj(F,na){var hb;const Ib=P.HelperMethods.Lb();var vc=
Date.now();0===this.hed&&(this.hed=F,this.ybc=Ib);this.Crf=F;++this.poc;na=vc-na;1<this.poc&&this.fyf.pI(na);vc=Ib-(null!==(hb=this.dmc)&&void 0!==hb?hb:this.ybc);this.dmc=Ib;k.ULS.sendTraceTag(523015443,0,50,`ExcelLiveFollowerOrExplorer.trackAndLogMessageReceived: Received message number [${this.poc}] MessageID: [${F}] Time since last message: [${vc}]ms with reception latency: [${na}]ms`)}bIi(){const F=P.HelperMethods.Lb(),na=this.fAa;this.fAa=void 0;k.ULS.sendTraceTag(509682772,0,15,`ExcelLiveFollowerOrExplorer.logPresenterRemoval: Presenter removed/reset at [${F}] after [${F-
this.Hbb}]ms since last identification. Previous presenter ID: [${na}]`)}uyd(F,na="PresenterUpdate"){this.Hbb=P.HelperMethods.Lb();this.fAa=F;this.TQf=na;k.ULS.sendTraceTag(523015442,0,50,`ExcelLiveFollowerOrExplorer.logPresenterIdentified: Presenter identified at [${this.Hbb}] after [${this.Hbb-this.ybc}]ms since first valid message with clientId=[${this.fAa}] via [${this.TQf}]`)}KZj(F){var na,hb;if(this.hJa!==F){var Ib=P.HelperMethods.Lb(),vc=O[this.hJa],nc=O[F];this.nxc[nc]=1+(null!==(na=this.nxc[nc])&&
void 0!==na?na:0);na=Ib-this.Ttc;this.pQd[vc]=na+(null!==(hb=this.pQd[vc])&&void 0!==hb?hb:0);this.oxc.has(vc)||(this.oxc[vc]=new N);this.oxc[vc].pI(na);this.Ttc=Ib;this.pJd=this.hJa;this.hJa=F;this.S9a()}}JEb(F){const na=()=>{this.S9a();H.a.instance.create(na,1E3*F,"ExcelLiveFollowerOrExplorer.logSessionTelemetryAtSpecifiedInterval",void 0,!0)};na.call(this)}}Object(r.a)(R,"ExcelLiveFollowerOrExplorerTelemetryHelper",null,[3]);a(1358);class Y extends Sys.EventArgs{constructor(F,na){super();this.aub=
F;this.hcj=na}}Object(r.a)(Y,"ExcelLiveViewStateChangedArgs",Sys.EventArgs,[]);class U extends Sys.EventArgs{constructor(F,na){super();this.QSe=F;this.dQe=na}}Object(r.a)(U,"ExcelLiveMeetingPresenceStateUpdatedArgs",Sys.EventArgs,[]);var da=a(39),T=a(33);class ka extends da.a{constructor(F,na){super();this.statusBarManager=null;this.aub=2;this.VQf=null;this.yMf=(hb,Ib)=>{this.aub=Ib.aub;this.VQf=Ib.hcj.toString();this.Az()};this.$=F;this.$.da.hb(29,hb=>{this.statusBarManager=hb;hb.rJ(this)});this.ur=
na;this.ur.Gte(this.yMf)}vq(F){this.addHandler("followerViewStateInfoChanged",F)}Wq(F){this.removeHandler("followerViewStateInfoChanged",F)}Az(){this.yn("QueryExcelLiveViewState")&&this.raiseEvent("followerViewStateInfoChanged")}$r(F,na){return"QueryExcelLiveViewState"!==F?!1:this.Kdi(na)}yn(){return Object(f.h)(this.$)&&ea.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShowExcelLiveViewStateInStatusBar",!1)}dispose(){this.statusBarManager&&(this.statusBarManager.SF(this),this.statusBarManager=
null);this.ur.HZf(this.yMf);this.$=this.ur=null;super.dispose()}Kdi(F){if(!this.$)return!1;const na=`View State: ${D[this.aub]} | Presenter Visible Range: ${this.VQf}`;T.a.xn()?(F.LabelText=na,F.Visible=!0):F.Value=na;return!0}}Object(r.a)(ka,"ExcelLiveStatusBarManager",da.a,[3,368,213]);var L=a(73);const fa=new Set("ZoomManager.ZoomFitToScreen ApplicationZoom ExcelLiveFollowerOrExplorerApp.SyncViewportToMatchOrigin ExcelLiveFollowerOrExplorer.syncViewportForNonCompleteViewState GridView.OnActiveItemChanged GridView.TryContinueGotoProcessing".split(" ")),
wa=F=>{F=F.endsWith("_Vacs")?F.split("_",1)[0]:F;return!fa.has(F)},oa=F=>Object(f.h)(F)&&ea.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelityTracker",!1);var xa=a(53);class bb{constructor(F,na,hb,Ib,vc=null){this.iwd=this.jAa=this.statusBarManager=null;this.hVa=2;this.rZ=this.tJb=0;this.QYe=10;this.RYe=1E3;this.SYe=3E4;this.ANa=!1;this.ur=this.hrf=null;this.B3d=.98;this.$sd=this.kxa=this.RMa=this.NNa=this.Rrd=!1;this.jqi=ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7503400_AwaitCoAuthMerge");
this.Cui=ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7396411_InitializeRoleOnlyIfNotSame");this.v7a=ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7451504_DependOnUserListChangedEventForPresenterDetails");this.HBb=f.f();this.qD=(Pb,oc)=>{var Ic,ec;this.hrf={commandName:null===(Ic=xa.b())||void 0===Ic?void 0:Ic.Ij(oc.Ud.command),isSystemInitiated:null===(ec=this.$.Ia.j4(oc.Ud.command))||void 0===ec?void 0:ec.isSystemInitiated,timestamp:P.HelperMethods.Lb()}};const nc=P.HelperMethods.Lb();k.ULS.sendTraceTag(509642590,
0,50,"ExcelLiveFollowerOrExplorer:Ctor");this.controller=hb;this.realtimeChannel=na;this.uya=vc;this.ur=Ib;this.$=F;this.gridView=y.h(F);this.Jn=new R(this.$,nc,3);this.statusBarManager=new ka(this.$,this.ur);this.B3d=this.$.ya.ExcelLiveViewportRoundOffFactor;this.QYe=this.$.ya.FetchPresenterNavigationStateMaxRetries;this.RYe=this.$.ya.FetchPresenterNavigationStateRetryBaseInMs;this.SYe=this.$.ya.FetchPresenterNavigationStateRetryMaxDelayInMs;this.DHa();this.kXg();2===this.realtimeChannel.connectionState?
this.CPb():this.realtimeChannel.z2(this.BR)}dispose(){this.hph();2!==this.controller.Nk&&(this.BNe(),this.zNe());this.ANa&&(this.controller.jdb(this.L_),this.ANa=!1);this.iwd=this.Pwd=this.fEb=this.jAa=null;this.G2a();this.$=this.gridView=this.controller=this.realtimeChannel=this.ur=null}bRa(F){this.G2a();this.realtimeChannel=F;this.Xxe()}ICc(){this.Jn.LZj();this.CPb(!0)}ydd(F=null){const na=null!==F&&void 0!==F?F:this.realtimeChannel.ogd();if(na)for(var hb in na){var Ib=hb;F=na[hb];if(!F)break;if(F.NavigationState&&
F.MeetingInfo&&(F.MeetingInfo.MeetingId===this.$.ya.MeetingId||f.e()))return this.Jn.CZj(F.MeetingInfo.MessageId,F.NavigationState.MessageBroadcastTime),this.HBb&&this.v7a?this.controller.Pwe?F.NavigationState.DurationSinceFirstBroadcast&&(hb=P.HelperMethods.Lb(),this.ur.yKd(new U(hb,F.NavigationState.DurationSinceFirstBroadcast))):this.controller.W2d(Ib,"ExcelLiveFollowerOrExplorer:extractNavigationStateFromMeetingPresence")?(this.Jn.uyd(Ib),this.ANa&&(this.ANa=!1,this.controller.jdb(this.L_))):
this.ANa||(this.controller.vpb(this.L_),this.ANa=!0):this.controller.Kz&&this.controller.Kz===Ib?F.NavigationState.DurationSinceFirstBroadcast&&(hb=P.HelperMethods.Lb(),this.ur.yKd(new U(hb,F.NavigationState.DurationSinceFirstBroadcast))):this.controller.W2d(Ib,"ExcelLiveFollowerOrExplorer:extractNavigationStateFromMeetingPresence")&&this.Jn.uyd(Ib),F.NavigationState}return null}a4g(F,na,hb){return hb+(na-F)/F*hb*100/100}Tah(F,na,hb=!1){if(!F)return 0;if(!na&&F)return 7;if(hb){if(!ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7532554_NonCompleteViewSyncBackFix1"))return 7;
na=t.E(F.SelectedRanges[F.IndexOfActiveRange]);return t.E(F.VisibleAreaRange).vd(na)?7:6}hb=t.E(F.SelectedRanges[F.IndexOfActiveRange]);var Ib=t.E(na.SelectedRanges[na.IndexOfActiveRange]),vc=t.E(F.VisibleAreaRange),nc=t.E(na.VisibleAreaRange);if(na.SheetID===F.SheetID&&(na.SheetID!==F.SheetID||na.ZoomLevel===F.ZoomLevel&&hb.equals(Ib)&&vc.equals(nc)&&na.TopLeftCellOffsets.X===F.TopLeftCellOffsets.X&&na.TopLeftCellOffsets.Y===F.TopLeftCellOffsets.Y))return 0;Ib=t.E(F.VisibleAreaRange);hb=t.E(F.SelectedRanges[F.IndexOfActiveRange]);
Ib=u.Range.Hc(Ib.top,Ib.left);vc=new m.a(F.TopLeftCellOffsets.X,F.TopLeftCellOffsets.Y);var Pb=t.E(na.VisibleAreaRange);nc=t.E(na.SelectedRanges[na.IndexOfActiveRange]);Pb=u.Range.Hc(Pb.top,Pb.left);const oc=new m.a(na.TopLeftCellOffsets.X,na.TopLeftCellOffsets.Y);let Ic=0;F.SheetID!==na.SheetID?Ic|=3:(nc.equals(hb)||(Ic|=1),F.ZoomLevel!==na.ZoomLevel&&(Ic|=4),vc.equals(oc)&&Ib.equals(Pb)||(Ic|=2));return Ic}D6(){this.Jn.AZj(this.jAa.ZoomLevel);if(oa(this.$)){const F=this.bHe(this.jAa),na=t.E(this.jAa.VisibleAreaRange);
this.hVa!==F&&(this.hVa=F,this.ur.oTf("onZoomChangedByUser",new Y(this.hVa,na)))}}Urc(){this.iab("OnUserInitiatedDirectScroll")}Di(){this.iab("OnEditStarted")}Lrc(){this.iab("OnTextInput")}Rqc(F,na){F=P.HelperMethods.Lb();this.$cj(na.waa);this.Cdj(na.vL,F)}Zd(){this.NNa||this.RMa||this.iab("OnActiveItemChanged")}Oqc(F,na){1!==this.controller.Nk||this.NNa||this.Rif()?this.Jn.FZj():this.iab(`${"OnLocalUserEditHappened"}:${na.commandName}`)}Xxe(){var F;null===(F=this.realtimeChannel)||void 0===F?void 0:
F.SZa(this.Rqc)}G2a(){var F,na;null===(F=this.realtimeChannel)||void 0===F?void 0:F.a7(this.BR);null===(na=this.realtimeChannel)||void 0===na?void 0:na.sRa(this.Rqc)}CPb(F=!1,na=null){var hb;F&&this.Jn.OIi();if(na)this.BPb(na)||this.kxa?this.wpd(F):k.ULS.sendTraceTag(527496925,0,15,"ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry: Could not sync to presenter from presence update"),this.rZ=0;else if(++this.rZ,this.rZ>this.QYe)k.ULS.sendTraceTag(527496924,0,10,`ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry: Presenter Nav State not available after ${this.rZ-
1} retries.`),this.Rrd=!0,this.rZ=0;else{if(1===this.rZ){const Ib=null!==(hb=this.iwd)&&void 0!==hb?hb:this.jAa;if(null!==Ib&&(this.BPb(Ib,!0)||this.kxa)){this.wpd(F,!0,this.rZ);this.rZ=0;return}}(hb=this.ydd())&&(this.BPb(hb)||this.kxa)?(this.wpd(F,!0,this.rZ),this.rZ=0):1!==this.controller.Nk&&(this.PUa(3,"ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry"),k.ULS.sendTraceTag(527496923,0,15,`ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry: Retry
           ${this.rZ} - Presenter Nav State not available.`),H.a.instance.create(()=>{this.CPb(F,na)},I.a.ELa(this.rZ,this.RYe,this.SYe,!0),"ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry",void 0,!0))}}wpd(F=!1,na=!1,hb=0){this.Cui&&1===this.controller.Nk||(this.PUa(1,"ExcelLiveFollowerOrExplorer::initializeFollower"),this.jXg(),this.gXg(),this.Rrd=!1,F&&this.Jn.NIi(na,F,hb),this.controller.Wof&&this.controller.zXe.i0d())}DHa(){this.Rqc=this.Rqc.bind(this);this.Ow=this.Ow.bind(this);
this.tD=this.tD.bind(this);this.xf=this.xf.bind(this);this.Di=this.Di.bind(this);this.Lrc=this.Lrc.bind(this);this.Oqc=this.Oqc.bind(this);this.D6=this.D6.bind(this);this.yc=this.yc.bind(this);this.xab=this.xab.bind(this);this.xqc=this.xqc.bind(this);this.qD=this.qD.bind(this);this.Zd=this.Zd.bind(this);this.Urc=this.Urc.bind(this);this.BR=this.BR.bind(this);this.v7a&&(this.L_=this.L_.bind(this))}PYe(){let F=this.ydd();return this.BPb(F)}L_(){k.ULS.sendTraceTag(509616403,0,50,"ExcelLiveFollowerOrExplorer::onPresenterDetailsSaved invoked");
this.Jn.uyd(this.controller.Kz,"UserListChanged");this.controller.jdb(this.L_);this.ANa=!1}PUa(F,na){var hb,Ib;this.Jn.KZj(F);this.controller.PUa(F,na);2===F?null===(hb=this.uya)||void 0===hb?void 0:hb.tKi():1===F&&(null===(Ib=this.uya)||void 0===Ib?void 0:Ib.uKi())}BPb(F,na=!1){const hb=P.HelperMethods.Lb(),Ib=this.Tah(F,this.jAa,na);if(0===Ib)return this.D3f(Ib,F),!0;if(!this.Z0j(F.SheetID))return!1;Ib&4&&this.setZoom(this.jAa,F);na=this.bHe(F);this.nVj(F,Ib,na);this.D3f(Ib,F);F=t.E(F.VisibleAreaRange);
this.hVa!==na&&(this.hVa=na,this.ur.oTf("syncFollowerViewportWithPresenter",new Y(this.hVa,F)));this.Jn.zZj(this.hVa,hb);return!0}nVj(F,na,hb){0===hb?this.agg(na,F):this.oVj(na,F)}D3f(F,na){this.jAa=na;this.tJb=F}Z0j(F){F=this.$.ua.getItemByName(F);let na=this.$.ua.na;if(!F)return this.kxa=!0,!1;if(F!==na){if(!F.visible)return!1;this.NNa=!0;F.activate();na=F}if(!na.ie.tK&&!na.ie.uz)return!0;this.$.Yc(1690118309,L.a.zb,0,{[f.b]:!0}).continueWith(()=>!0);return!0}setZoom(F,na){if(F&&F.SheetID===na.SheetID){const hb=
A.a(this.$).zoom;F=this.a4g(F.ZoomLevel,na.ZoomLevel,hb);A.a(this.$).Zqg(F);this.Jn.NZj(F,hb)}}agg(F,na){F&2&&(F=t.E(na.VisibleAreaRange),this.fEb=u.Range.Hc(F.top,F.left),this.Pwd=new m.a(na.TopLeftCellOffsets.X,na.TopLeftCellOffsets.Y),na=v.a(this.fEb,this.Pwd,this.gridView.Ep,this.gridView.jb,0,0,this.$,this.gridView.DZ()),this.gridView.r1b(na,this.fEb,"ExcelLiveFollowerOrExplorerApp.SyncViewportToMatchOrigin",60,this.fEb))}oVj(F,na){const hb=t.E(na.SelectedRanges[na.IndexOfActiveRange]),Ib=F!==
this.tJb,vc=t.E(na.VisibleAreaRange);F&1?(this.Z$j=this.gridView.Yja(),this.gridView.yv(hb,64,"ExcelLiveFollowerOrExplorer.syncViewportForNonCompleteViewState",!0),{NO:this.fEb,oD:this.Pwd}=this.gridView.qwa(),Ib&&(this.$sd=!0)):F&2&&(!vc.vd(hb)||this.tJb&2||this.tJb&4)&&(this.agg(F,na),Ib&&this.Jn.iuf());this.Jn.MZj()}Wfi(F){const na=this.gridView.Yja();return na.vd(F)&&F.vd(na)?!0:!1}bHe(F){const {QRb:na,MRb:hb}=C(this.$,A.a(this.$).zoom);return na<F.ViewportWidth*this.B3d||hb<F.ViewportHeight*
this.B3d?1:0}jXg(){this.$.ea.wA(this.Ow);this.$.ea.LZa(this.tD);this.$.da.hb(419,F=>{F.oZc(this.D6);F.Ite(this.D6)})}BNe(){this.$&&(this.$.ea.wB(this.Ow),this.$.ea.ddb(this.tD),this.$.da.hb(419,F=>{F.dOd(this.D6);F.KZf(this.D6)}))}Ow(){this.$.ea.se!==x.a.re&&this.$.ea.Yb&&(this.kxa&&this.$.ea.ju(this.xf),this.RMa=!0)}xf(){(this.RMa||this.kxa)&&this.PYe()&&(this.$.ea.Lv(this.xf),this.kxa=this.RMa=!1)}BR(F,na){if(2===na.newState||2===this.realtimeChannel.connectionState)this.CPb(),this.realtimeChannel.a7(this.BR)}tD(){this.NNa?
this.NNa=!1:this.RMa&&this.PYe()&&(this.RMa=!1)}gXg(){var F;this.gridView.view.vSg(this.Urc);this.gridView.EYc(this.xqc);ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7662490_CheckCommandForExplorerTransition")&&(null===(F=this.$.Ia)||void 0===F?void 0:F.Gsa(this.qD));this.gridView.Xb.gl(this.Di);this.$.da.hb(65,na=>{na.XQg(this.Lrc)})}zNe(){var F,na;this.gridView&&(this.gridView.view.zqj(this.Urc),this.gridView.xNd(this.xqc),this.gridView.Xb.Zk(this.Di));const hb=this.$.da.Ba(65);hb&&hb.rpj(this.Lrc);
null===(na=null===(F=this.$)||void 0===F?void 0:F.Ia)||void 0===na?void 0:na.Ena(this.qD)}xqc(F,na){1!==this.controller.Nk||wa(na.gotoCaller)||k.ULS.sendTraceTag(523015448,0,50,"ExcelLiveFollowerOrExplorer.onGoToEnded: Function called for viewport sync action");!this.Rif()&&wa(na.gotoCaller)?this.iab(`${"OnGoToEnded"}:${na.gotoCaller}`):this.$sd&&this.Wfi(this.Z$j)&&(this.Jn.iuf(),this.$sd=!1)}iab(F){this.Dtj();this.Jn.yZj(this.tJb,F,this.hrf);this.PUa(2,"ExcelLiveFollowerOrExplorer::onExploreActionsObserved");
this.BNe();this.zNe();this.controller.Wof&&this.controller.zXe.i0d()}kXg(){this.Xxe();this.$.ea.Ose(this.Oqc);this.$.ij(this.yc);this.$.na.ie.QZa(this.xab);this.$.na.ie.P0b(this.xab);this.$.ua.Yf(this.Zd)}hph(){this.G2a();null!==this.$&&(this.$.ea.epj(this.Oqc),this.$.$k(this.yc),this.$.na.ie.UKb(this.xab),this.$.na.ie.FNd(this.xab),this.$.ua.yg(this.Zd))}$cj(F){!F||1>F.length||2===this.controller.Nk||F.forEach(na=>{na===this.controller.Kz&&(this.controller.bNd(),this.Jn.bIi(),this.PUa(3,"ExcelLiveFollowerOrExplorer:processDisconnectedClients"))})}Cdj(F,
na){!F||1>F.length||(F=this.ydd(F),null!==F&&(this.iwd=F,2!==this.controller.Nk&&(3===this.controller.Nk?this.CPb(this.Rrd,F):(this.BPb(F),this.Jn.EZj(F.MessageOriginTime,na)))))}Dtj(){this.kxa=this.NNa=!1}xab(F,na){this.Jn.HZj(na)}yc(F,na){na.Ef||this.Jn.S9a()}Rif(){return this.jqi?this.NNa||this.RMa:!1}}Object(r.a)(bb,"ExcelLiveFollowerOrExplorer",null,[]);class Za{constructor(F){this.Qtb=this.pSa=this.UQf=0;this.ded=Number.MAX_SAFE_INTEGER;this.GDb=Number.MIN_SAFE_INTEGER;this.AFb=0;this.$=F;this.UQf=
P.HelperMethods.Lb();this.$Zd=new N;this.JEb(300)}dispose(){this.$Zd=this.$=null}DZj(F){var na=y.h(this.$).ha.ra.activeRange;F=F.vd(na)?!0:!1;na=P.HelperMethods.Lb();if(!F&&0===this.pSa)this.pSa=na;else if(0<this.pSa){const hb=na-this.pSa;this.Qtb+=hb;this.pSa=na;F&&W(hb,"ExcelLivePresenter.trackAndLogSelectionVisibility: Selection was outside presenter Viewport. TimeSpentWithoutSelectionVisible")}}S9a(){var F=P.HelperMethods.Lb();const na=F-this.UQf;let hb=0;0<this.pSa&&(hb=F-this.pSa,this.Qtb+=
hb);const Ib={};Ib.PercentageTimeSelectionVisible=(na-this.Qtb)/na*100;Ib.TimeSpentWithoutSelectionVisibleSinceLastBroadcast=hb;Ib.FirstMessageBroadcastTimestamp=this.ded;Ib.LastMessageBroadcastTimestamp=this.GDb;Ib.TotalMessagesBroadcasted=this.AFb;Ib.TimeSinceLastBroadcastInMs=F-this.GDb;Ib.TimeToCreateNavigationStateAggregatesInMs=this.$Zd;F=E.a.Ec(Ib);this.$.sendBeaconTraceTag(523015439,50,!1,`ExcelLivePresenter.logSessionTelemetry: ${F}`)}BZj(F){++this.AFb;const na=P.HelperMethods.Lb();this.ded=
Math.min(this.ded,na);const hb=na-this.GDb;this.GDb=Math.max(this.GDb,na);k.ULS.sendTraceTag(523015438,0,50,`ExcelLivePresenter.trackAndLogMessageBroadcasted: Sent message number [${F}] after [${na-this.tzf}]ms of viewport change by presenter and after [${hb}]ms of sending previous message`)}IZj(){this.tzf=P.HelperMethods.Lb()}GHi(){const F=P.HelperMethods.Lb()-this.tzf;W(F,"ExcelLivePresenter.getCurrentViewportNavigationState: TimeToCreateNavigationState");this.$Zd.pI(F)}JEb(F){const na=()=>{this.S9a();
H.a.instance.create(na,1E3*F,"ExcelLivePresenter.logSessionTelemetryAtSpecifiedInterval",void 0,!0)};na.call(this)}}Object(r.a)(Za,"ExcelLivePresenterTelemetryHelper",null,[3]);class La{constructor(F,na,hb,Ib,vc=null){this.controller=this.kD=null;this.dPi=1E4;this.AFb=0;this.yyc=null;this.d2b=ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7396010_SessionReopenFixes");this.ur=this.uya=null;this.ged=0;this.Dfi=()=>null!==this.yyc;k.ULS.sendTraceTag(509642586,0,50,"ExcelLivePresenter:Ctor");this.$=F;
this.gridView=y.h(this.$);this.Jn=new Za(this.$);this.realtimeChannel=na;this.uya=vc;this.controller=hb;this.ur=Ib;this.DHa();this.KCj();2===this.realtimeChannel.connectionState?this.YXd():this.realtimeChannel.z2(this.BR)}dispose(){var F;this.lph();this.G2a();this.d2b&&(null===(F=this.yyc)||void 0===F?void 0:F.cancel(),this.yyc=null);this.$=this.gridView=this.controller=this.realtimeChannel=this.ur=null}bRa(F){this.G2a();this.realtimeChannel=F;this.Dfi?this.dJb():this.YXd()}rfc(){this.gridView.fLb(this.Bwa);
this.gridView.BT(this.zqc)}zqc(){this.dJb();this.gridView.YN(this.zqc);this.gridView.Apb(this.Bwa)}Bwa(){this.$.ua&&this.$.ua.xif||this.dJb()}DHa(){this.zqc=this.zqc.bind(this);this.Bwa=this.Bwa.bind(this);this.rfc=this.rfc.bind(this);this.yc=this.yc.bind(this);this.BR=this.BR.bind(this)}G2a(){var F;null===(F=this.realtimeChannel)||void 0===F?void 0:F.a7(this.BR)}YXd(){this.dJb(!0);this.IXg()}BR(F,na){if(2===na.newState||2===this.realtimeChannel.connectionState)this.YXd(),this.realtimeChannel.a7(this.BR)}IXg(){this.$.ua.sJ(this.rfc);
this.gridView.Apb(this.Bwa);this.gridView.ha.$L(this.Bwa);this.$.ij(this.yc)}lph(){this.$&&(this.$.ua.XK(this.rfc),this.$.$k(this.yc));this.gridView&&(this.gridView.fLb(this.Bwa),this.gridView.ha.NR(this.Bwa))}yc(F,na){na.Ef||this.Jn.S9a()}zWh(){const F=Date.now();this.Jn.IZj();let na=this.gridView.Yja();if(null===na)return null;let hb;({oD:hb}=this.gridView.qwa());const Ib={};Ib.MessageOriginTime=F;Ib.SheetID=this.$.na?this.$.na.sheetName:null;Ib.ZoomLevel=A.a(this.$).zoom;Ib.SelectedRanges=t.k(this.gridView.ha.ra.selectedRanges,
this.$);Ib.IndexOfActiveRange=this.gridView.ha.ra.Mq;Ib.VisibleAreaRange=t.v(na,this.$);Ib.TopLeftCellOffsets={};Ib.TopLeftCellOffsets.X=hb.x;Ib.TopLeftCellOffsets.Y=hb.y;const {QRb:vc,MRb:nc}=C(this.$,Ib.ZoomLevel);Ib.ViewportHeight=nc;Ib.ViewportWidth=vc;this.Jn.DZj(na);this.Jn.GHi();return Ib}KCj(){this.kD={};this.kD.MeetingId=this.$.ya.MeetingId;this.kD.IsPresenter=!0}dJb(F=!1){var na;F&&(this.yyc=H.a.instance.create(()=>{this.dJb(F)},this.dPi+this.Pah(),"ExcelLivePresenter::postViewportUpdatesToMeetingParticipants",
void 0,!0));if(2!==this.realtimeChannel.connectionState)k.ULS.sendTraceTag(521195807,0,15,`ExcelLivePresenter:postViewportUpdatesToMeetingParticipants RTC connection state is not connected. Current state:[${this.realtimeChannel.connectionState}]`);else{var hb=this.zWh();if(null===hb)k.ULS.sendTraceTag(527962826,0,15,"ExcelLivePresenter:postViewportUpdatesToMeetingParticipants CurrentViewportNavigationState is null");else{var Ib={};Ib.MeetingInfo=this.kD;Ib.MeetingInfo.MessageId=++this.AFb;Ib.NavigationState=
hb;Ib.NavigationState.MessageBroadcastTime=Date.now();oa(this.$)&&(hb=P.HelperMethods.Lb(),0===this.ged&&(this.ged=hb),Ib.NavigationState.DurationSinceFirstBroadcast=hb-this.ged);this.realtimeChannel.H5f(Ib);Ib.NavigationState.DurationSinceFirstBroadcast&&(hb=P.HelperMethods.Lb(),this.ur.yKd(new U(hb,Ib.NavigationState.DurationSinceFirstBroadcast)));null===(na=this.uya)||void 0===na?void 0:na.O5f(Ib.NavigationState);this.Jn.BZj(this.AFb)}}}Pah(){return 6001*Math.random()+-3E3}}Object(r.a)(La,"ExcelLivePresenter",
null,[]);var va=a(902);class Ba{constructor(F,na){this.Pnc=this.E2f=0;this.Zmd=!1;this.Pnc=P.HelperMethods.Lb();this.$=F;this.bva=na;this.vQd=new Map;this.dMb=new Map;this.xxc=new Map;this.M2f=this.Pnc;this.JEb(300)}dispose(){this.bva=this.$=null}xZj(F,na){var hb,Ib;const vc=P.HelperMethods.Lb(),nc=vc-this.M2f;this.Zmd=this.Zmd||2==na;2!==na&&this.Zmd&&++this.E2f;k.ULS.sendTraceTag(523015441,0,50,`ExcelLiveManagerTelemetryHelper::trackAndLogConnectionStateChanged: Recorded ConnectionState change from [${F}] to [${na}] after [${nc}]ms with current participant role [${this.bva.Nk}]`);
F=va.a[F];na=va.a[na];this.dMb.has(F)||(this.dMb[F]=1);this.dMb[na]=1+(null!==(hb=this.dMb[na])&&void 0!==hb?hb:0);this.vQd[F]=nc+(null!==(Ib=this.vQd[F])&&void 0!==Ib?Ib:0);this.xxc.has(F)||(this.xxc[F]=new N);this.xxc[F].pI(nc);this.M2f=vc;this.Dyd()}Dyd(){var F={};F.RTCDisconnects=this.E2f;F.RTCConnectionStateCounts=this.dMb;F.RTCConnectionStateDurationsInMs=this.vQd;F.RTCConnectionStateDurationsAggregatesInMs=this.xxc;F.MeetingID=this.$.ya.MeetingId;F.AmIPresenter=this.$.ya.IsMeetingPresenter;
F.MeetingManagerCreated=this.Pnc;F.SessionDurationInMs=P.HelperMethods.Lb()-this.Pnc;F=E.a.Ec(F);this.$.sendBeaconTraceTag(523015440,50,!1,`ExcelLiveManagerTelemetryHelper.logSessionTelemetry: ${F}`)}JEb(F){const na=()=>{this.Dyd();H.a.instance.create(na,1E3*F,"ExcelLiveManagerTelemetryHelper.logSessionTelemetryAtSpecifiedInterval",void 0,!0)};na.call(this)}}Object(r.a)(Ba,"ExcelLiveManagerTelemetryHelper",null,[]);var Ea=a(168);class pa{constructor(F,na,hb,Ib){this.jed=null;this.Z_d=!1;this.$og=
0;this.GRb=[];this.zac=0;this.d3d=new J;this.bqd=new J([50,75,90,95,98,100]);this.oh=F;this.lZd=na;this.ur=Ib;this.O7=hb;this.DHa();this.sm()}dispose(){this.saa();this.iPb("ExcelLiveSyncFidelityTracker.dispose");this.ur=this.bqd=this.d3d=null;this.lZd.dispose();this.oh=this.lZd=null}dYd(){!this.Z_d&&this.jed&&(this.Z_d=!0,this.rif(this.a2e(this.O7.c3d)),this.jif(this.a2e(this.O7.Yuf)))}iPb(F){var na,hb;k.ULS.sendTraceTag(509616465,0,50,`ExcelLiveSyncFidelityTracker:stopTracking: stopping sync fidelity tracking. caller: ${F}`);
this.Kyd();this.xtf();null===(na=this.b3d)||void 0===na?void 0:na.cancel();this.b3d=null;null===(hb=this.Syd)||void 0===hb?void 0:hb.cancel();this.Syd=null;this.zac=0;this.Z_d=!1}rif(F){this.b3d=Ea.AsyncMethodContext.f7b(()=>{const na=this.fSh(1E3*this.O7.c3d);this.zac=P.HelperMethods.Lb()+na;this.rif(na)},F,"ExcelLiveSyncFidelityTracker.invokeValidation",this.b3d);this.L9j()}L9j(){var F=this.eSh();if(F=this.lZd.validate(F))++this.$og,this.bqd.pI("ExcelLiveSyncFidelityTracker.intersectionPercentageAggregates",
F.intersectionPercentage),F.isValid||(10<=this.GRb.length&&this.Kyd(),this.GRb.push(F))}jif(F){this.Syd=Ea.AsyncMethodContext.f7b(()=>{this.jif(1E3*this.O7.Yuf)},F,"ExcelLiveSyncFidelityTracker.invokeLogging",this.Syd);this.Kyd();this.xtf()}Kyd(){var F;1>(null===(F=this.GRb)||void 0===F?void 0:F.length)||(F=E.a.Ec(this.GRb),k.ULS.sendTraceTag(509616464,0,15,`ExcelLiveSyncFidelityTracker.logValidationReport: ${F}, TotalValidationReportsInSession: ${this.$og}`),this.GRb=[])}xtf(){k.ULS.sendTraceTag(509616463,
0,50,`ExcelLiveSyncFidelityTracker.validationTriggerDelayAggregates: ${this.d3d.toString()}`);k.ULS.sendTraceTag(509616466,0,50,`ExcelLiveSyncFidelityTracker.intersectionPercentageAggregates: ${this.bqd.toString()}`)}eSh(){let F=0;const na=this.u4e();0<na&&(F=Math.floor(na/(1E3*this.O7.c3d)));return F}a2e(F){var na=this.u4e();let hb=F;0<na&&(na/=1E3*F,hb=(Math.ceil(na)-na)*F);return 1E3*hb}fSh(F){var na=P.HelperMethods.Lb();let hb=F;0!==this.zac&&(na-=this.zac,hb=(Math.floor(na/F)+1)*F-na,this.d3d.pI("ExcelLiveSyncFidelityTracker.validationTriggerDelayAggregates",
na));return hb}u4e(){return P.HelperMethods.Lb()-this.jed}DHa(){this.Uma=this.Uma.bind(this);this.qHb=this.qHb.bind(this)}sm(){this.Uxe();this.ur.MQg(this.qHb)}saa(){this.GNe();this.ur.jZf(this.qHb)}Uxe(){this.oh.z2(this.Uma)}GNe(){this.oh.a7(this.Uma)}Uma(F,na){na.oldState!==na.newState&&(0===na.newState?this.iPb("ExcelLiveSyncFidelityTracker.onRealTimeChannelConnectionStateChanged"):2===na.newState&&this.dYd())}bRa(F){this.GNe();this.oh=F;this.Uxe();this.dYd()}qHb(F,na){na.dQe&&na.QSe&&(this.jed=
na.QSe-na.dQe,this.dYd(),this.ur.jZf(this.qHb))}}Object(r.a)(pa,"ExcelLiveSyncFidelityTracker",null,[3]);class $a{constructor(F,na,hb){this.$=F;this.oh=na;this.O7=hb}dispose(){this.$=this.oh=null}bRa(F){this.oh=F}vlc(F){return F?!0:(k.ULS.sendTraceTag(509616461,0,15,`ExcelLiveSyncFidelityValidator:isVisibleAreaRangeValid: skipping validation
        as visibleAreaRange is not valid: ${F}`),!1)}caf(F){const na=this.oh.ogd();if(!na)return k.ULS.sendTraceTag(509616460,0,15,"ExcelLiveSyncFidelityValidator:getVisibleAreaRangeAndSheetIdFromRtc: skipping validation due to null presence data from rtc"),null;F=na[F];return F&&F.NavigationState?{sheetId:F.NavigationState.SheetID,dDa:t.E(F.NavigationState.VisibleAreaRange)}:(k.ULS.sendTraceTag(509616459,0,15,"ExcelLiveSyncFidelityValidator:getVisibleAreaRangeAndSheetIdFromRtc: skipping validation as presenter update is not available in presence data"),
null)}daf(F,na,hb){let Ib=0;F=F.xe(na);null!==F&&(Ib=F.height*F.width*100/hb);return Math.round(Ib)}O1e(F,na,hb,Ib,vc,nc,Pb,oc){var Ic;F={["id"]:F,["isValid"]:na,["zoom"]:null===(Ic=A.a(this.$))||void 0===Ic?void 0:Ic.zoom,["intersectionPercentage"]:hb,["isSheetSameAsExpected"]:Ib,["actualVisibleArea"]:vc.toString(),["expectedVisibleArea"]:nc.toString()};void 0!==Pb&&(F.viewState=Pb,F.hasFollowerUpdatedZoomPostSync=oc);return F}}Object(r.a)($a,"ExcelLiveSyncFidelityValidator",null,[3]);class cb extends $a{constructor(F,
na,hb,Ib){super(F,hb,Ib);this.gridView=y.h(F);this.controller=na}dispose(){super.dispose();this.gridView=this.controller=null}validate(F){var na;if(0!==this.controller.Nk)return k.ULS.sendTraceTag(509616462,0,10,"ExcelLivePresenterSyncFidelityValidator:validate: skipping validation as the role is not presenter"),null;const hb=this.caf(this.oh.clientId),Ib=this.gridView.Yja();if(!this.vlc(null===hb||void 0===hb?void 0:hb.dDa)||!this.vlc(Ib))return null;let vc=!1,nc=!1,Pb=0;hb.sheetId===(null===(na=
this.$.na)||void 0===na?void 0:na.sheetName)&&(vc=!0,Pb=this.daf(Ib,hb.dDa,this.Okd(hb.dDa)),Pb>=this.O7.gcj&&(nc=!0));return this.O1e(F,nc,Pb,vc,Ib,hb.dDa)}Okd(F){return F.height*F.width}}Object(r.a)(cb,"ExcelLivePresenterSyncFidelityValidator",$a,[]);class ib extends $a{constructor(F,na,hb,Ib,vc){super(F,hb,vc);this.Obc=null;this.Qfc=!1;this.orf=0;this.gridView=y.h(F);this.controller=na;this.ur=Ib;this.sm()}dispose(){this.saa();this.gridView=this.controller=this.ur=null;super.dispose()}validate(F){var na;
if(1!==this.controller.Nk)return null;const hb=this.caf(this.controller.Kz),Ib=this.gridView.Yja();if(!this.vlc(null===hb||void 0===hb?void 0:hb.dDa)||!this.vlc(Ib))return null;let vc=!1,nc=!1,Pb=0;hb.sheetId===(null===(na=this.$.na)||void 0===na?void 0:na.sheetName)&&(vc=!0,Pb=this.daf(Ib,hb.dDa,this.Okd(hb.dDa,Ib)),nc=0===this.Obc?this.X9j(Pb):this.Y9j(Pb),this.orf=Pb);return this.O1e(F,nc,Pb,vc,Ib,hb.dDa,this.Obc,this.Qfc)}sm(){this.D6=this.D6.bind(this);this.$.da.hb(419,F=>{F.oZc(this.D6)});this.tqc=
this.tqc.bind(this);this.ur.Gte(this.tqc)}saa(){this.$.da.hb(419,F=>{F.dOd(this.D6)});this.ur.HZf(this.tqc)}D6(){this.Qfc=!0}tqc(F,na){"syncFollowerViewportWithPresenter"===F&&(this.Qfc=!1);this.Obc=na.aub}Okd(F,na){let hb=F.height*F.width;1===this.Obc&&(hb=Math.min(F.height,na.height)*Math.min(F.width,na.width));return hb}X9j(F){let na=!0;F<this.O7.bIh&&(na=!1);return na}Y9j(F){let na=!0;F<this.O7.gIh&&(na=!1,this.Qfc&&F>this.O7.eIh&&F>this.O7.cIh/100*this.orf&&(na=!0));return na}}Object(r.a)(ib,
"ExcelLiveFollowerSyncFidelityValidator",$a,[]);class ta extends da.a{constructor(){super()}Gte(F){this.addHandler("FollowerViewStateChanged",F)}HZf(F){this.removeHandler("FollowerViewStateChanged",F)}oTf(F,na){this.raiseEvent("FollowerViewStateChanged",na,F)}MQg(F){this.addHandler("MeetingPresenceStateUpdated",F)}jZf(F){this.removeHandler("MeetingPresenceStateUpdated",F)}yKd(F){this.raiseEvent("MeetingPresenceStateUpdated",F)}}Object(r.a)(ta,"ExcelLiveEventManager",da.a,[]);class Ya{constructor(F,
na,hb,Ib=null){this.Ifa=this.lga=this.lkb=null;this.d2b=ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7396010_SessionReopenFixes");this.hQc=null;this.Lud=!1;this.Mnb=this.xZb=null;this.Sca=(vc,nc)=>{var Pb;vc=nc.oh;(null===(Pb=this.pA)||void 0===Pb?void 0:Pb.clientId)!==vc.clientId&&(k.ULS.sendTraceTag(509678530,0,50,`ExcelLiveManager::onConnectionCompleted - Updating current RTC instance with client ID: [${this.pA.clientId}]  to RTC instance with client ID: [${vc.clientId}]`),this.HNe(),this.pA=
vc,this.Wxe(),f.g(this.$)?this.lga.bRa(this.pA):this.lkb.bRa(this.pA),this.Lud&&(this.xZb.bRa(this.pA),this.Mnb.bRa(this.pA)))};k.ULS.sendTraceTag(509642589,0,50,"ExcelLiveManager:Ctor");this.$=F;this.TXb=na;this.Jn=new Ba(this.$,hb);this.pA=Object(n.a)(247,this.Fn.oh);this.hQc=Ib;f.h(this.$)&&(this.yc=this.yc.bind(this),this.$.ij(this.yc),this.Uma=this.Uma.bind(this),this.Wxe(),this.d2b&&(this.Sca=this.Sca.bind(this),this.TXb.ipb(this.Sca)));this.Lud=oa(this.$);this.Ifa=hb;this.Gji()}dispose(){var F,
na,hb,Ib,vc,nc;null===(F=this.xZb)||void 0===F?void 0:F.dispose();this.xZb=null;null===(na=this.Mnb)||void 0===na?void 0:na.dispose();this.Mnb=null;null===(hb=this.lga)||void 0===hb?void 0:hb.dispose();this.lga=null;null===(Ib=this.lkb)||void 0===Ib?void 0:Ib.dispose();this.lkb=null;f.h(this.$)&&(this.HNe(),this.d2b&&(null===(vc=this.TXb)||void 0===vc?void 0:vc.Fvc(this.Sca)),null===(nc=this.$)||void 0===nc?void 0:nc.$k(this.yc));this.$=this.pA=this.TXb=this.Ifa=null}get Fn(){return this.TXb}get ibb(){return this.Ifa.ibb}get k0e(){return this.lkb}get presenter(){return this.lga}ICc(){this.k0e?
this.k0e.ICc():k.ULS.sendTraceTag(537162880,0,10,"ExcelLiveManager::SyncToPresenter - FollowerOrExplorer object is not available to complete the action")}vpb(F){this.Ifa.vpb(F)}jdb(F){this.Ifa.jdb(F)}Wxe(){var F;null===(F=this.pA)||void 0===F?void 0:F.z2(this.Uma)}HNe(){var F;null===(F=this.pA)||void 0===F?void 0:F.a7(this.Uma)}Gji(){const F=new ta;f.h(this.$)&&(f.g(this.$)?this.lga=new La(this.$,this.pA,this.Ifa,F,this.hQc):this.lkb=new bb(this.$,this.pA,this.Ifa,F,this.hQc),this.Lud&&this.uki(F))}uki(F){var na=
ea.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.ValidationIntervalInSec",15);const hb=ea.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.LoggingIntervalInSec",300),Ib=ea.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.PresenterExpectedIntersectionPercent",100),vc=ea.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.ExpectedCompleteViewIntersectionPercent",98),nc=ea.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.ExpectedNonCompleteViewIntersectionPercent",
98),Pb=ea.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.ExpectedMinIntersectionPercent",10),oc=ea.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.ExpectedIntersectionDecreaseAfterZoomPercent",50);na={c3d:na,Yuf:hb,gcj:Ib,bIh:vc,gIh:nc,eIh:Pb,cIh:oc};this.Mnb=f.g(this.$)?new cb(this.$,this.Ifa,this.pA,na):new ib(this.$,this.Ifa,this.pA,F,na);this.xZb=new pa(this.pA,this.Mnb,na,F)}Uma(F,na){na.oldState!==na.newState&&this.Jn.xZj(na.oldState,
na.newState)}yc(F,na){na.Ef||this.Jn.Dyd()}}Object(r.a)(Ya,"ExcelLiveManager",null,[358,3]);class Da{constructor(F){this.Sie=this.Rie=this.Qie=null;this.gie=void 0;this.$=F}dispose(){this.$=null}get Nk(){return this.gie}set Nk(F){this.gie=F}get Kz(){return this.Qie}set Kz(F){this.Qie=F}get N6(){return this.Rie}set N6(F){this.Rie=F}get Jbb(){return this.Sie}set Jbb(F){this.Sie=F}I3f(F,na,hb){k.ULS.sendTraceTag(527171654,0,50,`ExcelLiveFollowerOrExplorer:${hb} Setting presenter information to CID: ${F} from CID: ${this.Kz}`);
this.Kz=F;this.N6=null===na||void 0===na?void 0:na.User.UserName;this.Jbb=null===na||void 0===na?void 0:na.UserColor}bNd(){this.Jbb=this.N6=this.Kz=void 0}}Object(r.a)(Da,"ExcelLiveParticipantModel",null,[3]);var ba=a(256),ya=a(12),V=a(269),Z=a(22);class ja{constructor(F,na=null){this.mpa=null;this.WDc=this.l_e=!0;this.container=null;this.Nk=0;this.eAa=this.N6=null;this.lastUpdateTime=0;this.$=null;this.mjf=ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7662493_CheckMeetingPillUpdate");this.Acf=()=>
{var hb;this.WDc||(this.WZf(),null===(hb=this.VDc)||void 0===hb?void 0:hb.cancel(),this.WDc=!0,this.container.classList.remove("ewa-excelLive-meetingPill-container-hidden"))};na&&this.initialize(F,na);this.$=F}lOd(F,na,hb=null,Ib=null){this.mjf&&this.Nk===na&&this.N6===hb&&this.eAa===Ib&&k.ULS.sendTraceTag(509166604,0,15,`ExcelLiveMeetingPillUtility:renderMeetingPill: called for same participant role: ${this.Nk}`);this.xK(F,na);this.Nk=na;this.N6=hb;this.eAa=Ib;this.l_e?(this.l_e=!1,this.WZf()):(this.WDc=
!1,this.container.classList.add("ewa-excelLive-meetingPill-container-hidden"));this.mjf&&this.Vuj()}dispose(){var F;null===(F=this.VDc)||void 0===F?void 0:F.cancel();this.VDc=null;$removeHandler(this.container,"transitionend",this.mpa);$removeHandler(this.container,"transitioncancel",this.mpa);this.container=null}get mc(){return this.container}get If(){return!!this.container&&2===this.Nk}get ee(){return ba.a.Jsf}eg(F,na){if(na)return!1;F=this.container.querySelectorAll(ya.DOMElementExtensions.Hq);
let hb;for(na=0;na<F.length;na++){const Ib=F[na];ya.DOMElementExtensions.If(Ib)&&(hb=Ib)}if(!hb)return k.ULS.sendTraceTag(529109852,0,10,"ExcelLiveMeetingPillUtility.SetFocusOnSection: Could not find focusable element in live meeting pill"),!1;hb.focus();return!0}Bh(F){return ya.DOMElementExtensions.Df(this.mc,F)}Bj(){}ik(){}initialize(F,na){this.container=document.createElement("div");this.container.id="excelLiveMeetingPillContainer";this.container.classList.add("ewa-excelLive-meetingPill-container");
na.appendChild(this.container);f.d(F)&&(this.container.style.height="32px",k.ULS.sendTraceTag(529073433,0,50,"ExcelLiveMeetingPillUtility.initialize:Changed the height of meeting pill container for mobile"));this.mpa=this.Acf;$addHandler(this.container,"transitionend",this.mpa);$addHandler(this.container,"transitioncancel",this.mpa);V.a(F).fi(this)}WZf(){const F={};F.participantRole=this.Nk;this.$.Ev?(k.ULS.sendTraceTag(527991135,0,50,"ExcelLiveMeetingPillUtility.renderMeetingPillInternal: Getting shortened user name for mobile meeting pill"),
F.presenterName=this.z7h(this.N6)):F.presenterName=this.N6;F.presenterColor=this.eAa;appChrome.renderLiveMeetingPill(this.container,F)}z7h(F){if(Z.a.ah(F))return k.ULS.sendTraceTag(527991134,0,15,"ExcelLiveMeetingPillUtility.getShortenedUserName: Username is null or empty"),F;let na=F.split(" "),hb=na.length;return 2>hb||Z.a.ah(na[hb-1])?F:na[0]+" "+na[hb-1].substring(0,1)}xK(F,na){na=O[na];if(0===this.lastUpdateTime)k.ULS.sendTraceTag(527766152,0,50,`${F}::FirstRole - [${na}]`),this.lastUpdateTime=
P.HelperMethods.Lb();else{var hb=O[this.Nk];if(hb===na)k.ULS.sendTraceTag(523548820,0,15,`${F}:RoleTransition: Received transition to participant role which is same as current role: [${hb}]`);else{var Ib=((P.HelperMethods.Lb()-this.lastUpdateTime)/1E3).toFixed(2);k.ULS.sendTraceTag(528786757,0,50,`${F}:RoleTransition: Transition participant role from [${hb}] to [${na}] after ${Ib}s`);this.lastUpdateTime=P.HelperMethods.Lb()}}}Vuj(){this.VDc=Ea.AsyncMethodContext.f7b(()=>{var F,na;if(!this.WDc||(null===
(na=null===(F=this.container)||void 0===F?void 0:F.classList)||void 0===na?0:na.contains("ewa-excelLive-meetingPill-container-hidden")))k.ULS.sendTraceTag(509166603,0,10,"ExcelLiveMeetingPillUtility:renderMeetingPill: transition end event was not invoked"),this.Acf(null)},1E3,"ExcelLiveMeetingPillUtility.renderMeetingPill",this.VDc)}}Object(r.a)(ja,"ExcelLiveMeetingPillUtility",null,[63,3]);var la=a(4);class ua{get NNh(){let F;return(F=this.kf?document.getElementById("AdditionalBarsRegion"):document.getElementById(this.$.Cb+
z.a.w2a))?F.clientHeight:0}get r2g(){let F;return(F=this.kf?document.getElementById("BusinessBar"):document.getElementById(this.$.Cb+z.a.zAe))?F.clientHeight:0}get VIh(){let F=null;this.kf&&(F=document.getElementById("FarPaneRegion"));return F?F.clientWidth:0}get JUg(){var F=f.d(this.$)?(F=document.getElementById(this.$.Cb+z.a.vIa))?F.clientHeight:0:this.$.f_?0:this.$.y3g();return F}get TIj(){let F;return(F=this.kf?document.getElementById("Header"):document.getElementById(z.a.Vsa))?F.clientHeight:
0}get g4c(){return this.kf?document.getElementById("EditorContainer"):this.$.wC}get Eze(){return this.TIj+this.JUg+this.r2g+this.NNh}get e_g(){return this.g4c.clientLeft}get g_g(){return this.g4c.clientWidth+this.VIh-3}get d_g(){if(this.kf){const F=document.getElementById("StatusBar");return F.offsetTop+F.clientHeight-this.Eze}return this.g4c.clientHeight}get f_g(){const F={};F.participantRole=this.Nk;F.presenterColor=this.eAa;F.top=this.Eze;F.left=this.e_g;F.width=this.g_g;F.height=this.d_g;F.size=
3;return F}constructor(F,na=null,hb=0){this.container=null;this.Nk=0;this.eAa=null;this.kf=!1;na&&(this.$=F,this.Nk=hb,this.initialize(na),this.kf=la.AFrameworkApplication.sa.Qa.kf)}hLb(F,na=null){this.Nk=F;this.eAa=na;appChrome.renderLiveMeetingBoundary(this.container,this.f_g)}dispose(){this.container=null;this.$.UF(this.qcb);this.$.Zpj(this.qcb)}initialize(F){this.DHa();this.container=document.createElement("div");this.container.id="excelLiveMeetingBoundaryContainer";this.container.classList.add("ewa-excelLive-meetingBoundary-container");
F.append(this.container);this.hLb(this.Nk,this.eAa);this.$.iC(this.qcb);this.$.ORg(this.qcb)}DHa(){this.qcb=this.qcb.bind(this)}qcb(){this.hLb(this.Nk,this.eAa)}}Object(r.a)(ua,"ExcelLiveMeetingBoundaryUtility",null,[3]);var eb=a(142),Eb=a(45),Wb=a(91);class Ab{constructor(F,na){this.iKa=this.irb=null;this.Kud=this.IBb=this.qic=this.pic=!1;this.$=F;this.controller=na;this.IBb=ea.EwaSettings.isChangeGateEnabled("OfficeVSO:6454130_ExcelLiveExplorerBasedSurveyTriggerEnabled");(this.pic=ea.EwaSettings.isChangeGateEnabled("OfficeVSO:6603003_ExcelLiveBufferBasedSurveyTriggerEnabled"))?
this.Hdg(this.$.ya.ExcelLiveBufferBasedSurveyTriggerBufferTimeInMs):this.IBb&&this.Hdg(this.$.ya.ExcelLiveMeetingBufferTimeInMs)}dispose(){this.controller=this.$=null;this.iKa&&(Wb.a.Ja(this.iKa),this.iKa=null);this.irb&&(Wb.a.Ja(this.irb),this.irb=null)}Hdg(F){this.irb=Ea.AsyncMethodContext.Cq(()=>{this.qic=!0;this.i0d()},F,Eb.a.K_g,this.irb)}i0d(){this.Kud||(this.pic&&this.qic?this.AQb(0):1===this.controller.Nk?this.IBb?this.qic&&this.vEe():this.AQb(this.$.ya.ExcelLiveSurveyTriggerThresholdTimeInMs):
2===this.controller.Nk&&(this.IBb?this.qic&&this.AQb(this.$.ya.ExcelLiveSurveyChangedTriggerThresholdTimeInMs):this.vEe()))}AQb(F){this.iKa=Ea.AsyncMethodContext.Cq(()=>{this.Kud||(this.$.Yc(-1404915046,-1,0,null),this.Kud=!0,k.ULS.sendTraceTag(520495937,0,50,`ExcelLiveController.TriggerExcelLiveSurvey: ExcelLive survey shown using Buffer based trigger = ${this.pic}, using Explorer based trigger = ${this.IBb} with trigger threshold = ${F}`))},F,Eb.a.AQb,this.iKa)}vEe(){this.iKa&&this.iKa.cancel()}}
Object(r.a)(Ab,"ExcelLiveSurveyManager",null,[]);class Jb extends da.a{constructor(F){super();this.Q3a=this.R3a=this.pq=null;this.Kpf=!1;this.REb="ExcelLiveController::";this.HBb=f.f();this.v7a=ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7451504_DependOnUserListChangedEventForPresenterDetails");this.oB=()=>{this.W2d(this.pq.Kz,`${this.REb}onUserListChanged`)&&this.$.ea.c7(this.oB)};this.$Dd=()=>{this.xpd();this.kwc(`${this.REb}onCommandUIGenerated`);this.$.ea.EYf(this.$Dd)};k.ULS.sendTraceTag(509642591,
0,50,"ExcelLiveController:Ctor");this.$=F;this.Kpf=f.h(this.$);this.bli();if(this.ZEa=ea.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ExcelLiveSurvey",!1))this.tzg=new Ab(F,this)}dispose(){var F,na,hb;this.$=null;null===(F=this.pq)||void 0===F?void 0:F.dispose();this.pq=null;null===(na=this.R3a)||void 0===na?void 0:na.dispose();this.R3a=null;null===(hb=this.Q3a)||void 0===hb?void 0:hb.dispose();this.Q3a=null;this.HBb&&(this.$.ea.EYf(this.$Dd),this.v7a&&this.$.ea.c7(this.oB));this.$=null}get ibb(){return this.pq}get Nk(){return this.pq.Nk}get Pwe(){var F,
na,hb;return!(null===(F=this.pq)||void 0===F||!F.Kz)&&!(null===(na=this.pq)||void 0===na||!na.N6)&&!(null===(hb=this.pq)||void 0===hb||!hb.Jbb)}get Kz(){return this.pq.Kz}get zXe(){return this.tzg}get Wof(){return this.ZEa}PUa(F,na){this.pq.Nk&&this.pq.Nk===F||(this.pq.Nk=F,this.kwc(na))}W2d(F,na){if(!F)return k.ULS.sendTraceTag(528086352,0,10,"ExcelLiveController:savePresenterDetails Presenter CID is undefined"),!1;if(this.v7a&&this.Pwe&&this.pq.Kz===F)return!0;const hb=this.$.ea.fld(F);if(!hb)return k.ULS.sendTraceTag(528086351,
0,10,"ExcelLiveController:savePresenterDetails Failed to get presenter information from sessionStateManager"),this.HBb&&this.v7a&&this.pq.Kz!==F&&(this.pq.I3f(F,null,na),this.$.ea.T9(this.oB)),!1;this.pq.I3f(F,hb,na);this.kwc(`${na};${this.REb}${"savePresenterDetails"}`);this.raiseEvent(Jb.WId);return!0}bNd(){this.pq.bNd()}vpb(F){this.addHandler(Jb.WId,F)}jdb(F){this.removeHandler(Jb.WId,F)}bli(){this.pq=new Da(this.$);ea.EwaSettings.isChangeGateEnabled("OfficeVSO:7345545_InitMeetingUxOnChromeReady")?
eb.a.get_instance().Rj(7,()=>{this.Wgf()}):this.Wgf();const F=f.g(this.$)?0:3;this.PUa(F,`${this.REb}initializeController`)}xpd(){const F=la.AFrameworkApplication.sa.Qa.kf?document.getElementById("regionComposerRoot"):this.$.Hp;this.Q3a=new ua(this.$,F,this.Nk)}Wgf(){this.Wli();this.Kpf&&(this.HBb?this.$.ea.jla?this.xpd():this.$.ea.cse(this.$Dd):this.xpd());this.kwc(`${this.REb}initializeMeetingUx`)}Wli(){const F=la.AFrameworkApplication.sa.Qa.kf?document.getElementById("StatusBarRegion"):this.$.wC;
this.R3a=new ja(this.$,F)}kwc(F){var na,hb,Ib,vc,nc,Pb;switch(this.pq.Nk){case 2:null===(na=this.R3a)||void 0===na?void 0:na.lOd(F,this.pq.Nk,this.pq.N6);null===(hb=this.Q3a)||void 0===hb?void 0:hb.hLb(this.pq.Nk);break;case 1:null===(Ib=this.R3a)||void 0===Ib?void 0:Ib.lOd(F,this.pq.Nk,this.pq.N6,this.pq.Jbb);null===(vc=this.Q3a)||void 0===vc?void 0:vc.hLb(this.pq.Nk,this.pq.Jbb);break;case 3:case 0:null===(nc=this.R3a)||void 0===nc?void 0:nc.lOd(F,this.pq.Nk),null===(Pb=this.Q3a)||void 0===Pb?void 0:
Pb.hLb(this.pq.Nk)}}}Jb.WId="PDS";Object(r.a)(Jb,"ExcelLiveController",da.a,[3]);var Gb=a(717),Nb=a(86);class Ja extends w.a{constructor(F){super();this.bva=this.Fn=null;this.Azi=f.j();this.uya=null;this.MPa=()=>{this.Fn.ZKb(this.MPa);k.ULS.sendTraceTag(537162849,0,50,"ExcelLiveManager::OnRealTimeChannelInitialized");const na=Object(Gb.a)(this.$.da,473,()=>new Ya(this.$,this.Fn,this.bva,this.uya));this.qb(na)};k.ULS.sendTraceTag(509642588,0,50,"ExcelLiveManagerFactory: Ctor");this.$=F;this.Gb()}create(){this.Fji()}dispose(){this.Fn&&
this.Fn.ZKb(this.MPa);this.Fn=null;this.bva&&(this.bva.dispose(),this.bva=null);super.dispose()}Fji(){k.ULS.sendTraceTag(509642587,0,50,"ExcelLiveManagerFactory: InitExcelLiveMeeting");this.bva=new Jb(this.$);this.Azi&&(this.uya=Nb.a.instance.og("Common.App.LiveMeeting.ILiveMeetingManager"));this.$.da.hb(26,F=>{this.Fn=F;this.ybh()})}ybh(){k.ULS.sendTraceTag(537162850,0,50,"ExcelLiveCommandHandlerFactory::ConnectToRealTimeChannel - attach RealTimeChannelInitialized handler");this.Fn.ZYc(this.MPa);
this.Fn.Z0a()}static la(F){k.ULS.sendTraceTag(537162848,0,50,"ExcelLiveManagerFactory::Attach: Begin service registration");F.da.Ha(474,new Ja(F));k.ULS.sendTraceTag(537162847,0,50,"ExcelLiveManagerFactory::Attach: Complete service registration")}}Object(r.a)(Ja,"ExcelLiveManagerFactory",w.a,[]);var ab=a(101);class wb extends Sys.EventArgs{constructor(F){super();this.presenter=F}}Object(r.a)(wb,"PresenterIdentifiedEventArgs",Sys.EventArgs,[]);class xb extends Sys.EventArgs{constructor(){super()}}
Object(r.a)(xb,"PresenterStateUpdatedEventArgs",Sys.EventArgs,[]);class rb extends Sys.EventArgs{constructor(F,na){super();this.pJd=F;this.hJa=na}}Object(r.a)(rb,"RoleTransitionEventArgs",Sys.EventArgs,[]);class za{constructor(){this.Za=new ab.a}dispose(){this.Za.dispose()}XYc(F){this.Za.addHandler("EK_PI",F)}ONd(F){this.Za.removeHandler("EK_PI",F)}aZc(F){this.Za.addHandler("EK_RT",F)}RNd(F){this.Za.removeHandler("EK_RT",F)}agj(F){this.Za.raiseEvent("EK_PSU",new xb(F))}$fj(F){this.Za.raiseEvent("EK_PI",
new wb(F))}ggj(F,na){this.Za.raiseEvent("EK_RT",new rb(F,na))}}Object(r.a)(za,"LiveMeetingEventHub",null,[282,3]);var Aa=a(88);class pb{constructor(F,na,hb,Ib){this.data=F;this.kD=na;this.timestamp=hb;this.messageId=Ib}}Object(r.a)(pb,"LiveMeetingData",null,[]);var kb=a(1435),Cb=a(40);class ob{constructor(){this.LIc=0;this.R1=-1E8;this.e9=Number.MAX_VALUE;this.eu=-1E8;this.XSc=0}add(F){this.e9=F<this.e9?F:this.e9;this.R1=F>this.R1?F:this.R1;this.LIc=(F+this.LIc*this.XSc)/++this.XSc;this.eu=-1E8===
this.eu?F:this.eu}reset(){this.LIc=0;this.e9=Number.MAX_VALUE;this.R1=-1E8;this.XSc=0;this.eu=-1E8}toString(){return Cb.c(this)}}Object(r.a)(ob,"LatencyMetrics",null,[]);var qa;(function(F){F[F.unknown=0]="unknown";F[F.presenter=1]="presenter";F[F.follower=2]="follower";F[F.explorer=4]="explorer";F[F.default=0]="default"})(qa||(qa={}));Object(r.b)("ParticipantRole",qa);var ma=a(115),Ga=a(103);class vb{constructor(F){this.v1=this.Zlb=this.lga=this.GX=this.LQc=null;this.jWb=this.oWb=this.plb=this.Yfa=
this.N8=this.gkb=this.m9=this.nWb=this.kWb=this.ATb=this.JWb=this.mke=this.NWb=this.RQc=0;this.Fib=new Ga.a;this.HZb=new Ga.a;this.IZb=new Ga.a;this.UXb=new ob;this.MX=F}get DIg(){return this.currentTime()-this.kWb}get jne(){return this.currentTime()-this.nWb}get EIg(){return this.currentTime()-this.plb}get FIg(){return this.currentTime()-this.Yfa}get BIg(){return this.currentTime()-this.JWb}dispose(){k.ULS.sendTraceTag(520647007,230,10,vb.kx+"Dispose: Dispose called.");this.dKd();this.MX.ONd(Object(Aa.a)(this,
this.SQf,"presenterIdentifiedEventHandler"));this.MX.RNd(Object(Aa.a)(this,this.n2f,"roleTransitionEventHandler"))}Oij(F,na){const hb=this.currentTime();this.oWb=this.nWb=this.JWb=hb;this.GX=this.Djd(na);this.LQc=F;this.MX.XYc(Object(Aa.a)(this,this.SQf,"presenterIdentifiedEventHandler"));this.MX.aZc(Object(Aa.a)(this,this.n2f,"roleTransitionEventHandler"));k.ULS.sendTraceTag(520722377,230,50,vb.kx+"MeetingManagerInitialization: Meeting manager initialized with meeting ID [{0}] and initial role [{1}]",
this.LQc,this.GX)}Aij(F,na){const hb=this.currentTime();this.kWb=this.jWb=this.ATb=hb;this.v1=va.a[F];this.Fib.ia(this.v1,1);this.Zlb=na;k.ULS.sendTraceTag(520722376,230,50,vb.kx+"CommunicationChannelInitialized: Initialized with ConnectionState:[{0}] and Identifier:[{1}]",this.v1,this.Zlb)}Bij(F,na){const hb=this.currentTime();F=va.a[F];na=va.a[na];F!==this.v1?k.ULS.sendTraceTag(520722375,230,10,vb.kx+"RecordCommunicationChannelStateChange: Current state [{0}] not equal to received old state [{1}]",
this.v1,F):this.Hng(hb);this.v1!==na&&(k.ULS.sendTraceTag(520722374,230,50,vb.kx+"CommunicationChannelStateChange: Recorded ConnectionState change from [{0}] to [{1}] after [{2}]ms with current participant role [{3}]",F,na,this.DIg,this.GX),F=this.Fib.kb(na)?this.Fib.ma(na):0,this.Fib.ia(na,1+F),this.v1=na,this.jWb=this.kWb=hb);this.dKd()}YJb(F){const na=this.currentTime();this.RQc++;this.gkb=this.gkb?this.gkb:na;const hb=na-(this.Yfa?this.Yfa:this.gkb);this.Yfa=na;k.ULS.sendTraceTag(520722373,230,
50,vb.kx+"MessageSent: Sent message number [{0}] with message ID [{1}] after [{2}]ms",this.RQc,F,hb)}Sij(F){this.m9=this.currentTime();this.lga=F;k.ULS.sendTraceTag(520722372,230,50,vb.kx+"PresenterIdentified: Presenter identified at [{0}] with identifier:[{1}]",this.m9,this.lga.clientId)}ZQa(F,na){const hb=this.currentTime(),Ib=new Date;this.NWb++;this.N8=this.N8?this.N8:hb;const vc=hb-(this.plb?this.plb:this.N8);this.plb=hb;1!==this.NWb&&this.UXb.add(+Ib-+na);k.ULS.sendTraceTag(520722371,230,50,
vb.kx+"MessageReceived: Received message number [{0}] with message ID [{1}] after [{2}]ms with current latency distribution: [{3}]",this.NWb,F,vc,this.UXb)}Wij(F,na){const hb=this.currentTime();F=this.Djd(F);na=this.Djd(na);F!==this.GX?k.ULS.sendTraceTag(520722370,230,10,vb.kx+"RoleChange: Current participant role [{0}] not equal to received old participant role [{1}]",this.GX,F):this.Ing(hb);this.GX!==na&&(k.ULS.sendTraceTag(520722369,230,50,vb.kx+"RoleChange: Recorded ParticipantRole change from [{0}] to [{1}] after [{2}]ms",
F,na,this.jne),this.mke++,this.GX=na,this.oWb=this.nWb=hb)}Djd(F){return 0===F?"unknown":Object(kb.a)(qa,F)}get qha(){return"presenter"===this.GX.toLowerCase()}Ing(F=0){F=F?F:this.currentTime();const na=this.IZb.kb(this.GX)?this.IZb.ma(this.GX):0;this.IZb.ia(this.GX,na+(F-this.oWb));this.oWb=F}Hng(F=0){F=F?F:this.currentTime();const na=this.HZb.kb(this.v1)?this.HZb.ma(this.v1):0;this.HZb.ia(this.v1,na+(F-this.jWb));this.jWb=F}SQf(F,na){this.Sij(na.presenter)}n2f(F,na){this.Wij(na.pJd,na.hJa)}currentTime(){return window.performance.now()}dKd(){this.Ing();
this.Hng();this.Vdj();this.Wdj()}T9g(){return{["communicationChannelId"]:this.Zlb,["currentConnectionState"]:this.v1,["timeToChannelInitializationFromMeetingManagerCreationMs"]:this.ATb-this.JWb,["lastCommunicationChannelStateChange"]:this.kWb,["channelConnectionStateCounts"]:this.wYd(this.Fib),["timeInCommunicationChannelStateMs"]:this.wYd(this.HZb),["receivedMessageLatencyMs"]:this.UXb}}Vdj(){k.ULS.sendTraceTag(520722368,230,50,vb.kx+"CommunicationChannelMetrics: {0}",ma.a.toJSON(this.T9g()))}X9g(){return{["meetingId"]:this.LQc,
["meetingManagerCreated"]:this.JWb,["communicationChannelInitializated"]:this.ATb,["amIPresenter"]:this.qha,["timeInSession"]:this.BIg,["communicationChannelId"]:this.Zlb,["currentRole"]:this.GX,["lastRoleChanged"]:this.nWb,["totalRoleChangeCount"]:this.mke,["totalTimeInAllRolesMs"]:this.wYd(this.IZb),["timeInCurrentRoleMs"]:this.jne,["presenterId"]:this.qha?this.Zlb:this.m9?this.lga.clientId:"unidentified",["presenterIdentified"]:this.m9,["timeToIdentifyPresenterFromChannelInitializationMs"]:this.m9-
this.ATb,["firstMessageSent"]:this.gkb,["lastMessageSent"]:this.Yfa,["timeSinceLastMessageSentMs"]:this.FIg,["numberOfMessagesSent"]:this.RQc,["firstMessageReceived"]:this.N8,["lastMessageReceived"]:this.plb,["receivedMessagedLatenciesMs"]:this.UXb,["timeSinceLastMessageReceivedMs"]:this.EIg,["numberOfMessagesReceived"]:this.NWb}}wYd(F){const na=new Sys.StringBuilder;for(let hb of F.keys)na.append(String.format('"{0}": {1}',hb,F.ma(hb)));return"{"+na.toString(",")+"}"}Wdj(){k.ULS.sendTraceTag(520722339,
230,50,vb.kx+"MeetingMetrics: {0}",ma.a.toJSON(this.X9g()))}}vb.kx="LiveMeetingMetrics::";Object(r.a)(vb,"LiveMeetingMetrics",null,[3]);class Ka{constructor(F,na){this.Ibb=F;this.a6=na}}Object(r.a)(Ka,"MeetingInfo",null,[]);var Pa=a(607),fb=a(58);class Wa{constructor(F,na,hb,Ib,vc){this.RWb=this.aw=null;this.m9=!1;this.dJ=0;this.Qfe=null;this.Ml=na;this.MX=hb;this.tYa=F;this.qha=vc;this.Ml.Oij(Ib,vc?1:0);la.AFrameworkApplication.Sfb(()=>{this.Ml.dKd()});this.tYa.continueWith(()=>{this.tYa.result?
(this.aw=this.tYa.result,this.Ml.Aij(this.aw.connectionState,this.aw.clientId),this.aw.z2(Object(Aa.a)(this,this.BR,"onRtcConnectionStateChanged")),this.Qfe=new Ka(this.kii(),Ib),this.RWb=this.qha?this.kD.Ibb:new Pa.a(this.aw.clientId),2===this.aw.connectionState&&this.QRf()):k.ULS.sendTraceTag(520722385,230,10,Wa.kx+"Constructor: Result of rtc task is null.")})}get Ibb(){return this.kD.Ibb}get kD(){return this.Qfe}dispose(){k.ULS.sendTraceTag(520647008,230,10,Wa.kx+"Dispose: Dispose called.");this.qha||
this.aw.LNd(Object(Aa.a)(this,this.HPa,"onPersistentStateUpdated"));this.aw.a7(Object(Aa.a)(this,this.BR,"onRtcConnectionStateChanged"));this.aw=null}XYc(F){this.MX.XYc(F)}ONd(F){this.MX.ONd(F)}aZc(F){this.MX.aZc(F)}RNd(F){this.MX.RNd(F)}O5f(F){if(this.qha)if(this.aw){var na=++this.dJ;this.aw.Byc(2,new pb(F,this.kD,new Date,na));this.Ml.YJb(na)}else k.ULS.sendTraceTag(509223127,230,10,Wa.kx+"SendUpdate: Ignoring the update since RTC channel is null"),fb.Task.Ta(null);else k.ULS.sendTraceTag(520722382,
230,10,Wa.kx+"SendUpdate: Ignoring the update since session is not for presenter."),fb.Task.Ta(null)}tKi(){this.hDe(4)}uKi(){this.hDe(2)}ICc(){}hDe(F){if(this.qha)k.ULS.sendTraceTag(520722381,230,10,Wa.kx+"ChangeMyRole: Ignoring role change since we are in presenter session.");else{var na=this.RWb.role;this.RWb.role=F;this.MX.ggj(na,this.RWb.role)}}qSh(){return this.aw.ngd(2)}kii(){return this.qha?(this.m9=!0,new Pa.a(this.aw.clientId,void 0,void 0,1)):this.Gff(this.qSh())}Gff(F){for(let hb in F){var na=
hb;const Ib=F[hb];if(Ib&&Ib.kD&&Ib.kD.a6===this.a6)return this.m9=!0,F=new Pa.a(na,void 0,void 0,1),this.MX.$fj(F),F}k.ULS.sendTraceTag(520722380,230,15,Wa.kx+"IdentifyPresenter: Unable to identify presenter.");return null}Vri(F){return!!F&&F.a6===this.a6}get fAa(){return this.kD.Ibb?this.kD.Ibb.clientId:null}get a6(){return this.kD.a6}BR(F,na){this.Ml.Bij(na.oldState,na.newState);2===na.newState&&this.QRf()}QRf(){this.qha?this.O5f(null):(this.aw.WYc(Object(Aa.a)(this,this.HPa,"onPersistentStateUpdated")),
this.$Rf(this.aw.ngd(2)))}$Rf(F){this.m9||(this.kD.Ibb=this.Gff(F));this.m9&&this.fAa in F?(F=F[this.fAa],F=new pb(F.data,F.kD,new Date(F.timestamp),F.messageId),this.Vri(F.kD)?(this.Ml.ZQa(F.messageId,F.timestamp),this.MX.agj(F.data)):k.ULS.sendTraceTag(520722378,230,10,Wa.kx+"PersistentStateUpdated: Presenter data is for an unexpected meeting. PresenterId:[{0}], ExpectedMeetingId:[{1}], ActualMeetingId:[{2}]",this.fAa,this.a6,F.kD?F.kD.a6:"null")):k.ULS.sendTraceTag(520722379,230,10,Wa.kx+"PersistentStateUpdated: Unable to find data related to presenter in the received update.")}HPa(F,
na){k.ULS.sendTraceTag(527751173,230,100,"Updated clients: [{0}]",Cb.c(na.vL));2===na.type&&this.$Rf(na.vL)}static createInstance(F,na,hb){if(!na||!na.trim().length)return k.ULS.sendTraceTag(520722384,230,10,Wa.kx+"CreateInstance: Responding with a null instance since meeting ID is null/blank"),null;const Ib=new za,vc=new vb(Ib);return new Wa(F,vc,Ib,na,hb)}}Wa.kx="LiveMeetingManager::";Object(r.a)(Wa,"LiveMeetingManager",null,[281,3]);var Ma=a(257),lb=a(524);class Na{constructor(){this.$a=null}get name(){return"Common.App.LiveMeeting"}yV(){return la.AFrameworkApplication.yV||
la.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.Shared.IsLiveMeetingSessionOverrideEnabled",!1)}Mjc(){return la.AFrameworkApplication.Mjc||la.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.Shared.IsLiveMeetingPresenterOverrideEnabled",!1)}Kh(F){this.$a=F;F=this.yV();k.ULS.sendTraceTag(509195937,230,50,"{0}Configure: IsMeetingLiveSession: {1}.","LiveMeetingPackage::",F);F&&(k.ULS.sendTraceTag(509195936,230,50,"{0}Configure: Registering LiveMeeting instances.",
"LiveMeetingPackage::"),this.$a.register(za,"Common.App.LiveMeeting.LiveMeetingEventHub").as("Common.App.LiveMeeting.ILiveMeetingEventHub").tc().Bc(()=>new za),this.$a.register(vb,"Common.App.LiveMeeting.LiveMeetingMetrics").tc().Bc(()=>new vb(this.$a.og("Common.App.LiveMeeting.ILiveMeetingEventHub"))),this.$a.register(Wa,"Common.App.LiveMeeting.LiveMeetingManager").as("Common.App.LiveMeeting.ILiveMeetingManager").tc().Bc(()=>new Wa(lb.a.gq(this.$a.Tb("Common.IRealtimeChannelBasic")),this.$a.og("Common.App.LiveMeeting.LiveMeetingMetrics"),
this.$a.og("Common.App.LiveMeeting.ILiveMeetingEventHub"),la.AFrameworkApplication.a6,this.Mjc())))}init(){la.AFrameworkApplication.fa.zu(()=>{k.ULS.sendTraceTag(509195935,230,50,"{0}Init: Resolving LiveMeeting instances.","LiveMeetingPackage::");this.$a.og("Common.App.LiveMeeting.ILiveMeetingEventHub");this.$a.og("Common.App.LiveMeeting.LiveMeetingMetrics");this.$a.og("Common.App.LiveMeeting.ILiveMeetingManager")})}dispose(){}static main(){Ma.a.instance.si(new Na)}}Object(r.a)(Na,"LiveMeetingPackage",
null,[4,5]);a.d(B,"a",function(){return X});const X=()=>{c.a.Fa(F=>{k.ULS.sendTraceTag(509642592,0,50,`ExcelLiveBootstrapper.main: Called at ${P.HelperMethods.Lb()}`);f.j()&&(Type.registerNamespace("Common.App.LiveMeeting"),Na.main());Ja.la(F);l.la(F)})}},1478:function(r,B,a){a.r(B);r=a(1152);B=a(0);var c=a(15),b=a(88);class e extends Sys.EventArgs{constructor(){super()}}Object(B.a)(e,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var f;(function(Y){Y[Y.notYetStarted=0]="notYetStarted";Y[Y.polling=
1]="polling";Y[Y.subscribed=2]="subscribed";Y[Y.blocked=3]="blocked";Y[Y.permanentlyStopped=4]="permanentlyStopped"})(f||(f={}));Object(B.b)("RtcHostNotificationSubscriptionState",f);var d=a(112);class h extends Sys.EventArgs{constructor(Y,U,da,T){super();this.sJd=Y;this.newState=U;this.tcj=da;this.ucj=T}}Object(B.a)(h,"StateChangedEventArgs",Sys.EventArgs,[]);var l=a(101);class k{constructor(Y){this.Za=new l.a;this.kme=new Date;this.Q8d=Y;this.zLc=0}get currentState(){return this.Q8d}get JSe(){return this.zLc}event(Y,
U=null){this.currentState!==Y&&(this.ILh(this.currentState,Y,this.JSe,U),this.zLc=0,this.kme=new Date);this.Q8d=Y;this.zLc=this.JSe+1}ILh(Y,U,da,T){Y=new h(Y,U,da,this.kme,T);this.Za.raiseEvent("c",Y)}lZc(Y){this.Za.addHandler("c",Y)}EZf(Y){this.Za.removeHandler("c",Y)}}Object(B.a)(k,"StateMachine",null,[776]);class w{constructor(Y,U,da,T,ka,L,fa,wa,oa){this.Jm=!1;this.JYb=this.gYa=this.uP=this.tga=null;this.Inb=w.BHc;this.Za=new l.a;this.esa=new k(0);this.esa.lZc(Object(b.a)(this,this.c4i,"onStateMachineChanged"));
this.sGg=Y;this.tYb=U;this.rGg=da;this.ITc=T;this.pe=ka;this.mT=L;fa.execute(xa=>{this.Jm||(this.gYa=xa,this.gYa.UZa(Object(b.a)(this,this.eda,"onUpdateNotificationReceived")),this.start())});wa.execute(xa=>{this.Jm||(this.JYb=xa,xa.rpb(Object(b.a)(this,this.VPa,"onTokenRefreshed")))});this.ine=oa}get Tfb(){return this.esa.currentState}get wof(){return!this.mT||this.mT.Qpf}get w5(){return 2===this.Tfb&&this.ine()<this.Inb}start(){0!==this.Tfb?c.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",
f[this.Tfb]):(this.esa.event(1),this.$Rd(null))}$Rd(){this.tga=null;if(this.wof){c.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",f[this.Tfb]);let Y=null;this.ITc&&this.ITc.length&&(Y={},Y.etts=this.ITc);this.gYa.lea(14,Y,!0);this.m4f(this.sGg)}else this.esa.event(3)}m4f(Y){this.tga=d.a.d7b(1E3*Y,Object(b.a)(this,this.$Rd,"sendSubscribeEvent"),this.tYb,192,"RtcHostNotificationSubscribe");this.pe.ig(this.tga)}$xj(Y){Y=1E3*(Y+this.rGg);const U=
this.ine().getTime()+Y;this.Inb=new Date(U);Y-=this.tYb;this.uP?this.pe.Mna(this.uP,Y):(this.uP=d.a.d7b(Y,Object(b.a)(this,this.VZj,"transitionToPollingEvent"),this.tYb/2,194,"RtcHostNotificationTransitionToPolling"),this.pe.ig(this.uP))}VZj(){this.uP=null;2===this.Tfb&&(this.esa.event(1),c.ULS.shipAssertTag(573100185,502,!!this.tga,"Missing task to ensure that we re-subscribe."))}VPa(){this.Obi()}Obi(){3===this.Tfb&&this.wof&&(this.esa.event(this.w5?2:1),this.$Rd(null))}eda(Y,U){if(13===U.type&&
(Y=U.d8,c.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:Y,["DurationBeforeExpirationToResubscribeInSec"]:this.tYb}),U=Y.cts,!this.d1j(U))){if(Y.sb){var da=2;this.$xj(Y.cts)}else da=1,this.Inb=w.BHc,this.uP&&(this.pe.$o(this.uP),this.uP=null);this.esa.event(da);this.tga?this.pe.Mna(this.tga,1E3*U):this.m4f(U)}}d1j(Y){if(!isNaN(Y)&&isFinite(Y)&&0<Y)return!1;this.Ieg(!1);return!0}Ieg(Y){this.tga&&(this.pe.$o(this.tga),this.tga=
null);this.uP&&(this.pe.$o(this.uP),this.uP=null);this.gYa&&(this.gYa.dLb(Object(b.a)(this,this.eda,"onUpdateNotificationReceived")),this.gYa=null);this.JYb&&(this.JYb.Wvc(Object(b.a)(this,this.VPa,"onTokenRefreshed")),this.JYb=null);Y||this.esa.event(4)}c4i(Y,U){Y=U.newState;const da=U.sJd,T={};T.NewState=f[Y];T.PreviousState=f[da];T.PreviousStateHits=U.tcj;T.PreviousStateTransitionTime=U.ucj.toISOString();T.IsSubscribed=this.w5;this.Inb!==w.BHc&&(T.SubscriptionExpiringTime=this.Inb.toISOString());
c.ULS.sendTraceTag(572346515,502,4===Y?15:50,"HostNotificationChanged: {0}",T);this.Za.raiseEvent("HN",new e(da,Y))}dispose(){this.Jm||(this.Jm=!0,this.Ieg(!0),this.uP&&(this.pe.$o(this.uP),this.uP=null))}}w.BHc=new Date(0);Object(B.a)(w,"RtcHostNotificationSubscriptionManager",null,[757,3]);var n=a(4),x=a(257),m=a(655),u=a(86);class t{constructor(){this.px=this.Jm=!1}get name(){return"RtcHostNotificationSubscription"}Kh(Y){Y.register(w,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").tc().Bc(()=>
{const U=n.AFrameworkApplication.fa;return new w(U.Ad("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),U.Ad("RtcHostNotificationRetryIntervalBufferInSeconds",120),U.Ad("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.x6h(U),n.AFrameworkApplication.ti,m.SessionStatusManager.instance,Y.Tb("Common.IRealtimeChannelBasic"),Y.Tb("Common.ISessionExpirationManager"),()=>new Date)})}init(){n.AFrameworkApplication.fa.zu(()=>{!this.Jm&&n.AFrameworkApplication.fa.qa("RtcHostNotificationEnabled")&&
(this.px=!0,u.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Jm||(this.Jm=!0,this.px&&u.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}x6h(Y){return Y.Jp("RtcEventTypesToSubscribe")?Y.ww("RtcEventTypesToSubscribe"):null}static main(){x.a.instance.si(new t)}}Object(B.a)(t,"RtcHostNotificationSubscriptionPackage",null,[4,5]);var y=a(111),v=a(25);class A{constructor(Y,
U){this.La=Y;this.FXa=U}Hg(){this.La.Qb(v.a.Ksf,y.a.frame,Object(b.a)(this,this.Lsf,"livePersonaCardActionHandler"))}MQb(){this.La.Mz(v.a.Ksf,y.a.frame,Object(b.a)(this,this.Lsf,"livePersonaCardActionHandler"))}Lsf(Y,U,da,T,ka){if(!ka||3===da)return 2;if(1===da)return this.kZa(this.FXa.WBe(ka.upn||ka.aadObjectId));if(!this.Awh(ka))return 8;switch(ka.action){case 0:return this.kZa(this.FXa.xLg(ka));case 1:return this.kZa(this.FXa.wLg(ka));case 2:return this.kZa(this.FXa.yLg(ka));case 3:return this.kZa(this.FXa.openCard(ka));
case 4:return this.kZa(this.FXa.qmj(ka));default:return 2}}Awh(Y){const U=Y.upn||Y.aadObjectId;return Y.targetElement&&(4===Y.action||U&&""!==U)?!0:!1}kZa(Y){return Y?32:8}}Object(B.a)(A,"LivePersonaCardActor",null,[]);var z=a(167),C=a(87);class H{}Object(B.a)(H,"BootstrapperConfig",null,[]);class I{}Object(B.a)(I,"LivePersonaCardInitializerResult",null,[]);class S{}S.zze=null;Object(B.a)(S,"LivePersonaCardModule",null,[]);var P=a(565);class D{constructor(Y,U,da,T=null){this.Hk=new z.a;this.AEg=Y;
this.sDg=U;this.fb=da;this.ukb=T}init(){this.fmf()?this.AEg.dFi().continueWith(Object(b.a)(this,this.Z0i,"onPackageLoaded")):this.Hk.setResult(Object.assign(new I,{isInitialized:!1,isEnabled:!1,failureMessage:"LivePersonaCard is not enabled."}));return this.Hk.task}Z0i(){const Y=S.zze;if(Y){const U=this.BTh();try{Y.initializeLivePersonaCardAsync(U).then(()=>{this.Hk.setResult(Object.assign(new I,{isInitialized:!0,isEnabled:!0}))}).catch(da=>{const T=Object(C.a)(String,da);T?this.Hk.setException(Error.create(T)):
this.Hk.setException(Error.create(JSON.stringify(da)))})}catch(da){this.Hk.setException(da)}}else this.Hk.setResult(Object.assign(new I,{isInitialized:!1,isEnabled:!0,failureMessage:"LivePersonaCardBootstrapper package is not loaded."}))}BTh(){const Y=P.a.bK(n.AFrameworkApplication.lcid);return Object.assign(new H,{culture:Y?Y.name.toLocaleLowerCase():"en-us",clientType:this.fb.Wa("LivePersonaCardClientType"),clientContextType:"Generic",clientCorrelationId:n.AFrameworkApplication.userSessionId,complianceEnvironment:this.HVh(),
logMessage:Object(b.a)(this,this.logMessage,"logMessage"),getAuthToken:Object(b.a)(this,this.getAuthToken,"getAuthToken")})}fmf(){if(!this.fb.qa("LivePersonaCardIsEnabled")||!this.DUg())return!1;const Y=this.fb.Wa("SovereignEnvironmentName");return Y&&""!==Y?Y.toLocaleLowerCase()==="USGov".toLocaleLowerCase()||Y.toLocaleLowerCase()==="Blackforest".toLocaleLowerCase()?!0:!1:!0}DUg(){return this.fb.qa("CoauthorGalleryLivePersonaCardIsEnabled")||!!n.AFrameworkApplication.sa&&n.AFrameworkApplication.sa.Qa.aTa}HVh(){return this.fb.Wa("LivePersonaCardComplianceEnvironment")}logMessage(Y,
U,da){Y=JSON.stringify({["Log Type"]:Y,["Log Result Type"]:U,["Message"]:da});c.ULS.sendTraceTag(50431106,3006,50,Y)}getAuthToken(Y,U){n.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?this.ukb.continueWith(da=>{da.vh||da.Lf?U("LokiTokenManagerTask is either canceled or faulted.",n.AFrameworkApplication.userSessionId):this.ukb.result.Zid().then(T=>{T.isSuccess&&T.token&&T.token.length?Y(T.token,n.AFrameworkApplication.userSessionId):U(T.errorMessage,
n.AFrameworkApplication.userSessionId)}).catch(T=>c.ULS.sendTraceTag(539617039,3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(T)))}):this.sDg.Zid().then(da=>{da.isSuccess&&da.token&&da.token.length?Y(da.token,n.AFrameworkApplication.userSessionId):U(da.errorMessage,n.AFrameworkApplication.userSessionId)}).catch(da=>c.ULS.sendTraceTag(50431107,3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(da)))}}Object(B.a)(D,"LivePersonaCardInitializer",
null,[]);class G{}Object(B.a)(G,"Behavior",null,[]);class E{}Object(B.a)(E,"Identifiers",null,[]);class O{}Object(B.a)(O,"LivePersonaCardParameters",null,[]);class N{}Object(B.a)(N,"PersonaInfo",null,[]);class J{constructor(Y){this.BBg=Y}WBe(Y){return this.BBg.fmf()&&Y&&""!==Y?!!window.self.LPC:!1}xLg(Y){return this.EQb("addedPersonaToPageV2",Y,0)}wLg(Y){return this.EQb("addedPersonaToPageV2",Y,1)}yLg(Y){return this.EQb("addedPersonaToPageV2",Y,2)}openCard(Y){return this.EQb("openCard",Y)}qmj(Y){return this.EQb("removedPersonaFromPage",
Y)}z4g(Y){return!!Y.targetElement&&(this.WBe(Y.upn||Y.aadObjectId)||4===Y.action)}EQb(Y,U,da=3){if(!this.z4g(U))return!1;da=4!==U.action?this.Khh(U,da):null;const T=window.self.LPC;if(T&&T[Y]){if(da)T[Y](U.targetElement,da);else T[Y](U.targetElement);return!0}return!1}Khh(Y,U=3){const da=Object.assign(new E,{PersonaType:"User",Upn:Y.upn,AadObjectId:Y.aadObjectId});return Object.assign(new O,{personaInfo:Object.assign(new N,{identifiers:da,displayName:Y.name,personaCoinColor:Y.color}),behavior:Object.assign(new G,
{onCardOpen:()=>{c.ULS.sendTraceTag(595067869,3006,100,"LivePersonaCard opened");if(Y.onCardOpen)Y.onCardOpen()},onCardClose:Y.onCardClose,disableClick:2===U||3===U,disableHover:0===U||3===U})})}}Object(B.a)(J,"LivePersonaCardManager",null,[]);class W{constructor(Y){this.LGg=Y}dFi(){const Y=n.AFrameworkApplication.jO("midgardbootstrapper.js",5);return this.LGg.Ixd(Y).continueWith(()=>{S.zze=window.self.MidgardBootstrapper})}}Object(B.a)(W,"LivePersonaCardPackageLoader",null,[525]);var ea=a(524);class R{constructor(){this.$a=
null}get name(){return"Common.App.LivePersonaCard"}init(){n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.zu(Object(b.a)(this,this.mB,"onFullAppSettingsReady"))}dispose(){}Kh(Y){this.$a=Y}mB(){let Y;Y=n.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?new D(new W(this.$a.resolve("Common.ISharedDependencyLoader")),null,n.AFrameworkApplication.fa,ea.a.gq(this.$a.Tb("Common.ILokiTokenManager"))):new D(new W(this.$a.resolve("Common.ISharedDependencyLoader")),
this.$a.resolve("Common.ILokiTokenManager"),n.AFrameworkApplication.fa);Y.init().continueWith(U=>{U.Lf&&U.exception?c.ULS.sendTraceTag(50431108,3006,15,"Failed to initialize LivePersonaCard, exception: [{0}]",U.exception.message):((U=U.result)||c.ULS.sendTraceTag(595067868,3006,15,"LivePersonaCardInitializer did not return a result"),U.isInitialized?c.ULS.sendTraceTag(50431109,3006,100,"Successfully initialized LivePersonaCard"):c.ULS.sendTraceTag(595067867,3006,U.isEnabled?15:100,"Failed to initialize LivePersonaCard, failure message: [{0}]",
U.failureMessage))});(new A(n.AFrameworkApplication.rb,new J(Y))).Hg()}static main(){x.a.instance.si(new R)}}Object(B.a)(R,"LivePersonaCardPackage",null,[4,5]);a=a(1176);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.ExcelLive");Type.registerNamespace("_Ewa");Object(r.a)();Type.registerNamespace("Common.App.RtcHostNotificationSubscription");t.main();Type.registerNamespace("Common.App.LivePersonaCard.Contracts");Type.registerNamespace("Common.App.LivePersonaCard");R.main();Type.registerNamespace("AppRealtimeChannel");
Object(a.a)()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.rt.js.map/43196468ad2c6ec5d17669f687f5614e/EwaDSEsNext.rt.js.map