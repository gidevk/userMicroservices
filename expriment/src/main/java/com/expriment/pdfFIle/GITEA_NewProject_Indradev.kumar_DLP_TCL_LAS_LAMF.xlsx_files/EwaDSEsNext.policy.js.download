'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[59],{1471:function(r,B,a){a.r(B);var c=a(0),b=a(15),e=a(88),f=a(873),d=a(197),h=a(559);class l{constructor(Yb,Sc,qd=null){this.id=Yb.Id;qd||(qd="");this.pij=qd;this.sensitivityLabel=Yb}}Object(c.a)(l,"AutoPolicyLabelData",null,[]);class k{constructor(Yb,Sc){this.cM=Yb;this.displayName=Sc}}Object(c.a)(k,"PolicyLabelRequestState",null,[]);class w{constructor(){this.sRd=this.pCd=""}}Object(c.a)(w,"PolicyStrings",null,
[]);var n=a(156),x=a(4),m=a(163),u=a(13),t=a(47),y=a(31);class v{static get Xvd(){return v.$Bi}}v.$Bi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(c.a)(v,"JustificationDialogHtml",null,[]);class A extends n.a{constructor(Yb,Sc){super(!1,!1,A.Su);this.gra=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];this.PXb=null;this.NXb=!1;this.CYb=Yb;this.ZD=Sc;this.qg=this.y0g();this.Rb=1;this.we=A.id;this.wc(1,CommonUIStrings.l_DialogChange);this.gL(1,!1);this.C0(0)}nWd(){if(A.Su)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,
Object(e.a)(this,this.uUf,"reactJustificationDialogHandler"),this.t8e(this.NXb));else{const Yb={};for(let Sc=0;Sc<this.gra.length;Sc++)Yb[A.pKd+Sc]=!1;Yb[A.UPb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.ZBi,"justificationDialogHandler"),Yb);this.kkj();t.a.addHandler($get(A.UPb),u.a.input,Object(e.a)(this,this.AWj,"textAreaHandler"))}}validate(){if(A.Su)return this.Vog(this.PXb);const Yb=$get(A.UPb);return Yb.disabled?!0:this.Vog(Yb.value)}Vog(Yb){const Sc=
2>Yb.length,qd=500<Yb.length,Id=RegExp("[{|}|;|\\\\]").test(Yb);Yb=""===y.a.mvc(Yb);return!Sc&&!qd&&!Id&&!Yb}ZBi(Yb,Sc){let qd="";if(1===Yb)for(let Id=0;Id<this.gra.length;Id++)if(Sc[A.pKd+Id]){qd=Id===this.gra.length-1?Sc[A.UPb]:this.gra[Id];break}this.ZD(Yb,this.CYb,qd)}uUf(Yb){let Sc="";1===Yb&&this.PXb&&(Sc=this.PXb);this.ZD(Yb,this.CYb,Sc)}n_i(Yb){this.PXb=Yb;Yb=this.validate();this.NXb!==Yb&&(this.NXb=Yb,this.LUa(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.uUf,"reactJustificationDialogHandler"),
this.t8e(this.NXb)))}t8e(Yb){return{["id"]:this.we,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:CommonUIStrings.l_SensitivityJustificationPlaceholder}},["actionButtonProps"]:{["label"]:CommonUIStrings.l_DialogChange,["disabled"]:!Yb},["infoMessage"]:CommonUIStrings.l_SensitivityJustificationMessage,["justificationIrrelevantLabel"]:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,["justificationIncorrectLabel"]:CommonUIStrings.l_SensitivityJustificationIncorrect,
["justificationOtherLabel"]:CommonUIStrings.l_SensitivityJustificationOther,["onJustificationUpdated"]:Object(e.a)(this,this.n_i,"onJustificationUpdated")}}AWj(Yb){Yb.target&&this.gL(1,this.validate())}y0g(){return n.a.Iq(A.Xvd,x.AFrameworkApplication.ZA,m.getImageClass(A.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.gra[0],this.gra[1],this.gra[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)}kkj(){const Yb=document.getElementsByName(A.zEi);for(let Sc=0;Sc<Yb.length;Sc++)t.a.addHandler(Yb[Sc],
u.a.focus,Object(e.a)(this,this.$Sf,"radioButtonFocusHandler")),t.a.addHandler(Yb[Sc],u.a.click,Object(e.a)(this,this.$Sf,"radioButtonFocusHandler"))}$Sf(Yb){if(Yb=Yb.target){Yb.checked=!0;var Sc=$get(A.UPb);Yb.id===A.pKd+(this.gra.length-1)?(Sc.disabled=!1,Sys.UI.DomElement.setVisible(Sc,!0),Sc.focus()):(Sc.disabled=!0,Yb.focus());this.gL(1,this.validate())}}static get Su(){return x.AFrameworkApplication.sa.Qa.Fv&&x.AFrameworkApplication.sa.Qa.Ktd}}A.Xvd=v.Xvd;A.zEi="ListRadioBox";A.pKd="radiobox";
A.UPb="txtJustification";A.iconName="Info_32x32x32";A.id="JustificationDialog";Object(c.a)(A,"JustificationDialog",n.a,[]);class z extends n.a{constructor(Yb,Sc,qd){super(!1,!1,!0);if(Yb&&qd){var Id={["id"]:"MandatoryLabellingDialog"};this.Kyg=qd;this.$Pc=Sc;if(!x.AFrameworkApplication.fa.qa("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.$Pc&&""!==this.$Pc)Id.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:CommonUIStrings.l_LearnMore,["handler"]:{["href"]:this.$Pc,
["target"]:"_blank"},["customTooltip"]:CommonUIStrings.L_LearnMoreTooltip};Sc={["sections"]:[],["shouldAutoOpen"]:!1};Array.add(Sc.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:Yb});Id.labelFlyout={["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:Sc};Yb={["id"]:"MandatoryLabellingDialog",["bodyControls"]:Id};Id.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;
Id.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;this.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(e.a)(this,this.NKi,"mandatoryLabellingDialogHandler"),Yb)}else b.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}NKi(Yb,Sc){1===Yb&&Sc.selectedLabel&&(Yb=Sc.selectedLabel,""!==Yb&&this.Kyg(Yb))}}Object(c.a)(z,"MandatoryLabellingDialog",n.a,[]);class C{constructor(){this.Zkb=!!x.AFrameworkApplication.sa&&
x.AFrameworkApplication.sa.Qa.Fv}Qhh(Yb,Sc,qd){this.Zkb&&new z(Yb,Sc,qd)}static get instance(){return C.Ma||(C.Ma=new C)}}C.Ma=null;Object(c.a)(C,"MandatoryLabellingDialogFactory",null,[583]);class H{}H.xTj="sbProtectForm14";H.zTj="SBStatusBarMarkAsReadOnly14";H.KDi="Info_16x16x32";H.dsb="QuickSearchCompletedToday_16x16x32";H.SKd="CommonControlCheckboxCheck_16";H.Vhg="On";H.visible="Visible";H.JMh="ImageIsVisible";H.dG="SourceControlId";H.menuItemId="MenuItemId";H.menu="Menu";H.a_c="AppLockId";H.value=
"Value";H.Bi="LabelText";H.alt="Alt";H.Rff="Image16by16";H.I6a="Image16by16Class";H.wTj="SBProtectForm_16";H.yTj="SBStatusBarMarkAsReadOnly_16";H.icon="Icon";H.iconColor="IconColor";H.customTooltip="CustomTooltip";H.Ehj="MipTagDynamicFillWithOutline_20";H.Fhj="MipTagLockDynamicFillWithOutline_20";H.Dhj="MipTagErrorOutline_20";H.Ghj="MipTagQuestionOutline_20";H.c0d="transparent";H.J1j="UILocation";Object(c.a)(H,"PolicyConstants",null,[]);class I extends n.a{constructor(Yb,Sc,qd){super(!1,!1,I.Su);
this.CYb=Yb;this.uXa=Sc;this.ZD=qd;this.Rb=1;this.we=I.id;this.C0(1);this.C0(0)}JWd(){const Yb={["id"]:"UserDefinedPermissionsDialog"};I.Su&&this.initializeAndShow("Defined Permissions",Object(e.a)(this,this.x8j,"userDefinedPermissionsDialogHandler"),Yb)}x8j(Yb){1!==Yb&&this.ZD(Yb,this.CYb,"",this.uXa)}static get Su(){return x.AFrameworkApplication.sa.Qa.Fv&&x.AFrameworkApplication.sa.Qa.Ktd}}I.id="UserDefinedPermissionsDialog";Object(c.a)(I,"UserDefinedPermissionsDialog",n.a,[]);var S=a(588),P=a(382),
D=a(321),G=a(573),E=a(102),O=a(150),N=a(570),J=a(566),W=a(140),ea=a(436),R=a(141),Y=a(92),U=a(179),da=a(337),T=a(86),ka=a(111),L=a(25),fa=a(72),wa=a(58);class oa{constructor(Yb,Sc,qd,Id){this.BPc=this.llb=null;this.Wce=this.VOc=this.mPc=this.blb=this.bee=this.Efe=this.QKc=!1;this.hWa=this.wfa=this.pga=this.fqa=this.uXa=this.ho=this.Z1=this.Ne=null;this.eyg=this.MIc=0;this.T$d=this.iPc=this.XIc=this.wSc=null;this.La=Yb;this.ff=Sc;this.fb=qd;this.Ig=Id;this.Plb={};this.Die={};this.Ffe={};this.bBb=qd.qa("WacApplyManualPolicyLabelIsEnabled");
this.Ig.value.xte(Object(e.a)(this,this.HJd,"processAutoSensitivityLabel"));this.Ig.value.gZc(Object(e.a)(this,this.HJd,"processAutoSensitivityLabel"));this.Ig.value.N0b(Object(e.a)(this,this.l5i,"onUpdateLabelInfo"));x.AFrameworkApplication.sa&&x.AFrameworkApplication.sa.QQg(Object(e.a)(this,this.ujj,"refreshDocumentPolicyLabelsOnModeChange"));qd.qa("SupportsPolicies")&&qd.Wa("AppliedPolicyId")&&(this.llb=qd.Wa("IrmPolicyTitle"),this.BPc=qd.Wa("IrmPolicyDescription"));this.ISc=qd.qa("ProtectedFile");
this.vwg=this.fb.Ad("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.wwg=this.fb.Ad("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}get f8a(){return x.AFrameworkApplication.f8a||!!this.iPc&&this.iPc()}Hg(){this.La.Qb(L.a.vGd,ka.a.frame,Object(e.a)(this,this.A9b,"documentLabelPaneHandler"));this.La.Je(L.a.gcb,ka.a.frame,Object(e.a)(this,this.gcb,"queryPolicyLabel"),96);W.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.ClpQueryShortLabel")&&(this.La.Qb(L.a.dNf,
ka.a.frame,Object(e.a)(this,this.A9b,"documentLabelPaneHandler")),this.La.Je(L.a.DJb,ka.a.frame,Object(e.a)(this,this.DJb,"queryPolicyShortLabel"),96));this.La.Qb(L.a.sUa,ka.a.frame,Object(e.a)(this,this.sUa,"toggleSensitivity"));this.La.Qb(L.a.$za,ka.a.frame,Object(e.a)(this,this.$za,"populateSensitivityFlyout"));this.La.Qb(L.a.setSensitivity,ka.a.frame,Object(e.a)(this,this.setSensitivity,"setSensitivity"));this.La.Je(L.a.hcb,ka.a.frame,Object(e.a)(this,this.hcb,"querySensitivity"),96);this.La.Qb(L.a.R6,
ka.a.frame,Object(e.a)(this,this.R6,"querySensitivityToggleButton"));this.La.Qb(L.a.Q6,ka.a.frame,Object(e.a)(this,this.Q6,"querySensitivitySubFlyout"));this.sob(L.a.sUa)||this.La.meb(L.a.sUa,4);this.sob(L.a.$za)||this.La.meb(L.a.$za,4);this.sob(L.a.setSensitivity)||this.La.meb(L.a.setSensitivity,4);this.sob(L.a.R6)||this.La.meb(L.a.R6,4);this.sob(L.a.Q6)||this.La.meb(L.a.Q6,4);this.ff.updateCommandUI();x.AFrameworkApplication.fa&&x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",
!1)&&W.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this.Ig.value.Yoj(Object(e.a)(this,this.sWf,"registerActionsHandler"))}sWf(){this.Hg()}MQb(){this.La.Mz(L.a.vGd,ka.a.frame,Object(e.a)(this,this.A9b,"documentLabelPaneHandler"));this.La.Mz(L.a.gcb,ka.a.frame,Object(e.a)(this,this.gcb,"queryPolicyLabel"));W.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.ClpQueryShortLabel")&&(this.La.Mz(L.a.dNf,
ka.a.frame,Object(e.a)(this,this.A9b,"documentLabelPaneHandler")),this.La.Mz(L.a.DJb,ka.a.frame,Object(e.a)(this,this.DJb,"queryPolicyShortLabel")));this.La.Mz(L.a.sUa,ka.a.frame,Object(e.a)(this,this.sUa,"toggleSensitivity"));this.La.Mz(L.a.$za,ka.a.frame,Object(e.a)(this,this.$za,"populateSensitivityFlyout"));this.La.Mz(L.a.setSensitivity,ka.a.frame,Object(e.a)(this,this.setSensitivity,"setSensitivity"));this.La.Mz(L.a.hcb,ka.a.frame,Object(e.a)(this,this.hcb,"querySensitivity"));this.La.Mz(L.a.R6,
ka.a.frame,Object(e.a)(this,this.R6,"querySensitivityToggleButton"));this.La.Mz(L.a.Q6,ka.a.frame,Object(e.a)(this,this.Q6,"querySensitivitySubFlyout"))}sUa(){return 32}p2e(Yb){const Sc="mandatoryLabelling_"+Yb.Id;this.Ffe[Sc]=Yb.Id;return{["type"]:"AppToggleButtonProps",["id"]:Sc,["label"]:Yb.DisplayName,["hideLabel"]:!1,["customTooltip"]:Yb.Tooltip}}XNa(){return this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)}w1h(){const Yb=[],Sc=this.Z1;for(let Id in Sc){var qd=Sc[Id];
const ic=this.ho[Id];if(ic&&ic.Enabled&&!ic.HasUserDefinedPermissions)if(qd.count){const Gc={["sections"]:[],["shouldAutoOpen"]:!1},jd={["id"]:"mandatoryLabelling_flyoutMenuSection_"+ic.Id,["controls"]:[]};for(let ed of qd)(qd=this.ho[ed])&&qd.Enabled&&!qd.HasUserDefinedPermissions&&Array.add(jd.controls,this.p2e(qd));Array.add(Gc.sections,jd);Array.add(Yb,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+ic.Id,["label"]:ic.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,
["menuDefinition"]:Gc})}else Array.add(Yb,this.p2e(ic))}return Yb}$za(Yb,Sc,qd,Id,ic){if(1===qd||!this.Ig.value.uha(!0))return 32;ic.MenuItems=Object.assign(new N.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(ic.MenuItems.MenuSectionList,this.Jc(!this.isReactRibbonEnabled()));this.Ne.CustomUrl&&Array.add(ic.MenuItems.MenuSectionList,this.Fhh(this.isReactRibbonEnabled()?this.Ne.CustomUrl:y.a.df(this.Ne.CustomUrl)));this.isReactRibbonEnabled()||(ic.PopulationXML=D.q(ic.MenuItems));
return 32}hcb(Yb,Sc,qd,Id,ic){if(1===qd||!ic||!this.bBb)return 32;this.Ne=this.Ig.value.nm;if(this.Ig.value.uha(!0)&&(ic[H.visible]=!0,this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelsAvailableActivityControlEnabled",!1)?this.bee||(O.a("MipLabelsAvailable"),this.bee=!0):O.a("MipLabelsAvailable"),this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&this.Ne&&this.Ne.AreLabelsAvailable&&(Yb=T.a.instance.Tb("Common.ISystemInitiatedFeedback")))){const Gc=
oa.ah(this.Ne.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";Yb.execute(jd=>{jd.logActivity(Gc,null)})}return 32}R6(Yb,Sc,qd,Id,ic){if(1===qd||!ic)return 32;let Gc,jd;ic[H.Vhg]=!!(Gc=ic[H.menuItemId])&&!!(jd=this.Plb[Gc])&&jd===this.Ne.AppliedPolicyId;return 32}Q6(Yb,Sc,qd,Id,ic){if(1===qd||!ic)return 32;let Gc,jd,ed;Yb=!!(Gc=ic[H.dG])&&!!(jd=this.Plb[Gc])&&!!(ed=this.Z1[jd])&&ed.contains(this.Ne.AppliedPolicyId);ic[H.JMh]=Yb;ic[H.Vhg]=Yb;return 32}setSensitivity(Yb,
Sc,qd,Id,ic){if(1===qd||!ic)return 32;Yb=this.Plb[ic[H.dG]];Sc=this.K1j(ic[H.J1j]);qd=new fa.a;qd.name="SensitivityPickerLocation";qd.int64=Sc;O.a("SensitivityPickerUsage",void 0,void 0,[qd]);return this.moa(Yb,ic,2)}Pic(){return!!x.AFrameworkApplication.sa&&1===x.AFrameworkApplication.sa.mode}ujj(){this.VOc&&!this.Pic()&&(this.VOc=!1,this.Ig.value.tjj())}Vig(){this.Ne.DefaultLabelId&&this.Ne.MandatoryLabelingEnforced?this.QKc||this.Pic()?this.Ne.AppliedPolicyId?this.obd(""):(this.Ig.value.Lxi(this.Ig.value.bEb)||
this.Pic())&&this.LRe():this.c7f():this.Ne.DefaultLabelId?this.c7f():this.Ne.MandatoryLabelingEnforced&&(this.Ne.AppliedPolicyId?this.obd(""):this.LRe())}lmf(){return this.Ne.MandatoryLabelingEnforced?this.Ne&&this.Ne.AreLabelsAvailable?this.fb.qa("TestOverrideIsReactDialogEnabled")||this.ff&&this.ff.Qa&&this.ff.Qa.Fv?!0:(b.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(b.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),
!1):(b.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)}LRe(){!this.lmf()||x.AFrameworkApplication.h5||this.Efe||(this.Efe=x.AFrameworkApplication.h5=!0,b.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.Ig.value.uTf("",1),this.Ig.value.YXc(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,
()=>{this.LKi()}))}obd(Yb){this.lmf()&&x.AFrameworkApplication.h5&&(x.AFrameworkApplication.h5=!1,b.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.Ig.value.VMd(),this.Ig.value.uTf(Yb,2))}LKi(){C.instance.Qhh(this.w1h(),this.Ne.CustomUrl,Object(e.a)(this,this.MKi,"mandatoryLabellingDialogCallback"))}MKi(Yb){this.obd(this.Ffe[Yb])}Bye(){return this.fb.qa("CoAuthForProtectedFilesEnabled")&&this.fb.qa("SupportsOfficeClientCoauthoring")&&this.fb.qa("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&
!!this.T$d&&this.f8a}moa(Yb,Sc,qd,Id=null){this.Ig.value.lgj(qd);let ic=32,Gc=!1,jd=!0;const ed=2===qd||8===qd||16===qd,Qd=Yb===this.Ne.AppliedPolicyId;if(this.XIc&&this.XIc(Yb,ed))b.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",qd),this.ff.updateCommandUI();else if(Sc&&H.a_c in Sc&&this.Ig.value.PEj(Sc[H.a_c]),Yb)if(this.Ig.value.xof()||this.Bye()&&this.mPc)b.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",
qd),this.ff.updateCommandUI(),ed&&this.y1b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.fb.qa("HasDocumentEditRights"))if(this.Ig.value.P4g(Yb))if(!this.XNa()&&this.ho[Yb]&&this.ho[Yb].HasUserDefinedPermissions&&!Qd)b.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",qd),1!==qd&&4!==qd&&this.FTg();else if(ed&&this.Ne.MandatoryLabelingEnforced&&Qd)b.ULS.sendTraceTag(570972054,
306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",qd),this.y1b(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(ed&&this.fb.qa("WacLabelingJustificationDialogIsEnabled")&&this.Ne.RequiredDowngradeJustification&&(Qd||this.ho[Yb].RequiredDowngradeJustification)&&(this.XNa()?!this.Wce&&!Id:!this.uXa))return b.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
qd),this.nWd(Yb),ic;if(this.XNa()&&this.ho[Yb].HasUserDefinedPermissions&&!Qd)return b.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",qd),this.JWd(Yb,Id),ic;if(this.Bye()&&!this.T$d())this.MIc<this.vwg?(b.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.MIc,qd),this.mPc=!0,this.MIc++,wa.Task.delay(this.wwg).continueWith(()=>{this.mPc=!1;this.moa(Yb,Sc,qd)})):(b.ULS.sendTraceTag(577356771,
306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",qd),Gc=1!==qd,jd=!1,ic=8);else{if(this.nwi(Yb)&&(b.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",qd),1===qd||8===qd||4===qd))return ic;b.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",qd);this.setPolicyLabel(Qd?"":Yb,this.XNa()?Id:this.uXa,"",qd);return ic}}else b.ULS.sendTraceTag(42796169,
306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",qd),this.ff.updateCommandUI(),ed&&this.y1b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else b.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",qd),this.ff.updateCommandUI(),ed&&this.y1b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);
else b.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",qd),this.ff.updateCommandUI(),Gc=ed,jd=!1,ic=8;this.Ig.value.FKd(0,qd,Gc,jd);return ic}x_a(Yb,Sc,qd=null,Id=!1){E.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.fb.qa("SupportsOfficeClientCoauthoring")&&this.fb.qa("CoAuthForProtectedFilesIsEnabled")?(this.blb=!1,(this.Ne=this.Ig.value.nm)&&!this.Ne.AppliedPolicyId?this.blb=!0:this.Ne&&
this.Ne.PolicyLabelAssignmentMethod&&(this.blb=U.e(this.Ne.PolicyLabelAssignmentMethod)===U.e("standard"))):this.blb=Id;Yb=oa.ah(Yb)?null:this.ho[Yb];(Sc=oa.ah(Sc)?null:this.ho[Sc])?this.pga=new l(Sc,!0,qd):(this.Ig.value.Oda(29),this.wfa=null);Yb?this.fqa=new l(Yb,!1):this.hWa=null;this.HJd(null,null);return 32}JVg(Yb){""!==this.Ne.AppliedPolicyId?this.Ig.value.FKd(14,16,!0):this.moa(Yb,null,16)}Q7f(){this.ho={};if(this.Ne=this.Ig.value.nm)for(const Yb of this.Ne.SensitivityLabels)this.ho[Yb.Id]=
Yb}nwi(Yb){if(this.Z1&&Yb in this.Z1){Yb=this.Z1[Yb];for(let Sc of Yb)if((Yb=this.ho[Sc])&&Yb.Enabled)return!0}return!1}u8f(){this.Z1={};if(this.Ne=this.Ig.value.nm){for(const Yb of this.Ne.SensitivityLabels)Yb.ParentId||(this.Z1[Yb.Id]=new d.a);for(const Yb of this.Ne.SensitivityLabels){if(this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RemoveDisabledLabelsFromChildLabel",!1)){if(!(Yb.ParentId&&Yb.ParentId in this.Z1&&Yb.Enabled))continue}else if(!(Yb.ParentId&&Yb.ParentId in this.Z1))continue;
this.Z1[Yb.ParentId].add(Yb.Id)}}}NSf(){if(this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)){this.Ne=this.Ig.value.nm;const Yb=this.bBb&&this.isReactRibbonEnabled()&&this.Ig.value.uha();oa.vRa(Yb)}else this.bBb&&this.isReactRibbonEnabled()?(this.Ne=this.Ig.value.nm,this.Ig.value.uha()?(oa.vRa(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):oa.vRa(!1)):oa.vRa(!1)}Qjj(Yb){this.XIc=Yb}Hkj(Yb){this.iPc=Yb}c7f(){if(this.fb.qa("WacApplyDefaultPolicyLabelIsEnabled"))if(this.Pic())this.VOc=
!0;else if(!this.QKc)if(this.QKc=!0,this.Ne=this.Ig.value.nm,this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",!1)){if(this.Ne&&this.Ne.DefaultLabelId)if(!this.Ne.AppliedPolicyId)b.ULS.sendTraceTag(509732190,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.Ne.DefaultLabelType),this.moa(this.Ne.DefaultLabelId,null,1);else if(h.a.li().equals(this.Ne.DefaultLabelType,"documentLibraryDefault")){const Yb=this.ho[this.Ne.AppliedPolicyId],Sc=this.ho[this.Ne.DefaultLabelId];
this.Ne.AppliedPolicyId!==this.Ne.DefaultLabelId&&h.a.li().equals(this.Ne.PolicyLabelAssignmentMethod,"standard")&&Yb.Order<Sc.Order&&(b.ULS.sendTraceTag(509732189,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.Ne.DefaultLabelType),this.moa(this.Ne.DefaultLabelId,null,1))}}else this.Ne&&this.Ne.DefaultLabelId&&!this.Ne.AppliedPolicyId&&(b.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.Ne.DefaultLabelId),this.moa(this.Ne.DefaultLabelId,null,
1))}HJd(){if(!this.Ig.value.xof()){var Yb=this.ho[this.Ne.AppliedPolicyId];this.blb&&this.fqa&&this.hWa!==this.fqa.id&&(!Yb||Yb.Order<this.fqa.sensitivityLabel.Order)&&(Yb=this.moa(this.fqa.id,{},4),32!==Yb?b.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+Yb):(this.hWa=this.fqa.id,this.wfa&&(Yb=this.ho[this.wfa])&&Yb.Order<=this.fqa.sensitivityLabel.Order&&(this.Ig.value.Oda(29),this.wfa=null)));Yb=this.ho[this.Ig.value.nm.AppliedPolicyId];
if(this.pga&&this.wfa!==this.pga.id&&(!Yb||Yb.Order<this.pga.sensitivityLabel.Order)){const Sc=this.pga.id;this.Ig.value.Oda(29);this.Ig.value.f0b(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.Cjd(this.pga.sensitivityLabel))+" "+this.pga.pij,CommonUIStrings.l_PolicyLabelRecommendationButton,()=>{this.moa(Sc,{},8)});this.wfa=this.pga.id}this.pga=this.fqa=null}}setPolicyLabel(Yb,Sc,qd,Id=2){this.XNa()?Sc&&(this.Wce=!0):this.uXa=Sc;
this.Ig.value.setPolicyLabel(Yb);this.ff.updateCommandUI();qd=new k(Id,this.Cjd(this.ho[Yb]));this.Ig.value.DTd(Yb,this.XNa()?Sc:this.uXa,qd)}Ech(Yb,Sc,qd,Id){1===Yb&&this.setPolicyLabel(Sc,Id,qd)}Dch(Yb,Sc,qd){1===Yb?this.XNa()?this.moa(Sc,null,2,qd):this.setPolicyLabel(Sc===this.Ne.AppliedPolicyId?"":Sc,qd,""):this.ff.updateCommandUI()}nWd(Yb){(new A(Yb,Object(e.a)(this,this.Dch,"continueToSetPolicyLabelFromJustificationDialog"))).nWd()}JWd(Yb,Sc){(new I(Yb,Sc,Object(e.a)(this,this.Ech,"continueToSetPolicyLabelFromUDPDialog"))).JWd()}y1b(Yb=
"",Sc=""){const qd=new R.StandardDialog;qd.yt=x.AFrameworkApplication.hBb;qd.Rb=0;qd.wc(1,CommonUIStrings.l_DialogClose);qd.jS(Yb,Sc,null)}IZg(Yb){1===Yb&&this.Ig.value.qgj()}FTg(){const Yb=new R.StandardDialog;Yb.yt=x.AFrameworkApplication.hBb;Yb.Rb=1;Yb.wc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);Yb.wc(0,CommonUIStrings.l_DialogClose);Yb.jS(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(e.a)(this,this.IZg,"blockUDPSetLabelHandler"))}isReactRibbonEnabled(){return!!this.ff&&
!!this.ff.Qa&&this.ff.Qa.Ni}xn(){return this.ff&&this.ff.Qa?this.ff.Qa.xn:!1}A9b(){return 32}gcb(Yb,Sc,qd,Id,ic){if(1===qd)return 32;this.Ne=this.Ig.value.nm;if(!this.Ne||!ic)return 32;ic[H.value]="";ic[H.Bi]="";ic[H.alt]=null;ic[H.Rff]=null;ic[H.I6a]=null;ic[H.customTooltip]="";ic[H.visible]=!1;ic[H.iconColor]="";qd=Sc=Yb=ic[H.icon]="";if(!this.Ne.AreLabelsAvailable){if(!this.llb)return 32;Yb=this.llb;qd=H.c0d;this.BPc&&(Sc=this.BPc)}else if(this.Ne.AppliedPolicyId){Id=null;if(W.a("isSharedUxGateEnabled")&&
appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.ClpQueryShortLabel"))this.ho&&(Id=this.ho[this.Ne.AppliedPolicyId]);else for(const Gc of this.Ne.SensitivityLabels)if(Gc.Id.toLowerCase()===this.Ne.AppliedPolicyId.toLowerCase()){Id=Gc;break}Id&&(Yb=this.Cjd(Id),Sc=Id.Tooltip,this.ISc=x.AFrameworkApplication.protectedFile=Id.IsEndpointProtectionEnabled,qd=this.t3e(Id))}this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(Yb?(ic[H.value]=Yb,ic[H.Bi]=Yb,
ic[H.customTooltip]=Sc,this.Y7f(qd,this.ISc,ic)):(ic[H.iconColor]=H.c0d,this.Ne.MandatoryLabelingEnforced?(ic[H.value]=ic[H.Bi]=this.lec().sRd,ic[H.icon]=H.Dhj):(ic[H.value]=ic[H.Bi]=this.lec().pCd,ic[H.icon]=H.Ghj)),ic[H.visible]=!0):Yb&&(ic[H.value]=Yb,ic[H.Bi]=Yb,this.xn()?ic[H.customTooltip]=Sc:ic[H.alt]=Sc,this.Y7f(qd,this.ISc,ic),ic[H.visible]=!0);return 32}DJb(Yb,Sc,qd,Id,ic){if(1===qd)return 32;this.Ne=this.Ig.value.nm;if(!this.Ne||!ic)return 32;ic[H.Bi]="";if(this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpUseHideBarByDefaultSetting",
!1)&&this.Ne.HideBarByDefault)return 32;Yb="";if(this.Ne.AreLabelsAvailable)if(this.Ne.AppliedPolicyId){if(!this.ho)return 32;(Sc=this.ho[this.Ig.value.nm.AppliedPolicyId])&&(Yb=Sc.ParentId&&this.ho[Sc.ParentId]?this.ho[Sc.ParentId].DisplayName:Sc.DisplayName)}else Yb=this.Ne.MandatoryLabelingEnforced?this.lec().sRd:this.lec().pCd;else{if(!this.llb)return 32;Yb=this.llb}ic[H.Bi]=Yb;return 32}Cjd(Yb){return Yb?this.ho?Yb.ParentId&&this.ho[Yb.ParentId]?this.ho[Yb.ParentId].DisplayName+"\\"+Yb.DisplayName:
Yb.DisplayName:(b.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),Yb.DisplayName):""}Y7f(Yb,Sc,qd){this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(qd[H.icon]=this.m$e(Sc),qd[H.iconColor]=this.n$e(Yb)):this.xn()?qd[H.icon]=Sc?H.wTj:H.yTj:(qd[H.Rff]=x.AFrameworkApplication.ZA,qd[H.I6a]=Sc?m.getImageClass(H.xTj):m.getImageClass(H.zTj))}Fhh(Yb){const Sc=this.bQ("LearnMoreSection",!0);Yb=Object.assign(new P.a,
{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:Yb,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:x.AFrameworkApplication.ZA,Image16by16Class:m.getImageClass(H.KDi),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(Sc.ControlList,Yb);return Sc}iLe(Yb,Sc,qd=!1){let Id;Id="Toggle_"+Yb.Id;Id="Sensitivity_"+Id;const ic=Yb.DisplayName,Gc=Yb.Tooltip;var jd=Yb.Id===this.Ne.AppliedPolicyId,ed=qd?y.a.df(Id):Id;this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",
!1)?(jd=this.t3e(Yb),Sc=Object.assign(new ea.a,{Id:ed,ExternalId:ed,LabelText:qd?y.a.df(ic):ic,Command:"2935633379",MenuItemId:ed,QueryCommand:"991261903",Visible:!0,Alt:qd?y.a.df(Gc):Gc,AriaLabel:Y.a.i2b,IconColor:this.n$e(jd),KeyTip:Sc}),Sc.ExternalImageId=this.m$e(Yb.IsEndpointProtectionEnabled)):(ed=Object.assign(new S.a,{Id:ed,ExternalId:ed,LabelText:qd?y.a.df(ic):ic,Command:"2935633379",MenuItemId:ed,QueryCommand:"991261903",CheckedImage:x.AFrameworkApplication.ZA,Visible:!0,Alt:qd?y.a.df(Gc):
Gc,IsChecked:jd,AriaLabel:Y.a.i2b,KeyTip:Sc}),this.isReactRibbonEnabled()?(ed.CheckedImageClass=m.getImageClass(H.SKd),ed.ExternalImageId=H.SKd):ed.CheckedImageClass=m.getImageClass(H.dsb),Sc=ed);ed=Id;this.Plb[ed]=Yb.Id;this.Die[Yb.Id]=ed;return Sc}bQ(Yb,Sc=!1){return Object.assign(new J.a,{Title:"",Id:Yb,DisplayMode:H.menu,ShowMenuSectionSeparator:Sc,ControlsId:"Ctrl_"+Yb,ControlList:[]})}Hkh(Yb,Sc,qd,Id){Yb=oa.LZf()?this.bQ(Yb+"Sub"):this.bQ(Sc+"Sub");Sc=1;for(let ic of qd)(qd=this.ho[ic])&&qd.Enabled&&
(Array.add(Yb.ControlList,this.iLe(qd,Sc.toString(),Id)),Sc++);return Yb}Jc(Yb=!1){const Sc=this.bQ("SensitivitySection");let qd=1;const Id=this.Z1;for(let Gc in Id){const jd=Id[Gc],ed=this.ho[Gc];if(ed&&ed.Enabled){if(jd.count){const Qd="Sensitivity_"+ed.Name;var ic=Yb?y.a.df(Qd):Qd;ic=oa.LZf()?"Label"+this.eyg++:ic;const te=Object.assign(new G.a,{Id:ic,ExternalId:ic,LabelText:Yb?y.a.df(ed.DisplayName):ed.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new N.a,{Title:"",
MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:Y.a.i2b,KeyTip:qd.toString(),Alt:Yb?y.a.df(ed.Tooltip):ed.Tooltip});this.isReactRibbonEnabled()?te.ExternalImageId=H.SKd:(te.Image16by16=x.AFrameworkApplication.ZA,te.Image16by16Class=m.getImageClass(H.dsb));Array.add(te.Menu.MenuSectionList,this.Hkh(ic,Qd,jd,Yb));Array.add(Sc.ControlList,te);this.Plb[te.Id]=ed.Id;this.Die[ed.Id]=te.Id}else Array.add(Sc.ControlList,this.iLe(ed,qd.toString(),
Yb));qd++}}return Sc}sob(Yb){return!!this.La.h4(Yb)&&!!this.La.h4(Yb).flags&&!!this.La.h4(Yb).flags.length}l5i(Yb,Sc){Sc.onSuccess&&this.ho&&(Yb=this.ho[this.Ig.value.nm.AppliedPolicyId])&&(this.wfa&&(Sc=this.ho[this.wfa])&&Sc.Order<=Yb.Order&&(this.Ig.value.Oda(29),this.wfa=null),this.hWa&&this.hWa!==Yb.Id&&(this.Ig.value.Oda(28),this.hWa=null))}m$e(Yb){return Yb?H.Fhj:H.Ehj}n$e(Yb){return Yb?Yb:H.c0d}t3e(Yb){if(Yb.Color||!Yb.ParentId)return Yb.Color;const Sc=this.ho[Yb.ParentId];return Sc?Sc.Color:
Yb.Color}K1j(Yb){switch(Yb){case 2:case 14:case 15:return 1;case 21:return 2;default:return 0}}lec(){this.wSc||(this.wSc=Object.assign(new w,{pCd:HeaderStrings.NoSensitivityLabel,sRd:HeaderStrings.SelectASensitivityLabel}));return this.wSc}static LZf(){if(null!=oa.eYb)return oa.eYb;x.AFrameworkApplication.yya("ce2ai523-t;6f627846-c");oa.eYb=x.AFrameworkApplication.fa?x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.WordOnline.RenameCLPControlIds",!1):!1;return oa.eYb}static vRa(Yb){x.AFrameworkApplication.fa&&
x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Yb?(da.a.QCd("ribbon","sensitivity"),da.a.KCd("ribbon","sensitivity")):da.a.PCd("ribbon","sensitivity"));x.AFrameworkApplication.fa&&x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&W.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!Yb))}static ah(Yb){return Yb&&Yb.length?!1:!0}}oa.eYb=
null;Object(c.a)(oa,"PolicyActor",null,[524]);var xa=a(653),bb=a(101),Za;(function(Yb){Yb[Yb.unknown=0]="unknown";Yb[Yb.boot=1]="boot";Yb[Yb.refresh=2]="refresh";Yb[Yb.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(Za||(Za={}));Object(c.b)("GetPolicyLabelsReason",Za);class La extends Sys.EventArgs{constructor(Yb,Sc,qd,Id,ic,Gc){super();this.prb=Yb;this.title=Sc;this.message=qd;this.buttonText=Id;this.w$=ic;this.DCb=Gc}}Object(c.a)(La,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class va extends Sys.EventArgs{constructor(Yb,
Sc,qd,Id,ic){super();this.prb=Yb;this.title=Sc;this.message=qd;this.buttonText=Id;this.w$=ic}}Object(c.a)(va,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Ba;(function(Yb){Yb[Yb.none=0]="none";Yb[Yb.reasonDefaultLabel=1]="reasonDefaultLabel";Yb[Yb.reasonManual=2]="reasonManual";Yb[Yb.reasonAutomatic=4]="reasonAutomatic";Yb[Yb.reasonRecommended=8]="reasonRecommended";Yb[Yb.reasonMandatory=16]="reasonMandatory"})(Ba||(Ba={}));Object(c.b)("ApplyLabelFlags",Ba);class Ea extends Sys.EventArgs{constructor(Yb,
Sc,qd){super();this.AFe=Yb;this.zFe=Sc;this.existingLabelPriority=qd}}Object(c.a)(Ea,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class pa extends Sys.EventArgs{constructor(){super()}}Object(c.a)(pa,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);class $a extends Sys.EventArgs{constructor(){super()}}Object(c.a)($a,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class cb{constructor(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=
!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelType=this.DefaultLabelId=null;this.AreLabelsAvailable=this.HideBarByDefault=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelType=this.DefaultLabelId="";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;this.CustomUrl="";this.HideBarByDefault=!1}}Object(c.a)(cb,"GetPolicyLabelsData",
null,[]);class ib extends Sys.EventArgs{constructor(Yb=!1){super();this.onSuccess=Yb}}Object(c.a)(ib,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class ta extends Sys.EventArgs{constructor(Yb,Sc){super();this.Nya=Yb;this.vve=Sc}}Object(c.a)(ta,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);class Ya extends Sys.EventArgs{constructor(Yb,Sc,qd,Id){super();this.title=Yb;this.ftc=Sc;this.buttonText=qd;this.DCf=Id}}Object(c.a)(Ya,"PolicyTipEventArgs",Sys.EventArgs,[]);class Da extends Sys.EventArgs{constructor(Yb,
Sc){super();this.prb=Yb;this.DCb=Sc}}Object(c.a)(Da,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class ba extends Sys.EventArgs{constructor(){super()}}Object(c.a)(ba,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class ya extends Sys.EventArgs{constructor(Yb,Sc){super();this.etc=Yb;this.cM=Sc}}Object(c.a)(ya,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);class V extends Sys.EventArgs{constructor(Yb,Sc,qd,Id=null,ic=null,Gc=null,jd=null){super();this.errorType=
Yb;this.Lbg=qd;this.title=Id;this.message=ic;this.buttonText=Gc;this.w$=jd}}Object(c.a)(V,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class Z extends Sys.EventArgs{constructor(){super()}}Object(c.a)(Z,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class ja extends Sys.EventArgs{constructor(Yb){super();this.YKj=Yb}}Object(c.a)(ja,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var la=a(112),ua=a(107),eb=a(40),Eb=a(82),Wb=a(41);class Ab{constructor(Yb,Sc,qd,Id,ic,Gc,jd,ed=null,Qd=null,
te=!1,xe=null,He=null,We=null,ye=null,$e=!1,jf=null,gf=null,rf=null,Mf=null,Qa=null,Zb=null){this.url=Yb;this.l$j=Sc;this.body=qd;this.headers=Id;this.cfb=ic;this.priority=Gc;this.state=jd;this.eqg=ed;this.aO=Qd;this.kN=te;this.Yej=xe;this.UAj=He;this.name=We;this.cbb=ye;this.Xed=$e;this.VGd=jf;this.Cac=gf;this.Whc=rf;this.Hdb=Mf;this.thi=Qa;this.responseType=Zb}}Object(c.a)(Ab,"ClientRequest",null,[]);var Jb=a(466),Gb=a(274);class Nb{static nDj(Yb,Sc){if(!Yb||!Sc||Yb.count!==Sc.count)return!1;for(let qd of Yb)if(!Sc.contains(qd))return!1;
return!0}static toArray(Yb){if(!Yb)return null;const Sc=Array(Yb.count);let qd=0;for(let Id of Yb)Sc[qd]=Id,qd++;return Sc}}Object(c.a)(Nb,"HashSetUtils",null,[]);var Ja=a(288),ab=a(199);class wb{constructor(Yb,Sc,qd,Id=0,ic=null){this.NKc=this.h$d=null;this.asa=this.tkb=this.vkb=0;this.q8="";this.VFa=this.FIc=this.vce=this.aqa=this.mQc=null;this.Xce=!1;this.CDa=null;this.mNc=0;this.EXb=this.XFa=this.GEa=this.DXb=null;this.Za=new bb.a;this.CNb=this.xyb=this.aw=null;this.bOc=!1;this.bEb=null;this.fb=
Yb;this.rh=Sc;this.Ah=qd;this.FWb=Id;this.nm=new cb;this.Cie=this.fb.Wa("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.cP=ic;this.bBb=Yb.qa("WacApplyManualPolicyLabelIsEnabled");this.Aic=Yb.qa("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=Yb.qa("SupportsOfficeClientCoauthoring");this.Fyi=!1;this.EFj=3E4;this.pe=ua.a.instance;Yb.qa("SupportsPolicies")&&O.a("MipSupportsPolicies");this.Aic&&this.supportsOfficeClientCoauthoring&&O.a("MipSupportsOfficeClientCoauthoring")}get Eqd(){return this.bOc}kte(Yb){this.Za.addHandler("PolicyTipEvent",
Yb)}N0b(Yb){this.Za.addHandler("LabelInfoUpdateEvent",Yb)}Yoj(Yb){this.Za.removeHandler("LabelInfoUpdateEvent",Yb)}xte(Yb){this.Za.addHandler("SetPolicyLabelEventKey",Yb)}iqj(Yb){this.Za.removeHandler("SetPolicyLabelEventKey",Yb)}gZc(Yb){this.Za.addHandler("SetPolicyLabelFailureEventKey",Yb)}hqj(Yb){this.Za.removeHandler("SetPolicyLabelFailureEventKey",Yb)}aQg(Yb){this.Za.addHandler("GetPolicyLabelEventKey",Yb)}$Pg(Yb){this.Za.addHandler("GetPolicyLabelFailureEventKey",Yb)}YPg(Yb){this.Za.addHandler("GetAutoPolicyLabelEventKey",
Yb);this.Eqd&&(b.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.tKd(new pa(0)))}Doj(Yb){this.Za.removeHandler("GetAutoPolicyLabelEventKey",Yb)}wPg(Yb){this.Za.addHandler("CreateAutoCLPSecurityNodesEventKey",Yb)}hoj(Yb){this.Za.removeHandler("CreateAutoCLPSecurityNodesEventKey",Yb)}oSg(Yb){this.Za.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Yb)}vqj(Yb){this.Za.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",
Yb)}pSg(Yb){this.Za.addHandler("UpdateAutoCLPSITNodesEventKey",Yb)}wqj(Yb){this.Za.removeHandler("UpdateAutoCLPSITNodesEventKey",Yb)}Rre(Yb){this.Za.addHandler("AddAutoPolicyBusinessBarEntryEventKey",Yb)}znj(Yb){this.Za.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",Yb)}mte(Yb){this.Za.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",Yb)}Rpj(Yb){this.Za.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",Yb)}Sre(Yb){this.Za.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",
Yb)}Bnj(Yb){this.Za.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Yb)}nte(Yb){this.Za.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Yb)}Spj(Yb){this.Za.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Yb)}KQg(Yb){this.Za.addHandler("MandatoryLabellingAppHandlerEventKey",Yb)}ipj(Yb){this.Za.removeHandler("MandatoryLabellingAppHandlerEventKey",Yb)}lSg(Yb){this.Za.addHandler("UDPLabelingAppHandlerEventKey",Yb)}tqj(Yb){this.Za.removeHandler("UDPLabelingAppHandlerEventKey",
Yb)}get Mrd(){if(!this.h$d)return!1;for(const Yb of this.h$d.ydk())if(!Yb.Capabilities||!Yb.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get Yxi(){return!!this.aw}l7g(){return this.vce?this.vce():!1}Mjj(Yb){this.FIc=Yb}vw(){return(new Date).getTime()}uhd(){this.Ah&&(this.DXb=this.Ah.Kc("WebServiceCall","Call Get Policy Endpoint On Server"));var Yb=Ja.a.uia(1,1);this.fb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(Yb=new Ab(this.z5a("datalosspolicy"),1,null,null,!0,2,null,void 0,
void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Yb),this.rh.send(Yb).$Ld(Object(e.a)(this,this.aEf,"onDataLossPolicySuccessCallback"),Object(e.a)(this,this.$Df,"onDataLossPolicyFailureCallback"))):this.rh.Mm(this.z5a("datalosspolicy"),1,null,null,!0,2,Object(e.a)(this,this.aEf,"onDataLossPolicySuccessCallback"),Object(e.a)(this,this.$Df,"onDataLossPolicyFailureCallback"),null);this.vkb++;b.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",
this.Cie,this.vkb)}tjj(){this.thd(this.q8,2,this.aqa)}thd(Yb,Sc=0,qd=null,Id=!1){E.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.Jhd(void 0,Sc));this.xyb=this.vw();const ic=this.m7c(Sc);this.mdc(Yb,ic,qd,Id,Sc);this.yOd(!0)}aEf(Yb){this.yPf();let Sc="";({data:Sc}=this.z0d(Yb)).returnValue&&(b.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.vkb=0,this.Ah&&(this.EXb=this.Ah.Kc("Task","Parse and Handle Get Policy Response")),this.p8i(Sc),
this.EXb&&(this.EXb.stop(),this.EXb=null))}$Df(Yb){this.yPf();this.vkb<=this.FWb?this.uhd():(b.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",Yb?Yb.data?Yb.data.HRa:null:null),this.vkb=0)}xof(){return 0<this.asa}setPolicyLabel(Yb){this.nm.AppliedPolicyId=Yb}DTd(Yb,Sc,qd=null){const Id=this.ihh(qd);this.DFj(Yb,Sc,Id,qd)}VKf(Yb){this.XFa&&(this.XFa.stop(),this.XFa=null);let Sc,qd;({a5f:Sc,B8f:qd}=this.q9e(Yb));const Id=Yb.data.state,ic=Id?
Id.cM:2;let Gc="";({data:Gc}=this.z0d(Yb)).returnValue?(b.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",ic),this.asa=0,this.J8i(Gc,Sc,qd,Id)):this.cQd(ic)}lgj(Yb){E.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.Jhd(Yb));this.CNb=this.vw();b.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");this.Za.raiseEvent("SetPolicyLabelTriggeredEventKey",new Z(Yb))}pQi(){this.Aic&&this.supportsOfficeClientCoauthoring&&
this.Yxi&&this.aw.lea(12,null,!0)}UKf(Yb){this.XFa&&(this.XFa.stop(),this.XFa=null);let Sc;({a5f:qd,B8f:Sc}=this.q9e(Yb));if(this.asa<=this.FWb)this.DTd(qd,Sc);else{var qd=(qd=Yb.data.state)?qd.cM:2;b.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",Yb?Yb.data?Yb.data.HRa:null:null,qd);this.bEb="WACServerConnectionFailed";this.asa=0;this.cQd(qd)}}Lxi(Yb){if(Yb&&("LabelNotSupported"===Yb||"LabelErrorRetryLater"===Yb||"CoherencyFailure"===
Yb||"LabelIdNotFound"===Yb||"LabelDisabled"===Yb))return b.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",Yb),!0;b.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",Yb);return!1}P4g(Yb){if(!Yb)return!1;let Sc=null,qd=null;for(const Id of this.nm.SensitivityLabels)Id.Id===Yb&&(Sc=Id),Id.Id===this.q8&&(qd=Id);if(!Sc)return!1;if(this.Aic&&this.supportsOfficeClientCoauthoring){if(this.FIc&&this.FIc()||this.Mrd)return!0}else if(x.AFrameworkApplication.$y&&x.AFrameworkApplication.$y.gxb||
this.aqa&&this.aqa())return!0;return Sc.IsEndpointProtectionEnabled===(!!qd&&qd.IsEndpointProtectionEnabled)}f0b(Yb,Sc,qd,Id,ic){28===Yb?this.bTf(new La(Yb,Sc,qd,Id,ic,!1)):this.bTf(new La(Yb,Sc,qd,Id,ic,!0))}Oda(Yb){28===Yb?this.HTf(new Da(Yb,!1)):this.HTf(new Da(Yb,!0))}ofj(Yb,Sc,qd){b.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.Za.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new Ea(Yb,Sc,qd))}rgj(Yb){b.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");
this.Za.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new Ea(null,null,Yb))}sgj(Yb,Sc){b.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.Za.raiseEvent("UpdateAutoCLPSITNodesEventKey",new Ea(Yb,Sc,null))}uTf(Yb,Sc){b.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===Sc?"Reading":"Edit")+" switch event.");this.Za.raiseEvent("MandatoryLabellingAppHandlerEventKey",new ta(Yb,Sc))}YXc(Yb,Sc,qd,Id,ic){37===Yb&&this.efj(new va(37,Sc,qd,Id,ic))}VMd(){this.egj(new ba)}qgj(){b.ULS.sendTraceTag(540608322,
306,50,"Raising a UDP labeling event.");this.Za.raiseEvent("UDPLabelingAppHandlerEventKey",new ja(!0))}uha(Yb=!1){const Sc=!!this.nm&&this.nm.AreLabelsAvailable&&!!this.nm.SensitivityLabels&&0<this.nm.SensitivityLabels.length&&Gb.a.any(this.nm.SensitivityLabels,qd=>!!qd&&qd.Enabled);Sc||Yb||oa.vRa(!1);return Sc}cGf(Yb){this.GEa&&(this.GEa.stop(),this.GEa=null);var Sc="";this.yOd(!1);({data:Sc}=this.z0d(Yb)).returnValue?(b.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),
this.tkb=0,Sc=this.y8i(Sc),Yb=this.Z7e(Yb.data),E.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.Acc(void 0,Yb,this.xyb)),this.xyb=null,Yb=new pa(Yb),this.Bfj(Yb),this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?Sc&&this.DJj()?this.Eqd?this.O3j():(this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)||this.rtb(),this.tKd(Yb),this.bOc=!0):Sc||this.kuc():!this.Eqd&&Sc&&this.fb.qa("WacApplyManualPolicyLabelIsEnabled")&&
this.Swe()?(this.tKd(Yb),this.bOc=!0):Sc||this.kuc()):this.kuc()}DJj(){if(!this.fb.qa("WacApplyManualPolicyLabelIsEnabled"))return b.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.Swe())return!1;if(""===this.q8)return b.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.CDa===this.mNc)return b.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),
!1;b.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0}rtb(){this.Dlg();b.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.VFa.count,this.CDa);const Yb=Nb.toArray(this.VFa);this.ofj(Yb,Yb,this.CDa)}O3j(){var Yb=this.VFa;this.Dlg();Nb.nDj(Yb,this.VFa)||(b.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.VFa.count),
Yb=Nb.toArray(this.VFa),this.sgj(Yb,Yb));this.Xce&&(b.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.CDa),this.rgj(this.CDa))}Dlg(){const Yb=new xa.a(h.a.li());for(const Sc of this.nm.SensitivityLabels)if(Sc&&Sc.AutoLabelingSensitiveTypeIds&&0<Sc.AutoLabelingSensitiveTypeIds.length)for(const qd of Sc.AutoLabelingSensitiveTypeIds)qd&&Yb.add(qd);this.VFa=Yb}bGf(Yb){const Sc=this.Z7e(Yb.data);E.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",
!1,!1,this.Acc(void 0,Sc,this.xyb));this.xyb=null;this.GEa&&(this.GEa.stop(),this.GEa=null);if(this.tkb<=this.FWb){if(this.fb.qa("SendHostAttributionInfoForPolicyLabelEnabled")){const qd=Yb.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in qd&&qd[Ja.a.VQd]&&"HostAttributionInfo.ScenarioTypeParamName"in qd&&qd[Ja.a.WQd]){Yb.data.request.get_headers();Yb.data.request.get_headers();Yb=this.m7c(Sc);this.mdc(this.q8,Yb,this.aqa,void 0,Sc);return}}this.thd(this.q8,Sc,this.aqa)}else b.ULS.sendTraceTag(34996494,
306,15,"Request to get label policy failed with error response: {0}.",Yb?Yb.data?Yb.data.HRa:null:null),this.kuc(),this.tkb=0,this.yOd(!1)}Z7e(Yb){return Yb.state?Yb.state:0}z5a(Yb,Sc=!1){let qd=String.format("{0}{1}?action={2}&{3}",this.fb.Wa("PolicyHandlerWebServiceBase")||x.AFrameworkApplication.sa.Qa.C_,this.Cie,Yb,x.AFrameworkApplication.xi);"setpolicylabel"===Yb&&x.AFrameworkApplication.$y&&x.AFrameworkApplication.$y.Gkf&&(qd=Eb.a.fl(qd,"sl","1"));Sc&&(qd=Eb.a.fl(qd,"cbd","1"));return qd}q9e(Yb){let Sc,
qd;Sc=qd=null;Yb&&Yb.data&&Yb.data.request&&Yb.data.request.get_headers()&&(Sc=Yb.data.request.get_headers()[Jb.a.b5f],qd=Yb.data.request.get_headers()[Jb.a.C8f]);return{a5f:Sc,B8f:qd}}z0d(Yb){Yb=Yb?Yb.data?Yb.data.me:null:null;return Yb&&Yb.length&&!this.Byi(Yb)?{returnValue:!0,data:Yb}:(b.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:Yb})}p8i(Yb){let Sc;try{Sc=eb.b(Yb)}catch(qd){b.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");
return}if(Sc)if(Sc.IsPolicyTipAvailable)switch(Sc.IsPolicyTipAvailable.toLowerCase()){case "false":b.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");break;case "true":b.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.NKc=Sc.NavigateUrl;this.ROj(Sc.GeneralText,Object(e.a)(this,this.sVi,"onDataLossPolicyOverrideButtonClick"));break;default:b.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",
Sc.IsPolicyTipAvailable)}else b.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else b.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")}vdh(Yb){switch(Yb){case "CoherencyFailure":return 1;case "DisabledByPolicy":return 2;case "FileCheckedOut":return 3;case "FileEncrypted":return 4;case "FileLocked":return 5;case "FileNotSupported":return 6;case "FileTooLarge":return 7;
case "InvalidOperationOnZeroByteFile":return 8;case "LabelDisabled":return 9;case "LabelErrorRetryLater":return 10;case "LabelIdNotFound":return 11;case "LabelIrmDisabledByTenant":return 12;case "LabelNotSupported":return 13;case "MinorVersionLimitExceeded":return 15;default:return 0}}J8i(Yb,Sc,qd,Id){var ic=Id?Id.cM:2;let Gc=0,jd="",ed;if(({ot:ed}=eb.d(Yb)).returnValue)if(ed){jd="Success";Yb=this.m7c(3);if(ed.IsSuccessful){E.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.Acc(ic,void 0,
this.CNb));this.bEb=this.CNb=null;b.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",ic);2===ic&&this.Oda(29);this.zGj(Sc,ic);this.pQi();this.Oda(28);Id&&4===ic&&this.f0b(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,Id.displayName),CommonUIStrings.l_DialogOk,()=>{});O.a("MipAppliedLabels",void 0,void 0,[Object.assign(new fa.a,{name:"SetPolicyLabelApplyFlag",
string:Ba[ic]})]);this.mdc(Sc,Yb,this.aqa,void 0,3);return}b.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",ic,ed.FailureReason);this.bEb=ed.FailureReason;this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ImproveSetLabelFailureErrMsg",!1)?Gc=this.vdh(ed.FailureReason):"FileTooLarge"===ed.FailureReason?Gc=7:"LabelNotSupported"===ed.FailureReason?Gc=13:"LabelDisabled"===
ed.FailureReason?Gc=9:"MinorVersionLimitExceeded"===ed.FailureReason&&(Gc=15);this.Fyi&&0<=ed.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Id=new la.a(2,1,this.EFj,()=>{b.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",this.asa);this.asa<=this.FWb&&this.DTd(Sc,qd)}),this.pe.ig(Id));this.Aic&&this.supportsOfficeClientCoauthoring&&this.mdc(this.nm.AppliedPolicyId,Yb,this.aqa,!0,3)}else jd="setPolicyLabelData null.",
b.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",ic);else jd="TryDeserialize failed.",b.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",ic);this.cQd(ic,Gc);ic=this.Acc(ic,void 0,this.CNb);this.CNb=null;ic.extendedProperties.set("SetPolicyLabelDataFailureReason",this.bEb);ic.extendedProperties.set("SetPolicyLabelDataParseStatus",jd.toString());E.Health.instance.recordKpiFailure("MipSetPolicyLabel",
"SetPolicyLabelFailure",!1,!1,ic)}cQd(Yb,Sc=0){const qd=2===Yb||8===Yb||16===Yb;this.setPolicyLabel(this.q8);this.sTf(new ib);this.FKd(Sc,Yb,qd,!1)}zGj(Yb,Sc){this.setPolicyLabel(this.q8=Yb);if(""===Yb)x.AFrameworkApplication.protectedFile=!1,x.AFrameworkApplication.enableMacrosForProtectedFile=!1;else for(const qd of this.nm.SensitivityLabels)if(qd.Id===Yb){x.AFrameworkApplication.protectedFile=qd.IsEndpointProtectionEnabled;break}this.kgj(new ya(Yb,Sc))}N5j(){for(const Yb of this.nm.SensitivityLabels)Yb&&
Yb.Enabled&&(Yb.Id===this.q8&&(this.Xce=this.CDa!==Yb.Order,this.CDa=Yb.Order),Yb.Order>this.mNc&&(this.mNc=Yb.Order))}y8i(Yb){if(!({ot:Yb}=eb.d(Yb)).returnValue)return b.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!Yb)return b.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!Yb.AreLabelsAvailable)return!1;this.nm=Yb;this.q8=Yb.AppliedPolicyId;this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",
!1)&&this.N5j();this.uha()&&b.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");this.sTf(new ib(!0));return!0}Swe(){if(!this.uha())return b.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(const Yb of this.nm.SensitivityLabels)if(Yb&&Yb.AutoLabelingSensitiveTypeIds&&0<Yb.AutoLabelingSensitiveTypeIds.length)return!0;b.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");
return!1}sTf(Yb){b.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.Za.raiseEvent("LabelInfoUpdateEvent",Yb)}Bfj(Yb){b.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.Za.raiseEvent("GetPolicyLabelEventKey",Yb)}kuc(){oa.vRa(!1);this.Za.raiseEvent("GetPolicyLabelFailureEventKey",new $a)}tKd(Yb){this.cP&&this.cP.execute(Sc=>{Sc=[Sc.isFeatureEnabled("MsoClpSpTwo",!0),Sc.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Sc).then(qd=>{Gb.a.any(qd,Id=>
Id)&&(b.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),this.Za.raiseEvent("GetAutoPolicyLabelEventKey",Yb),this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&this.rtb(),O.a("MipAutoClassificationEnabled"));return null})})}Jhd(Yb=null,Sc=null){const qd=new Map;qd.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=Yb&&qd.set("ApplyLabelFlags",Ba[Yb]);null!=Sc&&qd.set("GetPolicyLabelsReason",Za[Sc]);return qd}Acc(Yb=
null,Sc=null,qd=null){const Id=new ab.a;Id.extendedProperties=this.Jhd(Yb,Sc);null!=qd&&(Id.durationMs=this.vw()-qd);return Id}kgj(Yb){b.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.Za.raiseEvent("SetPolicyLabelEventKey",Yb)}bTf(Yb){b.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");Yb&&Yb.DCb&&O.a("MipRecommendations");this.Za.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",Yb)}HTf(Yb){b.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");
this.Za.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",Yb)}efj(Yb){b.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.Za.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",Yb)}egj(Yb){b.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.Za.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",Yb)}ROj(Yb,Sc=null){b.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");
this.Za.raiseEvent("PolicyTipEvent",new Ya(CommonUIStrings.l_PolicyBusinessBarTitle,Yb,CommonUIStrings.l_PolicyOverrideButton,Sc))}FKd(Yb,Sc,qd,Id=!0){b.ULS.sendTraceTag(42074656,306,Id?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Sc);Id=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;let ic=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,Gc=null,jd=null;switch(Yb){case 2:Id=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle;
ic=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage;break;case 5:ic=CommonUIStrings.l_SensitivityApplicationErrorFileLockedBusinessBarMessage;break;case 7:Id=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;ic=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 13:Id=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;ic=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;
break;case 9:Id=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;ic=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 10:ic=CommonUIStrings.l_SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage;break;case 14:Id=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;ic=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;break;case 15:Id=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,
ic=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,Gc=CommonUIStrings.l_LearnMore,jd=()=>{this.FFj()}}Yb=new V(Yb,Sc,qd,Id,ic,Gc,jd);this.Za.raiseEvent("SetPolicyLabelFailureEventKey",Yb)}PEj(Yb){this.mQc=Yb}sVi(){this.NKc?(b.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),Wb.a.TU(this.NKc)):b.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}Byi(Yb){if(!Yb.startsWith("<")||-1===Yb.indexOf("Error")&&
-1===Yb.indexOf("Unavailable"))return!1;b.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0}yPf(){this.DXb&&(this.DXb.stop(),this.DXb=null)}FRh(Yb){if(!Yb)return"manual";switch(Yb.cM){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}}RSh(Yb){if(!Yb)return"privileged";
Yb=Yb.cM;let Sc="privileged";if(4===Yb||1===Yb)Sc="standard";return Sc}mdc(Yb,Sc,qd=null,Id=!1,ic=0){this.fb.qa("WacLabelingGetPolicyLabelsIsEnabled")&&(this.q8=Yb,this.aqa=qd,this.Ah&&(this.GEa=this.Ah.Kc("WebServiceCall","Call Get Policy Endpoint On Server")),qd={},qd[Jb.a.wVg]=Yb,this.fb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(Yb=new Ab(this.z5a("getpolicylabels",Id),1,null,qd,!0,2,ic,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Sc),this.rh.send(Yb).$Ld(Object(e.a)(this,
this.cGf,"onGetPolicyLabelsSuccessCallback"),Object(e.a)(this,this.bGf,"onGetPolicyLabelsFailureCallback"))):this.rh.Mm(this.z5a("getpolicylabels",Id),1,null,qd,!0,2,Object(e.a)(this,this.cGf,"onGetPolicyLabelsSuccessCallback"),Object(e.a)(this,this.bGf,"onGetPolicyLabelsFailureCallback"),ic,void 0,void 0,void 0,void 0,"22"),this.tkb++,b.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this.tkb))}DFj(Yb,Sc,qd,Id=null){if(this.bBb){this.Ah&&(this.XFa=this.Ah.Kc("WebServiceCall",
"Call Set Policy Endpoint On Server"));var ic={};ic[Jb.a.b5f]=Yb;Sc&&(ic[Jb.a.C8f]=encodeURIComponent(Sc));this.mQc&&(ic[Jb.a.NUg]=this.mQc);Id?(ic[Jb.a.z8f]=this.FRh(Id),ic[Jb.a.A8f]=this.RSh(Id),this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",!1)&&1===Id.cM&&this.nm.DefaultLabelType&&(ic[Jb.a.CFj]=this.nm.DefaultLabelType)):(ic[Jb.a.z8f]="manual",ic[Jb.a.A8f]="privileged");this.supportsOfficeClientCoauthoring&&this.nm&&(ic[Jb.a.y$i]=this.nm.PolicyLabelVersionToken);
this.fb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(Yb=new Ab(this.z5a("setpolicylabel",!0),1,null,ic,!0,2,Id,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,qd),this.rh.send(Yb).$Ld(Object(e.a)(this,this.VKf,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,this.UKf,"onSetPolicyLabelFailureCallback"))):this.rh.Mm(this.z5a("setpolicylabel",!0),1,null,ic,!0,2,Object(e.a)(this,this.VKf,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,this.UKf,"onSetPolicyLabelFailureCallback"),
Id,void 0,void 0,void 0,void 0,"32");this.asa++;b.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.asa)}else b.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}FFj(){const Yb=new R.StandardDialog,Sc=this.fb.Wa("BreadcrumbFolderUrl");Sc?(Yb.Rb=11,Yb.wc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),Yb.wc(2,CommonUIStrings.l_DialogOk)):
(Yb.Rb=0,Yb.wc(1,CommonUIStrings.l_DialogOk));Yb.Iqe(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");Yb.Jmj();Yb.jS(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,qd=>{1===qd&&Sc&&Wb.a.nf(Sc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}m7c(Yb){switch(Yb){case 1:return Ja.a.uia(1,
1);case 2:return Ja.a.uia(7,1);case 3:return Ja.a.uia(8,1);default:return Ja.a.uia(7,0)}}ihh(Yb=null){if(!Yb)return Ja.a.uia(8,0);switch(Yb.cM){case 1:case 16:return Ja.a.uia(1,1);case 4:case 2:case 8:return Ja.a.uia(8,1);default:return Ja.a.uia(8,0)}}yOd(Yb){this.fb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",Yb)}}Object(c.a)(wb,"PolicyManager",null,[508]);var xb=a(142),rb=a(257);class za{constructor(){this.p1=
this.Kra=this.$a=this.Ig=null}get name(){return"Common.App.Policy"}init(){x.AFrameworkApplication.fa.qa("ShouldInitCommonPolicyPackage")&&(x.AFrameworkApplication.fa.qa("IsDataLossPreventionEnabledForUser")&&x.AFrameworkApplication.sa&&(this.Ig=this.$a.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.Ig.kte(Object(e.a)(this,this.wWd,"showPolicyBusinessBar")),b.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),xb.a.get_instance().Rj(6,()=>{this.Ig.uhd()})),x.AFrameworkApplication.fa.qa("WacLabelingPoliciesIsEnabled")&&
x.AFrameworkApplication.fa.qa("SupportsPolicies")?xb.a.get_instance().Rj(6,Object(e.a)(this,this.uSi,"onAfterRibbonBehaviorAttached")):oa.vRa(!1))}dispose(){}Kh(Yb){Yb.register(508,"Common.App.Policy.Contracts.IPolicyManager").tc().Bc(()=>new wb(x.AFrameworkApplication.fa,x.AFrameworkApplication.Hd,x.AFrameworkApplication.sa.SD,x.AFrameworkApplication.fa.Ad("MaxGetPolicyRetries",1),Yb.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),x.AFrameworkApplication.sa.Qa.ri));Yb.register(oa,
"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").tc().Bc(()=>new oa(x.AFrameworkApplication.rb,x.AFrameworkApplication.sa,x.AFrameworkApplication.fa,Yb.KPd("Common.App.Policy.Contracts.IPolicyManager")));this.$a=Yb}uSi(){this.p1=this.$a.og("CommonUI.BusinessBar");this.Ig||(this.Ig=this.$a.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.Kra=this.$a.resolve("Common.App.Policy.PolicyActor");x.AFrameworkApplication.fa&&x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",
!1)&&W.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.Ig.N0b(Object(e.a)(this.Kra,this.Kra.sWf,"registerActionsHandler")):this.Kra.Hg();this.Ig.N0b(Object(e.a)(this,this.N1d,"updateLabelInfo"));x.AFrameworkApplication.fa.qa("WacApplyManualPolicyLabelIsEnabled")&&(this.Ig.gZc(Object(e.a)(this,this.lei,"handleSetPolicyLabelFailure")),this.Ig.Rre(Object(e.a)(this,this.f0b,"addAutoPolicyBusinessBarEntry")),this.Ig.mte(Object(e.a)(this,
this.Oda,"removeAutoPolicyBusinessBarEntry")),this.Ig.Sre(Object(e.a)(this,this.YXc,"addMandatoryLabellingBusinessBarEntry")),this.Ig.nte(Object(e.a)(this,this.VMd,"removeMandatoryLabellingBusinessBarEntry")))}N1d(){this.Kra.u8f();this.Kra.Q7f();this.Kra.NSf();const Yb=this.Ig.l7g();x.AFrameworkApplication.fa.qa("HasDocumentEditRights")&&!Yb?this.Kra.Vig():b.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",
x.AFrameworkApplication.fa.qa("HasDocumentEditRights"),Yb);x.AFrameworkApplication.sa.updateCommandUI()}wWd(Yb,Sc){this.X7e(Sc.title,Sc.ftc,38,Sc.DCf,Sc.buttonText);b.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")}lei(Yb,Sc){Sc.Lbg&&(this.X7e(Sc.title,Sc.message,21,null,null,Sc.w$,Sc.buttonText),b.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))}Oda(){}f0b(Yb,
Sc){this.p1&&(this.Ig.Oda(Sc.prb),Yb=new f.a(Sc.title,Sc.message,null),Yb.id=Sc.prb,Yb.closeable=!0,Yb.image=3,Yb.addButton(Sc.buttonText,Sc.w$,Sc.buttonText,!0),this.p1.rE(Yb,!1))}YXc(Yb,Sc){this.p1&&(Yb=new f.a(Sc.title,Sc.message,null),Yb.id=Sc.prb,Yb.closeable=!1,Yb.image=3,Yb.addButton(Sc.buttonText,Sc.w$,Sc.buttonText,!1),this.p1.rE(Yb,!1))}VMd(){}X7e(Yb,Sc,qd,Id=null,ic=null,Gc=null,jd=null){Yb=new f.a(Yb,Sc,null);Yb.id=qd;Yb.closeable=!0;Id&&Yb.zMg(ic,Id);Gc&&Yb.addButton(jd,Gc,jd)}static main(){rb.a.instance.si(new za)}}
Object(c.a)(za,"PackageManager",null,[4,5]);var Aa=a(9),pb=a(558),kb=a(228),Cb=a(50),ob=a(38),qa=a(87),ma=a(39),Ga=a(379),vb=a(198),Ka=a(96),Pa=a(29),fb=a(255),Wa=a(1),Ma=a(22),lb=a(290);class Na{constructor(){this.etc=this.U5f=null;this.cM=0}}Object(c.a)(Na,"ApplyPolicyContextParameters",null,[]);var X=a(7),F=a(713),na=a(571),hb=a(49),Ib=a(45);class vc{constructor(){this.lHa=this.annotationType=null;this.KMa=this.Dw=!1}}Object(c.a)(vc,"AnnotationActivationOptions",null,[]);var nc=a(63);const Pb=
(Yb,Sc,qd,Id,ic,Gc,jd=null)=>{jd=Yb.Oa(1,jd);jd.tenantId=Sc;return nc.g(Yb,"GetPolicyLabelId",jd,qd,Id,ic,Gc,4)},oc=(Yb,Sc,qd,Id,ic,Gc,jd,ed,Qd,te,xe=null)=>{xe=Yb.Oa(41,xe);xe.labelsInfoJson=Sc;xe.appliedLabelId=qd;xe.tenantId=Id;xe.applyLabelFlag=ic;xe.skipApplyOutcomes=Gc;return nc.g(Yb,"ApplyPolicyLabel",xe,jd,ed,Qd,te,0)},Ic=(Yb,Sc,qd,Id,ic,Gc,jd=null)=>{jd=Yb.Oa(1,jd);jd.tenantId=Sc;return nc.g(Yb,"GetPolicyApplicationMethod",jd,qd,Id,ic,Gc,4)};var ec=a(741),mb=a(718);class Ob extends ec.a{constructor(){super();
this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new mb.a,{T_:Ob.getTypeName(),B_:Ob.Pd()})}static getTypeName(){return"AugLoop_SecurityClp_LabellingAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(Ob,"LabellingAnnotation",ec.a,[]);var Ta=a(735);class sb extends Ta.a{constructor(){super();this.fullDocSITs=this.partialDocSITs=null;this.H_=Object.assign(new mb.a,{T_:sb.getTypeName(),B_:sb.Pd()})}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static Pd(){return[]}}
Object(c.a)(sb,"SecurityShared",Ta.a,[]);class zb extends sb{constructor(){super();this.existingLabelPriority=null;this.H_=Object.assign(new mb.a,{T_:zb.getTypeName(),B_:zb.Pd()})}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static Pd(){return["AugLoop_SecurityShared_SecurityShared"]}}Object(c.a)(zb,"CLP",sb,[]);class db extends ec.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new mb.a,{T_:db.getTypeName(),B_:db.Pd()})}static getTypeName(){return"AugLoop_Automatic_Clp_LabellingAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}
Object(c.a)(db,"LabellingAnnotation",ec.a,[]);var jb=a(999),Ub=a(892),xd=a(1001);class ne extends ec.a{constructor(){super();this.classificationId=null;this.H_=Object.assign(new mb.a,{T_:ne.getTypeName(),B_:ne.Pd()})}static getTypeName(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(ne,"LinkedDataTypeAnnotation",ec.a,[]);class fe extends ma.a{constructor(Yb,Sc,qd,Id,ic){super();this.bxf=3;this.xA=this.augmentationLoopManager=null;
this.R_a=!1;this.Oab=[];this.Drf=new F.a(na.a.hK());this.jJd=0;this.oJd=null;this.rtb=(Gc,jd)=>{Gc=Object(X.a)(new jb.a,{parentPath:["session","doc","security"],items:[Object(X.a)(new Ub.a,{id:"clp",body:Object(X.a)(new zb,{existingLabelPriority:jd.existingLabelPriority,partialDocSITs:jd.AFe,fullDocSITs:jd.zFe})})]});this.Oab.push(Gc);this.BAb()};this.Blg=(Gc,jd)=>{Gc=Object(X.a)(new xd.a,{parentPath:["session","doc","security"],items:[Object(X.a)(new Ub.a,{id:"clp",body:Object(X.a)(new zb,{existingLabelPriority:jd.existingLabelPriority})})]});
this.Oab.push(Gc);this.BAb()};this.Clg=(Gc,jd)=>{Gc=Object(X.a)(new xd.a,{parentPath:["session","doc","security"],items:[Object(X.a)(new Ub.a,{id:"clp",body:Object(X.a)(new zb,{partialDocSITs:jd.AFe,fullDocSITs:jd.zFe})})]});this.Oab.push(Gc);this.BAb()};this.l6=()=>{b.ULS.sendTraceTag(537154588,306,50,`AutoPolicyManager::OnApplicationModeChanged - isEditMode:${this.$.isEditMode}.`);this.$.isEditMode?Wa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.BAb():
this.pgf():(this.businessBar.removeEntry(41),this.businessBar.removeEntry(40),this.Vmh())};this.Jpc=()=>{b.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");this.nNe();this.augmentationLoopManager=null};this.BCi=(Gc,jd)=>{var ed,Qd,te,xe,He;b.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===jd.operationType)b.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");
else{var We=Gc=null,ye=null;if(this.iic()){var $e=jd.VG;if(!$e){b.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(ed=$e.automatic)||void 0===ed?0:ed.id)Gc=$e.automatic.id;if(null===(Qd=$e.recommended)||void 0===Qd?0:Qd.id)We=$e.recommended.id,$e.recommended.policyTip&&(ye=$e.recommended.policyTip)}else{ed=jd.VG;if(!ed){b.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");
return}if(null===(te=null===($e=ed.automatic)||void 0===$e?void 0:$e.sensitivityLabel)||void 0===te?0:te.id)Gc=ed.automatic.sensitivityLabel.id;if(null===(He=null===(xe=ed.recommended)||void 0===xe?void 0:xe.sensitivityLabel)||void 0===He?0:He.id)We=ed.recommended.sensitivityLabel.id,ed.recommended.sensitivityLabel.policyTip&&(ye=ed.recommended.sensitivityLabel.policyTip)}this.applyPolicyLabel(Gc,We,ye,1)}};this.wEi=(Gc,jd)=>{b.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");
3===jd.operationType?b.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(Gc=jd.VG)?(Gc=Gc.classificationId,this.applyPolicyLabel(Gc,Gc,null,2)):b.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};this.vXf=(Gc,jd)=>{jd?jd.DCb&&this.businessBar.bH(41)?(this.businessBar.removeEntry(41),b.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):
!jd.DCb&&this.businessBar.bH(40)&&(this.businessBar.removeEntry(40),b.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):b.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.$ag=(Gc,jd)=>{jd?jd.DCb?(this.businessBar.ePj(jd.title,jd.message,jd.buttonText,ed=>{jd.w$(ed);this.businessBar.bH(41)&&this.businessBar.removeEntry(41)}),b.ULS.sendTraceTag(537154531,306,50,
"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(this.businessBar.WMj(jd.title,jd.message,jd.buttonText,ed=>{jd.w$(ed);this.businessBar.bH(40)&&this.businessBar.removeEntry(40)}),b.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.YHd=Yb;
this.policyManager=Sc;this.$=qd;this.fa=Id;this.businessBar=ic;this.pji();this.Ojj();this.disposed=!1}get Yb(){return!this.disposed&&this.$.ea.Yb}dispose(){this.disposed||(this.disposed=!0,this.Koh(),this.nNe(),this.YHd=this.policyManager=this.augmentationLoopManager=null,super.dispose())}x_a(Yb,Sc,qd,Id,ic=!1){b.ULS.sendTraceTag(537154642,306,50,`AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource ${Id} with AutoLabelPresent: ${!!Yb}, RecommendedLabelPresent: ${!!Sc}, isStandard: ${ic}.`);
this.Yb?this.YHd&&(this.Q4g(Sc,Id)?(this.oJd=Sc,this.jJd=Id,this.Drf.ia(Id,Sc)):Sc=this.oJd,Yb=this.YHd.x_a(Yb,Sc,qd,ic),b.ULS.sendTraceTag(537154640,306,50,`AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned ${Yb}.`)):b.ULS.sendTraceTag(537154641,306,15,`AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Yb}.`)}Q4g(Yb,Sc){if(!this.policyManager.uha())return b.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),
!1;const qd=this.policyManager.nm;let Id;({value:Id}=this.Drf.Ic(this.jJd));let ic=null,Gc=null,jd=null;for(const ed of qd.SensitivityLabels)ed.Id===Yb&&(ic=ed),ed.Id===Id&&(Gc=ed),ed.Id===this.oJd&&(jd=ed);return Gc&&Gc.Id===Yb?(b.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.bH(41)&&this.jJd!==Sc&&jd&&(!ic||jd.Order>=ic.Order)?(b.ULS.sendTraceTag(537154637,
306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0}iic(){return Wa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)}Pif(){return Wa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPSecurityNodeCreation",!1)}Ojj(){this.policyManager.Rre(this.$ag);this.policyManager.mte(this.vXf);this.$.ea.x2(this.l6);this.iic()&&this.Pif()&&
(this.policyManager.wPg(this.rtb),this.policyManager.oSg(this.Blg),this.policyManager.pSg(this.Clg))}Koh(){this.businessBar.removeEntry(41);this.businessBar.removeEntry(40);this.policyManager.znj(this.$ag);this.policyManager.Rpj(this.vXf);this.$.ea.Z6(this.l6);this.iic()&&this.Pif()&&(this.policyManager.hoj(this.rtb),this.policyManager.vqj(this.Blg),this.policyManager.wqj(this.Clg))}pji(){this.xA=new F.a(na.a.hK());const Yb=this.iic()?Ob.getTypeName():db.getTypeName();this.xA.add(1,Object(X.a)(new vc,
{annotationType:Yb,lHa:this.BCi,Dw:!1,KMa:!1}));this.xA.add(2,Object(X.a)(new vc,{annotationType:ne.getTypeName(),lHa:this.wEi,Dw:!1,KMa:!1}))}nfg(){for(let Yb of this.Oab)this.augmentationLoopManager.submitOperation(Yb);this.Oab=[]}Uuc(Yb){if(!this.xA.kb(Yb))return b.ULS.sendTraceTag(537154636,306,15,`AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource ${Yb}.`),!1;if(this.xA.ma(Yb).Dw)return b.ULS.sendTraceTag(537154635,306,15,`AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource ${Yb}.`),
!0;this.xA.ma(Yb).Dw=!0;b.ULS.sendTraceTag(537154634,306,50,`AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource ${Yb}.`);if(!this.$.isEditMode)return b.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;Wa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.BAb():this.pgf();return!0}pgf(){var Yb=!1;for(let Sc of this.xA)if(Yb=Sc.value.Dw||Yb)break;
Yb?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),this.D_b()):this.R_a?b.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):(this.R_a=!0,Yb=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154629,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in ${Yb} milliseconds.`),
hb.a.instance.create(()=>{this.rji()},Yb,Ib.a.vye,!0,!0)):b.ULS.sendTraceTag(537154632,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")}BAb(){var Yb=0<this.Oab.length;if(!Yb)for(let Sc of this.xA)if(Yb=Sc.value.Dw||Yb)break;Yb?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.D_b(),this.nfg()):this.R_a?b.ULS.sendTraceTag(537154626,
306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):(this.R_a=!0,Yb=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154625,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in ${Yb} milliseconds.`),hb.a.instance.create(()=>{this.sji()},Yb,Ib.a.vye,!0,!0)):b.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")}sji(){ob.TaskExtensions.za(Cb.GetServiceTaskFactory.Pa(this.$.da,
328,327,1),Yb=>{this.augmentationLoopManager=Yb.result;this.R_a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.fqe(this.Jpc),this.$.isEditMode?(this.D_b(),this.nfg()):b.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},
this.ka,3)}rji(){ob.TaskExtensions.za(Cb.GetServiceTaskFactory.Pa(this.$.da,328,327,1),Yb=>{this.augmentationLoopManager=Yb.result;this.R_a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.fqe(this.Jpc),this.$.isEditMode?this.D_b():b.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154593,
306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.ka,3)}nNe(){for(let Yb of this.xA)Yb.value.Dw&&this.Joh(Yb.key)}Joh(Yb){this.xA.ma(Yb).KMa&&this.mMe(Yb);this.xA.ma(Yb).Dw=!1;b.ULS.sendTraceTag(537154591,306,50,`AutoPolicyManager::DeregisterAnnotation completed for LabellingSource ${Yb}.`)}D_b(){for(let Yb of this.xA)Yb.value.Dw&&!Yb.value.KMa&&this.activateAnnotation(Yb.key)}activateAnnotation(Yb){this.augmentationLoopManager.mZa(this.xA.ma(Yb).annotationType);
this.augmentationLoopManager.s2(this.xA.ma(Yb).annotationType,this.xA.ma(Yb).lHa);this.xA.ma(Yb).KMa=!0;b.ULS.sendTraceTag(537154590,306,50,`AutoPolicyManager::ActivateAnnotation completed for LabellingSource ${Yb}.`)}Vmh(){for(let Yb of this.xA)Yb.value.KMa&&this.mMe(Yb.key)}mMe(Yb){this.augmentationLoopManager.zna(this.xA.ma(Yb).annotationType,this.xA.ma(Yb).lHa);this.xA.ma(Yb).KMa=!1;b.ULS.sendTraceTag(537154589,306,50,`AutoPolicyManager::DeactivateAnnotation completed for LabellingSource ${Yb}.`)}applyPolicyLabel(Yb,
Sc,qd,Id){if(this.fa.qa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.x_a(Yb,Sc,qd,Id);else{b.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");const ic=Gc=>{this.x_a(Yb,Sc,qd,Id,0===Gc||1===Gc||4===Gc)};this.Jjd(ic,()=>{ic(2)},this.bxf)}}h0c(Yb,Sc){let qd=null,Id=null;if(!({sensitivityLabel:qd,oHa:Id}=this.Ljg(Yb)).returnValue)return b.ULS.sendTraceTag(537154577,
306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Id&&Id.Order>=qd.Order)return b.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(qd.Id,qd.Id,null,Sc);return!0}i0c(Yb,Sc){Sc=!1;let qd=null,Id=null;if(!({sensitivityLabel:qd,oHa:Id}=this.Ljg(Yb)).returnValue)return b.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),
{returnValue:!1,F7a:Sc};if(Id&&Id.ParentId&&qd.ParentId&&Id.ParentId===qd.ParentId)return b.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,F7a:Sc};if(Id&&Id.Order>=qd.Order)return b.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,F7a:Sc};if(this.fa.qa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154572,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),Yb=this.policyManager.nm,Yb=!Yb.AppliedPolicyId||!Yb.PolicyLabelAssignmentMethod||U.e(Yb.PolicyLabelAssignmentMethod)===U.e("standard"),this.Kwe(qd.Id,Yb);else{b.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");const ic=Gc=>{this.Kwe(qd.Id,0===Gc||1===Gc||4===Gc)};this.Jjd(ic,()=>{ic(2)},this.bxf)}return{returnValue:!0,
F7a:Sc}}Jjd(Yb,Sc,qd,Id=0){if(this.Yb){var ic=this.$.pa.va.$b();Ic(this.$.pa.va,this.$.ya.DocumentHostInfo.TenantId,Gc=>{this.W3h(Gc,Yb)},()=>{this.V3h(Yb,Sc,qd,Id)},null,null,ic)}else b.ULS.sendTraceTag(537154570,306,15,`AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Yb}.`)}W3h(Yb,Sc){b.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.Yb?!Yb||fb.a(Yb)?
b.ULS.sendTraceTag(537154567,306,15,Yb?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Sc(Yb.Result):b.ULS.sendTraceTag(537154568,306,50,`AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Yb}.`)}V3h(Yb,Sc,qd,Id){b.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");
this.Yb?Id>=qd?(b.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Sc()):this.Jjd(Yb,Sc,qd,Id+1):b.ULS.sendTraceTag(537154565,306,50,`AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Yb}.`)}Kwe(Yb,Sc){Sc?this.x_a(Yb,null,null,3,!0):this.x_a(null,Yb,null,3,!1)}Ljg(Yb){let Sc,qd;qd=Sc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Sc,oHa:qd};
if(!this.policyManager.uha())return b.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Sc,oHa:qd};const Id=this.policyManager.nm;if(!Id)return b.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),{returnValue:!1,sensitivityLabel:Sc,oHa:qd};if(Gb.a.ah(Id.SensitivityLabels))return b.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),
{returnValue:!1,sensitivityLabel:Sc,oHa:qd};const ic=Id.AppliedPolicyId;for(const Gc of Yb)for(const jd of Id.SensitivityLabels)jd.Id===Gc&&(!Sc||Sc.Order<jd.Order)&&(Sc=jd),jd.Id===ic&&(qd=jd);return Sc?{returnValue:!0,sensitivityLabel:Sc,oHa:qd}:(b.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:Sc,oHa:qd})}}Object(c.a)(fe,"AutoPolicyManager",ma.a,[3]);var Bd=a(164),Ue=a(12),mc=a(14);class Fc extends Bd.ErrorDialog{constructor(Yb){super(Yb,
Fc.DQ(Yb))}fq(){super.fq();if(this.error.Appearance&1&&this.$.Bd&2){const Yb=this.getButton(0);Ue.DOMElementExtensions.QSd(Yb.get_element(),mc.a.instance.ga(1315));this.YL(()=>{0===this.returnValue&&this.$.Bd&2&&(b.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),ob.TaskExtensions.za(Cb.GetServiceTaskFactory.Pa(this.$.da,55,56,0),Sc=>{Sc.result.V5c()},this.$.ka,3))})}}static DQ(Yb){return Yb.Bd&2?Pa.a.hd(3,1,0,1975,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):
Pa.a.hd(1,1,0,1976,0,-313914360,"SensitivityLabelBlockApplyLabel")}}Object(c.a)(Fc,"BlockSenitivityLabelActionDialog",Bd.ErrorDialog,[]);var bd=a(33),de=a(89);class Md extends ma.a{constructor(Yb,Sc,qd,Id,ic){super();this.statusBarManager=null;this.g1c=!1;this.r$=null;this.HFc=!1;this.Nya=this.eSd=null;this.Vn=this.ZHd=!1;this.bFa=this.vhe=this.$fa=this.Eie=this.Dp=null;this.mRe=()=>{b.ULS.sendTraceTag(537154520,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");
const Gc=this.wWf(1);b.ULS.sendTraceTag(537154519,306,50,`PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: ${Gc}.`)};this.wWd=(Gc,jd)=>{jd?(this.Dp=jd.title,this.Eie=jd.ftc,this.$fa=jd.buttonText,this.vhe=jd.DCf,this.x$.sh(27,null),b.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};this.mcg=(Gc,jd)=>{const ed=
Object(qa.a)(V,jd);ed?ed.Lbg?(b.ULS.sendTraceTag(537154508,306,15,`ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of ${ed.errorType}`),this.x$.lPj(ed.title,ed.message,ed.buttonText,Qd=>{ed.w$&&(this.x$.bH(54)&&this.x$.removeEntry(54),ed.w$(Qd))})):b.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(b.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),
this.x$.sh(48,null))};this.N1d=(Gc,jd)=>{this.L6&&(b.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.L6.u8f(),this.L6.Q7f(),this.L6.NSf(),this.$.Bd&64&&(jd.onSuccess&&this.Nya?this.IVg():this.L6.Vig()));this.fa.qa("SupportsOfficeClientCoauthoring")&&(Gc=this.vs.nm,this.bFa=Gc.AppliedPolicyId,"null"===this.labelId&&(this.bFa=""),this.HFc&&(Gc=Gc.PolicyLabelAssignmentMethod&&U.e(Gc.PolicyLabelAssignmentMethod)===U.e("standard")?4:2,this.applyPolicyLabel(this.labelId,
Gc,!0,this.eSd)));this.TXe();this.Az()};this.aGf=()=>{this.ZHd=!0;this.TXe()};this.TKf=(Gc,jd)=>{b.ULS.sendTraceTag(42322116,306,50,`PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = ${x.AFrameworkApplication.protectedFile}, ApplyLabelFlag = ${jd.cM}`);this.applyPolicyLabel(jd.etc,jd.cM,!1,null)};this.FSi=(Gc,jd)=>{this.bFa=jd.etc;if(Pa.a.wq(Gc.Errors)){var ed=Pa.a.W3(Gc.Errors,[2045508683]);0<ed.length&&(Gc.Errors=Pa.a.Oz(Gc.Errors,[2045508683],
"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.$n(Gc.Errors));ed=Pa.a.W3(Gc.Errors,[2046680228]);0<ed.length&&(4===jd.cM||1===jd.cM)&&(Gc.Errors=Pa.a.Oz(Gc.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.$n(Gc.Errors));ed=Gc=null;for(var Qd of this.vs.nm.SensitivityLabels)Ma.a.equals(this.labelId,Qd.Id,!1)&&(Gc=Qd),Ma.a.equals(jd.U5f,Qd.Id,!1)&&(ed=Qd);Qd={};Qd.ApplyLabelFlag=jd.cM;Gc?(Qd.currentLabel="Set",Qd.currentLabelEnabled=
Gc.Enabled,Qd.currentLabelName=Gc.Name?"Set":"NotSet",Qd.currentLabelParentId=Gc.ParentId?"Set":"NotSet"):Qd.currentLabel="NotSet";ed?(Qd.serverLabel="Set",Qd.serverLabelEnabled=ed.Enabled,Qd.serverLabelName=ed.Name?"Set":"NotSet",Qd.serverLabelParentId=ed.ParentId?"Set":"NotSet"):Qd.serverLabel="NotSet";b.ULS.sendTraceTag(541638850,306,15,`PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : ${JSON.stringify(Qd)}`)}};this.GZg=(Gc,jd)=>{if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;
const ed=this.vs.nm;if(!ed)return b.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;let Qd=null;for(const te of ed.SensitivityLabels)Ma.a.equals(te.Id,Gc,!1)&&(Qd=te);return Qd&&this.Yfi(Qd)?(b.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.ZMj(jd),!0):!1};this.qpi=()=>{let Gc=!1;!this.$.ya.IsNewWorkbook||this.labelId&&this.labelId.length||(Gc=
!0);b.ULS.sendTraceTag(537154501,306,50,`PolicyManagerWrapper.IsANewFile: is this a new file : ${Gc}`);return Gc};this.Swf=(Gc,jd)=>{1===jd.vve?this.$.isEditMode?(b.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ia.Hb(new Ka.a(-723527778,0,this.$.xc,10,null))):b.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.Nya=jd.Nya,this.$.ea.x2(this.Fwe),this.$.bhb(),b.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),
this.$.Ia.Hb(new Ka.a(-8805455,0,this.$.xc,10,null)))};this.Oqe=(Gc,jd)=>{jd?(Gc=!!(this.$.Bd&64),b.ULS.sendTraceTag(537154496,306,50,`AddMandatoryLabellingBusinessBar User has edit permission : ${Gc}`),Gc&&(this.$.bhb(),this.x$.vOj(jd.title,jd.message,jd.buttonText,ed=>{jd.w$(ed)}))):b.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};this.SXf=()=>{this.x$.bH(42)&&this.x$.removeEntry(42)};this.lkg=(Gc,jd)=>{jd.YKj&&
(b.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),ob.TaskExtensions.za(Cb.GetServiceTaskFactory.Pa(this.$.da,55,56,0),ed=>{ed.result.V5c()},this.$.ka,3))};this.Fwe=()=>{this.Nya&&this.$.isEditMode?(this.$.ea.Z6(this.Fwe),this.Hxb()):b.ULS.sendTraceTag(537154467,306,15,`ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty ${!this.Nya} , edit mode : ${this.$.isEditMode}.`)};this.Hka=()=>{const Gc=
this.$.ea.Tm;Gc&&!Ma.a.equals(Gc.AppliedPolicyLabelId,this.labelId,!1)&&(b.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),b.ULS.shipAssertTag(537154463,306,this.$.isEditMode,"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.fa.qa("SupportsOfficeClientCoauthoring")&&this.$.isEditMode&&
(this.HFc=!0,this.eSd=Gc.AppliedPolicyLabelId),this.bFa=Gc.AppliedPolicyLabelId,this.Hxb())};this.Mrd=()=>{let Gc=!0;if(!this.$.ea.amIAlone)for(const jd of this.$.ea.Do)if(!jd.SupportsClientIsMipTrusted){Gc=!1;break}b.ULS.sendTraceTag(537154462,306,50,`PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : ${Gc}`);return Gc};this.jHf=()=>{b.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.HFc=!0;this.Hxb()};this.$=Id;this.vs=Yb;this.x$=
qd;this.fa=ic;this.vs.kte(this.wWd);this.L6=Sc}initialize(){this.fa.qa("SupportsPolicies")?(this.bFa=this.fa.Wa("AppliedPolicyId"),this.L6.Hg(),this.$.da.hb(29,Yb=>{this.statusBarManager=Yb;Yb.rJ(this)}),this.Az(),Ma.a.ah(this.fa.Wa("HostUserId"))||this.z$i(),this.L6.Qjj(this.GZg),this.L6.Hkj(this.qpi),this.vs.Mjj(this.Mrd),this.Vn=Wa.EwaSettings.isChangeGateEnabled("OfficeVSO:7568646_PressEnterToPaste")):Wa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",
!1)&&W.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!Ma.a.ah(this.fa.Wa("HostUserId"))&&Wa.EwaSettings.xa(158)&&this.$.ea.Dg.get(45)&&(b.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.IXh())}vq(Yb){this.addHandler("LabelInfoChangedKey",Yb)}Wq(Yb){this.removeHandler("LabelInfoChangedKey",Yb)}yn(){return!0}$r(Yb,Sc){if("QueryPolicyLabel"!==Yb)return!1;if(this.zoa())return Sc.Visible=!1,!0;!Ma.a.ah(Sc.LabelText)&&
bd.a.xn()&&window.setTimeout(()=>{appChrome.api.dispatch(appChrome.actions.setControlCustomTooltip(de.a.N4b,Sc.Alt))},0);Sc.Visible=!0;return 32===x.AFrameworkApplication.rb.$d(L.a.gcb,2,Sc)}dispose(){this.statusBarManager&&(this.statusBarManager.SF(this),this.statusBarManager=null);this.L6.MQb();this.g1c=!1;this.vs.hqj(this.mcg);this.vs.iqj(this.TKf);this.$.ea.Lv(this.Hka);if(this.fa.qa("SupportsOfficeClientCoauthoring")){const Yb=this.$.da.Ba(292);Yb&&Yb.Zoj(this.jHf)}this.vs.Bnj(this.Oqe);this.vs.Spj(this.SXf);
this.vs.ipj(this.Swf);this.vs.tqj(this.lkg);Wa.EwaSettings.xa(259)&&this.vs.Doj(this.mRe);this.r$&&(this.r$.dispose(),this.r$=null);super.dispose()}get title(){return this.Dp}get ftc(){return this.Eie}get linkText(){return this.$fa}get J_i(){return this.vhe}get labelId(){return this.bFa}h0c(Yb,Sc){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),!1;if(!this.ZHd)return b.ULS.sendTraceTag(537154522,
306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(Gb.a.ah(Yb))return!1;this.r$||this.apd();return this.r$.h0c(Yb,Sc)}Az(){this.raiseEvent("LabelInfoChangedKey")}IXh(){xb.a.get_instance().Rj(10,()=>{this.vs.uhd()})}z$i(){xb.a.get_instance().Rj(10,()=>{this.vs.N0b(this.N1d);this.vs.aQg(this.aGf);this.vs.$Pg(this.aGf);this.vs.gZc(this.mcg);this.vs.xte(this.TKf);this.$.ea.ju(this.Hka);this.vs.Sre(this.Oqe);this.vs.nte(this.SXf);this.vs.KQg(this.Swf);this.vs.lSg(this.lkg);
if(this.fa.qa("SupportsOfficeClientCoauthoring")){const Yb=this.$.da.Ba(292);Yb&&Yb.AQg(this.jHf)}Wa.EwaSettings.xa(259)&&(b.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),this.vs.YPg(this.mRe));this.kJh()});this.$.GTd("sensitivity",!0)}kJh(){this.fa.qa("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.Hxb():this.KSh(this.$.ya.DocumentHostInfo.TenantId)}apd(){this.r$=new fe(this.L6,this.vs,
this.$,this.fa,this.x$)}wWf(Yb){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1;this.r$||this.apd();return this.r$.Uuc(Yb)}i0c(Yb,Sc){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,F7a:!1};if(!this.ZHd)return b.ULS.sendTraceTag(537154516,306,15,
"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,F7a:!0};this.r$||this.apd();return this.r$.i0c(Yb,Sc)}KSh(Yb){b.ULS.sendTraceTag(537154514,306,50,`PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length ${Yb.length}`);const Sc=this.$.pa.va.$b();Pb(this.$.pa.va,Yb,qd=>{this.zUj(qd)},null,null,null,Sc)}zUj(Yb){b.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");
Yb&&!fb.a(Yb)&&(this.bFa=Yb.Result);this.Hxb();this.labelId?b.ULS.sendTraceTag(537154512,306,50,`PolicyManagerWrapper: Fetched LabelId length from custom.xml is ${this.labelId.length}`):b.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")}Hxb(){this.vs.thd(this.labelId,void 0,void 0,!1)}TXe(){if(!this.g1c){this.$.tf();this.g1c=!0;this.x$.bcf();const Yb={};Yb.hasLabel=!!this.labelId&&0<this.labelId.length;Yb.isProtectedFile=this.fa.qa("ProtectedFile");Yb.SupportsPolicies=
this.fa.qa("SupportsPolicies");Yb.AreLabelsAvailableForDisplay=this.vs.uha();Yb.SupportsOfficeClientCoauthoring=this.fa.qa("SupportsOfficeClientCoauthoring");Yb.IsAnonymousUser=this.fa.qa("IsAnonymousUser");b.ULS.sendTraceTag(51238051,306,50,`CLPUsage : ${JSON.stringify(Yb)}`)}}IVg(){this.L6.JVg(this.Nya);this.Nya=null}Yfi(Yb){for(const Sc of Yb.LabelActions)if(Ma.a.equals(Sc.Name,"ApplyWatermark",!1))return!0;return!1}ZMj(Yb){Yb?(new Fc(this.$)).fg():b.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")}applyPolicyLabel(Yb,
Sc,qd,Id){const ic=eb.c(this.vs.nm);if(void 0===Yb||null===Yb)Yb="";const Gc=new Na;Gc.etc=Yb;Gc.U5f=Id;Gc.cM=Sc;const jd=this.$.pa.va;Ga.a(this.$.userOperationManager,(ed,Qd,te)=>oc(jd,ic,Yb,this.$.ya.DocumentHostInfo.TenantId,Sc,qd,lb.b.call(null,this.FSi,ed),null,te,Gc),ed=>new vb.a(222,0,ed),null);this.HFc=!1;this.eSd=null}zoa(){const Yb=this.$.da.Ba(478);return this.Vn&&Yb?Yb.Vn():!1}}Object(c.a)(Md,"PolicyManagerWrapper",ma.a,[368,213,526]);var se=a(70),tc=a(108),dd=a(153),Hd=a(54);class Xc extends kb.a{constructor(Yb){super();
this.$=Yb;this.Gb()}create(){const Yb=Object(se.b)("OfficeVSO:7624544_ConvertBusinessBarManagerService")?Object(tc.c)(dd.a.resolve(Hd.e,{Wb:this.Na})):Cb.GetServiceTaskFactory.Pa(this.$.da,5,4,this.Na),Sc=x.AFrameworkApplication.Hd,qd=x.AFrameworkApplication.fa;ob.TaskExtensions.za(Yb,()=>{try{const Id=new pb.a(()=>new wb(qd,Sc,x.AFrameworkApplication.sa.SD,this.$.ya.MaxGetPolicyRetries,T.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))),ic=new pb.a(()=>new oa(x.AFrameworkApplication.rb,
x.AFrameworkApplication.sa,x.AFrameworkApplication.fa,Id));let Gc=this.$.da.Ba(274);Gc||(Gc=new Md(Id.value,ic.value,Yb.result,this.$,x.AFrameworkApplication.fa),this.$.da.Ha(274,Gc),Gc.initialize());this.qb(Gc)}catch(Id){throw b.ULS.sendTraceTag(537154525,306,10,`PolicyManager was not created successfully [Exception: ${Id.toString()}]`),Id;}},this.ka,3)}static la(Yb){Yb.da.Ha(275,new Xc(Yb))}}Object(c.a)(Xc,"PolicyManagerFactory",kb.a,[]);var gd=a(714),je=a(196);class Ee{constructor(Yb){this.$=Yb}Mc(){return!1}executeCommand(Yb,
Sc,qd){switch(Sc.command){case L.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(qd[H.a_c]=this.$.workbookContext.ExclusiveLockId),Yb=x.AFrameworkApplication.rb.$d(L.a.setSensitivity,2,qd),wa.Task.Ta(32===Yb);case L.a.Q6:return Yb=x.AFrameworkApplication.rb.$d(L.a.Q6,2,qd),wa.Task.Ta(32===Yb);case L.a.R6:return Yb=x.AFrameworkApplication.rb.$d(L.a.R6,2,qd),wa.Task.Ta(32===Yb);default:return je.a(Sc.command)}}Ac(Yb,Sc){switch(Sc.command){case L.a.setSensitivity:case L.a.Q6:case L.a.R6:return!0;
default:return!1}}Rc(Yb,Sc,qd){switch(Sc){case "PopulateSensitivityFlyout":return 32===x.AFrameworkApplication.rb.$d(L.a.$za,2,qd);default:return!1}}}Object(c.a)(Ee,"SensitivityCommandHandler",null,[222]);class ae extends gd.a{constructor(Yb){super(Yb)}ld(){this.fd([new Ee(this.$)])}static la(Yb){gd.a.Rd(316,new ae(Yb))}}Object(c.a)(ae,"SensitivityCommandHandlerFactory",gd.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.Policy.Contracts");Type.registerNamespace("Common.App.Policy");
za.main();(()=>{Aa.a.Fa(Yb=>{Xc.la(Yb);ae.la(Yb)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.policy.js.map/8484e0d0fc5ea5e09d13b28e2038ee65/EwaDSEsNext.policy.js.map