'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[15],{1012:function(r,B,a){a.d(B,"a",function(){return c});r=a(0);class c{}c.DEi="literal";c.operator="operator";c.func="function";c.namedRange="namedRange";c.range="range";c.psf="letName";c.all="*";c.zYd="structRefRange";Object(r.a)(c,"TraverseFormulaInterestTypes",null,[])},1013:function(r,B,a){a.d(B,"a",function(){return c});r=a(0);class c{}c.cell="cell";c.range="range";c.row="row";c.column="col";Object(r.a)(c,
"TraverseFormulaRefTypes",null,[])},1192:function(r,B,a){r={};a.r(r);a.d(r,"CalcManager",function(){return ib});var c=a(0),b=a(15),e=a(228),f=a(155),d=a(8),h=a(115);a(179);var l=a(197),k=a(87),w=a(187),n=a(108),x=a(71);class m{}m.local="Local";m.WWj="Thread";Object(c.a)(m,"RecalcServiceCreateMode",null,[]);var u=a(182);class t{constructor(V){this.b8d=null;this.init(V)}get O$(){return this.b8d}init(V){this.b8d=new w.a;if(void 0!==V&&null!==V&&void 0!==V.HeadersList&&null!==V.HeadersList&&0<V.HeadersList.length)for(const Z of V.HeadersList)this.O$.ia(Z.Index,
Z.Name)}}Object(c.a)(t,"ColHeadersListData",null,[]);var y=a(1),v=a(33),A=a(104),z=a(22),C=a(21),H=a(184);class I{constructor(V,Z){this.aBe=V;this.sheetName=Z;this.Hyc=!1}}Object(c.a)(I,"CalcBlockInformation",null,[]);class S{constructor(V,Z,ja,la,ua){this.type=V;this.fullName=Z;this.range=ja;this.sheetId=la;this.attributes=ua;this.KE=null}}Object(c.a)(S,"CalcNamedObject",null,[]);class P{get sk(){return this.Ble}constructor(V){this.iog=V;this.Ble=[];this.vlg=[];this.F0a={};this.JUd=new Map}T8f(V,
Z){this.Ble[V]=Z;this.iog&&Z.x7&&this.JUd.set(Z.x7.sheetName,V)}getSheetIndex(V){if(this.iog){if(this.JUd.has(V))return this.JUd.get(V)}else for(let Z=1;Z<this.sk.length;Z++)if(z.a.equals(this.sk[Z].x7.sheetName,V,!1))return Z;return-1}}Object(c.a)(P,"GridCache",null,[]);var D=a(702),G=a(559);class E{constructor(V){this.x7=V;this.d6=new D.a(G.a.li());this.Ooc=!1}}Object(c.a)(E,"SheetInformation",null,[]);var O=a(961),N;(function(V){V[V.initialization=0]="initialization";V[V.contentReady=1]="contentReady";
V[V.cellEdit=2]="cellEdit"})(N||(N={}));Object(c.b)("UpdateDataTrigger",N);class J{constructor(V){this.sLd=null;this.Lxd=this.rLd=this.FFd=!1;this.lJd=0;this.dJd=this.fJd=this.gJd=this.eJd=-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.aq=this.errorTypeNames=null;this.Ft=this.currentStateId=-1;this.bua="";this.oaa=null;this.getNameLoc=(Z,ja)=>this.Tjc()?this.jf.ma(this.currentStateId).sk[0].d6.kb(ja)?(Z=excelOnlineCalc.location.nameLoc(Z,ja),excelOnlineCalc.util.success(Z)):
excelOnlineCalc.util.success(null):(Z=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Z));this.getContainingTable=Z=>{if(!this.Tjc())return Z=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Z);const ja=Z.range.col,la=Z.range.row;var ua=this.jf.ma(this.currentStateId).sk[0].d6,eb=null;for(let Eb of ua)if(ua=Eb.value,2===ua.type&&z.a.equals(Z.sheet.index.toString(),ua.sheetId,!0)){const Wb=ua.range;ja>=Wb.left-1&&ja<=Wb.right-1&&la<=Wb.bottom-1&&la>=Wb.top-1&&(eb=
excelOnlineCalc.location.nameScope(this.documentLoc,ua.sheetId),eb=excelOnlineCalc.location.nameLoc(eb,ua.fullName))}return eb?excelOnlineCalc.util.success(eb):excelOnlineCalc.util.success(null)};this.getStructRefColumn=(Z,ja)=>{if(!this.Tjc()){var la=excelOnlineCalc.util.unavailable([2]);return excelOnlineCalc.util.failure(la)}la=Z.name;var ua=this.jf.ma(this.currentStateId).sk[0].d6;if(ua.kb(la)){ua=ua.ma(la);const Eb=ua.range;if(2!==ua.type)return excelOnlineCalc.util.failure(this.r7c(5));const Wb=
ua.KE?ua.KE.O$:null;if(!Wb)return excelOnlineCalc.util.success(null);for(var eb of Wb)if(z.a.equals(eb.value,ja,!0))return Z=excelOnlineCalc.location.documentLoc(Z.scope.document.path,Z.scope.document.name),Z=excelOnlineCalc.location.sheetIndex(Z,ua.sheetId),eb=excelOnlineCalc.location.gridRange(Eb.top-1,eb.key,Eb.bottom-Eb.top+1,1),eb=excelOnlineCalc.location.sheetGridRange(Z,eb),la=excelOnlineCalc.location.structRefColumnLoc(la,eb,!!(ua.attributes&16),!!(ua.attributes&8)),excelOnlineCalc.util.success(la);
return Eb.right-Eb.left+1!==Wb.count?(la=excelOnlineCalc.util.unavailable([17,Z,ja]),excelOnlineCalc.util.failure(la)):excelOnlineCalc.util.failure(this.r7c(0))}return excelOnlineCalc.util.success(null)};this.getStructRefSpecialRef=(Z,ja)=>{if(!this.Tjc())return ja=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ja);var la=this.jf.ma(this.currentStateId).sk[0].d6;if(la.kb(Z.name)){var ua=la.ma(Z.name);if(2!==ua.type)return excelOnlineCalc.util.failure(this.r7c(5));la=!!(ua.attributes&
16);const eb=!!(ua.attributes&8),Eb=la?1:0,Wb=eb?1:0;Z=excelOnlineCalc.location.documentLoc(Z.scope.document.path,Z.scope.document.name);Z=excelOnlineCalc.location.sheetIndex(Z,ua.sheetId);ua=ua.range;let Ab={};if(1===ja)Ab=excelOnlineCalc.location.gridRange(ua.top-Eb-1,ua.left-1,ua.bottom+Wb-ua.top+Eb+1,ua.right-ua.left+1);else if(2===ja)Ab=excelOnlineCalc.location.gridRange(ua.top-1,ua.left-1,ua.bottom-ua.top+1,ua.right-ua.left+1);else if(3===ja)if(la)Ab=excelOnlineCalc.location.gridRange(ua.top-
2,ua.left-1,1,ua.right-ua.left+1);else return excelOnlineCalc.util.success(null);else if(4===ja)if(eb)Ab=excelOnlineCalc.location.gridRange(ua.bottom,ua.left-1,1,ua.right-ua.left+1);else return excelOnlineCalc.util.success(null);ja=excelOnlineCalc.location.sheetGridRange(Z,Ab);return excelOnlineCalc.util.success(ja)}return excelOnlineCalc.util.success(null)};this.getDocumentLoc=(Z,ja)=>{if((z.a.equals(Z,this.documentLoc.path,!0)||!Z)&&z.a.equals(ja,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);
Z=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(Z,ja)]);return excelOnlineCalc.util.failure(Z)};this.getSheetIndex=(Z,ja)=>{if(!this.jf.kb(this.currentStateId)||!this.jf.ma(this.currentStateId).sk)return ja=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ja);Z=this.jf.ma(this.currentStateId).sk;for(let la=1;la<Z.length;la++)if(z.a.equals(Z[la].x7.sheetName,ja,!0))return excelOnlineCalc.util.success(Z[la].x7.sheetId);return excelOnlineCalc.util.success(null)};
this.getSheetName=(Z,ja)=>{if(!this.jf.kb(this.currentStateId)||!this.jf.ma(this.currentStateId).sk)return ja=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ja);Z=this.jf.ma(this.currentStateId).sk;for(let la=1;la<Z.length;la++)if(z.a.equals(Z[la].x7.sheetId,ja,!0))return excelOnlineCalc.util.success(Z[la].x7.sheetName);return excelOnlineCalc.util.success(null)};this.getUserDefinedFuncLoc=()=>excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"]);
this.getSheetRangeIndexes=()=>excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"]);this.xIf=()=>{this.setNumberFormats()};this.od=()=>{b.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");this.jf=new w.a;this.currentStateId=this.Ft=-1;this.bua="";this.n2a=null;this.rLd=!1;this.aq&&this.clearCache()};this.Uc=V;this.jf=new w.a;this.n2a=null;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.Uc.workbookContext.FullDocumentInfo.BreadcrumbDocName);
this.ppa();this.isd=v.a.isd();this.r5=y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SetCellEstimationPrefetch",!1)}dispose(){this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.HNd(this.xIf);this.Uc&&this.Uc.em(this.od);this.close()}UQb(V){if(!this.aq)return!1;if(!this.instantaneousSupportInformationManager&&(this.instantaneousSupportInformationManager=this.Uc.da.Ba(268),!this.instantaneousSupportInformationManager))return b.ULS.sendTraceTag(537170198,
0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),!1;2!==V&&(this.currentStateId=this.Uc.ea.dEb,this.currentStateId===d.a.re&&(this.currentStateId=this.Uc.ea.se));if(1===V&&this.currentStateId<this.Ft)return b.ULS.sendTraceTag(537170197,0,50,`CalcAsyncEngine::UpdateData() currentStateId:${this.currentStateId} < lastUpdatedStateId:${this.Ft} - ignoring update`),!1;this.TCj();0!==V&&this.rLd||(this.vHj(),this.vEj(),this.jFj(),this.setNumberFormats(),this.instantaneousSupportInformationManager.Wse(this.xIf),
this.Uc.hl(this.od),this.rLd=!0);this.rij();let Z=!1;0===V&&(Z=this.Ali());if(0!==V||Z)this.EGj()?(this.iHj(V),this.hHj(),this.Ft=this.currentStateId,this.X7g()):b.ULS.sendTraceTag(537170196,0,15,`CalcAsyncEngine::UpdateData() for StateId:${this.currentStateId} failed - no Sheets information`);2!==V&&this.resumeRecalc();return!0}evalFormula(V,Z,ja,la){if(!this.aq)return b.ULS.sendTraceTag(537170195,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});Z=excelOnlineCalc.calc.sheetCellLocation(null!==
ja&&void 0!==ja?ja:x.d(this.Uc.ua.na),Z.top-1,Z.left-1);V=this.aq.evalFormula(this.Uc.ea.se,V,Z,la);this.resumeRecalc();return V}D3g(V,Z,ja,la=null){const ua=x.d(this.Uc.ua.na);let eb=V.cell.SQ-1,Eb=V.cell.RQ-1;var Wb=eb,Ab=Eb;let Jb=null;la&&(Jb=excelOnlineCalc.calc.cellLocation(eb,Eb),eb=la.top-1,Eb=la.left-1,Wb=la.bottom-1,Ab=la.right-1);ja=this.X2d(V,ja,"SetCell");0>ja||(Ab=J.kaa("CalculateFormula.cell",ua,eb,Eb,Wb,Ab),Wb=[],la=this.mld(ua),Z=excelOnlineCalc.calc.inferredRangeFormulaEdit(Ab,Z,
Jb,la),Wb.push(Z),V=(Z=this.aaf())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ua,eb,Eb,z.a.$ue(V.cell.text),ja,Z.top-1,Z.left-1,Z.bottom-1,Z.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ua,eb,Eb,z.a.$ue(V.cell.text),ja,"","","",""),b.ULS.sendTraceTag(537170180,0,50,V),this.aq.editRangeFormulas(ja,Wb),this.resumeRecalc())}B3a(V,
Z,ja,la,ua){if(!this.aq)return b.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),Promise.reject("RecalcService is null");if(!ja||!Z)return b.ULS.sendTraceTag(524120779,0,15,`CalcAsyncEngine::EvalFormulaRangeOnClone inputs are null. originCell null: ${!ja}, outputColumnRange null: ${!Z}`),Promise.reject("CalcAsyncEngine::EvalFormulaRangeOnClone: null inputs");b.ULS.shipAssertTag(537170178,0,ja.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");
const eb=x.d(this.Uc.ua.na),Eb=this.mld(eb);let Wb=null;if(V){Wb=[];for(const Gb of V)if(Gb.column!==ja.left){V=Gb.row-1;var Ab=Gb.column-1;V=J.kaa("EvalFormulaRangeOnClone.cell",eb,V,Ab,V,Ab);Ab=y.EwaSettings.isChangeGateEnabled("OfficeVSO:7459428_TypedValueInCloneWrite")?W(Gb.Nr,Gb.formulaBarText,Gb.Ci):excelOnlineCalc.calc.valueCellData(Gb.text,Gb.text,Gb.Ci,null);Wb.push(excelOnlineCalc.calc.rangeWrite(V,Ab))}}ja=excelOnlineCalc.calc.cellLocation(ja.top-1,ja.left-1);Z=J.kaa("EvalFormulaRangeOnClone.outputColumnRange",
eb,Z.top-1,Z.left-1,Z.bottom-1,Z.right-1);let Jb;ua?this.r5&&(la=[excelOnlineCalc.calc.inferredRangeFormulaEdit(Z,la,ja,Eb)],Jb=this.aq.evalOnClonedModel(Wb,la,ua)):(ua=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(Z,la,ja,Eb)],Jb=this.aq.evalOnClonedModel(Wb,ua));this.resumeRecalc();return Jb}lLe(V){let Z=null;try{if(V)if(this.bua=C.h(this.Uc).Ca.Fva(V),this.currentStateId=V.WTa,this.currentStateId<this.Ft||this.currentStateId===d.a.re)b.ULS.sendTraceTag(537170176,0,50,`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:${this.bua} blockRevision:${this.currentStateId} < lastUpdatedStateId:${this.Ft}`);
else{if(this.Gli(),!this.FZg())if(Z=this.Uc.Mb.Kc("ModelUpdate",`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:${this.bua} StateId:${this.currentStateId}`),this.n2a=this.I5a(V.na.sheetName),!this.n2a){const eb=!!(this.Uc.Bd&32),Eb=this.jf.kb(this.currentStateId)&&this.jf.ma(this.currentStateId).sk?this.jf.ma(this.currentStateId).sk.length:0;b.ULS.sendTraceTag(537170147,0,15,`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets ${Eb}, scratchPad:${eb}, sheetNameLength:${V.na.sheetName?
V.na.sheetName.length:-1} Hash:${V.na.hash}`)}else if(C.h(this.Uc).Ca.fm.S2a(V.gd)){var ja=V.wf;if(ja){var la=ja.getCalcBlockModel();if(!la)b.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.xZg(la)){this.jf.ma(this.currentStateId).F0a[this.bua]=new I(la,V.na.sheetName);var ua=V.ae;ua?this.MMg(ua.NamedObjects):b.ULS.sendTraceTag(537170144,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else b.ULS.sendTraceTag(537170146,
0,15,`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:${this.bua}`)}}else b.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{Z&&Z.stop()}}Gec(V){var Z;if(!this.jf.kb(this.currentStateId))return b.ULS.sendTraceTag(509646790,0,15,`CalcAsyncEngine.getTableHeaders: stateId ${this.currentStateId} not found in gridCache`),null;const ja=null===(Z=this.jf.ma(this.currentStateId))||void 0===Z?void 0:Z.sk;
if(!ja||!ja[0])return null;Z=ja[0].d6;if(!Z||!Z.kb(V.name))return b.ULS.sendTraceTag(509646789,0,15,`CalcAsyncEngine.getTableHeaders: table key found wasn't found in cached named objects list. cached named objects is null: ${null==Z}`),null;V=Z.ma(V.name);if(!V||!V.KE)return null;Z=new l.a;for(let la of V.KE.O$)Z.add(la.value);return Z}E3g(V,Z,ja){var la=C.h(this.Uc),ua=la.Jb(Z);ua=this.X2d(ua,null,"CopyPaste");ja=this.X2d(la.Jb(V),ja,"CopyPaste");if(0>ua||0>ja||ua!==ja)b.ULS.sendTraceTag(537170143,
0,15,`CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:${ja}, targetRevision:${ua}.`);else{ja=[];la=x.d(this.Uc.ua.na);var eb=this.mld(la);V=J.kaa("CalculateFormulaForCopyPaste.srcRange",la,V.top-1,V.left-1,V.bottom-1,V.right-1);Z=J.kaa("CalculateFormulaForCopyPaste.targetRange",la,Z.top-1,Z.left-1,Z.bottom-1,Z.right-1);Z=excelOnlineCalc.calc.copyPasteRangePasteEdit(Z,V,eb);ja.push(Z);Z=eb?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",
la,ua,eb.row,eb.column,eb.lastRow,eb.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",la,ua,"","","","");b.ULS.sendTraceTag(537170142,0,50,Z);this.aq.editRangePaste(ua,ja);this.resumeRecalc()}}mld(V){const Z=this.aaf();let ja=null;Z?ja=J.kaa("GetViewport.viewport",V,Z.top-1,Z.left-1,Z.bottom-1,Z.right-1):b.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");
return ja}aaf(){const V=C.h(this.Uc);let Z=V.pi;if(C.h(this.Uc).jb.oj){Z=V.Vf(1).pi;if(y.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&!Z)return b.ULS.sendTraceTag(537170140,0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;Z.nea(1,1);Z.nea(3,1)}return Z}X2d(V,Z,ja){let la;if(!this.aq||!V)return b.ULS.sendTraceTag(537170139,0,15,`CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:${!this.aq}, modifiedCell is null:${!V}, operation:${ja}`),
-1;const ua=V.cell.SQ-1,eb=V.cell.RQ-1;if(V.cell.zv){if(la=V.cell.zv.Y2b,la===d.a.re)return b.ULS.sendTraceTag(537170138,0,15,`CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:${V.cell.zv.gd}, operation:${ja}`),-1}else return b.ULS.sendTraceTag(537170137,0,15,`CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:(${V.cell.SQ},${V.cell.RQ}), operation:${ja}`),-1;if(la<this.Ft)return b.ULS.sendTraceTag(537170136,0,50,`CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:(${ua},${eb}) - blockRevision:${la} < lastUpdatedStateId:${this.Ft}, operation:${ja}`),
-1;if(la<this.currentStateId)return b.ULS.sendTraceTag(537170135,0,50,`CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:(${ua},${eb}) - blockRevision:${la} < currentStateId:${this.currentStateId}, operation:${ja}`),-1;Z&&!this.FFd&&(this.aq.setOnRecalcResults(Z),this.FFd=!0);return this.j3j()&&!this.UQb(2)?(b.ULS.sendTraceTag(537170134,0,15,`CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:${ja}`),-1):la}getFormulaBarText(V,Z,ja){return Z&&Z.startsWith("'")?
Z:V.cell.formulaBarText||ja.toString()}tjh(V,Z,ja){let la=null;y.EwaSettings.isChangeGateEnabled("OfficeVSO:7616924_fixSheetIdSentToCalcts")&&(this.n2a=this.I5a(ja));if(this.NBe()&&this.jf.ma(this.Ft).F0a){const Wb=this.jf.ma(this.Ft).F0a[V];if(null===Wb||void 0===Wb?0:Wb.Hyc)la=Wb.aBe}ja=this.uqi(la,Z,ja);const {mRi:ua,numberOfNonEmptyCells:eb,kRi:Eb}=this.pah(la,Z,ja);b.ULS.sendTraceTag(50671754,0,50,`CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:${V} StateId:${this.currentStateId} number of formulas ${ua}, number of non-empty cells ${eb}, number of cells ${Eb}`)}uqi(V,
Z,ja){let la=!1;const ua=J.P2e(Z);if(V){const eb=J.P2e(V);z.a.equals(eb,ua,!1)&&(la=!0)}la?this.nNg(V,this.Ft,ja):this.pNg(Z,ja);return la}NBe(){let V=!1;this.aq&&-1!==this.Ft&&(V=this.aq.stateIdAvailable(this.Ft));return V&&this.jf.kb(this.Ft)&&this.Ft<this.currentStateId}pah(V,Z,ja){let la=0,ua=0,eb=0,Eb,Wb;for(Z.reset();Eb=Z.getNextCell();)eb++,(Eb.value||Eb.formula)&&ua++,H.f(Eb.formula)&&la++,(Wb=ja?V.getCell(Eb.row,Eb.col):null)?this.lah(Z,Eb,Wb):this.oNg(Z,Eb);if(ja)for(V.reset();Wb=V.getNextCell();)(Eb=
Z.getCell(Wb.row,Wb.col))||this.fre(V,Wb);return{mRi:la,numberOfNonEmptyCells:ua,kRi:eb}}jFj(){this.aq.setOnUpdateRequest(()=>{})}iFj(){this.aq.setOnUnresponsive((V,Z,ja,la)=>{this.g5i(V,Z,ja,la)})}g5i(V,Z,ja,la){b.ULS.sendTraceTag(537170126,0,15,`CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:${V}, waitTime:${Z}, timeoutCount:${ja}, hasBeenClosed:${la}.`);la&&(this.Itj(),this.ppa())}Itj(){this.od(null,null);this.Lxd=this.FFd=!1;this.lJd=0;this.dJd=this.fJd=this.gJd=this.eJd=
-1}close(){this.aq.close()}clearCache(){this.aq.clearCache()}resumeRecalc(){this.aq.resumeRecalc()}vEj(){this.aq.setA1ReferenceStyle(!0)}rij(){if(this.instantaneousSupportInformationManager){var V=this.instantaneousSupportInformationManager.Gni;const ja=this.instantaneousSupportInformationManager.Jni,la=this.instantaneousSupportInformationManager.Ini,ua=this.instantaneousSupportInformationManager.Hni;var Z=!1;V!==this.eJd&&(Z=!0,this.eJd=V);ja!==this.gJd&&(Z=!0,this.gJd=ja);la!==this.fJd&&(Z=!0,this.fJd=
la);ua!==this.dJd&&(Z=!0,this.dJd=ua);const eb=[];y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",!1)&&(Z=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),eb.push(Z),Z=!0);y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",!1)&&(Z=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),eb.push(Z),Z=!0);y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(Z=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",
null),eb.push(Z),Z=!0);Z&&(V=excelOnlineCalc.calc.recalcServiceConfig(null,V,null,ja,null,null,null,la,eb,ua),this.aq.reconfigure(V))}}iHj(V){let Z=null;if(this.jf.kb(this.currentStateId))try{this.oaa=[],Z=this.Uc.Mb.Kc("ModelUpdate",`CalcAsyncEngine::SetUpdatedRanges() StateId:${this.currentStateId} UpdateTriggerData:${N[V]}`),h.a.forEach(this.jf.ma(this.currentStateId).F0a,(ja,la)=>{la.Hyc||(this.tjh(ja,la.aBe,la.sheetName),la.Hyc=!0)},null),this.aq.updateRanges(this.currentStateId,this.oaa)}finally{Z&&
Z.stop()}else b.ULS.sendTraceTag(537170122,0,15,`CalcAsyncEngine::SetUpdatedRanges StateId:${this.currentStateId} does not exist in GridCache`)}hHj(){const V=[],Z=this.NBe();var ja=Z&&this.jf.ma(this.Ft).sk&&this.jf.ma(this.Ft).sk[0]&&this.jf.ma(this.Ft).sk[0].Ooc?this.jf.ma(this.Ft).sk[0].d6:null;this.PGe(ja,this.jf.ma(this.currentStateId).sk[0].d6,null,this.Ft,V);this.jf.ma(this.currentStateId).sk[0].Ooc=!0;for(let la=1;la<this.jf.ma(this.currentStateId).sk.length;la++)ja=-1,Z&&this.jf.ma(this.Ft).sk&&
(ja=this.tkd(this.jf.ma(this.currentStateId).sk[la].x7.sheetName,this.Ft)),ja=-1!==ja&&this.jf.ma(this.Ft).sk[ja].Ooc?this.jf.ma(this.Ft).sk[ja].d6:null,this.PGe(ja,this.jf.ma(this.currentStateId).sk[la].d6,this.jf.ma(this.currentStateId).sk[la].x7.sheetId,this.Ft,V),this.jf.ma(this.currentStateId).sk[la].Ooc=!0;this.aq.updateNamedObjects(this.currentStateId,V)}PGe(V,Z,ja,la,ua){if(void 0!==ja&&null!==ja){var eb=excelOnlineCalc.calc.undefinedNamesWrite(ja);ua.push(eb)}if(V){var Eb=!1;eb=[];var Wb=
[];if(Z)for(let Jb of Z){const Gb=Jb.value;if(V.kb(Jb.key)){var Ab=V.ma(Jb.key);J.HPi(Ab,Gb)?Eb=!0:(Ab=excelOnlineCalc.calc.namedObject(Jb.key,null),eb.push(Ab),J.ZXc(Jb.key,Gb,Wb))}else J.ZXc(Jb.key,Gb,Wb)}for(let Jb of V)Z&&Z.kb(Jb.key)||(V=excelOnlineCalc.calc.namedObject(Jb.key,null),eb.push(V));Eb&&(Z=excelOnlineCalc.calc.namedObjectsPromote(ja,la),ua.push(Z));0<eb.length&&(Z=excelOnlineCalc.calc.namedObjectsWrite(ja,eb),ua.push(Z));0<Wb.length&&(ja=excelOnlineCalc.calc.namedObjectsWrite(ja,
Wb),ua.push(ja))}else if(Z){la=[];for(Wb of Z)J.ZXc(Wb.key,Wb.value,la);0<la.length&&(ja=excelOnlineCalc.calc.namedObjectsWrite(ja,la),ua.push(ja))}}FZg(){return this.jf.ma(this.currentStateId).F0a[this.bua]?(b.ULS.sendTraceTag(537170121,0,50,`CalcAsyncEngine::BlockPreviouslyHandled Block Hash:${this.bua} StateId:${this.currentStateId} previously handled`),!0):!1}xZg(V){return 1===V.getColumnNumbers().length&&V.getColumnNumbers()[0]===J.nAd+1?!1:!0}Ali(){let V=!1;C.h(this.Uc).Ca.Gwb(Z=>{Z.state&1&&
this.Uc.ea.se===Z.he.Revision&&(this.lLe(Z),V=!0)});return V}eJe(V,Z){var ja=V.getRowNumbers(),la=V.getColumnNumbers();V=ja[0]-1;ja=ja[ja.length-1]-1;const ua=la[0]-1;la=la[la.length-1]-1;Z=this.I5a(Z);if(!Z){const eb=this.jf.kb(this.currentStateId)&&this.jf.ma(this.currentStateId).sk?this.jf.ma(this.currentStateId).sk.length:0;b.ULS.sendTraceTag(537170120,0,15,`CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets ${eb}`)}return J.kaa("CreateBlockRangeLocation",
Z,V,ua,ja,la)}nNg(V,Z,ja){if(ja=this.eJe(V,ja)){var la=J.W6b(V.getRowNumbers());V=J.W6b(V.getColumnNumbers());Z=excelOnlineCalc.calc.rangePromote(ja,Z,la,V);this.oaa[this.oaa.length]=Z}}pNg(V,Z){if(Z=this.eJe(V,Z)){var ja=J.W6b(V.getRowNumbers());V=J.W6b(V.getColumnNumbers());V=excelOnlineCalc.calc.rangeWrite(Z,null,ja,V);this.oaa[this.oaa.length]=V}}lah(V,Z,ja){let la=null,ua=0,eb=0;switch(Z.valueType){case 2:la=this.jld(Z);var Eb=this.jld(ja);Eb=z.a.equals(Eb,la,!1);break;case 1:null===Z.value&&
null===ja.value?Eb=!0:(ua=parseFloat(Z.value),Eb=parseFloat(ja.value)===ua);break;default:null===Z.value&&null===ja.value?Eb=!0:(eb=parseFloat(Z.value),Eb=eb===parseFloat(ja.value))}Eb&&Z.valueType===ja.valueType&&Z.ifmt===ja.ifmt&&Z.formulaType===ja.formulaType&&z.a.equals(ja.formula,Z.formula,!1)||(void 0!==Z.formula&&null!==Z.formula||void 0!==Z.value&&null!==Z.value||void 0!==Z.text&&null!==Z.text||0!==Z.valueType?this.s0b(V,Z,la,ua,eb):this.fre(V,Z))}MMg(V){if(this.Uc.Bb&&this.Uc.Bb.items)for(let eb=
0;eb<this.Uc.Bb.count;eb++){var Z=this.Uc.Bb.items[eb];if(2!==Z.type&&3!==Z.type)continue;var ja=0,la=Z.name,ua=la.lastIndexOf("!");if(0<ua){ja=la.substr(0,ua);"'"===ja.charAt(0)&&(ja=ja.substr(1,ja.length-2));ja=this.tkd(ja,this.currentStateId);if(-1===ja){Z=this.jf.kb(this.currentStateId)&&this.jf.ma(this.currentStateId).sk?this.jf.ma(this.currentStateId).sk.length:0;b.ULS.sendTraceTag(595096334,0,50,`CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets ${Z}`);
continue}la=la.substr(ua+1)}ja=this.jf.ma(this.currentStateId).sk[ja].d6;let Eb=Z.usedRange;2===Z.type&&(Eb=u.a(Z));if(ja.kb(la)){if(ua=ja.ma(la),ua.range=Eb,ua.attributes=Z.attributes,2===ua.type&&(la=J.LZe(Z.name,V),Z=(ja=y.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc"))?Z.zO:null===la||void 0===la?void 0:la.ColHeadersList,la||ja))if(!ua.KE)ua.KE=new t(Z);else if(Z)for(const Wb of Z.HeadersList)ua.KE.O$.ia(Wb.Index,Wb.Name)}else if(ua=this.I5a(Z.sheetName)){ua=
new S(Z.type,Z.name,Eb,ua,Z.attributes);if(2===ua.type)if(y.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc")&&Z.zO)ua.KE=new t(Z.zO);else if(Z=J.LZe(Z.name,V))ua.KE=new t(Z.ColHeadersList);ja.ia(la,ua)}else Z=this.jf.kb(this.currentStateId)&&this.jf.ma(this.currentStateId).sk?this.jf.ma(this.currentStateId).sk.length:0,b.ULS.sendTraceTag(537170117,0,50,`CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets ${Z}`)}}s0b(V,Z,ja,la,ua){var eb=
V.getRowNumbers()[Z.row]-1;V=V.getColumnNumbers()[Z.col]-1;eb=J.kaa("AddRangeUpdateCommand",this.n2a,eb,V,eb,V);V=null;let Eb=Z.formula||Z.text;const Wb=excelOnlineCalc.calc.blankValue;let Ab=null;void 0!==Z.text&&null!==Z.text||void 0!==Z.value&&null!==Z.value||(ja="",Ab="This cell contains blanks only",0===Z.formulaType&&(Eb=""));switch(Z.valueType){case 2:null!==ja&&(0===Z.formulaType&&(V=excelOnlineCalc.calc.valueCellData(Eb,ja,Z.ifmt,Ab)),1===Z.formulaType&&(V=excelOnlineCalc.calc.cellFormulaCellData(Eb,
ja,Z.ifmt,Ab)),2===Z.formulaType&&(V=excelOnlineCalc.calc.valueCellData("",Wb,0,"This cell is a part of an array")));break;case 1:isNaN(la)?b.ULS.sendTraceTag(537170116,0,50,`CalcAsyncEngine::AddRangeUpdateCommand Cell(${Z.row},${Z.col}) invalid numeric value`):(0===Z.formulaType&&(V=excelOnlineCalc.calc.valueCellData(Eb,la,Z.ifmt,null)),1===Z.formulaType&&(V=excelOnlineCalc.calc.cellFormulaCellData(Eb,la,Z.ifmt,null)),2===Z.formulaType&&(V=excelOnlineCalc.calc.valueCellData("",Wb,0,"This cell is a part of an array")));
break;case 3:isNaN(ua)?b.ULS.sendTraceTag(537170115,0,15,`CalcAsyncEngine::AddRangeUpdateCommand Cell(${Z.row},${Z.col}) invalid boolean value`):(ja=1===ua?!0:!1,0===Z.formulaType&&(V=excelOnlineCalc.calc.valueCellData(Eb,ja,Z.ifmt,null)),1===Z.formulaType&&(V=excelOnlineCalc.calc.cellFormulaCellData(Eb,ja,Z.ifmt,null)),2===Z.formulaType&&(V=excelOnlineCalc.calc.valueCellData("",Wb,0,"This cell is a part of an array")));break;case 4:isNaN(ua)?b.ULS.sendTraceTag(537170114,0,15,`CalcAsyncEngine::AddRangeUpdateCommand Cell(${Z.row},${Z.col}) invalid error value`):
(ja=excelOnlineCalc.calc.errorValue(ua),0===Z.formulaType&&(V=excelOnlineCalc.calc.valueCellData(Eb,ja,Z.ifmt,null)),1===Z.formulaType&&(V=excelOnlineCalc.calc.cellFormulaCellData(Eb,ja,Z.ifmt,null)),2===Z.formulaType&&(V=excelOnlineCalc.calc.valueCellData("",Wb,0,"This cell is a part of an array")));break;default:V=excelOnlineCalc.calc.valueCellData("",Wb,Z.ifmt,null)}V&&(Z=excelOnlineCalc.calc.rangeWrite(eb,V,null,null),this.oaa[this.oaa.length]=Z)}oNg(V,Z){switch(Z.valueType){case 2:this.s0b(V,
Z,this.jld(Z),null,0);break;case 1:this.s0b(V,Z,null,parseFloat(Z.value),0);break;default:this.s0b(V,Z,null,null,parseFloat(Z.value))}}fre(V,Z){var ja=V.getRowNumbers()[Z.row]-1;V=V.getColumnNumbers()[Z.col]-1;ja=J.kaa("AddRangeUpdateCommandEmptyCell",this.n2a,ja,V,ja,V);Z=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,Z.ifmt,null);Z=excelOnlineCalc.calc.rangeWrite(ja,Z,null,null);this.oaa[this.oaa.length]=Z}I5a(V){V=this.tkd(V,this.currentStateId);return 0<V?this.jf.ma(this.currentStateId).sk[V].x7.sheetId:
null}tkd(V,Z){if(!this.jf.kb(Z))return b.ULS.sendTraceTag(537170113,0,15,`CalcAsyncEngine.GetSheetInternalIndex StateId:${Z} does not exist in GridCache`),-1;const ja=this.jf.ma(Z);return ja.sk?ja.getSheetIndex(V):(b.ULS.sendTraceTag(537170112,0,15,`CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:${Z}`),-1)}EGj(){if(!this.jf.kb(this.currentStateId)||!this.jf.ma(this.currentStateId).sk.length)return b.ULS.sendTraceTag(537170083,0,15,`CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:${this.currentStateId} or StateId does not exist in GridCache`),
!1;const V=[];for(let Z=1;Z<this.jf.ma(this.currentStateId).sk.length;Z++){const ja=this.jf.ma(this.currentStateId).sk[Z];ja&&V.push(ja.x7)}this.aq.updateSheetNames(this.currentStateId,V);this.aq.updateUnusedCells(this.currentStateId,this.jf.ma(this.currentStateId).vlg);return!0}setNumberFormats(){if(this.instantaneousSupportInformationManager){var V=[];for(const Z of this.instantaneousSupportInformationManager.hza){const ja=excelOnlineCalc.calc.numberFormat(Z.IfmtIndex,Z.FormatString,Z.Builtin);
V.push(ja)}this.aq.setNumberFormats(V,!0)}}TCj(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Re){var V=this.Eli();if(!this.Lxd||V)this.V6b(),this.instantaneousSupportInformationManager.Re.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.Re.TrueValueString),this.instantaneousSupportInformationManager.Re.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.Re.FalseValueString),V=O.CalcHelper.bKe(this.instantaneousSupportInformationManager,
V),this.aq.setLocale(V),this.Lxd=!0}}vHj(){var V=null;if(void 0!==this.Uc.workbookContext.TimeZoneInformation&&null!==this.Uc.workbookContext.TimeZoneInformation){V=null;this.Uc.workbookContext.TimeZoneInformation.StandardDate.Month&&(V=excelOnlineCalc.date.dateTime(this.Uc.workbookContext.TimeZoneInformation.StandardDate.Year,this.Uc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Uc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Uc.workbookContext.TimeZoneInformation.StandardDate.Hour,
this.Uc.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Uc.workbookContext.TimeZoneInformation.StandardDate.Second,this.Uc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Uc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));let Z=null;this.Uc.workbookContext.TimeZoneInformation.DaylightDate.Month&&(Z=excelOnlineCalc.date.dateTime(this.Uc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Uc.workbookContext.TimeZoneInformation.DaylightDate.Month,
this.Uc.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Uc.workbookContext.TimeZoneInformation.DaylightDate.Hour,this.Uc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Uc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Uc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Uc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,3));V=excelOnlineCalc.date.tzData(this.Uc.workbookContext.TimeZoneInformation.Bias,V,this.Uc.workbookContext.TimeZoneInformation.StandardBias,
Z,this.Uc.workbookContext.TimeZoneInformation.DaylightBias)}else b.ULS.sendTraceTag(537170082,0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");V=excelOnlineCalc.calc.workbookProps(this.Uc.workbookContext.F1904,this.Uc.workbookContext.FDateCompatibility,V);this.aq.setWorkbookProps(V)}ppa(){const V=y.EwaSettings.xa(570)?m.local:m.WWj,[Z,ja]=v.a.aR(this.Uc)?[excelOnlineCalc.x10.PluginSchedulerSingleton.instance(),excelOnlineCalc.x10.GridImportManagerSingleton.instance()]:[void 0,
void 0];this.sLd=n.c(excelOnlineCalc.calc.createRecalcService(V,Z,ja));this.sLd.continueWith(la=>{la.exception?b.ULS.sendTraceTag(537170075,0,50,`CalcAsyncEngine.TryInitialize: Calc web worker failed: ${la.exception.toString()}`):(b.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),(this.aq=this.sLd.result)?this.UQb(0)?this.iFj():b.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):b.ULS.sendTraceTag(537170076,
0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})}Eli(){const V=this.instantaneousSupportInformationManager.Rja;if(!V||this.lJd===V.length)return null;this.lJd=V.length;return O.CalcHelper.MJe(V)}V6b(){this.errorTypeNames=O.CalcHelper.V6b()}Gli(){if(!(this.jf.kb(this.currentStateId)&&0<this.jf.ma(this.currentStateId).sk.length)){this.jf.ia(this.currentStateId,new P(this.isd));this.jf.ma(this.currentStateId).T8f(0,new E(null));var V=this.Uc.ua;for(let la=0;la<V.count;la++){var Z=
Object(k.a)(A.a,V.getItem(la));if(Z){void 0!==Z.sheetId&&null!==Z.sheetId&&void 0!==Z.name&&null!==Z.name&&Z.sheetId.length&&Z.sheetName.length||b.ULS.sendTraceTag(537170074,0,15,`CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:${la} Id:${Z.sheetId} Hash:${Z.hash} NameLength:${Z.name?Z.name.length:-1}`);var ja=void 0;ja=excelOnlineCalc.calc.sheetName(Z.sheetId,Z.name);this.jf.ma(this.currentStateId).T8f(la+1,new E(ja));ja=Z.usedRange.qS();ja=excelOnlineCalc.calc.rangeLocation(0,
0,ja.LastRow,ja.LastColumn);Z=excelOnlineCalc.calc.unusedCellsUpdate(Z.sheetId,ja);this.jf.ma(this.currentStateId).vlg.push(Z)}else b.ULS.sendTraceTag(537170073,0,15,`CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:${this.currentStateId} sheet-index:${la}`)}}}X7g(){for(let V of this.jf)V.key<this.Ft&&this.jf.remove(V.key)}jld(V){V=V.value||V.text;if(void 0===V||null===V)V="";return V}j3j(){if(!this.jf.kb(this.currentStateId))return!1;let V=!1;h.a.forEach(this.jf.ma(this.currentStateId).F0a,
(Z,ja)=>{ja.Hyc||(V=!0)},null);return V}r7c(V){const Z={};Z.reason=V;Z.kind=1;return Z}Tjc(){return this.jf.kb(this.currentStateId)&&this.jf.ma(this.currentStateId).sk&&this.jf.ma(this.currentStateId).sk[0]&&this.jf.ma(this.currentStateId).sk[0].d6?!0:!1}static vfh(V){const Z=[];if(null===V||void 0===V?0:V.O$)for(let ja of V.O$)V=excelOnlineCalc.calc.columnData(ja.key,ja.value),Z.push(V);return Z}static HPi(V,Z){if(V.type!==Z.type||V.attributes!==Z.attributes||!z.a.equals(V.fullName,Z.fullName,!1)||
!V.range.equals(Z.range))return!1;if(!V.KE&&!Z.KE)return!0;if(!V.KE||!Z.KE||V.KE.O$.count!==Z.KE.O$.count)return!1;for(let ja of V.KE.O$){let la;if(!(ja.value&&({value:la}=Z.KE.O$.Ic(ja.key)).returnValue&&la&&z.a.equals(ja.value,la,!1)))return!1}return!0}static ZXc(V,Z,ja){var la=J.kaa("NamedObject",Z.sheetId,Z.range.top-1,Z.range.left-1,Z.range.bottom-1,Z.range.right-1);if(2===Z.type){const ua=!!(Z.attributes&16),eb=!!(Z.attributes&8);Z=J.vfh(Z.KE);la=excelOnlineCalc.calc.namedTableData(la,ua,eb,
Z);V=excelOnlineCalc.calc.namedObject(V,la)}else la=excelOnlineCalc.calc.namedRangeData(la),V=excelOnlineCalc.calc.namedObject(V,la);ja.push(V)}static P2e(V){const Z=Sys.Serialization.JavaScriptSerializer.serialize(V.getRowNumbers());V=Sys.Serialization.JavaScriptSerializer.serialize(V.getColumnNumbers());return Z+V}static W6b(V){let Z=null;if(1<V.length)for(let ja=1;ja<V.length;ja++){let la=0;for(;V[ja-1]+1+la<V[ja];)Z=Z||[],Z.push(V[ja-1]+la),la++}return Z}static LZe(V,Z){if(!Z)return null;for(let ja=
0,la=Z.length;ja<la;++ja)if(z.a.equals(V,Z[ja].Name,!1))return Z[ja];return null}static kaa(V,Z,ja,la,ua,eb){const Eb=(Wb,Ab,Jb,Gb)=>{(0>Jb||Jb>=Gb)&&b.ULS.sendTraceTag(537170072,0,15,`CalcAsyncEngine::CreateSheetRangeLocation() callerId:${Wb} invalid ${Ab}:${Jb}`)};void 0!==Z&&null!==Z||b.ULS.sendTraceTag(537170071,0,15,`CalcAsyncEngine::CreateSheetRangeLocation() callerId:${V} sheetId is null`);Eb(V,"top",ja,J.Bxf);Eb(V,"left",la,J.nAd);Eb(V,"bottom",ua,J.Bxf);Eb(V,"right",eb,J.nAd);return excelOnlineCalc.calc.sheetRangeLocation(Z,
ja,la,ua,eb)}}J.Bxf=1048576;J.nAd=16384;Object(c.a)(J,"CalcAsyncEngine",null,[3]);const W=(V,Z,ja)=>{switch(V.type){case 2:return excelOnlineCalc.calc.valueCellData(Z,V.value,ja,null);case 1:return excelOnlineCalc.calc.valueCellData(Z,parseFloat(V.value),ja,null);case 3:return excelOnlineCalc.calc.valueCellData(Z,1===parseFloat(V.value),ja,null);case 4:return excelOnlineCalc.calc.valueCellData(Z,excelOnlineCalc.calc.errorValue(parseFloat(V.value)),ja,null);default:return excelOnlineCalc.calc.valueCellData("",
excelOnlineCalc.calc.blankValue,ja,null)}};class ea{constructor(){this.oK=this.pK=this.tF=this.uF=this.d_=!1}}Object(c.a)(ea,"AbsoluteRelativeReferenceInfo",null,[]);var R=a(1011),Y=a(24);class U{}U.iQf="#";Object(c.a)(U,"Operators",null,[]);var da=a(1012);class T{}T.sheet="Sheet";T.sheetRange="SheetRange";T.document="Document";T.jii="Ident";Object(c.a)(T,"TraverseFormulaQualifierTypes",null,[]);var ka=a(1013),L=a(898),fa=a(808),wa=a(44),oa=a(58),xa=a(75),bb=a(294),Za=a(39);class La extends Sys.EventArgs{constructor(V){super();
this.Sk=V}}Object(c.a)(La,"EditedCellRecalcCompleteEventArgs",Sys.EventArgs,[]);var va=a(153),Ba=a(54),Ea=a(275);class pa{constructor(V,Z){this.NEf=(ja,la)=>{ja=this.gridView.ha.ra.activeCell;const ua=this.gridView.Jb(ja);this.hbj(ja,la.text,ua.cell.Ci,ua.cell.zv.Y2b,this.gridView.$.activeItemName)};this.Iza=()=>{this.kya=Object(bb.a)({message:"PrefetchNotStarted"})};this.calcManager=V;this.gridView=Z;this.kya=Object(bb.a)({message:"Ctor"});V=y.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.SetCellEstimationPrefetchMsDebounce",
100);this.hbj=Ea.a((ja,la,ua,eb,Eb)=>this.prefetch({text:la,range:ja,ifmt:ua,stateId:eb,sheetName:Eb}),V);this.gridView.Xb.gl(this.Iza);this.gridView.Mh.sse(this.NEf)}dispose(){this.gridView.Mh.RYf(this.NEf);this.gridView.Xb.Zk(this.Iza);this.CEe()}Y2e(V){if(Object(bb.b)(this.kya))return Object(bb.a)(this.kya.reason.message);if(pa.pWg(V,this.kya.value.key)){for(const Z of this.kya.value.results.results)if(Object(bb.c)(Z)&&pa.Jxi(V,Z))return Z;return Object(bb.a)("RangeNotFoundInPrefetchResult")}return Object(bb.a)("ResultUnavailable")}CEe(){this.kya=
Object(bb.a)({message:"PrefetchResultCleared"})}prefetch(V){this.kya=Object(bb.a)({message:"EvalInProgress",key:V});this.calcManager.B3a([],V.range,V.range,V.text,!0).then(Z=>{this.kya=Object(bb.d)({key:V,results:Z})}).catch(Z=>{b.ULS.sendTraceTag(509219811,0,10,`SetCellEstimationPrefetcher.prefetch: evalFormulaRangeOnClonedModel promise rejected with error ${Z}`)})}static pWg(V,Z){return V.text===Z.text&&V.range.toString()===Z.range.toString()&&V.ifmt===Z.ifmt&&V.stateId===Z.stateId&&V.sheetName===
Z.sheetName}static Jxi(V,Z){return V.range.top-1===Z.value.cell.row&&V.range.left-1===Z.value.cell.col}}Object(c.a)(pa,"SetCellEstimationPrefetcher",null,[662,3]);var $a=a(91),cb;let ib=cb=class extends Za.a{constructor(V){super();this.lu=null;this.bqg=!1;this.MPd=this.instantaneousSupportInformationManager=this.zIb=null;this.XCd=new Map;this.Wge=null;this.Pqc=Z=>{b.ULS.sendTraceTag(537170005,0,50,"CalcManager.OnLocaleInformationAvailable() called");Z.HNd(this.Pqc);Z.Rja.length?this.uqc(Z,Sys.EventArgs.Empty):
(b.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),Z.Ase(this.uqc))};this.uqc=Z=>{b.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");Z.wNd(this.uqc);this.O0j(Z)};this.onContentReady=()=>{this.lu&&(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Tpd||oa.Task.delay(0).continueWith(()=>{this.lu.UQb(1)},0,null,xa.a.current))};this.yCf=(Z,ja)=>{this.lu&&(this.instantaneousSupportInformationManager&&
this.instantaneousSupportInformationManager.Tpd||this.lu.lLe(ja.dd.block))};b.ULS.sendTraceTag(537170067,0,50,"Creating CalcManager");this.uic=!1;this.mb=V;this.Ns=C.h(V);this.uJc=null;this.gridView.ev(this.onContentReady);this.gridView.Ca.yYc(this.yCf);this.$.da.hb(268,Z=>{Z.Re?(b.ULS.sendTraceTag(537170066,0,50,"CalcManager.ctor: LocaleInformation already available..."),this.Pqc(Z,Sys.EventArgs.Empty)):(b.ULS.sendTraceTag(537170065,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),Z.Wse(this.Pqc))});
if(this.r5=y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SetCellEstimationPrefetch",!1))this.mle=new pa(this,this.Ns)}EPg(V){this.addHandler(cb.tQe,V)}lAf(V){this.raiseEvent(cb.tQe,new La(V))}get $yc(){return this.mle}get Vr(){return this.uJc}get gridView(){return this.Ns}get $(){return this.mb}get HF(){return this.Wge}get localeInfo(){return this.Vr?this.Vr.config.localeInfo:null}get config(){return this.Vr.config}dispose(){b.ULS.sendTraceTag(537170064,0,50,"CalcManager.Dispose called");
this.$.da.hb(268,V=>{V.HNd(this.Pqc);V.wNd(this.uqc)});this.gridView&&(this.gridView.ty(this.onContentReady),this.gridView.Ca&&this.gridView.Ca.yYf(this.yCf),this.Ns=null);this.uJc=null;this.uic=!1;this.r5&&($a.a.Ja(this.$yc),this.mle=null)}F3g(V,Z,ja,la=null){this.lu&&this.lu.D3g(V,Z,ja,la)}evalFormula(V,Z,ja,la){return this.lu?this.lu.evalFormula(V,Z,ja,la):Promise.reject("calc engine not initialized")}B3a(V,Z,ja,la,ua){return this.lu?this.lu.B3a(V,Z,ja,la,ua):Promise.reject("CalcEngine is null")}Gec(V){if(!V)return b.ULS.sendTraceTag(509649312,
0,100,"CalcManager.GetTableHeaders: table is null"),null;if(!this.lu)return null;b.ULS.shipAssertTag(537170059,0,2===V.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table");return this.lu.Gec(V)}STg(V,Z){if(!Z||2!==V.type)return!1;V=u.a(V);return V.right-V.left+1===Z.count}AYe(V,Z){if(!this.zIb)return this.bqg||b.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var ja=this.Tta(Y.Range.Hc(1,1));ja=this.zIb.parseFormula(excelOnlineCalc.parse.parseLocals(1,
ja.range),V);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(ja))return b.ULS.sendTraceTag(537170056,0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{let la;if(y.EwaSettings.isChangeGateEnabled("OfficeVSO:6518739_FlightRemovalStructuredReferencesHighlighting")){const ua=null!==Z&&void 0!==Z?Z:this.gridView.ha.ra.activeCell,eb=excelOnlineCalc.location.gridCell(ua.top-1,ua.left-1),Eb=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),
Wb=excelOnlineCalc.location.sheetIndex(Eb,this.$.ua.na.sheetId),Ab=this.Qjh(eb,Wb);this.MPd||(this.MPd=excelOnlineCalc.util.createResolver(this.Pjh()));la=excelOnlineCalc.parse.parseResultHelper.extractReferences(ja,this.Vr.config.localeInfo,y.EwaSettings.xa(512),Ab,this.MPd)}else la=excelOnlineCalc.parse.parseResultHelper.extractReferences(ja,this.Vr.config.localeInfo,y.EwaSettings.xa(512));y.EwaSettings.xa(101)&&this.G6j(la,V);return la}catch(la){return b.ULS.sendTraceTag(537170055,0,10,`CalcManager.ExtractReferenceWrappers - exception: ${la.message}`),
null}}extractLetVariables(V,Z){if(!this.zIb)return this.bqg||b.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;const ja=this.Tta(Y.Range.Hc(1,1));V=this.zIb.parseFormula(excelOnlineCalc.parse.parseLocals(1,ja.range),V);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(V))return b.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(V,
Z,this.Vr.config.localeInfo)}catch(la){return b.ULS.sendTraceTag(537170052,0,10,`CalcManager.ExtractLetVariables - exception: ${la.message}`),null}}extractReferences(V,Z,ja,la,ua){if(!Z)return b.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!ja)return b.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;ua=this.AYe(V,ua);if(!ua)return b.ULS.sendTraceTag(537170049,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),
null;try{return this.Kih(ua,Z,ja,V,la)}catch(eb){return b.ULS.sendTraceTag(537170048,0,10,`CalcManager.ExtractReferences - exception: ${eb.message}`),null}}m8h(V,Z,ja,la){if(!V)return b.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!Z||0>=Z.length)return b.ULS.sendTraceTag(537170018,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;V=this.Tta(V);if(!this.Vr||!V)return null;const ua=
this.sxb(V).returnValue;if(!ua||ua.B7a)return null;ja=excelOnline.utils.getCharIndexInTextFromPoint(ja,la,y.EwaSettings.xa(512));return 0>ja?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.Vr.config,ja,Z,V)}s3g(V,Z,ja,la){if(!V)return b.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),null;let ua=null;return this.evalFormula(Z,V,void 0,excelOnlineCalc.calc.evalFormulaFormatOrigin()).then(eb=>{let Eb;const Wb=({kind:Eb}=this.Vr.oxh(eb,
ja)).returnValue;8!==Eb||Wb.length&&Wb!==O.CalcHelper.unknownError?eb=0:(b.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),eb=excelOnlineCalc.calc.getEvalFailureReason(eb),void 0!==eb&&null!==eb||b.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),eb=1);return ua=la?new R.a(Wb,la.start,la.end,eb):new R.a(Wb,-1,-1,eb)},eb=>{b.ULS.sendTraceTag(537170014,0,10,`EvalSession.GetPartialResultValueForFormula - exception: ${eb}`);
return Promise.resolve(ua)})}getSubExpressionSpan(V){return this.Vr&&V?excelOnlineCalc.runtime.getSubExpressionSpan(V):null}getFormulaSubExpressionObject(V,Z,ja){return this.Vr&&V&&Z&&ja?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.Vr.config,Z,ja,this.Tta(V)):null}p8h(V,Z,ja){return this.Vr&&V&&Z?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.Vr.config,Z,ja,this.Tta(V)):null}n8h(V,Z,ja){return this.Vr&&V&&Z?excelOnlineCalc.runtime.getSubExpressionSubspans(this.Vr.config.localeInfo,
Z,ja):null}g1h(){return this.Vr?this.Vr.config.localeInfo.listSeparator:null}isFormulaSubExpressionVolatile(V){return this.Vr?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.Vr.config.localeInfo,V):!1}Tta(V,Z=!0){return V&&this.Vr?this.Vr.mkh(this.Vr.$lh(),V.top-1,V.left-1,Z):null}clf(V,Z){V=this.t5a(V);if(!Object(bb.c)(V))return null;Z=this.HF.parseEdit(Z,V.value);return excelOnlineCalc.util.isSuccess(Z)?Z.value.kind===L.a.formula:null}Tzi(V){V=this.t5a(V);return Object(bb.c)(V)?"Text"===
V.value.valueType:null}t5a(V){if(null==this.HF)return Object(bb.a)("Number formatter is null");if(null==this.instantaneousSupportInformationManager)return Object(bb.a)("Instantaneous manager is null");if(this.XCd.has(V))return Object(bb.d)(this.XCd.get(V));if("number"===typeof V){var Z=this.njd(V);if(null==Z)return Object(bb.a)(`Invalid ifmt=${V}`);var ja=Z.FormatString;Z=Z.Builtin}else ja=V,Z=!1;ja=this.HF.createFormat(ja,Z);return excelOnlineCalc.util.isSuccess(ja)?(this.XCd.set(V,ja.value),Object(bb.d)(ja.value)):
Object(bb.a)("Could not create number format")}getWorksheetFuncId(V){return this.localeInfo.getWorksheetFuncId(V)}Kih(V,Z,ja,la,ua){const eb={Items:[]};for(let Jb=0;Jb<V.length;Jb++){var Eb=V[Jb];const Gb={};Gb.Start=Eb.span.start;Gb.End=Eb.span.end;if(ua||Eb.kind!==da.a.func)if(ua||Eb.kind!==da.a.DEi){if(!this.zsh(Eb,Z,ja))continue;var Wb=new ea;const Nb=this.b5h(Eb,Z,Wb,la);if(y.EwaSettings.xa(512)){var Ab=this.Y0h(Eb);const Ja=this.X0h(Eb);if(Nb||Ja&&0<=Ab){let ab={};ab.Span=Gb;ab.LetNumber=Ab;
ab.LetName=Ja;ab.Range=Nb;ab.IsRangeRef=Wb.d_;ab.IsAbsoluteFirstRow=Wb.uF;ab.IsAbsoluteFirstColumn=Wb.tF;ab.IsAbsoluteSecondRow=Wb.pK;ab.IsAbsoluteSecondColumn=Wb.oK;ab.IsStructRef=Eb.kind===da.a.zYd;eb.Items.push(ab)}}else Nb&&(Ab={},Ab.Span=Gb,Ab.Range=Nb,Ab.IsRangeRef=Wb.d_,Ab.IsAbsoluteFirstRow=Wb.uF,Ab.IsAbsoluteFirstColumn=Wb.tF,Ab.IsAbsoluteSecondRow=Wb.pK,Ab.IsAbsoluteSecondColumn=Wb.oK,Ab.IsStructRef=Eb.kind===da.a.zYd,eb.Items.push(Ab))}else Eb=Eb.ref.value.oper.kind,Wb={},Wb.Span=Gb,Wb.IsString=
2===Eb,Wb.IsBoolean=4===Eb,Wb.IsNumber=1===Eb,eb.Items.push(Wb);else Gb.End=Eb.span.start+Eb.ref.name.length,Eb={},Eb.Span=Gb,Eb.IsFunction=!0,Eb.FunctionId=this.getWorksheetFuncId(la.substring(Gb.Start,Gb.End)),eb.Items.push(Eb)}eb.Items.sort((Jb,Gb)=>Jb.Span.Start-Gb.Span.Start);return eb}Y0h(V){return V.kind===da.a.psf?V.ref.number:-1}X0h(V){return V.kind===da.a.psf?V.ref.name:null}b5h(V,Z,ja,la){if(V.kind===da.a.range)return ja.d_=!0,this.cIe(V,Z,ja,la);if(V.kind===da.a.namedRange){ja=V.ref;(V=
this.$.Bb.getItemByName(ja.name))||(V=this.$.Bb.getItemByName(Z+"!"+ja.name));if(!(V&&V.sheetName&&V.usedRange&&z.a.equals(V.sheetName,Z,!0)))return null;Z=2===V.type?u.a(V):V.usedRange;return wa.m(Z,V)}if(V.kind===da.a.zYd){let ua=V.ref,eb;ua.name?(eb=this.$.Bb.getItemByName(ua.name))||(eb=this.$.Bb.getItemByName(Z+"!"+ua.name)):eb=this.gridView.tb.uh(this.gridView.ha.ra.activeCell);if(!(eb&&eb.sheetName&&eb.usedRange&&z.a.equals(eb.sheetName,Z,!0)))return null;ja.d_=!1;return this.cIe(V,Z,ja,la)}return null}cIe(V,
Z,ja,la){V=V.ref;if(V.type){if(V.type===ka.a.column){var ua=V.startIndex;V=V.endIndex;ja.tF=ua.kind===fa.a.abs;ja.oK=V.kind===fa.a.abs;return this.createRange(0,ua.index,d.a.xg,V.index,Z)}if(V.type===ka.a.row)return ua=V.endIndex,ja.uF=V.startIndex.kind===fa.a.abs,ja.pK=ua.kind===fa.a.abs,this.createRange(V.startIndex.index,0,V.endIndex.index,d.a.wg,Z);if(V.type===ka.a.cell){ua=V.row;var eb=V.col;ja.uF=ja.pK=ua.kind===fa.a.abs;ja.tF=ja.oK=eb.kind===fa.a.abs;return this.p4b(V.span.end,la)&&(ja=Y.Range.Hc(ua.index+
1,eb.index+1),ja=this.gridView.tb.M9e(ja))?wa.n(ja,Z):this.createRange(ua.index,eb.index,ua.index,eb.index,Z)}if(V.type===ka.a.range){ua=V.top;eb=V.left;la=V.bottom;V=V.right;const Eb=Math.min(ua.index,la.index),Wb=Math.min(eb.index,V.index),Ab=Math.max(ua.index,la.index),Jb=Math.max(eb.index,V.index);ja.uF=ua.kind===fa.a.abs;ja.pK=la.kind===fa.a.abs;ja.tF=eb.kind===fa.a.abs;ja.oK=V.kind===fa.a.abs;return this.createRange(Eb,Wb,Ab,Jb,Z)}b.ULS.sendTraceTag(537170010,0,10,`CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '${V.type}'`);
return null}b.ULS.sendTraceTag(537170011,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null}p4b(V,Z){return Z.length>=V&&0<V&&Z.charAt(V-1)===U.iQf}z3g(V,Z,ja){this.lu&&this.lu.E3g(V,Z,ja)}njd(V){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.hza&&this.instantaneousSupportInformationManager.hza[V]&&this.HF?this.instantaneousSupportInformationManager.hza[V]:null}toXLNumber(V){if(!this.HF)return null;V=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,
this.HF,V);return excelOnlineCalc.util.isSuccess(V)?V.value:null}G6j(V,Z){if(V)for(const ja of V)ja.ref.type&&ja.ref.type===ka.a.cell&&(V=ja.ref,cb.Yaj(V,Z)&&(V.span.end+=1,ja.span.end+=1))}createRange(V,Z,ja,la,ua){const eb={};eb.FirstRow=V;eb.FirstColumn=Z;eb.LastRow=ja;eb.LastColumn=la;eb.SheetName=ua;return eb}zsh(V,Z,ja){var la=V.ref.qualifier;if(!la)return!0;switch(V.ref.qualifier.type){case T.sheet:return V=la.document,z.a.equals(la.sheet,Z,!0)&&(!V||z.a.equals(V.document,ja,!0));case T.sheetRange:return Z=
this.$.ua.getItemByName(Z),ja=this.$.ua.getItemByName(la.sheet1),la=this.$.ua.getItemByName(la.sheet2),!!Z&&!!ja&&!!la&&(ja.index<=Z.index&&Z.index<=la.index||la.index<=Z.index&&Z.index<=ja.index);case T.document:return z.a.equals(la.document,ja,!0);case T.jii:return la=la.name,z.a.equals(la,Z,!0)||z.a.equals(la,ja,!0);default:return b.ULS.sendTraceTag(537170009,0,10,`CalcManager.GetQualifierData: Unsupported formula qualifier type '${la.type}'`),!1}}O0j(V){this.instantaneousSupportInformationManager=
V;V.hza.length&&V.Rja.length?(this.uJc=new O.CalcHelper(this.gridView.$),this.zIb=this.Vr.createParser(),this.Wge=this.Vr.createNumberFormatter(),this.uic=!0,b.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),this.lu||(b.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.lu=new J(this.$))):b.ULS.sendTraceTag(537170008,0,15,`CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = ${V.hza.length}, functions info count = ${V.Rja.length}`)}sxb(V){if(!V)return{returnValue:null,
emptyCell:!1};var Z=this.getSheetName(V.sheet.index);if(!Z)return b.ULS.sendTraceTag(537169998,0,50,`CalcManager.GetCellFromBlockCache: No sheet index ${V.sheet.index}`),{returnValue:null,emptyCell:!1};const ja=cb.convertToRange(V);Z=this.gridView.sxb(Z,ja.top,ja.left);return Z?Z.vsh?{returnValue:Z,emptyCell:!1}:(b.ULS.sendTraceTag(537169996,0,50,`CalcManager.GetCellFromBlockCache: cell ${V.range.row} ${V.range.col} is empty`),{returnValue:null,emptyCell:!0}):(b.ULS.sendTraceTag(537169997,0,50,`CalcManager.GetCellFromBlockCache: cellProxy is null for cell ${V.range.row} ${V.range.col}`),
{returnValue:null,emptyCell:!1})}getSheetName(V){const Z=this.gridView.$.ua.getItem(V);return Z?Z.sheetName:(b.ULS.sendTraceTag(537169995,0,50,`CalcManager.GetSheetName - no sheet in index ${V}`),null)}Qjh(V,Z){const ja={allowUnqualifiedCell:!0,wrapCellReferences:!0};ja.config=this.Vr.config;ja.originGridCell=excelOnlineCalc.util.success(V);ja.originSheet=excelOnlineCalc.util.success(Z);return ja}Pjh(){const V={};V.config=this.Vr.config;V.getNameLoc=this.lu.getNameLoc;V.getContainingTable=this.lu.getContainingTable;
V.getStructRefColumn=this.lu.getStructRefColumn;V.getStructRefSpecialRef=this.lu.getStructRefSpecialRef;V.getDocumentLoc=this.lu.getDocumentLoc;V.getSheetIndex=this.lu.getSheetIndex;V.getSheetName=this.lu.getSheetName;V.getUserDefinedFuncLoc=this.lu.getUserDefinedFuncLoc;V.getSheetRangeIndexes=this.lu.getSheetRangeIndexes;return V}static Yaj(V,Z){return Z.length>V.span.end&&Z.charAt(V.span.end)===U.iQf}static convertToRange(V){return Y.Range.Hc(V.range.row+1,V.range.col+1)}};ib.tQe="ECRC";ib=cb=Object(f.b)([Object(va.d)(Ba.f),
Object(f.c)(0,Object(Ba.o)()),Object(f.c)(1,Object(Ba.p)())],ib);Object(c.a)(ib,"CalcManager",Za.a,[638,3]);var ta=a(38),Ya=a(52);class Da extends e.a{constructor(V){super();this.$=V;this.Gb()}create(){if(this.$){b.ULS.sendTraceTag(537169993,0,50,"CalcManagerFactory.Create: Start loading script");if(y.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var V=76;var Z="Current"}else V=79,Z="Stable";b.ULS.sendTraceTag(537169992,0,50,`CalcManagerFactory.Create: Calc ${Z} JS was loaded`);
ta.TaskExtensions.za(Ya.a.loadScript(V,4,this.Na,void 0,void 0,265),()=>{b.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");let ja=this.$.da.Ba(266,!1);ja||(b.ULS.sendTraceTag(537169990,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),ja=new ib(this.$),this.$.da.Ha(266,ja));this.qb(ja)},this.ka,3)}else b.ULS.sendTraceTag(537169994,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")}static la(V){V&&
V.da&&V.da.Ha(265,new Da(V))}}Object(c.a)(Da,"CalcManagerFactory",e.a,[]);var ba=a(9);a.d(B,"a",function(){return ya});const ya=()=>{ba.a.Fa(V=>{y.EwaSettings.OH()||Da.la(V)})};String(r);window.___1678693003405_closurehack=r},1243:function(r,B,a){var c=a(9);r=a(0);var b=a(15),e=a(228),f=a(91),d=a(4),h=a(197),l=a(8),k=a(39),w=a(897),n=a(231),x=a(63),m=a(896);class u extends Sys.EventArgs{constructor(){super()}}Object(r.a)(u,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);var t=a(49),y=a(45);a(36);
var v=a(29),A=a(1),z=a(622);a(22);var C=a(290),H=a(21);a(184);class I{constructor(O){this.data=O}}Object(r.a)(I,"NumberFormatDataHolder",null,[]);var S=a(187);class P extends k.a{constructor(O,N){super();this.Cwd=l.a.re;this.a2c=null;this.Mhb=this.Zlc=!1;this.CBf=(J,W)=>{var ea;(J=H.h(this.$))&&(W=null!==(ea=null===W||void 0===W?void 0:W.cell)&&void 0!==ea?ea:J.Jb(null))&&this.FCa(W.cell.Ci,!0)};this.zXi=J=>{this.isActive()&&(v.a.wq(J.Errors)||!J.Result?(J=J.Errors?J.Errors.map(W=>JSON.stringify(W)).join(","):
"None",b.ULS.sendTraceTag(537155726,0,50,`GetCategoryFromServer failed, ignoring - server errors: ${J}`)):(J=J.Result,b.ULS.sendTraceTag(537155725,0,50,`Updating number format category cache, format index = ${J.Index}, category = ${J.Category}`),this.eFj(J.Index,J.Category),this.raiseEvent(P.V2c,new w.a(J.Index,J.Category),this)))};this.refresh=()=>{b.ULS.sendTraceTag(537155722,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");this.a4b();this.isActive()&&this.ea.ic.allowEdits&&
(this.Mhb||this.zn&&!(this.ea.dEb>this.Cwd)?this.HGc():(b.ULS.sendTraceTag(537155721,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information."),this.Qid=m.a(this.$.pa.va,this.zn?this.zn.Digest:"",this.hYi,this.gYi,null,null)),b.ULS.sendTraceTag(537155720,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info."),this.p5e())};this.WFf=J=>{b.ULS.sendTraceTag(537155716,0,50,`InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = ${J.data.status}, HTTP status = ${J.data.httpStatus}.`);
this.qLa=null};this.K_=()=>{this.Mhb=!1;this.ea.wB(this.K_);this.eSa(this.Zlc?P.TUd:P.tCd)};this.Wc=(J,W)=>{b.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");n.a(W)&&this.eSa(P.TUd)};this.xf=()=>{b.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==this.$.workbookContext.CalcMode&&this.GCd(0===this.$.workbookContext.CalcMode)};this.od=()=>{b.ULS.sendTraceTag(537155713,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");
this.eSa(P.TUd);A.EwaSettings.xa(269)&&3!==this.$.workbookContext.CalcMode&&this.GCd(0===this.$.workbookContext.CalcMode)};this.$Xi=(J,W,ea)=>{b.ULS.sendTraceTag(537155712,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");this.qLa=null;this.isActive()?J.StateId===l.a.re?(b.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),this.HGc()):!J.Result||this.NX&&this.NX.length?this.eSa(P.tCd):this.CJf(J,
W,ea):b.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};this.CJf=J=>{this.NX=J.Result;b.ULS.sendTraceTag(537155681,0,50,`InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned ${this.NX?this.NX.length:-1} functions.`);J=!1;if(this.NX){for(const W of this.NX)W&&(this.V0e[W.NameUI.toLocaleUpperCase()]=W.FunctionIndex.toString(),W.NameUI!==W.NameDataStrings&&(this.V0e[W.NameDataStrings.toLocaleUpperCase()]=
W.FunctionIndex.toString(),J=!0),this.NOh.ia(W.FunctionIndex,W.NameUI));this.raiseEvent(P.Bfd,Sys.EventArgs.Empty,this)}J&&b.ULS.sendTraceTag(537155680,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};this.hYi=J=>{if(this.isActive())if(b.ULS.shipAssertTag(537155679,0,!!this.$,"null ewaControl"),this.Zlc=!1,this.Cwd=J.StateId,this.Cwd===l.a.re)this.Zlc=!0,this.HGc();else{if(J.Result){var W=this.zn;this.zn=J.Result;b.ULS.sendTraceTag(537155678,
0,50,`InstantaneousSupportInformation updated, new result digest: ${this.zn.Digest}.`);J=[];if(W)J=P.N1h(W.NumberFormats,this.zn.NumberFormats);else for(W=0;W<this.zn.NumberFormats.length;W++)this.npc.ia(W,this.zn.NumberFormats[W].NumberFormatCategory);for(const ea of J)this.npc.ia(ea,this.zn.NumberFormats[ea].NumberFormatCategory);this.raiseEvent(P.bDd,new u(J),this);this.raiseEvent(P.ptf)}this.eSa(P.tCd)}};this.gYi=J=>{this.isActive()&&(10===J.data.status?b.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):
(b.ULS.sendTraceTag(21311555,0,10,`Failed to update instantaneous support information, status = ${J.data.status}, HTTP status = ${J.data.httpStatus}.`),this.Zlc=!0,this.HGc()))};b.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");this.ea=O;this.$=N;this.zn=this.qLa=this.Qid=this.dKb=null;this.npc=new S.a;this.rxb=new S.a;this.NX=[];this.NOh=new S.a;this.V0e={};this.ea.Oj(this.Wc);this.$.hl(this.od);H.h(this.$).ha.hha(this.CBf);A.EwaSettings.xa(269)&&this.ea.ju(this.xf);
this.eSa(P.Wff);b.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end")}Wse(O){this.addHandler(P.bDd,O)}HNd(O){this.removeHandler(P.bDd,O)}dPg(O){this.addHandler(P.V2c,O)}Pnj(O){this.removeHandler(P.V2c,O)}Ase(O){this.addHandler(P.Bfd,O)}wNd(O){this.removeHandler(P.Bfd,O)}HQg(O){this.addHandler(P.ptf,O)}get Re(){return this.zn?this.zn.LocaleInformation:null}get hza(){return this.zn?this.zn.NumberFormats:[]}get Rja(){this.NX&&this.NX.length||this.p5e();return this.NX}get Gni(){return this.zn&&
void 0!==this.zn.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.zn.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.zn.InstantaneousCalcWebWorkerPrecisionSamplingRate:P.znh}get Jni(){return this.zn&&void 0!==this.zn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.zn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.zn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:P.Dnh}get Ini(){return this.zn&&void 0!==this.zn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&
null!==this.zn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.zn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:P.Cnh}get Hni(){return this.zn&&void 0!==this.zn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.zn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.zn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:P.Bnh}get Fhf(){return this.zn?this.zn.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:P.Anh}get Tpd(){return null!==this.a2c?
this.a2c:this.zn?this.zn.InstantaneousCalcManualMode:!1}F0j(O){let N;if(!O)return{returnValue:!0,category:"General"};N="";if(!({category:O}=this.FCa(O,!1)).returnValue)return{returnValue:!1,category:N};N=this.Ych(O);return{returnValue:!0,category:N}}Ych(O){let N="";switch(O){case 0:N="General";break;case 1:N="Number";break;case 2:N="Currency";break;case 3:N="Accounting";break;case 4:N="Date";break;case 5:N="Time";break;case 6:N="Percentage";break;case 7:N="Fraction";break;case 8:N="Scientific";break;
case 9:N="Text";break;case 10:N="Special";break;case 11:N="Custom"}return N}FCa(O,N){let J,W=({value:J}=this.npc.Ic(O,0)).returnValue;!W&&0<O&&this.$&&(b.ULS.sendTraceTag(537155735,0,50,`InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache ${O}`),this.xUh(O),N&&(J=this.wUh(O),W=!0),z.a(O,this.$.pG)&&(J=6));return{returnValue:W,category:J}}vti(O){let N=0;if(({category:N}=this.FCa(O,!0)).returnValue)return 6===N;b.ULS.sendTraceTag(537155733,
0,50,`InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index ${O}`);return!1}mNh(O){b.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.qLa=x.o(this.$.pa.va,{FilterType:0},C.b(this.CJf,O),this.WFf,null,null,null)}q0e(){this.eSa(P.Wff)}GCd(O){this.a2c=O}xUh(O){if(this.rxb&&this.$){var N;if(!({value:N}=this.rxb.Ic(O)).returnValue||N.isCompleted)b.ULS.sendTraceTag(537155728,
0,50,`Getting number format category for format index: ${O}`),(N=m.c(this.$.pa.va,O,this.zXi,null,null,null))&&this.rxb.ia(O,N)}else b.ULS.sendTraceTag(537155729,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")}wUh(O){return 1<=O&&8>=O?1:9<=O&&12>=O?2:13===O||14===O?6:15===O?8:17===O|18===O?7:19===O?4:16===O||20<=O&&29>=O||31===O?11:30===O?9:32<=O&&35>=O?3:0}isActive(){const O=void 0===this.ea||null===this.ea,N=!O&&this.ea.Yb;b.ULS.sendTraceTag(537155727,
0,50,`InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:${N} - sessionStateManager IsNullOrUndefined: ${O}`);return N}eFj(O,N){this.npc.ia(O,N)}dispose(){f.a.Ja(this.dKb);this.dKb=null;this.a4b();for(let O of this.rxb){const N=O.value;N&&!N.isCompleted&&d.AFrameworkApplication.Hd.Wt(N.Xs)}this.rxb=null;this.ea&&(this.ea.pk(this.Wc),this.Mhb&&this.ea.wB(this.K_),this.Mhb=!1,this.ea.Lv(this.xf));this.ea=null;this.$&&H.h(this.$)&&H.h(this.$).ha&&(H.h(this.$).ha.Cna(this.CBf),
this.$.em(this.od));this.$=null;super.dispose()}isFeatureEnabled(O){try{switch(O){case "LocaleLongDateFormat":return A.EwaSettings.xa(184);case "GetLocaleDayNames":return A.EwaSettings.xa(185);case "CalculateTextWidthIgnoreLetterSpacing":return A.EwaSettings.xa(255);case "OfficeVSO:3657744_CalcFixForDateFormat":return A.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return A.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");
case "CalcAutocompleteExperiment":return A.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1);case "CalcWebWorker":return!0;case "CalcPreventSpillingHack":return A.EwaSettings.isChangeGateEnabled("OfficeVSO:7504597_calcPreventSpillingHack");case "CalcDynamicArrayOperators":return A.EwaSettings.xa(101);default:return O.startsWith("OfficeVSO:")?A.EwaSettings.isChangeGateEnabled(O):!1}}catch(N){return b.ULS.sendTraceTag(537155724,0,15,`InstantaneousSupportInformation.IsFeatureEnabled(${O}): feature parsing failed, returning false. Exception: ${N.toString()}.`),
!1}}eSa(O){this.isActive()&&this.ea.ic.allowEdits?(f.a.Ja(this.dKb),this.dKb=null,this.dKb=t.a.instance.create(this.refresh,O,y.a.Kni)):b.ULS.sendTraceTag(537155723,0,50,`InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits ${void 0!==this.ea&&null!==this.ea&&void 0!==this.ea.ic&&null!==this.ea.ic?this.ea.ic.allowEdits:!1}, IsEditMode ${void 0===this.ea||null===this.ea?!1:this.$.ea.isEditMode}`)}p5e(){b.ULS.sendTraceTag(537155719,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");
this.qLa?b.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.NX&&this.NX.length||(this.qLa=x.o(this.$.pa.va,{FilterType:0},this.$Xi,this.WFf,null,null,null)):b.ULS.sendTraceTag(537155717,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")}HGc(){this.Mhb||(this.Mhb=!0,this.ea.wA(this.K_))}a4b(){this.Wt(this.Qid);this.Wt(this.qLa);this.qLa=this.Qid=null}Wt(O){O&&
!O.isCompleted&&this.$.pa.va.Ogb(O.Xs)}static N1h(O,N){if(!O||!O.length)return[];if(!N||!N.length){N=Array(O.length);for(var J=0;J<O.length;++J)N[J]=O[J].IfmtIndex;return N}J=new S.a;for(const W of O)J.ia(W.IfmtIndex,new I(W));O=new h.a;for(const W of N){let ea;({value:ea}=J.Ic(W.IfmtIndex)).returnValue&&ea.data.FormatString===W.FormatString||O.add(W.IfmtIndex)}return O.toArray()}}P.bDd="isim0";P.V2c="isim1";P.Bfd="isim2";P.ptf="isim3";P.Wff=100;P.TUd=1E3;P.tCd=3E5;P.znh=.001;P.Dnh=.1;P.Cnh=.2;P.Bnh=
.001;P.Anh=50;Object(r.a)(P,"InstantaneousSupportInformationManager",k.a,[546,3]);var D=a(717);class G extends e.a{constructor(O){super();this.$=O;this.Gb()}create(){if(this.$){b.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script");var O=Object(D.a)(this.$.da,268,()=>new P(this.$.ea,this.$));this.qb(O)}}static la(O){if(!O)throw Error.argumentNull("ewaControl");O.da.Ha(246,new G(O))}}Object(r.a)(G,"InstantaneousSupportInformationManagerFactory",
e.a,[]);a.d(B,"a",function(){return E});const E=()=>{c.a.Fa(G.la)}},1258:function(r,B,a){function c(ea){if(ea){var R=new w(ea.IsRangeRef);R.uF=ea.IsAbsoluteFirstRow;R.tF=ea.IsAbsoluteFirstColumn;R.pK=ea.IsAbsoluteSecondRow;R.oK=ea.IsAbsoluteSecondColumn;return R}}function b(ea){var R;if(ea){var Y=new w(0===ea.kind);ea=null===(R=null===ea||void 0===ea?void 0:ea.rangeInfo)||void 0===R?void 0:R.positionKindInfo;if(!ea)return Y;Y.uF=0===ea.firstRow;Y.tF=0===ea.firstColumn;Y.pK=0===ea.secondRow;Y.oK=0===
ea.secondColumn;return Y}}r=a(0);var e=a(228),f=a(7),d=a(15),h=a(87),l=a(5),k=a(328);class w{constructor(ea){this.oK=this.pK=this.tF=this.uF=!1;this.d_=ea}}Object(r.a)(w,"MarqueeRangeData",null,[]);class n{constructor(ea,R,Y,U=!1){this.RZd=ea;this.VPb=R;this.o8a=U;Y?(this.d_=Y.d_,this.uF=Y.uF,this.tF=Y.tF,this.pK=Y.pK,this.oK=Y.oK):d.ULS.shipAssertTag(524039642,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}}Object(r.a)(n,"MarqueeMetadata",null,[]);var x=a(44),m=a(146),u=a(36),t=a(1),y=a(22),v=a(585),
A=a(21),z=a(184),C=a(350),H=a(33),I=a(562),S=a(899);const P="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");class D{constructor(ea,R){this.nK=this.Wfb=this.Vuf=!1;this.Q8=null;this.INa=t.EwaSettings.INa();this.mza=()=>{this.nK=!1};this.Uc=ea;this.gridView=A.h(ea);this.calcManager=R;this.Bif=t.EwaSettings.xa(595);this.LH=H.a.LH(ea);this.gridView.Xb.rm(this.mza)}get formulaAssistanceManager(){this.Q8||
(this.Q8=this.Uc.da.Ba(464));return this.Q8}get formulaAssistanceTelemetryManager(){this.DEa||(this.DEa=this.Uc.da.Ba(491));return this.DEa}VD(ea,R){ea.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");if(this.Wfb||ea.vF)return!1;const Y=void 0===R||null===R?ea.text:R;if(this.calcManager&&1<Y.length&&z.f(Y)){var U=this.pka(),da=this.F7e(),T=this.Uc.workbookContext.WorkbookFileName;let ka=!1;const L=.01>Math.random()?Object(h.a)(m.a,this.Uc.Mb.Kc("LoadingUIShown","ColoredReferencesManager")):
null;try{const fa=this.calcManager.extractReferences(Y,da,T,!this.Bif);if(!fa)return d.ULS.sendTraceTag(524039689,0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;da=[];T=[];const wa=[],oa=[];let xa=0,bb=0;const Za=new u.a(!1);let La="";for(const Ba of fa.Items)if(ka=Ba.IsStructRef||ka,Ba.IsBoolean||Ba.IsNumber||Ba.IsString){const Ea=Ba.IsBoolean?"rgba(0, 0, 255, 1)":Ba.IsNumber?"rgba(9, 134, 88, 1)":"rgba(163, 21, 21, 1)";this.sE(T,
Y,xa,Ba.Span.Start,null);this.sE(T,Y,Ba.Span.Start,Ba.Span.End,Ea);xa=Ba.Span.End}else if(t.EwaSettings.xa(512)){if(Ba.Range||Ba.LetName&&0<=Ba.LetNumber){let Ea=null;if(Ba.Range){let $a=x.E(Ba.Range);Ea=this.zZ($a,Za,1);da.push(new C.a($a,U))}else Ba.LetName&&0<=Ba.LetNumber&&(Ea=La=this.kVh(Ba.LetName,Ba.LetNumber,Za,La),bb!==Za.count&&ea.colors.add(Ba.Span.Start+"-"+Ba.Span.End,P[(Za.count-1)%P.length]));this.sE(T,Y,xa,Ba.Span.Start,null);this.sE(T,Y,Ba.Span.Start,Ba.Span.End,Ea);xa=Ba.Span.End;
wa.push(Ba.Span);let pa=T.length-1;oa.push(new n(pa,T[pa].text,c(Ba)));bb=Za.count}}else if(Ba.Range){let Ea=x.E(Ba.Range),pa=this.zZ(Ea,Za,1);this.sE(T,Y,xa,Ba.Span.Start,null);this.sE(T,Y,Ba.Span.Start,Ba.Span.End,pa);da.push(new C.a(Ea,U));xa=Ba.Span.End;wa.push(Ba.Span);let $a=T.length-1;oa.push(new n($a,T[$a].text,c(Ba)))}this.formulaAssistanceTelemetryManager?0<fa.Items.length&&this.formulaAssistanceTelemetryManager.bcc.formulaHighlightsCounter++:this.inc("ColoredReferencesManager.tryUpdateColoredReferences: FormulaAssistanceTelemetryManager unavailable");
this.sE(T,Y,xa,Y.length,null);this.Jzc(ea,T,!!R);const va=ea.textBox.text;if(!y.a.equals(va,Y,!1)){d.ULS.shipAssertTag(38114182,0,!1,`ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [${va.length}], originalTextLength [${Y.length}]`);let Ba=ea.textBox.caretPosition;ea.textBox.text=Y;ea.textBox.caretPosition=Ba;return!0}this.mz(da,Za,oa);t.EwaSettings.xa(512)&&0<da.length&&d.ULS.sendTraceTag(524039688,
0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");t.EwaSettings.xa(512)&&0<ea.colors.count&&d.ULS.sendTraceTag(524039687,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.nK=!0}finally{L&&L.WBa(()=>{ka&&d.ULS.sendTraceTag(524039686,0,50,`ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in ${L.Fc} ms`)})}}else return this.mz(null,null),this.nK&&(this.nK=!1,this.INa||(U=ea.textBox.caretPosition,
ea.textBox.setPlainText(Y),ea.textBox.caretPosition=Math.min(U,Y.length)),R)?!0:!1}Rgb(ea,R,Y){if(this.Wfb||ea.vF)return!1;const U=isNullOrUndefined(R)?ea.text:R;var da=[];const T=new u.a(!1);if(1<U.length&&Object(I.b)(Y)){const L=[],fa=[],wa=[];var ka=0;const oa=this.pka();for(const xa of Y.formulaHighlights){this.sE(L,U,ka,xa.span.start,null);switch(xa.kind){case 0:case 1:case 2:Y=x.C(xa.rangeInfo.sharedRange);if(isNullOrUndefined(Y)){d.ULS.sendTraceTag(521211937,0,10,`ColoredReferencesManager.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:${xa.kind.toString()},`);
this.sE(L,U,xa.span.start,xa.span.end,null);break}ka=this.zZ(Y,T,1);this.sE(L,U,xa.span.start,xa.span.end,ka);da.push(new C.a(Y,oa));fa.push({Start:xa.span.start,End:xa.span.end});Y=L.length-1;wa.push(new n(Y,L[Y].text,b(xa)));break;case 3:this.sE(L,U,xa.span.start,xa.span.end,null,"rgba(229, 229, 229, 1)")}ka=xa.span.end}this.sE(L,U,ka,U.length);this.Jzc(ea,L,!!R);R=ea.textBox.text;if(!y.a.equals(R,U,!1))return d.ULS.shipAssertTag(521211936,0,!1,`ColoredReferencesManager.UpdateFormulaHighlights: The text we created is different from the original text. Setting the original text back. currentTextLength [${R.length}], originalTextLength [${U.length}]`),
R=ea.textBox.caretPosition,ea.textBox.text=U,ea.textBox.caretPosition=R,!0;this.mz(da,T,wa);return this.nK=!0}this.mz(null,null);return this.nK&&(this.nK=!1,this.INa||(da=ea.textBox.caretPosition,ea.textBox.setPlainText(U),ea.textBox.caretPosition=Math.min(da,U.length)),R)?!0:!1}KFb(ea,R,Y){if(!ea||!R||!Y)return d.ULS.shipAssertTag(524039685,0,!!ea,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),d.ULS.shipAssertTag(524039684,0,!!R,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),
d.ULS.shipAssertTag(524039683,0,!!Y,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;const U=Object(h.a)(n,R.metadata);if(!U)return d.ULS.shipAssertTag(524039682,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var da=U.RZd,T=U.VPb,ka=this.gridView.tb.Erd(Y)?Y.Kxb(U.tF,U.uF):Y.ALa(U.tF,U.uF,U.oK,U.pK);if(!ka)return d.ULS.shipAssertTag(524039681,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;const L=T.indexOf("!");-1!==L&&(ka=T.substring(0,
L+1)+ka);if(!ea.textBox.changeTextInExistingTextPart(da,T,ka))return d.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;U.VPb=ka;da=!0;for(T=1;4>=T;T++)(ka=A.h(this.Uc).Eb.WC(3,T,R.dU))?(ka.range=Y,ka.metadata=U):(d.ULS.shipAssertTag(524039680,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),da=!1);this.gridView.Eb.update(!1,!1);this.gridView.Ul&&(this.gridView.oc.textBox.text=ea.text);this.gridView.oc.OQa(new k.a({zBb:!0}));
return da}ivi(ea){if(3!==ea.Kq)return d.ULS.shipAssertTag(524039651,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;ea=Object(h.a)(n,ea.metadata);return ea?ea.d_&&!ea.o8a:(d.ULS.shipAssertTag(524039650,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)}bCa(ea,R){d.ULS.sendTraceTag(524039649,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+(R?"suspending":"resuming")+" colored references");R&&this.nK&&
(this.nK=!1,this.mz(null,null),ea.textBox.wEe());this.Wfb=R}dispose(){this.gridView&&this.gridView.Xb&&this.gridView.Xb.dm(this.mza)}Zzb(ea){const R=this.formulaAssistanceTelemetryManager;R||this.inc("ColoredReferencesManager.highlightPreviewRanges: Failed to log highlightPreviewRanges measurement, FormulaAssistanceTelemetryManager unavailable");null===R||void 0===R?void 0:R.ND(["highlightPreviewRanges"]);this.LH?this.jhi(ea):this.ihi(ea);null===R||void 0===R?void 0:R.rv(["highlightPreviewRanges"],
!0)}jhi(ea){var R=this.formulaAssistanceManager.l5a(ea,S.a);if(isNullOrUndefined(R))this.mz(null,null);else{var Y=this.pka(),U=[],da=new u.a(!1),T=[];R=R.formulaHighlights;for(const ka of R)if(R=ka.kind,0===R||2===R||1===R)R=x.C(ka.rangeInfo.sharedRange),Object(I.b)(R)&&(U.push(new C.a(R,Y)),this.zZ(R,da,1),T.push(new n(ka.span.start,ea.substring(ka.span.start,ka.span.end),b(ka),!0)));this.mz(U,da,T)}}ihi(ea){const R=this.pka();var Y=this.F7e();const U=this.Uc.workbookContext.WorkbookFileName,da=
[],T=new u.a(!1),ka=[];if(Y=this.calcManager.extractReferences(ea,Y,U,!this.Bif)){for(const L of Y.Items)L.Range&&(Y=x.E(L.Range),da.push(new C.a(Y,R)),this.zZ(Y,T,1),ka.push(new n(L.Span.Start,ea.substring(L.Span.Start,L.Span.End),c(L),!0)));this.mz(da,T,ka)}else this.mz(null,null)}zZ(ea,R,Y){let U=R.getItem(ea.toString());U||(U=P[R.count%P.length],R.add(ea.toString(),U));return String.format(U,Y)}kVh(ea,R,Y,U){ea="["+ea+", "+R+"]";R=Y.getItem(ea);R||(R=Y.count%P.length,R=P[R],U===String.format(R,
1)&&(Y.add("skip-"+ea,R),R=Y.count%P.length,R=P[R]),Y.add(ea,R));return String.format(R,1)}sE(ea,R,Y,U,da=null,T=null){d.ULS.shipAssertTag(524039648,0,Y<=U,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");Y<U&&(R=R.substring(Y,U),ea.push(Object(f.a)(new v.a,{text:R,color:da,backgroundColor:T})))}mz(ea,R,Y=null){ea&&ea.length?(d.ULS.sendTraceTag(524039647,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+ea.length),ea.reverse(),Y.reverse(),
this.gridView.Eb.CB(ea,[3],!0,(U,da)=>{if(U&&U.range&&da){d.ULS.shipAssertTag(524039643,0,R.kb(U.range.toString()),`ColoredReferencesManager.HighlightRanges: The range '${U.range.toString()}' doesn't exist in the range to color dictionary`);var T=this.zZ(U.range,R,.1),ka=this.zZ(U.range,R,1);this.Uc.frame&&this.Uc.frame.cD&&this.Uc.frame.cD.cN||(da.style.background=T);da.style.borderColor=ka;Y&&(da.setAttribute(l.a.P6a,U.dU.toString()),U.metadata=Y[U.dU])}else d.ULS.shipAssertTag(524039646,0,!!U,
"ColoredReferencesManager.HighlightRanges: state is null"),d.ULS.shipAssertTag(524039645,0,!!U.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),d.ULS.shipAssertTag(524039644,0,!!da,"ColoredReferencesManager.HighlightRanges: div is null")})):(ea=this.Uc.Mb.Kc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.Eb.Tj([3]),this.gridView.Eb.JSa(new C.a(null,this.pka()),[3]),ea.stop())}Jzc(ea,R,Y){const U=ea.textBox;U.oF=!0;var da=U.selection;const T=da.index;da=T+da.length;
U.setTextFromTextParts(R);R=U.text.length;U.selectRange(Math.min(T,R),Math.min(da,R));Y&&ea.OQa(new k.a);U.oF=!1}inc(ea){this.Vuf||(d.ULS.sendTraceTag(521211935,0,50,ea),this.Vuf=!0)}pka(){return this.gec().sheetId}F7e(){return this.gec().sheetName}gec(){return this.gridView.Vq&&this.gridView.Vq.NF?this.gridView.Vq.NF:this.Uc.na}}Object(r.a)(D,"ColoredReferencesManager",null,[370,3]);var G=a(153),E=a(54),O=a(717);class N extends e.a{constructor(ea){super();this.$=ea;this.Gb()}create(){t.EwaSettings.OH()?
void G.a.resolve(E.f,{Wb:this.Na}).then(ea=>{const R=Object(O.a)(this.$.da,281,()=>new D(this.$,ea));this.qb(R)}):this.$.da.hb(266,ea=>{ea=this.$.da.Ba(281)||this.$.da.Ha(281,new D(this.$,ea));this.qb(ea)})}static la(ea){ea.da.Ha(282,new N(ea))}}Object(r.a)(N,"ColoredReferencesManagerFactory",e.a,[]);var J=a(9);a.d(B,"a",function(){return W});const W=()=>{J.a.Fa(N.la)}},1303:function(r,B,a){r=a(0);var c=a(228),b=a(829),e=a(1),f=a(153),d=a(54);class h extends c.a{constructor(w){super();this.$=w;this.Gb()}create(){(e.EwaSettings.OH()?
w=>f.a.resolve(d.f).then(n=>setTimeout(()=>w(n),0)):w=>this.$.da.hb(266,w))(w=>{w=this.$.da.Ba(294)||this.$.da.Ha(294,new b.RelativeAndAbsoluteReferencesManager(w));this.qb(w)})}static la(w){w.da.Ha(295,new h(w))}}Object(r.a)(h,"RelativeAndAbsoluteReferencesManagerFactory",c.a,[]);var l=a(9);a.d(B,"a",function(){return k});const k=()=>{l.a.Fa(h.la)}},1430:function(r,B,a){a.r(B);r=a(1243);B=a(1192);var c=a(1258);a=a(1303);Type.registerNamespace("_Ewa");Object(r.a)();Object(B.a)();Object(c.a)();Object(a.a)()},
808:function(r,B,a){a.d(B,"a",function(){return c});r=a(0);class c{}c.abs="Abs";c.rel="Rel";Object(r.a)(c,"PositionBaseType",null,[])},829:function(r,B,a){a.r(B);r=a(0);var c=a(7),b=a(15);class e{}Object(r.a)(e,"Reference",null,[]);class f extends e{constructor(){super();this.column=this.row=null}}Object(r.a)(f,"CellReference",e,[]);class d{constructor(){this.end=this.start=0;this.Cr=null}BVg(C,H){for(let I=0;I<this.Cr.length;I++){const S=this.U1b(C,this.Cr[I]);H+=S;I<this.Cr.length-1&&(H+=":")}return H}}
Object(r.a)(d,"IReferenceSequence",null,[]);var h=a(24),l=a(808);class k extends d{constructor(){super();this.qkc=!1}aec(){const {RelativeAndAbsoluteReferencesManager:C}=a(829),H=this.Cr[0];return C.Pzf(H.row.kind===l.a.abs,H.column.kind===l.a.abs)}U1b(C,H){H=h.Range.Hc(H.row.index+1,H.column.index+1);return this.qkc?H.Kxb(1===C||3===C,1===C||2===C):H.ALa(1===C||3===C,1===C||2===C,!0,!0)}}Object(r.a)(k,"CellReferenceSequence",d,[]);class w extends e{constructor(){super();this.secondColumn=this.firstColumn=
null}}Object(r.a)(w,"ColumnReference",e,[]);class n extends d{constructor(){super()}aec(){const C=this.Cr[0];return a(829).RelativeAndAbsoluteReferencesManager.myf(C.firstColumn,C.secondColumn).kind===l.a.abs?2:3}U1b(C,H){return h.Range.Qwb(H.firstColumn.index+1,H.secondColumn.index+1).ALa(1===C||3===C,!0,1===C||3===C,!0)}}Object(r.a)(n,"ColumnReferenceSequence",d,[]);class x extends e{constructor(){super();this.right=this.left=this.bottom=this.top=null}}Object(r.a)(x,"RangeReference",e,[]);class m extends d{constructor(){super()}aec(){const {RelativeAndAbsoluteReferencesManager:C}=
a(829),H=this.Cr[0];return C.Pzf(H.top.kind===l.a.abs,H.left.kind===l.a.abs)}U1b(C,H){H=new h.Range(H.top.index+1,H.left.index+1,H.bottom.index+1,H.right.index+1,!1,!1);const I=1===C||3===C;C=1===C||2===C;return H.ALa(I,C,I,C)}}Object(r.a)(m,"RangeReferenceSequence",d,[]);class u extends e{constructor(){super();this.secondRow=this.firstRow=null}}Object(r.a)(u,"RowReference",e,[]);class t extends d{constructor(){super()}aec(){const C=this.Cr[0];return a(829).RelativeAndAbsoluteReferencesManager.myf(C.firstRow,
C.secondRow).kind===l.a.abs?0:1}U1b(C,H){return h.Range.gcc(H.firstRow.index+1,H.secondRow.index+1).ALa(!0,1===C||2===C,!0,1===C||2===C)}}Object(r.a)(t,"RowReferenceSequence",d,[]);var y=a(1012),v=a(1013),A=a(184);a.d(B,"RelativeAndAbsoluteReferencesManager",function(){return z});class z{constructor(C){this.calcManager=C}s2a(C,H,I){let S,P;S=H;P=I;if(!C||!A.f(C))return{returnValue:C,eCd:S,dCd:P};var D=this.calcManager.AYe(C);if(!D)return b.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),
{returnValue:null,eCd:S,dCd:P};D=this.V6h(D,C,H,I);let G=0,E="",O=0,N=0;for(;N<D.length;N++)if(this.qPe(D[N],H,I)){G=D[N].aec();S=D[N].start;break}for(;N<D.length&&this.qPe(D[N],H,I);N++)E+=C.substring(O,D[N].start),E=D[N].BVg(G,E),O=D[N].end;O&&(P=E.length);E+=C.substring(O,C.length);return{returnValue:E,eCd:S,dCd:P}}V6h(C,H,I,S){const P=[];for(let O=0;O<C.length;O++){var D=C[O];if(D.kind===y.a.range)if(D=D.ref,D.type===v.a.cell){var G=D;D=Object(c.a)(new k,{start:D.span.start,end:D.span.end,Cr:[Object(c.a)(new f,
{column:G.col,row:G.row})],qkc:this.calcManager.p4b(D.span.end,H)});P.push(D)}else if(D.type===v.a.range)this.rPe(D.topLeftSpan,I,S)&&this.rPe(D.bottomRightSpan,I,S)?(G=new x,D.top.index<=D.bottom.index?(G.top=D.top,G.bottom=D.bottom):(G.bottom=D.top,G.top=D.bottom),D.left.index<=D.right.index?(G.left=D.left,G.right=D.right):(G.right=D.left,G.left=D.right),D=Object(c.a)(new m,{start:D.topLeftSpan.start,end:D.bottomRightSpan.end,Cr:[G]}),P.push(D)):(G=Object(c.a)(new k,{start:D.topLeftSpan.start,end:D.topLeftSpan.end,
Cr:[Object(c.a)(new f,{column:D.left,row:D.top})],qkc:this.calcManager.p4b(D.topLeftSpan.end,H)}),D=Object(c.a)(new k,{start:D.bottomRightSpan.start,end:D.bottomRightSpan.end,Cr:[Object(c.a)(new f,{column:D.right,row:D.bottom})],qkc:this.calcManager.p4b(D.topLeftSpan.end,H)}),P.push(G),P.push(D));else if(D.type===v.a.column){G=D;for(D=Object(c.a)(new n,{start:D.span.start,end:D.span.end,Cr:[Object(c.a)(new w,{firstColumn:G.startIndex,secondColumn:G.endIndex})]});D.end<H.length-1&&":"===H.charAt(D.end)&&
O<C.length-1;)if(G=C[O+1].ref,G.type===v.a.column&&G.span.start===D.end+1){var E=G;D.Cr.push(Object(c.a)(new w,{firstColumn:E.startIndex,secondColumn:E.endIndex}));D.end=G.span.end;O++}else break;P.push(D)}else if(D.type===v.a.row){G=D;for(D=Object(c.a)(new t,{start:D.span.start,end:D.span.end,Cr:[Object(c.a)(new u,{firstRow:G.startIndex,secondRow:G.endIndex})]});D.end<H.length-1&&":"===H.charAt(D.end)&&O<C.length-1;)if(G=C[O+1].ref,G.type===v.a.row&&G.span.start===D.end+1)E=G,D.Cr.push(Object(c.a)(new u,
{firstRow:E.startIndex,secondRow:E.endIndex})),D.end=G.span.end,O++;else break;P.push(D)}}return P}qPe(C,H,I){return!(C.start>I||H>C.end)}rPe(C,H,I){return!(C.start>I||H>C.end)}static myf(C,H){return C.index<=H.index?C:H}static Pzf(C,H){return H||C?H&&C?2:!H&&C?3:0:1}}Object(r.a)(z,"RelativeAndAbsoluteReferencesManager",null,[369])},961:function(r,B,a){a.r(B);r=a(0);var c=a(15),b=a(274),e;(function(t){t[t.paren=0]="paren";t[t.lead=1]="lead";t[t.intern=2]="intern";t[t.trail=3]="trail";t[t.undefined=
4]="undefined"})(e||(e={}));Object(r.b)("CurrencyFormatOption",e);var f;(function(t){t[t.none=-1]="none";t[t.mdy=0]="mdy";t[t.dmy=1]="dmy";t[t.ymd=2]="ymd";t[t.myd=3]="myd";t[t.dym=4]="dym";t[t.ydm=5]="ydm"})(f||(f={}));Object(r.b)("DateOrderOption",f);var d=a(8);class h{constructor(t,y){({CalcHelper:t}=a(961));y&&(y.Re||c.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));this.kDg=t.bKe(y,t.MJe(y.Rja));this.lDg=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}get localeInfo(){return this.lDg}get localeData(){return this.kDg}formatNumber(t){return this.localeInfo.formatNumber(t)}}
Object(r.a)(h,"LocaleHolder",null,[]);var l=a(1010),k=a(52),w=a(1),n=a(22),x=a(14),m=a(179);a.d(B,"CalcHelper",function(){return u});class u{constructor(t){this.$=t;(this.gy=this.$.da.Ba(268))||c.ULS.shipAssertTag(537170070,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");let y;y=w.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?k.a.current.Un(76):k.a.current.Un(79);this.logger=new l.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",
this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.uca=new h(t,this.gy);excelOnlineCalc.config.initCalc(this.logger,this.gy?v=>this.gy.isFeatureEnabled(v):()=>!1,y);this.tfa=excelOnlineCalc.config.calcConfig(this.uca.localeInfo)}get config(){return this.tfa}$lh(){if(w.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.ua)return c.ULS.shipAssertTag(537170069,0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;const t=this.$.ua.na;
return t?t.index:(c.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.ua.na.index}createParser(){const t={};t.config=this.config;return excelOnlineCalc.parse.createParser(t)}createNumberFormatter(){const t=excelOnlineCalc.numfmt.createFormatGlobals(this.config,(y,v)=>excelOnlineCalc.calc.getTime(this.config,y,v,"Estimation"));return excelOnlineCalc.numfmt.createNumberFormatter(t)}mkh(t,y,v,A){if(!A)return{range:{row:y,col:v},sheet:{document:this.documentLoc,
index:t}};y=excelOnlineCalc.location.gridCell(y,v);t=excelOnlineCalc.location.sheetIndex(this.documentLoc,t);return excelOnlineCalc.location.sheetGridCell(t,y)}oxh(t,y){let v;v=excelOnlineCalc.calc.getEvalResultKind(t);switch(v){case 4:return{returnValue:t?this.uca.localeInfo.trueName:this.uca.localeInfo.falseName,kind:v};case 1:return{returnValue:w.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.UDc(this.uca.formatNumber(t),y):this.uca.formatNumber(t),
kind:v};case 2:return{returnValue:w.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.UDc(t.toString(),y):t.toString(),kind:v};case 128:return{returnValue:"",kind:v};case 8:switch(t.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.uca.localeInfo.errorNames[t.type],kind:v};default:return{returnValue:u.unknownError,kind:v}}case 32:return{returnValue:w.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.UDc(this.Ckh(t,y),y):"##UNSUPPORTED: ARRAY",kind:v};default:return{returnValue:x.a.instance.ga(2220),kind:v}}}UDc(t,y){return t.length<=y?t:t.substring(0,y-3)+"..."}Ckh(t,y){let v=this.uca.localeInfo.leftBrace;for(let A=0;A<t.rows;++A){for(let z=0;z<t.cols;++z)v+=t.opers[A][z],z<t.cols-1&&(v+=this.uca.localeInfo.columnSeparator);A<t.rows-1&&(v+=this.uca.localeInfo.rowSeparator)}return this.UDc(v,y-1)+this.uca.localeInfo.rightBrace}static bKe(t,y=null){const v=u.V6b(),A=t.Re.TrueValueString,z=
t.Re.FalseValueString,C=t.Re.DecimalSeparator.toString(),H=t.Re.ListSeparator.toString(),I=t.Re.ColumnSeparator.toString(),S=t.Re.RowSeparator.toString(),P=t.Re.ThousandsDataArray,D=t.Re.ThousandSeparator.toString(),G=t.Re.Lcid,E=t.Re.Country,O=t.Re.DigitsNumber,N=t.Re.ExpSeparatedBySpace,J=t.Re.FractionSeparator.toString(),W=t.Re.PercentSeparatedBySpace,ea=n.a.n5g(Enum.toString(e,t.Re.CurrencyFormat)),R=t.Re.CurrencySymbolLead,Y=t.Re.CurrencySeparatedBySpace,U=t.Re.CurrencySymbolString,da=t.Re.DigitsCurrency,
T=-1===t.Re.DateOrder?"MDY":m.e(Enum.toString(f,t.Re.DateOrder)),ka=t.Re.DateSeparator.toString(),L=t.Re.DateAlternativeSeparator.toString(),fa=t.Re.Year4Digits,wa=t.Re.Month2Digits,oa=t.Re.Day2Digits,xa=t.Re.LongDateFormat,bb=t.Re.TimeSeparator.toString(),Za=t.Re.TimeAltSeparator,La=t.Re.Hour2Digits,va=t.Re.Use24HourClock,Ba=t.Re.AmPmSeparatedBySpace,Ea=[t.Re.AmString,t.Re.PmString],pa=t.Re.DayNameShortArray,$a=t.Re.DayNameLongArray,cb=t.Re.MonthNameShortArray,ib=t.Re.MonthNameLongArray,ta=t.Re.PictureSpecialArray,
Ya=b.a.map(("\x00"+t.Re.PictureSingleString).split(""),Eb=>"\x00"===Eb?null:Eb),Da=t.Re.PictureColorArray,ba=t.Re.PictureDbnumArray,ya=t.Re.RowLetter.toString(),V=t.Re.ColumnLetter.toString(),Z=t.Re.LeftBrace.toString(),ja=t.Re.RightBrace.toString(),la=t.Re.LeftBracket.toString(),ua=t.Re.RightBracket.toString(),eb=u.Q7h(t.Re);return excelOnlineCalc.calc.localeData(y,v,A,z,ya,V,Z,ja,la,ua,C,H,I,S,P,D,G,E,O,N,J,W,ea,R,Y,U,da,T,ka,L,fa,wa,oa,xa,bb,Za,La,va,Ba,Ea,pa,$a,cb,ib,ta,Ya,Da,ba,eb,t.Re.SysDateFormatString,
t.Re.SysTimeFormatString)}static MJe(t){const y=[];if(!t)return y;for(const v of t)t=null,v.IsDynamicUdf||(t=excelOnlineCalc.calc.worksheetFunctionName(v.FunctionIndexInServer,v.NameUI)),t&&y.push(t);return y}static V6b(){const t=[],y=Object.keys(d.a.errorNames);for(let v=0;v<y.length;v++){const A=excelOnlineCalc.calc.errorTypeName(v+1,y[v]);A&&t.push(A)}return t}static Q7h(t){const y=Array(6);y[1]="#"+t.AllStructRefString;y[3]="#"+t.HeadersStructRefString;y[2]="#"+t.DataStructRefString;y[4]="#"+
t.TotalsStructRefString;y[5]="#"+t.ThisRowStructRefString;return y}}u.unknownError="##ERR##";Object(r.a)(u,"CalcHelper",null,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.calc.js.map/4c81f5975238bb4b07298c990d77ebc7/EwaDSEsNext.calc.js.map